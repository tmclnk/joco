{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/__tests__/profilerContext-test.js          | 284 +++++++++++++++++++++\n .../src/devtools/views/Profiler/Profiler.js        |  22 +-\n .../src/devtools/views/Profiler/ProfilerContext.js | 105 ++++++--\n .../devtools/views/Profiler/SnapshotSelector.js    |  78 +-----\n .../Profiler/useCommitFilteringAndNavigation.js    | 199 +++++++++++++++\n 5 files changed, 595 insertions(+), 93 deletions(-)\n\ndiff --git a/packages/react-devtools-shared/src/__tests__/profilerContext-test.js b/packages/react-devtools-shared/src/__tests__/profilerContext-test.js\nindex 2cd2340..7864f97 100644\n--- a/packages/react-devtools-shared/src/__tests__/profilerContext-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/profilerContext-test.js\n@@ -655,4 +655,288 @@ describe('ProfilerContext', () => {\n \n     document.body.removeChild(profilerContainer);\n   });\n+\n+  it('should navigate between commits when the keyboard shortcut is pressed', async () => {\n+    const Parent = () => <Child />;\n+    const Child = () => null;\n+\n+    const container = document.createElement('div');\n+    const root = ReactDOMClient.createRoot(container);\n+    utils.act(() => root.render(<Parent />));\n+\n+    // Profile and record multiple commits\n+    await utils.actAsync(() => store.profilerStore.startProfiling());\n+    await utils.actAsync(() => root.render(<Parent />)); // Commit 1\n+    await utils.actAsync(() => root.render(<Parent />)); // Commit 2\n+    await utils.actAsync(() => root.render(<Parent />)); // Commit 3\n+    await utils.actAsync(() => store.profilerStore.stopProfiling());\n+\n+    const Profiler =\n+      require('react-devtools-shared/src/devtools/views/Profiler/Profiler').default;\n+    const {\n+      TimelineContextController,\n+    } = require('react-devtools-timeline/src/TimelineContext');\n+    const {\n+      SettingsContextController,\n+    } = require('react-devtools-shared/src/devtools/views/Settings/SettingsContext');\n+    const {\n+      ModalDialogContextController,\n+    } = require('react-devtools-shared/src/devtools/views/ModalDialog');\n+\n+    let context: Context = ((null: any): Context);\n+    function ContextReader() {\n+      context = React.useContext(ProfilerContext);\n+      return null;\n+    }\n+\n+    const profilerContainer = document.createElement('div');\n+    document.body.appendChild(profilerContainer);\n+\n+    const profilerRoot = ReactDOMClient.createRoot(profilerContainer);\n+\n+    await utils.actAsync(() => {\n+      profilerRoot.render(\n+        <Contexts>\n+          <SettingsContextController browserTheme=\"light\">\n+            <ModalDialogContextController>\n+              <TimelineContextController>\n+                <Profiler />\n+                <ContextReader />\n+              </TimelineContextController>\n+            </ModalDialogContextController>\n+          </SettingsContextController>\n+        </Contexts>,\n+      );\n+    });\n+\n+    // Verify we have profiling data with 3 commits\n+    expect(context.didRecordCommits).toBe(true);\n+    expect(context.profilingData).not.toBeNull();\n+    const rootID = context.rootID;\n+    expect(rootID).not.toBeNull();\n+    const dataForRoot = context.profilingData.dataForRoots.get(rootID);\n+    expect(dataForRoot.commitData.length).toBe(3);\n+    // Should start at the first commit\n+    expect(context.selectedCommitIndex).toBe(0);\n+\n+    const ownerWindow = profilerContainer.ownerDocument.defaultView;\n+    const isMac =\n+      typeof navigator !== 'undefined' &&\n+      navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n+\n+    // Test ArrowRight navigation (forward) with correct modifier\n+    const arrowRightEvent = new KeyboardEvent('keydown', {\n+      key: 'ArrowRight',\n+      metaKey: isMac,\n+      ctrlKey: !isMac,\n+      bubbles: true,\n+    });\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowRightEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(1);\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowRightEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(2);\n+\n+    // Test wrap-around (last -> first)\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowRightEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(0);\n+\n+    // Test ArrowLeft navigation (backward) with correct modifier\n+    const arrowLeftEvent = new KeyboardEvent('keydown', {\n+      key: 'ArrowLeft',\n+      metaKey: isMac,\n+      ctrlKey: !isMac,\n+      bubbles: true,\n+    });\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowLeftEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(2);\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowLeftEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(1);\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowLeftEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(0);\n+\n+    // Cleanup\n+    await utils.actAsync(() => profilerRoot.unmount());\n+    document.body.removeChild(profilerContainer);\n+  });\n+\n+  it('should handle commit selection edge cases when filtering commits', async () => {\n+    const Scheduler = require('scheduler');\n+\n+    // Create components that do varying amounts of work to generate different commit durations\n+    const Parent = ({count}) => {\n+      Scheduler.unstable_advanceTime(10);\n+      const items = [];\n+      for (let i = 0; i < count; i++) {\n+        items.push(<Child key={i} duration={i} />);\n+      }\n+      return <div>{items}</div>;\n+    };\n+    const Child = ({duration}) => {\n+      Scheduler.unstable_advanceTime(duration);\n+      return <span>{duration}</span>;\n+    };\n+\n+    const container = document.createElement('div');\n+    const root = ReactDOMClient.createRoot(container);\n+    utils.act(() => root.render(<Parent count={1} />));\n+\n+    // Profile and record multiple commits with different amounts of work\n+    await utils.actAsync(() => store.profilerStore.startProfiling());\n+    await utils.actAsync(() => root.render(<Parent count={5} />)); // Commit 1 - 20ms\n+    await utils.actAsync(() => root.render(<Parent count={20} />)); // Commit 2 - 200ms\n+    await utils.actAsync(() => root.render(<Parent count={50} />)); // Commit 3 - 1235ms\n+    await utils.actAsync(() => root.render(<Parent count={10} />)); // Commit 4 - 55ms\n+    await utils.actAsync(() => store.profilerStore.stopProfiling());\n+\n+    // Context providers\n+    const Profiler =\n+      require('react-devtools-shared/src/devtools/views/Profiler/Profiler').default;\n+    const {\n+      TimelineContextController,\n+    } = require('react-devtools-timeline/src/TimelineContext');\n+    const {\n+      SettingsContextController,\n+    } = require('react-devtools-shared/src/devtools/views/Settings/SettingsContext');\n+    const {\n+      ModalDialogContextController,\n+    } = require('react-devtools-shared/src/devtools/views/ModalDialog');\n+\n+    let context: Context = ((null: any): Context);\n+    function ContextReader() {\n+      context = React.useContext(ProfilerContext);\n+      return null;\n+    }\n+\n+    const profilerContainer = document.createElement('div');\n+    document.body.appendChild(profilerContainer);\n+\n+    const profilerRoot = ReactDOMClient.createRoot(profilerContainer);\n+\n+    await utils.actAsync(() => {\n+      profilerRoot.render(\n+        <Contexts>\n+          <SettingsContextController browserTheme=\"light\">\n+            <ModalDialogContextController>\n+              <TimelineContextController>\n+                <Profiler />\n+                <ContextReader />\n+              </TimelineContextController>\n+            </ModalDialogContextController>\n+          </SettingsContextController>\n+        </Contexts>,\n+      );\n+    });\n+\n+    // Verify we have profiling data with 4 commits\n+    expect(context.didRecordCommits).toBe(true);\n+    expect(context.profilingData).not.toBeNull();\n+    const rootID = context.rootID;\n+    expect(rootID).not.toBeNull();\n+    const dataForRoot = context.profilingData.dataForRoots.get(rootID);\n+    expect(dataForRoot.commitData.length).toBe(4);\n+    // Edge case 1: Should start at the first commit\n+    expect(context.selectedCommitIndex).toBe(0);\n+\n+    const ownerWindow = profilerContainer.ownerDocument.defaultView;\n+    const isMac =\n+      typeof navigator !== 'undefined' &&\n+      navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n+\n+    const arrowRightEvent = new KeyboardEvent('keydown', {\n+      key: 'ArrowRight',\n+      metaKey: isMac,\n+      ctrlKey: !isMac,\n+      bubbles: true,\n+    });\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowRightEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(1);\n+\n+    await utils.actAsync(() => {\n+      context.setIsCommitFilterEnabled(true);\n+    });\n+\n+    // Edge case 2:  When filtering is enabled, selected commit should remain if it's still visible\n+    expect(context.filteredCommitIndices.length).toBe(4);\n+    expect(context.selectedCommitIndex).toBe(1);\n+    expect(context.selectedFilteredCommitIndex).toBe(1);\n+\n+    await utils.actAsync(() => {\n+      context.setMinCommitDuration(1000000);\n+    });\n+\n+    // Edge case 3: When all commits are filtered out, selection should be null\n+    expect(context.filteredCommitIndices).toEqual([]);\n+    expect(context.selectedCommitIndex).toBe(null);\n+    expect(context.selectedFilteredCommitIndex).toBe(null);\n+\n+    await utils.actAsync(() => {\n+      context.setMinCommitDuration(0);\n+    });\n+\n+    // Edge case 4: After restoring commits, first commit should be auto-selected\n+    expect(context.filteredCommitIndices.length).toBe(4);\n+    expect(context.selectedCommitIndex).toBe(0);\n+    expect(context.selectedFilteredCommitIndex).toBe(0);\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowRightEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(1);\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowRightEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(2);\n+\n+    await utils.actAsync(() => {\n+      ownerWindow.dispatchEvent(arrowRightEvent);\n+    }, false);\n+    expect(context.selectedCommitIndex).toBe(3);\n+\n+    // Filter out the currently selected commit using actual commit data\n+    const commitDurations = dataForRoot.commitData.map(\n+      commit => commit.duration,\n+    );\n+    const selectedCommitDuration = commitDurations[3];\n+    const filterThreshold = selectedCommitDuration + 0.001;\n+    await utils.actAsync(() => {\n+      context.setMinCommitDuration(filterThreshold);\n+    });\n+\n+    // Edge case 5: Should auto-select first available commit when current one is filtered\n+    expect(context.selectedCommitIndex).not.toBe(null);\n+    expect(context.selectedFilteredCommitIndex).toBe(1);\n+\n+    await utils.actAsync(() => {\n+      context.setIsCommitFilterEnabled(false);\n+    });\n+\n+    // Edge case 6: When filtering is disabled, selected commit should remain\n+    expect(context.filteredCommitIndices.length).toBe(4);\n+    expect(context.selectedCommitIndex).toBe(2);\n+    expect(context.selectedFilteredCommitIndex).toBe(2);\n+\n+    await utils.actAsync(() => profilerRoot.unmount());\n+    document.body.removeChild(profilerContainer);\n+  });\n });\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Profiler/Profiler.js b/packages/react-devtools-shared/src/devtools/views/Profiler/Profiler.js\nindex 5e33063..6254be0 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Profiler/Profiler.js\n+++ b/packages/react-devtools-shared/src/devtools/views/Profiler/Profiler.js\n@@ -54,6 +54,8 @@ function Profiler(_: {}) {\n     supportsProfiling,\n     startProfiling,\n     stopProfiling,\n+    selectPrevCommitIndex,\n+    selectNextCommitIndex,\n   } = useContext(ProfilerContext);\n \n   const {file: timelineTraceEventData, searchInputContainerRef} =\n@@ -63,9 +65,9 @@ function Profiler(_: {}) {\n \n   const isLegacyProfilerSelected = selectedTabID !== 'timeline';\n \n-  // Cmd+E to start/stop profiler recording\n   const handleKeyDown = useEffectEvent((event: KeyboardEvent) => {\n     const correctModifier = isMac ? event.metaKey : event.ctrlKey;\n+    // Cmd+E to start/stop profiler recording\n     if (correctModifier && event.key === 'e') {\n       if (isProfiling) {\n         stopProfiling();\n@@ -74,6 +76,24 @@ function Profiler(_: {}) {\n       }\n       event.preventDefault();\n       event.stopPropagation();\n+    } else if (\n+      isLegacyProfilerSelected &&\n+      didRecordCommits &&\n+      selectedCommitIndex !== null\n+    ) {\n+      // Cmd+Left/Right (Mac) or Ctrl+Left/Right (Windows/Linux) to navigate commits\n+      if (\n+        correctModifier &&\n+        (event.key === 'ArrowLeft' || event.key === 'ArrowRight')\n+      ) {\n+        if (event.key === 'ArrowLeft') {\n+          selectPrevCommitIndex();\n+        } else {\n+          selectNextCommitIndex();\n+        }\n+        event.preventDefault();\n+        event.stopPropagation();\n+      }\n     }\n   });\n \ndiff --git a/packages/react-devtools-shared/src/devtools/views/Profiler/ProfilerContext.js b/packages/react-devtools-shared/src/devtools/views/Profiler/ProfilerContext.js\nindex a9225c3..d593558 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Profiler/ProfilerContext.js\n+++ b/packages/react-devtools-shared/src/devtools/views/Profiler/ProfilerContext.js\n@@ -10,7 +10,14 @@\n import type {ReactContext} from 'shared/ReactTypes';\n \n import * as React from 'react';\n-import {createContext, useCallback, useContext, useMemo, useState} from 'react';\n+import {\n+  createContext,\n+  useCallback,\n+  useContext,\n+  useMemo,\n+  useState,\n+  useEffect,\n+} from 'react';\n import {useLocalStorage, useSubscription} from '../hooks';\n import {\n   TreeDispatcherContext,\n@@ -18,8 +25,9 @@ import {\n } from '../Components/TreeContext';\n import {StoreContext} from '../context';\n import {logEvent} from 'react-devtools-shared/src/Logger';\n+import {useCommitFilteringAndNavigation} from './useCommitFilteringAndNavigation';\n \n-import type {ProfilingDataFrontend} from './types';\n+import type {CommitDataFrontend, ProfilingDataFrontend} from './types';\n \n export type TabID = 'flame-chart' | 'ranked-chart' | 'timeline';\n \n@@ -61,6 +69,12 @@ export type Context = {\n   // It impacts the flame graph and ranked charts.\n   selectedCommitIndex: number | null,\n   selectCommitIndex: (value: number | null) => void,\n+  selectNextCommitIndex(): void,\n+  selectPrevCommitIndex(): void,\n+\n+  // Which commits are currently filtered by duration?\n+  filteredCommitIndices: Array<number>,\n+  selectedFilteredCommitIndex: number | null,\n \n   // Which fiber is currently selected in the Ranked or Flamegraph charts?\n   selectedFiberID: number | null,\n@@ -164,6 +178,7 @@ function ProfilerContextController({children}: Props): React.Node {\n     [setRootID, selectFiber],\n   );\n \n+  // Sync rootID with profilingData changes.\n   if (prevProfilingData !== profilingData) {\n     setPrevProfilingData(profilingData);\n \n@@ -189,16 +204,6 @@ function ProfilerContextController({children}: Props): React.Node {\n     }\n   }\n \n-  const [isCommitFilterEnabled, setIsCommitFilterEnabled] =\n-    useLocalStorage<boolean>('React::DevTools::isCommitFilterEnabled', false);\n-  const [minCommitDuration, setMinCommitDuration] = useLocalStorage<number>(\n-    'minCommitDuration',\n-    0,\n-  );\n-\n-  const [selectedCommitIndex, selectCommitIndex] = useState<number | null>(\n-    null,\n-  );\n   const [selectedTabID, selectTab] = useLocalStorage<TabID>(\n     'React::DevTools::Profiler::defaultTab',\n     'flame-chart',\n@@ -212,27 +217,66 @@ function ProfilerContextController({children}: Props): React.Node {\n     },\n   );\n \n-  const startProfiling = useCallback(() => {\n-    logEvent({\n-      event_name: 'profiling-start',\n-      metadata: {current_tab: selectedTabID},\n-    });\n-    store.profilerStore.startProfiling();\n-  }, [store, selectedTabID]);\n   const stopProfiling = useCallback(\n     () => store.profilerStore.stopProfiling(),\n     [store],\n   );\n \n-  if (isProfiling) {\n-    if (selectedCommitIndex !== null) {\n-      selectCommitIndex(null);\n+  // Get commit data for the current root\n+  // NOTE: Unlike profilerStore.getDataForRoot() which uses Suspense (throws when data unavailable),\n+  // this uses subscription pattern and returns [] when data isn't ready.\n+  // Always check didRecordCommits before using commitData or filteredCommitIndices.\n+  const commitData = useMemo(() => {\n+    if (!didRecordCommits || rootID === null || profilingData === null) {\n+      return ([]: Array<CommitDataFrontend>);\n     }\n-    if (selectedFiberID !== null) {\n-      selectFiberID(null);\n-      selectFiberName(null);\n+    const dataForRoot = profilingData.dataForRoots.get(rootID);\n+    return dataForRoot\n+      ? dataForRoot.commitData\n+      : ([]: Array<CommitDataFrontend>);\n+  }, [didRecordCommits, rootID, profilingData]);\n+\n+  // Commit filtering and navigation\n+  const {\n+    isCommitFilterEnabled,\n+    setIsCommitFilterEnabled,\n+    minCommitDuration,\n+    setMinCommitDuration,\n+    selectedCommitIndex,\n+    selectCommitIndex,\n+    filteredCommitIndices,\n+    selectedFilteredCommitIndex,\n+    selectNextCommitIndex,\n+    selectPrevCommitIndex,\n+  } = useCommitFilteringAndNavigation(commitData);\n+\n+  const startProfiling = useCallback(() => {\n+    logEvent({\n+      event_name: 'profiling-start',\n+      metadata: {current_tab: selectedTabID},\n+    });\n+\n+    // Clear selections when starting a new profiling session\n+    selectCommitIndex(null);\n+    selectFiberID(null);\n+    selectFiberName(null);\n+\n+    store.profilerStore.startProfiling();\n+  }, [store, selectedTabID, selectCommitIndex]);\n+\n+  // Auto-select first commit when profiling data becomes available and no commit is selected.\n+  useEffect(() => {\n+    if (\n+      profilingData !== null &&\n+      selectedCommitIndex === null &&\n+      rootID !== null\n+    ) {\n+      const dataForRoot = profilingData.dataForRoots.get(rootID);\n+      if (dataForRoot && dataForRoot.commitData.length > 0) {\n+        selectCommitIndex(0);\n+      }\n     }\n-  }\n+  }, [profilingData, rootID, selectCommitIndex]);\n \n   const value = useMemo(\n     () => ({\n@@ -257,6 +301,10 @@ function ProfilerContextController({children}: Props): React.Node {\n \n       selectedCommitIndex,\n       selectCommitIndex,\n+      selectNextCommitIndex,\n+      selectPrevCommitIndex,\n+      filteredCommitIndices,\n+      selectedFilteredCommitIndex,\n \n       selectedFiberID,\n       selectedFiberName,\n@@ -275,7 +323,6 @@ function ProfilerContextController({children}: Props): React.Node {\n       supportsProfiling,\n \n       rootID,\n-      setRootID,\n       setRootIDAndClearFiber,\n \n       isCommitFilterEnabled,\n@@ -285,6 +332,10 @@ function ProfilerContextController({children}: Props): React.Node {\n \n       selectedCommitIndex,\n       selectCommitIndex,\n+      selectNextCommitIndex,\n+      selectPrevCommitIndex,\n+      filteredCommitIndices,\n+      selectedFilteredCommitIndex,\n \n       selectedFiberID,\n       selectedFiberName,\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Profiler/SnapshotSelector.js b/packages/react-devtools-shared/src/devtools/views/Profiler/SnapshotSelector.js\nindex 088ca03..0d470dd 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Profiler/SnapshotSelector.js\n+++ b/packages/react-devtools-shared/src/devtools/views/Profiler/SnapshotSelector.js\n@@ -8,7 +8,7 @@\n  */\n \n import * as React from 'react';\n-import {Fragment, useContext, useMemo} from 'react';\n+import {Fragment, useContext} from 'react';\n import Button from '../Button';\n import ButtonIcon from '../ButtonIcon';\n import {ProfilerContext} from './ProfilerContext';\n@@ -22,11 +22,13 @@ export type Props = {};\n \n export default function SnapshotSelector(_: Props): React.Node {\n   const {\n-    isCommitFilterEnabled,\n-    minCommitDuration,\n     rootID,\n     selectedCommitIndex,\n     selectCommitIndex,\n+    selectPrevCommitIndex,\n+    selectNextCommitIndex,\n+    filteredCommitIndices,\n+    selectedFilteredCommitIndex,\n   } = useContext(ProfilerContext);\n \n   const {profilerStore} = useContext(StoreContext);\n@@ -43,47 +45,8 @@ export default function SnapshotSelector(_: Props): React.Node {\n     commitTimes.push(commitDatum.timestamp);\n   });\n \n-  const filteredCommitIndices = useMemo(\n-    () =>\n-      commitData.reduce((reduced: $FlowFixMe, commitDatum, index) => {\n-        if (\n-          !isCommitFilterEnabled ||\n-          commitDatum.duration >= minCommitDuration\n-        ) {\n-          reduced.push(index);\n-        }\n-        return reduced;\n-      }, []),\n-    [commitData, isCommitFilterEnabled, minCommitDuration],\n-  );\n-\n   const numFilteredCommits = filteredCommitIndices.length;\n \n-  // Map the (unfiltered) selected commit index to an index within the filtered data.\n-  const selectedFilteredCommitIndex = useMemo(() => {\n-    if (selectedCommitIndex !== null) {\n-      for (let i = 0; i < filteredCommitIndices.length; i++) {\n-        if (filteredCommitIndices[i] === selectedCommitIndex) {\n-          return i;\n-        }\n-      }\n-    }\n-    return null;\n-  }, [filteredCommitIndices, selectedCommitIndex]);\n-\n-  // TODO (ProfilerContext) This should be managed by the context controller (reducer).\n-  // It doesn't currently know about the filtered commits though (since it doesn't suspend).\n-  // Maybe this component should pass filteredCommitIndices up?\n-  if (selectedFilteredCommitIndex === null) {\n-    if (numFilteredCommits > 0) {\n-      selectCommitIndex(0);\n-    } else {\n-      selectCommitIndex(null);\n-    }\n-  } else if (selectedFilteredCommitIndex >= numFilteredCommits) {\n-    selectCommitIndex(numFilteredCommits === 0 ? null : numFilteredCommits - 1);\n-  }\n-\n   let label = null;\n   if (numFilteredCommits > 0) {\n     // $FlowFixMe[missing-local-annot]\n@@ -110,11 +73,11 @@ export default function SnapshotSelector(_: Props): React.Node {\n     const handleKeyDown = event => {\n       switch (event.key) {\n         case 'ArrowDown':\n-          viewPrevCommit();\n+          selectPrevCommitIndex();\n           event.stopPropagation();\n           break;\n         case 'ArrowUp':\n-          viewNextCommit();\n+          selectNextCommitIndex();\n           event.stopPropagation();\n           break;\n         default:\n@@ -147,30 +110,15 @@ export default function SnapshotSelector(_: Props): React.Node {\n     );\n   }\n \n-  const viewNextCommit = () => {\n-    let nextCommitIndex = ((selectedFilteredCommitIndex: any): number) + 1;\n-    if (nextCommitIndex === filteredCommitIndices.length) {\n-      nextCommitIndex = 0;\n-    }\n-    selectCommitIndex(filteredCommitIndices[nextCommitIndex]);\n-  };\n-  const viewPrevCommit = () => {\n-    let nextCommitIndex = ((selectedFilteredCommitIndex: any): number) - 1;\n-    if (nextCommitIndex < 0) {\n-      nextCommitIndex = filteredCommitIndices.length - 1;\n-    }\n-    selectCommitIndex(filteredCommitIndices[nextCommitIndex]);\n-  };\n-\n   // $FlowFixMe[missing-local-annot]\n   const handleKeyDown = event => {\n     switch (event.key) {\n       case 'ArrowLeft':\n-        viewPrevCommit();\n+        selectPrevCommitIndex();\n         event.stopPropagation();\n         break;\n       case 'ArrowRight':\n-        viewNextCommit();\n+        selectNextCommitIndex();\n         event.stopPropagation();\n         break;\n       default:\n@@ -193,8 +141,8 @@ export default function SnapshotSelector(_: Props): React.Node {\n         className={styles.Button}\n         data-testname=\"SnapshotSelector-PreviousButton\"\n         disabled={numFilteredCommits === 0}\n-        onClick={viewPrevCommit}\n-        title=\"Select previous commit\">\n+        onClick={selectPrevCommitIndex}\n+        title=\"Select previous commit \u2190\">\n         <ButtonIcon type=\"previous\" />\n       </Button>\n       <div\n@@ -227,8 +175,8 @@ export default function SnapshotSelector(_: Props): React.Node {\n         className={styles.Button}\n         data-testname=\"SnapshotSelector-NextButton\"\n         disabled={numFilteredCommits === 0}\n-        onClick={viewNextCommit}\n-        title=\"Select next commit\">\n+        onClick={selectNextCommitIndex}\n+        title=\"Select next commit \u2192\">\n         <ButtonIcon type=\"next\" />\n       </Button>\n     </Fragment>\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Profiler/useCommitFilteringAndNavigation.js b/packages/react-devtools-shared/src/devtools/views/Profiler/useCommitFilteringAndNavigation.js\nnew file mode 100644\nindex 0000000..e309e6a\n--- /dev/null\n+++ b/packages/react-devtools-shared/src/devtools/views/Profiler/useCommitFilteringAndNavigation.js\n@@ -0,0 +1,199 @@\n+/**\n+ * Copyright (c) Meta Platforms, Inc. and affiliates.\n+ *\n+ * This source code is licensed under the MIT license found in the\n+ * LICENSE file in the root directory of this source tree.\n+ *\n+ * @flow\n+ */\n+\n+import {useCallback, useMemo, useState} from 'react';\n+import {useLocalStorage} from '../hooks';\n+\n+import type {CommitDataFrontend} from './types';\n+\n+export type CommitFilteringAndNavigation = {\n+  isCommitFilterEnabled: boolean,\n+  setIsCommitFilterEnabled: (value: boolean) => void,\n+  minCommitDuration: number,\n+  setMinCommitDuration: (value: number) => void,\n+\n+  // Selection state\n+  selectedCommitIndex: number | null,\n+  selectCommitIndex: (value: number | null) => void,\n+\n+  // Filtered data\n+  filteredCommitIndices: Array<number>,\n+  selectedFilteredCommitIndex: number | null,\n+\n+  // Navigation\n+  selectNextCommitIndex: () => void,\n+  selectPrevCommitIndex: () => void,\n+};\n+\n+export function useCommitFilteringAndNavigation(\n+  commitData: Array<CommitDataFrontend>,\n+): CommitFilteringAndNavigation {\n+  // Filter settings persisted to localStorage\n+  const [isCommitFilterEnabled, setIsCommitFilterEnabledValue] =\n+    useLocalStorage<boolean>('React::DevTools::isCommitFilterEnabled', false);\n+  const [minCommitDuration, setMinCommitDurationValue] =\n+    useLocalStorage<number>('minCommitDuration', 0);\n+\n+  // Currently selected commit index (in the unfiltered list)\n+  const [selectedCommitIndex, selectCommitIndex] = useState<number | null>(\n+    null,\n+  );\n+\n+  const calculateFilteredIndices = useCallback(\n+    (enabled: boolean, minDuration: number): Array<number> => {\n+      return commitData.reduce((reduced: Array<number>, commitDatum, index) => {\n+        if (!enabled || commitDatum.duration >= minDuration) {\n+          reduced.push(index);\n+        }\n+        return reduced;\n+      }, ([]: Array<number>));\n+    },\n+    [commitData],\n+  );\n+\n+  const findFilteredIndex = useCallback(\n+    (commitIndex: number | null, filtered: Array<number>): number | null => {\n+      if (commitIndex === null) return null;\n+      for (let i = 0; i < filtered.length; i++) {\n+        if (filtered[i] === commitIndex) {\n+          return i;\n+        }\n+      }\n+      return null;\n+    },\n+    [],\n+  );\n+\n+  // Adjust selection when filter settings change to keep a valid selection\n+  const adjustSelectionAfterFilterChange = useCallback(\n+    (newFilteredIndices: Array<number>) => {\n+      const currentSelectedIndex = selectedCommitIndex;\n+      const selectedFilteredIndex = findFilteredIndex(\n+        currentSelectedIndex,\n+        newFilteredIndices,\n+      );\n+\n+      if (newFilteredIndices.length === 0) {\n+        // No commits pass the filter - clear selection\n+        selectCommitIndex(null);\n+      } else if (currentSelectedIndex === null) {\n+        // No commit was selected - select first available\n+        selectCommitIndex(newFilteredIndices[0]);\n+      } else if (selectedFilteredIndex === null) {\n+        // Currently selected commit was filtered out - find closest commit before it\n+        let closestBefore = null;\n+        for (let i = newFilteredIndices.length - 1; i >= 0; i--) {\n+          if (newFilteredIndices[i] < currentSelectedIndex) {\n+            closestBefore = newFilteredIndices[i];\n+            break;\n+          }\n+        }\n+        // If no commit before it, use the first available\n+        selectCommitIndex(\n+          closestBefore !== null ? closestBefore : newFilteredIndices[0],\n+        );\n+      } else if (selectedFilteredIndex >= newFilteredIndices.length) {\n+        // Filtered position is out of bounds - clamp to last available\n+        selectCommitIndex(newFilteredIndices[newFilteredIndices.length - 1]);\n+      }\n+      // Otherwise, the current selection is still valid in the filtered list, keep it\n+    },\n+    [findFilteredIndex, selectedCommitIndex, selectCommitIndex],\n+  );\n+\n+  const filteredCommitIndices = useMemo(\n+    () => calculateFilteredIndices(isCommitFilterEnabled, minCommitDuration),\n+    [calculateFilteredIndices, isCommitFilterEnabled, minCommitDuration],\n+  );\n+\n+  const selectedFilteredCommitIndex = useMemo(\n+    () => findFilteredIndex(selectedCommitIndex, filteredCommitIndices),\n+    [findFilteredIndex, selectedCommitIndex, filteredCommitIndices],\n+  );\n+\n+  const selectNextCommitIndex = useCallback(() => {\n+    if (\n+      selectedFilteredCommitIndex === null ||\n+      filteredCommitIndices.length === 0\n+    ) {\n+      return;\n+    }\n+    let nextCommitIndex = selectedFilteredCommitIndex + 1;\n+    if (nextCommitIndex === filteredCommitIndices.length) {\n+      nextCommitIndex = 0;\n+    }\n+    selectCommitIndex(filteredCommitIndices[nextCommitIndex]);\n+  }, [selectedFilteredCommitIndex, filteredCommitIndices, selectCommitIndex]);\n+\n+  const selectPrevCommitIndex = useCallback(() => {\n+    if (\n+      selectedFilteredCommitIndex === null ||\n+      filteredCommitIndices.length === 0\n+    ) {\n+      return;\n+    }\n+    let prevCommitIndex = selectedFilteredCommitIndex - 1;\n+    if (prevCommitIndex < 0) {\n+      prevCommitIndex = filteredCommitIndices.length - 1;\n+    }\n+    selectCommitIndex(filteredCommitIndices[prevCommitIndex]);\n+  }, [selectedFilteredCommitIndex, filteredCommitIndices, selectCommitIndex]);\n+\n+  // Setters that also adjust selection when filter changes\n+  const setIsCommitFilterEnabled = useCallback(\n+    (value: boolean) => {\n+      setIsCommitFilterEnabledValue(value);\n+\n+      const newFilteredIndices = calculateFilteredIndices(\n+        value,\n+        minCommitDuration,\n+      );\n+\n+      adjustSelectionAfterFilterChange(newFilteredIndices);\n+    },\n+    [\n+      setIsCommitFilterEnabledValue,\n+      calculateFilteredIndices,\n+      minCommitDuration,\n+      adjustSelectionAfterFilterChange,\n+    ],\n+  );\n+\n+  const setMinCommitDuration = useCallback(\n+    (value: number) => {\n+      setMinCommitDurationValue(value);\n+\n+      const newFilteredIndices = calculateFilteredIndices(\n+        isCommitFilterEnabled,\n+        value,\n+      );\n+\n+      adjustSelectionAfterFilterChange(newFilteredIndices);\n+    },\n+    [\n+      setMinCommitDurationValue,\n+      calculateFilteredIndices,\n+      isCommitFilterEnabled,\n+      adjustSelectionAfterFilterChange,\n+    ],\n+  );\n+\n+  return {\n+    isCommitFilterEnabled,\n+    setIsCommitFilterEnabled,\n+    minCommitDuration,\n+    setMinCommitDuration,\n+    selectedCommitIndex,\n+    selectCommitIndex,\n+    filteredCommitIndices,\n+    selectedFilteredCommitIndex,\n+    selectNextCommitIndex,\n+    selectPrevCommitIndex,\n+  };\n+}"}, {"role": "assistant", "content": "refactor(profiler): extract commit filtering and navigation into hook"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_attr_parsing/src/attributes/cfg.rs | 1 -\n compiler/rustc_attr_parsing/src/attributes/doc.rs | 6 ------\n compiler/rustc_attr_parsing/src/parser.rs         | 8 +++-----\n 3 files changed, 3 insertions(+), 12 deletions(-)\n\ndiff --git a/compiler/rustc_attr_parsing/src/attributes/cfg.rs b/compiler/rustc_attr_parsing/src/attributes/cfg.rs\nindex ccf0a394afd..dcb74dda81a 100644\n--- a/compiler/rustc_attr_parsing/src/attributes/cfg.rs\n+++ b/compiler/rustc_attr_parsing/src/attributes/cfg.rs\n@@ -94,7 +94,6 @@ pub fn parse_cfg_entry<S: Stage>(\n             LitKind::Bool(b) => CfgEntry::Bool(b, lit.span),\n             _ => return Err(cx.expected_identifier(lit.span)),\n         },\n-        MetaItemOrLitParser::Err(_, err) => return Err(*err),\n     })\n }\n \ndiff --git a/compiler/rustc_attr_parsing/src/attributes/doc.rs b/compiler/rustc_attr_parsing/src/attributes/doc.rs\nindex 6cc4ac35ead..409102a79c0 100644\n--- a/compiler/rustc_attr_parsing/src/attributes/doc.rs\n+++ b/compiler/rustc_attr_parsing/src/attributes/doc.rs\n@@ -514,9 +514,6 @@ macro_rules! string_arg_and_crate_level {\n                         MetaItemOrLitParser::Lit(lit) => {\n                             cx.unexpected_literal(lit.span);\n                         }\n-                        MetaItemOrLitParser::Err(..) => {\n-                            // already had an error here, move on.\n-                        }\n                     }\n                 }\n             }\n@@ -600,9 +597,6 @@ fn accept_single_doc_attr<S: Stage>(\n                         MetaItemOrLitParser::Lit(lit) => {\n                             cx.expected_name_value(lit.span, None);\n                         }\n-                        MetaItemOrLitParser::Err(..) => {\n-                            // already had an error here, move on.\n-                        }\n                     }\n                 }\n             }\ndiff --git a/compiler/rustc_attr_parsing/src/parser.rs b/compiler/rustc_attr_parsing/src/parser.rs\nindex 68265649d18..ebf12dd1dfd 100644\n--- a/compiler/rustc_attr_parsing/src/parser.rs\n+++ b/compiler/rustc_attr_parsing/src/parser.rs\n@@ -18,7 +18,7 @@\n use rustc_parse::parser::{ForceCollect, Parser, PathStyle, token_descr};\n use rustc_session::errors::{create_lit_error, report_lit_error};\n use rustc_session::parse::ParseSess;\n-use rustc_span::{ErrorGuaranteed, Ident, Span, Symbol, sym};\n+use rustc_span::{Ident, Span, Symbol, sym};\n use thin_vec::ThinVec;\n \n use crate::ShouldEmit;\n@@ -192,7 +192,6 @@ pub fn no_args(&self) -> Result<(), Span> {\n pub enum MetaItemOrLitParser {\n     MetaItemParser(MetaItemParser),\n     Lit(MetaItemLit),\n-    Err(Span, ErrorGuaranteed),\n }\n \n impl MetaItemOrLitParser {\n@@ -210,21 +209,20 @@ pub fn span(&self) -> Span {\n                 generic_meta_item_parser.span()\n             }\n             MetaItemOrLitParser::Lit(meta_item_lit) => meta_item_lit.span,\n-            MetaItemOrLitParser::Err(span, _) => *span,\n         }\n     }\n \n     pub fn lit(&self) -> Option<&MetaItemLit> {\n         match self {\n             MetaItemOrLitParser::Lit(meta_item_lit) => Some(meta_item_lit),\n-            _ => None,\n+            MetaItemOrLitParser::MetaItemParser(_) => None,\n         }\n     }\n \n     pub fn meta_item(&self) -> Option<&MetaItemParser> {\n         match self {\n             MetaItemOrLitParser::MetaItemParser(parser) => Some(parser),\n-            _ => None,\n+            MetaItemOrLitParser::Lit(_) => None,\n         }\n     }\n }"}, {"role": "assistant", "content": "refactor: remove unused error variant from MetaItemOrLitParser"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/issue-manager.yml |  6 +++++-\n docs/en/docs/contributing.md        | 36 ++++++++++++++++++++++++++++++++++++\n docs/en/docs/management-tasks.md    |  2 ++\n 3 files changed, 43 insertions(+), 1 deletion(-)\n\ndiff --git a/.github/workflows/issue-manager.yml b/.github/workflows/issue-manager.yml\nindex f40ec4d..2ae588d 100644\n--- a/.github/workflows/issue-manager.yml\n+++ b/.github/workflows/issue-manager.yml\n@@ -41,11 +41,15 @@ jobs:\n                 \"message\": \"As this PR has been waiting for the original user for a while but seems to be inactive, it's now going to be closed. But if there's anyone interested, feel free to create a new PR.\",\n                 \"reminder\": {\n                     \"before\": \"P3D\",\n-                    \"message\": \"Heads-up: this will be closed in 3 days unless there\u2019s new activity.\"\n+                    \"message\": \"Heads-up: this will be closed in 3 days unless there's new activity.\"\n                 }\n               },\n               \"invalid\": {\n                 \"delay\": 0,\n                 \"message\": \"This was marked as invalid and will be closed now. If this is an error, please provide additional details.\"\n+              },\n+              \"maybe-ai\": {\n+                \"delay\": 0,\n+                \"message\": \"This was marked as potentially AI generated and will be closed now. If this is an error, please provide additional details, make sure to read the docs about contributing and AI.\"\n               }\n             }\ndiff --git a/docs/en/docs/contributing.md b/docs/en/docs/contributing.md\nindex be4706f..a4d8961 100644\n--- a/docs/en/docs/contributing.md\n+++ b/docs/en/docs/contributing.md\n@@ -219,3 +219,39 @@ Once there are several people in the discussion, the FastAPI team can evaluate i\n Then the docs will be automatically translated using LLMs, and the team of native speakers can review the translation, and help tweak the LLM prompts.\n \n Once there's a new translation, for example if docs are updated or there's a new section, there will be a comment in the same discussion with the link to the new translation to review.\n+\n+## Automated Code and AI\n+\n+You are encouraged to use all the tools you want to do your work and contribute as efficiently as possible, this includes AI (LLM) tools, etc. Nevertheless, contributions should have meaningful human intervention, judgement, context, etc.\n+\n+If the **human effort** put in a PR, e.g. writing LLM prompts, is **less** than the **effort we would need to put** to **review it**, please **don't** submit the PR.\n+\n+Think of it this way: we can already write LLM prompts or run automated tools ourselves, and that would be faster than reviewing external PRs.\n+\n+### Closing Automated and AI PRs\n+\n+If we see PRs that seem AI generated or automated in similar ways, we'll flag them and close them.\n+\n+The same applies to comments and descriptions, please don't copy paste the content generated by an LLM.\n+\n+### Human Effort Denial of Service\n+\n+Using automated tools and AI to submit PRs or comments that we have to carefully review and handle would be the equivalent of a <a href=\"https://en.wikipedia.org/wiki/Denial-of-service_attack\" class=\"external-link\" target=\"_blank\">Denial-of-service attack</a> on our human effort.\n+\n+It would be very little effort from the person submitting the PR (an LLM prompt) that generates a large amount of effort on our side (carefully reviewing code).\n+\n+Please don't do that.\n+\n+We'll need to block accounts that spam us with repeated automated PRs or comments.\n+\n+### Use Tools Wisely\n+\n+As Uncle Ben said:\n+\n+<blockquote>\n+With great <strike>power</strike> <strong>tools</strong> comes great responsibility.\n+</blockquote>\n+\n+Avoid inadvertently doing harm.\n+\n+You have amazing tools at hand, use them wisely to help effectively.\ndiff --git a/docs/en/docs/management-tasks.md b/docs/en/docs/management-tasks.md\nindex 6f34afb..fc6e1eb 100644\n--- a/docs/en/docs/management-tasks.md\n+++ b/docs/en/docs/management-tasks.md\n@@ -122,6 +122,8 @@ For these language translation PRs, confirm that:\n \n * If a PR seems to be spam, meaningless, only to change statistics (to appear as \"contributor\") or similar, you can simply mark it as `invalid`, and it will be automatically closed.\n \n+* If a PR seems to be AI generated, and seems like reviewing it would take more time from you than the time it took to write the prompt, mark it as `maybe-ai`, and it will be automatically closed.\n+\n * A PR should have a specific use case that it is solving.\n \n * If the PR is for a feature, it should have docs."}, {"role": "assistant", "content": "docs: add AI contribution policy and automated PR handling"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/hir_ty_lowering/bounds.rs                  | 34 +++++------\n .../rustc_hir_analysis/src/hir_ty_lowering/mod.rs  | 53 +++++++++++++---\n compiler/rustc_hir_typeck/src/expr.rs              |  5 +-\n src/librustdoc/clean/mod.rs                        | 70 ++++++++++++++++++----\n 4 files changed, 126 insertions(+), 36 deletions(-)\n\ndiff --git a/compiler/rustc_hir_analysis/src/hir_ty_lowering/bounds.rs b/compiler/rustc_hir_analysis/src/hir_ty_lowering/bounds.rs\nindex 72d21371f66..0a874b88180 100644\n--- a/compiler/rustc_hir_analysis/src/hir_ty_lowering/bounds.rs\n+++ b/compiler/rustc_hir_analysis/src/hir_ty_lowering/bounds.rs\n@@ -510,7 +510,7 @@ pub(super) fn lower_assoc_item_constraint(\n             // Create the generic arguments for the associated type or constant by joining the\n             // parent arguments (the arguments of the trait) and the own arguments (the ones of\n             // the associated item itself) and construct an alias type using them.\n-            let alias_term = candidate.map_bound(|trait_ref| {\n+            candidate.map_bound(|trait_ref| {\n                 let item_segment = hir::PathSegment {\n                     ident: constraint.ident,\n                     hir_id: constraint.hir_id,\n@@ -528,20 +528,7 @@ pub(super) fn lower_assoc_item_constraint(\n                 debug!(?alias_args);\n \n                 ty::AliasTerm::new_from_args(tcx, assoc_item.def_id, alias_args)\n-            });\n-\n-            // Provide the resolved type of the associated constant to `type_of(AnonConst)`.\n-            if let Some(const_arg) = constraint.ct()\n-                && let hir::ConstArgKind::Anon(anon_const) = const_arg.kind\n-            {\n-                let ty = alias_term\n-                    .map_bound(|alias| tcx.type_of(alias.def_id).instantiate(tcx, alias.args));\n-                let ty =\n-                    check_assoc_const_binding_type(self, constraint.ident, ty, constraint.hir_id);\n-                tcx.feed_anon_const_type(anon_const.def_id, ty::EarlyBinder::bind(ty));\n-            }\n-\n-            alias_term\n+            })\n         };\n \n         match constraint.kind {\n@@ -555,7 +542,20 @@ pub(super) fn lower_assoc_item_constraint(\n             hir::AssocItemConstraintKind::Equality { term } => {\n                 let term = match term {\n                     hir::Term::Ty(ty) => self.lower_ty(ty).into(),\n-                    hir::Term::Const(ct) => self.lower_const_arg(ct, FeedConstTy::No).into(),\n+                    hir::Term::Const(ct) => {\n+                        // Provide the resolved type of the associated constant\n+                        let ty = projection_term.map_bound(|alias| {\n+                            tcx.type_of(alias.def_id).instantiate(tcx, alias.args)\n+                        });\n+                        let ty = check_assoc_const_binding_type(\n+                            self,\n+                            constraint.ident,\n+                            ty,\n+                            constraint.hir_id,\n+                        );\n+\n+                        self.lower_const_arg(ct, FeedConstTy::WithTy(ty)).into()\n+                    }\n                 };\n \n                 // Find any late-bound regions declared in `ty` that are not\n@@ -871,7 +871,7 @@ fn lower_return_type_notation_ty(\n /// probably gate this behind another feature flag.\n ///\n /// [^1]: <https://github.com/rust-lang/project-const-generics/issues/28>.\n-fn check_assoc_const_binding_type<'tcx>(\n+pub(crate) fn check_assoc_const_binding_type<'tcx>(\n     cx: &dyn HirTyLowerer<'tcx>,\n     assoc_const: Ident,\n     ty: ty::Binder<'tcx, Ty<'tcx>>,\ndiff --git a/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs b/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\nindex d2cbf89336d..be5ac21e2ca 100644\n--- a/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\n+++ b/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\n@@ -1269,10 +1269,13 @@ fn probe_single_bound_for_assoc_item<I>(\n             let mut where_bounds = vec![];\n             for bound in [bound, bound2].into_iter().chain(matching_candidates) {\n                 let bound_id = bound.def_id();\n-                let bound_span = tcx\n-                    .associated_items(bound_id)\n-                    .find_by_ident_and_kind(tcx, assoc_ident, assoc_tag, bound_id)\n-                    .and_then(|item| tcx.hir_span_if_local(item.def_id));\n+                let assoc_item = tcx.associated_items(bound_id).find_by_ident_and_kind(\n+                    tcx,\n+                    assoc_ident,\n+                    assoc_tag,\n+                    bound_id,\n+                );\n+                let bound_span = assoc_item.and_then(|item| tcx.hir_span_if_local(item.def_id));\n \n                 if let Some(bound_span) = bound_span {\n                     err.span_label(\n@@ -1285,7 +1288,41 @@ fn probe_single_bound_for_assoc_item<I>(\n                                 let term: ty::Term<'_> = match term {\n                                     hir::Term::Ty(ty) => self.lower_ty(ty).into(),\n                                     hir::Term::Const(ct) => {\n-                                        self.lower_const_arg(ct, FeedConstTy::No).into()\n+                                        let assoc_item =\n+                                            assoc_item.expect(\"assoc_item should be present\");\n+                                        let projection_term = bound.map_bound(|trait_ref| {\n+                                            let item_segment = hir::PathSegment {\n+                                                ident: constraint.ident,\n+                                                hir_id: constraint.hir_id,\n+                                                res: Res::Err,\n+                                                args: Some(constraint.gen_args),\n+                                                infer_args: false,\n+                                            };\n+\n+                                            let alias_args = self.lower_generic_args_of_assoc_item(\n+                                                constraint.ident.span,\n+                                                assoc_item.def_id,\n+                                                &item_segment,\n+                                                trait_ref.args,\n+                                            );\n+                                            ty::AliasTerm::new_from_args(\n+                                                tcx,\n+                                                assoc_item.def_id,\n+                                                alias_args,\n+                                            )\n+                                        });\n+\n+                                        let ty = projection_term.map_bound(|alias| {\n+                                            tcx.type_of(alias.def_id).instantiate(tcx, alias.args)\n+                                        });\n+                                        let ty = bounds::check_assoc_const_binding_type(\n+                                            self,\n+                                            constraint.ident,\n+                                            ty,\n+                                            constraint.hir_id,\n+                                        );\n+\n+                                        self.lower_const_arg(ct, FeedConstTy::WithTy(ty)).into()\n                                     }\n                                 };\n                                 if term.references_error() {\n@@ -2993,7 +3030,7 @@ pub fn lower_ty(&self, hir_ty: &hir::Ty<'tcx>) -> Ty<'tcx> {\n                 .unwrap_or_else(|guar| Ty::new_error(tcx, guar))\n             }\n             hir::TyKind::Array(ty, length) => {\n-                let length = self.lower_const_arg(length, FeedConstTy::No);\n+                let length = self.lower_const_arg(length, FeedConstTy::WithTy(tcx.types.usize));\n                 Ty::new_array_with_const_len(tcx, self.lower_ty(ty), length)\n             }\n             hir::TyKind::Infer(()) => {\n@@ -3033,8 +3070,8 @@ fn lower_pat_ty_pat(\n                     // Keep this list of types in sync with the list of types that\n                     // the `RangePattern` trait is implemented for.\n                     ty::Int(_) | ty::Uint(_) | ty::Char => {\n-                        let start = self.lower_const_arg(start, FeedConstTy::No);\n-                        let end = self.lower_const_arg(end, FeedConstTy::No);\n+                        let start = self.lower_const_arg(start, FeedConstTy::WithTy(ty));\n+                        let end = self.lower_const_arg(end, FeedConstTy::WithTy(ty));\n                         Ok(ty::PatternKind::Range { start, end })\n                     }\n                     _ => Err(self\ndiff --git a/compiler/rustc_hir_typeck/src/expr.rs b/compiler/rustc_hir_typeck/src/expr.rs\nindex 9d7e09b020a..d7366887d85 100644\n--- a/compiler/rustc_hir_typeck/src/expr.rs\n+++ b/compiler/rustc_hir_typeck/src/expr.rs\n@@ -1749,7 +1749,10 @@ fn check_expr_repeat(\n         let count_span = count.span;\n         let count = self.try_structurally_resolve_const(\n             count_span,\n-            self.normalize(count_span, self.lower_const_arg(count, FeedConstTy::No)),\n+            self.normalize(\n+                count_span,\n+                self.lower_const_arg(count, FeedConstTy::WithTy(tcx.types.usize)),\n+            ),\n         );\n \n         if let Some(count) = count.try_to_target_usize(tcx) {\ndiff --git a/src/librustdoc/clean/mod.rs b/src/librustdoc/clean/mod.rs\nindex 597a85f3976..ac17014ebfd 100644\n--- a/src/librustdoc/clean/mod.rs\n+++ b/src/librustdoc/clean/mod.rs\n@@ -469,11 +469,23 @@ fn clean_middle_term<'tcx>(\n     }\n }\n \n-fn clean_hir_term<'tcx>(term: &hir::Term<'tcx>, cx: &mut DocContext<'tcx>) -> Term {\n+fn clean_hir_term<'tcx>(\n+    assoc_item: Option<DefId>,\n+    term: &hir::Term<'tcx>,\n+    span: rustc_span::Span,\n+    cx: &mut DocContext<'tcx>,\n+) -> Term {\n     match term {\n         hir::Term::Ty(ty) => Term::Type(clean_ty(ty, cx)),\n         hir::Term::Const(c) => {\n-            let ct = lower_const_arg_for_rustdoc(cx.tcx, c, FeedConstTy::No);\n+            let ty = if let Some(assoc_item) = assoc_item {\n+                // FIXME(generic_const_items): this should instantiate with the alias item's args\n+                cx.tcx.type_of(assoc_item).instantiate_identity()\n+            } else {\n+                Ty::new_error_with_message(cx.tcx, span, \"cannot find the associated constant\")\n+            };\n+\n+            let ct = lower_const_arg_for_rustdoc(cx.tcx, c, FeedConstTy::WithTy(ty));\n             Term::Constant(clean_middle_const(ty::Binder::dummy(ct), cx))\n         }\n     }\n@@ -650,7 +662,14 @@ fn clean_generic_param<'tcx>(\n             GenericParamDefKind::Const {\n                 ty: Box::new(clean_ty(ty, cx)),\n                 default: default.map(|ct| {\n-                    Box::new(lower_const_arg_for_rustdoc(cx.tcx, ct, FeedConstTy::No).to_string())\n+                    Box::new(\n+                        lower_const_arg_for_rustdoc(\n+                            cx.tcx,\n+                            ct,\n+                            FeedConstTy::WithTy(lower_ty(cx.tcx, ty)),\n+                        )\n+                        .to_string(),\n+                    )\n                 }),\n             },\n         ),\n@@ -1531,7 +1550,7 @@ fn first_non_private_clean_path<'tcx>(\n         && path_last.args.is_some()\n     {\n         assert!(new_path_last.args.is_empty());\n-        new_path_last.args = clean_generic_args(path_last_args, cx);\n+        new_path_last.args = clean_generic_args(None, path_last_args, cx);\n     }\n     new_clean_path\n }\n@@ -1812,7 +1831,11 @@ pub(crate) fn clean_ty<'tcx>(ty: &hir::Ty<'tcx>, cx: &mut DocContext<'tcx>) -> T\n             let length = match const_arg.kind {\n                 hir::ConstArgKind::Infer(..) | hir::ConstArgKind::Error(..) => \"_\".to_string(),\n                 hir::ConstArgKind::Anon(hir::AnonConst { def_id, .. }) => {\n-                    let ct = lower_const_arg_for_rustdoc(cx.tcx, const_arg, FeedConstTy::No);\n+                    let ct = lower_const_arg_for_rustdoc(\n+                        cx.tcx,\n+                        const_arg,\n+                        FeedConstTy::WithTy(cx.tcx.types.usize),\n+                    );\n                     let typing_env = ty::TypingEnv::post_analysis(cx.tcx, *def_id);\n                     let ct = cx.tcx.normalize_erasing_regions(typing_env, ct);\n                     print_const(cx, ct)\n@@ -1823,7 +1846,11 @@ pub(crate) fn clean_ty<'tcx>(ty: &hir::Ty<'tcx>, cx: &mut DocContext<'tcx>) -> T\n                 | hir::ConstArgKind::Tup(..)\n                 | hir::ConstArgKind::Array(..)\n                 | hir::ConstArgKind::Literal(..) => {\n-                    let ct = lower_const_arg_for_rustdoc(cx.tcx, const_arg, FeedConstTy::No);\n+                    let ct = lower_const_arg_for_rustdoc(\n+                        cx.tcx,\n+                        const_arg,\n+                        FeedConstTy::WithTy(cx.tcx.types.usize),\n+                    );\n                     print_const(cx, ct)\n                 }\n             };\n@@ -2516,6 +2543,7 @@ fn clean_path<'tcx>(path: &hir::Path<'tcx>, cx: &mut DocContext<'tcx>) -> Path {\n }\n \n fn clean_generic_args<'tcx>(\n+    trait_did: Option<DefId>,\n     generic_args: &hir::GenericArgs<'tcx>,\n     cx: &mut DocContext<'tcx>,\n ) -> GenericArgs {\n@@ -2539,7 +2567,13 @@ fn clean_generic_args<'tcx>(\n             let constraints = generic_args\n                 .constraints\n                 .iter()\n-                .map(|c| clean_assoc_item_constraint(c, cx))\n+                .map(|c| {\n+                    clean_assoc_item_constraint(\n+                        trait_did.expect(\"only trait ref has constraints\"),\n+                        c,\n+                        cx,\n+                    )\n+                })\n                 .collect::<ThinVec<_>>();\n             GenericArgs::AngleBracketed { args, constraints }\n         }\n@@ -2562,7 +2596,11 @@ fn clean_path_segment<'tcx>(\n     path: &hir::PathSegment<'tcx>,\n     cx: &mut DocContext<'tcx>,\n ) -> PathSegment {\n-    PathSegment { name: path.ident.name, args: clean_generic_args(path.args(), cx) }\n+    let trait_did = match path.res {\n+        hir::def::Res::Def(DefKind::Trait | DefKind::TraitAlias, did) => Some(did),\n+        _ => None,\n+    };\n+    PathSegment { name: path.ident.name, args: clean_generic_args(trait_did, path.args(), cx) }\n }\n \n fn clean_bare_fn_ty<'tcx>(\n@@ -3126,17 +3164,29 @@ fn clean_maybe_renamed_foreign_item<'tcx>(\n }\n \n fn clean_assoc_item_constraint<'tcx>(\n+    trait_did: DefId,\n     constraint: &hir::AssocItemConstraint<'tcx>,\n     cx: &mut DocContext<'tcx>,\n ) -> AssocItemConstraint {\n     AssocItemConstraint {\n         assoc: PathSegment {\n             name: constraint.ident.name,\n-            args: clean_generic_args(constraint.gen_args, cx),\n+            args: clean_generic_args(None, constraint.gen_args, cx),\n         },\n         kind: match constraint.kind {\n             hir::AssocItemConstraintKind::Equality { ref term } => {\n-                AssocItemConstraintKind::Equality { term: clean_hir_term(term, cx) }\n+                let assoc_tag = match term {\n+                    hir::Term::Ty(_) => ty::AssocTag::Type,\n+                    hir::Term::Const(_) => ty::AssocTag::Const,\n+                };\n+                let assoc_item = cx\n+                    .tcx\n+                    .associated_items(trait_did)\n+                    .find_by_ident_and_kind(cx.tcx, constraint.ident, assoc_tag, trait_did)\n+                    .map(|item| item.def_id);\n+                AssocItemConstraintKind::Equality {\n+                    term: clean_hir_term(assoc_item, term, constraint.span, cx),\n+                }\n             }\n             hir::AssocItemConstraintKind::Bound { bounds } => AssocItemConstraintKind::Bound {\n                 bounds: bounds.iter().filter_map(|b| clean_generic_bound(b, cx)).collect(),"}, {"role": "assistant", "content": "refactor: pass type info to const arg lowering"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .github/workflows/ci.yml                   |  2 +-\n adev/scripts/synonyms/algolia-synonyms.mts |  2 +-\n adev/scripts/synonyms/tsconfig.json        | 22 ++++++++++++++++++++++\n adev/scripts/synonyms/update-synonyms.mts  |  2 +-\n 4 files changed, 25 insertions(+), 3 deletions(-)\n\ndiff --git a/.github/workflows/ci.yml b/.github/workflows/ci.yml\nindex 04ff82f5..d1be1578 100644\n--- a/.github/workflows/ci.yml\n+++ b/.github/workflows/ci.yml\n@@ -224,6 +224,6 @@ jobs:\n           configPath: 'adev/firebase.json'\n           distDir: 'dist/bin/adev/dist'\n       - name: Update Algolia synonym record\n-        run: pnpm tsx adev/scripts/synonyms/update-synonyms.mts\n+        run: node adev/scripts/synonyms/update-synonyms.mts\n         env:\n           ALGOLIA_KEY: ${{ secrets.ALGOLIA_SYNONYM_MANAGER }}\ndiff --git a/adev/scripts/synonyms/algolia-synonyms.mts b/adev/scripts/synonyms/algolia-synonyms.mts\nindex e50c8d28..78fe68c4 100644\n--- a/adev/scripts/synonyms/algolia-synonyms.mts\n+++ b/adev/scripts/synonyms/algolia-synonyms.mts\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.dev/license\n  */\n \n-import {SynonymHit} from 'algoliasearch';\n+import {type SynonymHit} from 'algoliasearch';\n \n /**\n  * List of synonyms to upload to algolia.\ndiff --git a/adev/scripts/synonyms/tsconfig.json b/adev/scripts/synonyms/tsconfig.json\nnew file mode 100644\nindex 00000000..7f56507b\n--- /dev/null\n+++ b/adev/scripts/synonyms/tsconfig.json\n@@ -0,0 +1,22 @@\n+{\n+  \"compileOnSave\": false,\n+  \"compilerOptions\": {\n+    \"forceConsistentCasingInFileNames\": true,\n+    \"strict\": true,\n+    \"noImplicitOverride\": true,\n+    \"noPropertyAccessFromIndexSignature\": true,\n+    \"noImplicitReturns\": true,\n+    \"noFallthroughCasesInSwitch\": true,\n+    \"sourceMap\": true,\n+    \"declaration\": false,\n+    \"moduleResolution\": \"bundler\",\n+    \"preserveSymlinks\": true,\n+    \"importHelpers\": true,\n+    \"target\": \"ES2022\",\n+    \"module\": \"ES2022\",\n+    \"allowImportingTsExtensions\": true,\n+    \"lib\": [\"ES2022\"],\n+    \"types\": [],\n+    \"skipLibCheck\": true\n+  }\n+}\ndiff --git a/adev/scripts/synonyms/update-synonyms.mts b/adev/scripts/synonyms/update-synonyms.mts\nindex c0277df8..ee28ec30 100644\n--- a/adev/scripts/synonyms/update-synonyms.mts\n+++ b/adev/scripts/synonyms/update-synonyms.mts\n@@ -7,7 +7,7 @@\n  */\n \n import {algoliasearch} from 'algoliasearch';\n-import synonyms from './algolia-synonyms.mjs';\n+import synonyms from './algolia-synonyms.mts';\n \n /** The name of the index being updated. */\n const INDEX_NAME = 'angular_v17';"}, {"role": "assistant", "content": "ci: update algolia synonym updater to use node directly rather than tsx"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../background/dynamicallyInjectContentScripts.js  |   8 ++\n .../src/background/messageHandlers.js              |  52 +++++++++\n .../src/contentScripts/fallbackEvalContext.js      |  35 +++++++\n .../src/contentScripts/proxy.js                    |  46 ++++++++\n .../react-devtools-extensions/src/evalScripts.js   | 112 ++++++++++++++++++++\n .../src/main/elementSelection.js                   |  16 ++-\n .../src/main/evalInInspectedWindow.js              | 116 +++++++++++++++++++++\n .../react-devtools-extensions/src/main/index.js    |   3 +-\n .../src/main/reactPolling.js                       |   7 +-\n .../src/main/sourceSelection.js                    |  48 ++-------\n .../react-devtools-extensions/webpack.config.js    |   1 +\n 11 files changed, 390 insertions(+), 54 deletions(-)\n\ndiff --git a/packages/react-devtools-extensions/src/background/dynamicallyInjectContentScripts.js b/packages/react-devtools-extensions/src/background/dynamicallyInjectContentScripts.js\nindex 3e2f6b7..84624b0 100644\n--- a/packages/react-devtools-extensions/src/background/dynamicallyInjectContentScripts.js\n+++ b/packages/react-devtools-extensions/src/background/dynamicallyInjectContentScripts.js\n@@ -17,6 +17,14 @@ const contentScriptsToInject = [\n     runAt: 'document_end',\n     world: chrome.scripting.ExecutionWorld.ISOLATED,\n   },\n+  {\n+    id: '@react-devtools/fallback-eval-context',\n+    js: ['build/fallbackEvalContext.js'],\n+    matches: ['<all_urls>'],\n+    persistAcrossSessions: true,\n+    runAt: 'document_start',\n+    world: chrome.scripting.ExecutionWorld.MAIN,\n+  },\n   {\n     id: '@react-devtools/hook',\n     js: ['build/installHook.js'],\ndiff --git a/packages/react-devtools-extensions/src/background/messageHandlers.js b/packages/react-devtools-extensions/src/background/messageHandlers.js\nindex 0152418..f762d64 100644\n--- a/packages/react-devtools-extensions/src/background/messageHandlers.js\n+++ b/packages/react-devtools-extensions/src/background/messageHandlers.js\n@@ -97,6 +97,58 @@ export function handleDevToolsPageMessage(message) {\n \n       break;\n     }\n+\n+    case 'eval-in-inspected-window': {\n+      const {\n+        payload: {tabId, requestId, scriptId, args},\n+      } = message;\n+\n+      chrome.tabs\n+        .sendMessage(tabId, {\n+          source: 'devtools-page-eval',\n+          payload: {\n+            scriptId,\n+            args,\n+          },\n+        })\n+        .then(response => {\n+          if (!response) {\n+            chrome.runtime.sendMessage({\n+              source: 'react-devtools-background',\n+              payload: {\n+                type: 'eval-in-inspected-window-response',\n+                requestId,\n+                result: null,\n+                error: 'No response from content script',\n+              },\n+            });\n+            return;\n+          }\n+          const {result, error} = response;\n+          chrome.runtime.sendMessage({\n+            source: 'react-devtools-background',\n+            payload: {\n+              type: 'eval-in-inspected-window-response',\n+              requestId,\n+              result,\n+              error,\n+            },\n+          });\n+        })\n+        .catch(error => {\n+          chrome.runtime.sendMessage({\n+            source: 'react-devtools-background',\n+            payload: {\n+              type: 'eval-in-inspected-window-response',\n+              requestId,\n+              result: null,\n+              error: error?.message || String(error),\n+            },\n+          });\n+        });\n+\n+      break;\n+    }\n   }\n }\n \ndiff --git a/packages/react-devtools-extensions/src/contentScripts/fallbackEvalContext.js b/packages/react-devtools-extensions/src/contentScripts/fallbackEvalContext.js\nnew file mode 100644\nindex 0000000..e274f88\n--- /dev/null\n+++ b/packages/react-devtools-extensions/src/contentScripts/fallbackEvalContext.js\n@@ -0,0 +1,35 @@\n+/**\n+ * Copyright (c) Meta Platforms, Inc. and affiliates.\n+ *\n+ * This source code is licensed under the MIT license found in the\n+ * LICENSE file in the root directory of this source tree.\n+ *\n+ * @flow\n+ */\n+\n+import {evalScripts} from '../evalScripts';\n+\n+window.addEventListener('message', event => {\n+  if (event.data?.source === 'react-devtools-content-script-eval') {\n+    const {scriptId, args, requestId} = event.data.payload;\n+    const response = {result: null, error: null};\n+    try {\n+      if (!evalScripts[scriptId]) {\n+        throw new Error(`No eval script with id \"${scriptId}\" exists.`);\n+      }\n+      response.result = evalScripts[scriptId].fn.apply(null, args);\n+    } catch (err) {\n+      response.error = err.message;\n+    }\n+    window.postMessage(\n+      {\n+        source: 'react-devtools-content-script-eval-response',\n+        payload: {\n+          requestId,\n+          response,\n+        },\n+      },\n+      '*',\n+    );\n+  }\n+});\ndiff --git a/packages/react-devtools-extensions/src/contentScripts/proxy.js b/packages/react-devtools-extensions/src/contentScripts/proxy.js\nindex 02253f6..a4e7dd6 100644\n--- a/packages/react-devtools-extensions/src/contentScripts/proxy.js\n+++ b/packages/react-devtools-extensions/src/contentScripts/proxy.js\n@@ -117,3 +117,49 @@ function connectPort() {\n   // $FlowFixMe[incompatible-use]\n   port.onDisconnect.addListener(handleDisconnect);\n }\n+\n+let evalRequestId = 0;\n+const evalRequestCallbacks = new Map<number, Function>();\n+\n+chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {\n+  switch (msg?.source) {\n+    case 'devtools-page-eval': {\n+      const {scriptId, args} = msg.payload;\n+      const requestId = evalRequestId++;\n+      window.postMessage(\n+        {\n+          source: 'react-devtools-content-script-eval',\n+          payload: {\n+            requestId,\n+            scriptId,\n+            args,\n+          },\n+        },\n+        '*',\n+      );\n+      evalRequestCallbacks.set(requestId, sendResponse);\n+      return true; // Indicate we will respond asynchronously\n+    }\n+  }\n+});\n+\n+window.addEventListener('message', event => {\n+  if (event.data?.source === 'react-devtools-content-script-eval-response') {\n+    const {requestId, response} = event.data.payload;\n+    const callback = evalRequestCallbacks.get(requestId);\n+    try {\n+      if (!callback)\n+        throw new Error(\n+          `No eval request callback for id \"${requestId}\" exists.`,\n+        );\n+      callback(response);\n+    } catch (e) {\n+      console.warn(\n+        'React DevTools Content Script eval response error occurred:',\n+        e,\n+      );\n+    } finally {\n+      evalRequestCallbacks.delete(requestId);\n+    }\n+  }\n+});\ndiff --git a/packages/react-devtools-extensions/src/evalScripts.js b/packages/react-devtools-extensions/src/evalScripts.js\nnew file mode 100644\nindex 0000000..60757ca\n--- /dev/null\n+++ b/packages/react-devtools-extensions/src/evalScripts.js\n@@ -0,0 +1,112 @@\n+/**\n+ * Copyright (c) Meta Platforms, Inc. and affiliates.\n+ *\n+ * This source code is licensed under the MIT license found in the\n+ * LICENSE file in the root directory of this source tree.\n+ *\n+ * @flow\n+ */\n+\n+export type EvalScriptIds =\n+  | 'checkIfReactPresentInInspectedWindow'\n+  | 'reload'\n+  | 'setBrowserSelectionFromReact'\n+  | 'setReactSelectionFromBrowser'\n+  | 'viewAttributeSource'\n+  | 'viewElementSource';\n+\n+/*\n+ .fn for fallback in Content Script context\n+ .code for chrome.devtools.inspectedWindow.eval()\n+*/\n+type EvalScriptEntry = {\n+  fn: (...args: any[]) => any,\n+  code: (...args: any[]) => string,\n+};\n+\n+/*\n+  Can not access `Developer Tools Console API` (e.g., inspect(), $0) in this context.\n+  So some fallback functions are no-op or throw error.\n+*/\n+export const evalScripts: {[key: EvalScriptIds]: EvalScriptEntry} = {\n+  checkIfReactPresentInInspectedWindow: {\n+    fn: () =>\n+      window.__REACT_DEVTOOLS_GLOBAL_HOOK__ &&\n+      window.__REACT_DEVTOOLS_GLOBAL_HOOK__.renderers.size > 0,\n+    code: () =>\n+      'window.__REACT_DEVTOOLS_GLOBAL_HOOK__ &&' +\n+      'window.__REACT_DEVTOOLS_GLOBAL_HOOK__.renderers.size > 0',\n+  },\n+  reload: {\n+    fn: () => window.location.reload(),\n+    code: () => 'window.location.reload();',\n+  },\n+  setBrowserSelectionFromReact: {\n+    fn: () => {\n+      throw new Error('Not supported in fallback eval context');\n+    },\n+    code: () =>\n+      '(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.$0 !== $0) ?' +\n+      '(inspect(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.$0), true) :' +\n+      'false',\n+  },\n+  setReactSelectionFromBrowser: {\n+    fn: () => {\n+      throw new Error('Not supported in fallback eval context');\n+    },\n+    code: () =>\n+      '(window.__REACT_DEVTOOLS_GLOBAL_HOOK__ && window.__REACT_DEVTOOLS_GLOBAL_HOOK__.$0 !== $0) ?' +\n+      '(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.$0 = $0, true) :' +\n+      'false',\n+  },\n+  viewAttributeSource: {\n+    fn: ({rendererID, elementID, path}) => {\n+      return false; // Not supported in fallback eval context\n+    },\n+    code: ({rendererID, elementID, path}) =>\n+      '{' + // The outer block is important because it means we can declare local variables.\n+      'const renderer = window.__REACT_DEVTOOLS_GLOBAL_HOOK__.rendererInterfaces.get(' +\n+      JSON.stringify(rendererID) +\n+      ');' +\n+      'if (renderer) {' +\n+      '  const value = renderer.getElementAttributeByPath(' +\n+      JSON.stringify(elementID) +\n+      ',' +\n+      JSON.stringify(path) +\n+      ');' +\n+      '  if (value) {' +\n+      '    inspect(value);' +\n+      '    true;' +\n+      '  } else {' +\n+      '    false;' +\n+      '  }' +\n+      '} else {' +\n+      '  false;' +\n+      '}' +\n+      '}',\n+  },\n+  viewElementSource: {\n+    fn: ({rendererID, elementID}) => {\n+      return false; // Not supported in fallback eval context\n+    },\n+    code: ({rendererID, elementID}) =>\n+      '{' + // The outer block is important because it means we can declare local variables.\n+      'const renderer = window.__REACT_DEVTOOLS_GLOBAL_HOOK__.rendererInterfaces.get(' +\n+      JSON.stringify(rendererID) +\n+      ');' +\n+      'if (renderer) {' +\n+      '  const value = renderer.getElementSourceFunctionById(' +\n+      JSON.stringify(elementID) +\n+      ');' +\n+      '  if (value) {' +\n+      '    inspect(value);' +\n+      '    true;' +\n+      '  } else {' +\n+      '    false;' +\n+      '  }' +\n+      '} else {' +\n+      '  false;' +\n+      '}' +\n+      '}',\n+  },\n+};\ndiff --git a/packages/react-devtools-extensions/src/main/elementSelection.js b/packages/react-devtools-extensions/src/main/elementSelection.js\nindex 7f9b8ed..315482e 100644\n--- a/packages/react-devtools-extensions/src/main/elementSelection.js\n+++ b/packages/react-devtools-extensions/src/main/elementSelection.js\n@@ -1,13 +1,12 @@\n-/* global chrome */\n+import {evalInInspectedWindow} from './evalInInspectedWindow';\n \n export function setBrowserSelectionFromReact() {\n   // This is currently only called on demand when you press \"view DOM\".\n   // In the future, if Chrome adds an inspect() that doesn't switch tabs,\n   // we could make this happen automatically when you select another component.\n-  chrome.devtools.inspectedWindow.eval(\n-    '(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.$0 !== $0) ?' +\n-      '(inspect(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.$0), true) :' +\n-      'false',\n+  evalInInspectedWindow(\n+    'setBrowserSelectionFromReact',\n+    [],\n     (didSelectionChange, evalError) => {\n       if (evalError) {\n         console.error(evalError);\n@@ -19,10 +18,9 @@ export function setBrowserSelectionFromReact() {\n export function setReactSelectionFromBrowser(bridge) {\n   // When the user chooses a different node in the browser Elements tab,\n   // copy it over to the hook object so that we can sync the selection.\n-  chrome.devtools.inspectedWindow.eval(\n-    '(window.__REACT_DEVTOOLS_GLOBAL_HOOK__ && window.__REACT_DEVTOOLS_GLOBAL_HOOK__.$0 !== $0) ?' +\n-      '(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.$0 = $0, true) :' +\n-      'false',\n+  evalInInspectedWindow(\n+    'setReactSelectionFromBrowser',\n+    [],\n     (didSelectionChange, evalError) => {\n       if (evalError) {\n         console.error(evalError);\ndiff --git a/packages/react-devtools-extensions/src/main/evalInInspectedWindow.js b/packages/react-devtools-extensions/src/main/evalInInspectedWindow.js\nnew file mode 100644\nindex 0000000..27a339f\n--- /dev/null\n+++ b/packages/react-devtools-extensions/src/main/evalInInspectedWindow.js\n@@ -0,0 +1,116 @@\n+/**\n+ * Copyright (c) Meta Platforms, Inc. and affiliates.\n+ *\n+ * This source code is licensed under the MIT license found in the\n+ * LICENSE file in the root directory of this source tree.\n+ *\n+ * @flow\n+ */\n+\n+import type {EvalScriptIds} from '../evalScripts';\n+\n+import {evalScripts} from '../evalScripts';\n+\n+type ExceptionInfo = {\n+  code: ?string,\n+  description: ?string,\n+  isError: boolean,\n+  isException: boolean,\n+  value: any,\n+};\n+\n+const EVAL_TIMEOUT = 1000 * 10;\n+\n+let evalRequestId = 0;\n+const evalRequestCallbacks = new Map<\n+  number,\n+  (value: {result: any, error: any}) => void,\n+>();\n+\n+function fallbackEvalInInspectedWindow(\n+  scriptId: EvalScriptIds,\n+  args: any[],\n+  callback: (value: any, exceptionInfo: ?ExceptionInfo) => void,\n+) {\n+  if (!evalScripts[scriptId]) {\n+    throw new Error(`No eval script with id \"${scriptId}\" exists.`);\n+  }\n+  const code = evalScripts[scriptId].code.apply(null, args);\n+  const tabId = chrome.devtools.inspectedWindow.tabId;\n+  const requestId = evalRequestId++;\n+  chrome.runtime.sendMessage({\n+    source: 'devtools-page',\n+    payload: {\n+      type: 'eval-in-inspected-window',\n+      tabId,\n+      requestId,\n+      scriptId,\n+      args,\n+    },\n+  });\n+  const timeout = setTimeout(() => {\n+    evalRequestCallbacks.delete(requestId);\n+    if (callback) {\n+      callback(null, {\n+        code,\n+        description:\n+          'Timed out while waiting for eval response from the inspected window.',\n+        isError: true,\n+        isException: false,\n+        value: undefined,\n+      });\n+    }\n+  }, EVAL_TIMEOUT);\n+  evalRequestCallbacks.set(requestId, ({result, error}) => {\n+    clearTimeout(timeout);\n+    evalRequestCallbacks.delete(requestId);\n+    if (callback) {\n+      if (error) {\n+        callback(null, {\n+          code,\n+          description: undefined,\n+          isError: false,\n+          isException: true,\n+          value: error,\n+        });\n+        return;\n+      }\n+      callback(result, null);\n+    }\n+  });\n+}\n+\n+export function evalInInspectedWindow(\n+  scriptId: EvalScriptIds,\n+  args: any[],\n+  callback: (value: any, exceptionInfo: ?ExceptionInfo) => void,\n+) {\n+  if (!evalScripts[scriptId]) {\n+    throw new Error(`No eval script with id \"${scriptId}\" exists.`);\n+  }\n+  const code = evalScripts[scriptId].code.apply(null, args);\n+  chrome.devtools.inspectedWindow.eval(code, (result, exceptionInfo) => {\n+    if (!exceptionInfo) {\n+      callback(result, exceptionInfo);\n+      return;\n+    }\n+    // If an exception (e.g. CSP Blocked) occurred,\n+    // fallback to the content script eval context\n+    fallbackEvalInInspectedWindow(scriptId, args, callback);\n+  });\n+}\n+\n+chrome.runtime.onMessage.addListener(({payload, source}) => {\n+  if (source === 'react-devtools-background') {\n+    switch (payload?.type) {\n+      case 'eval-in-inspected-window-response': {\n+        const {requestId, result, error} = payload;\n+        const callback = evalRequestCallbacks.get(requestId);\n+        if (callback) {\n+          callback({result, error});\n+        }\n+        break;\n+      }\n+    }\n+  }\n+});\ndiff --git a/packages/react-devtools-extensions/src/main/index.js b/packages/react-devtools-extensions/src/main/index.js\nindex bc948d1..03f9c2b 100644\n--- a/packages/react-devtools-extensions/src/main/index.js\n+++ b/packages/react-devtools-extensions/src/main/index.js\n@@ -32,6 +32,7 @@ import {\n } from './elementSelection';\n import {viewAttributeSource} from './sourceSelection';\n \n+import {evalInInspectedWindow} from './evalInInspectedWindow';\n import {startReactPolling} from './reactPolling';\n import {cloneStyleTags} from './cloneStyleTags';\n import fetchFileWithCaching from './fetchFileWithCaching';\n@@ -70,7 +71,7 @@ function createBridge() {\n \n   bridge.addListener('reloadAppForProfiling', () => {\n     localStorageSetItem(LOCAL_STORAGE_SUPPORTS_PROFILING_KEY, 'true');\n-    chrome.devtools.inspectedWindow.eval('window.location.reload();');\n+    evalInInspectedWindow('reload', []);\n   });\n \n   bridge.addListener(\ndiff --git a/packages/react-devtools-extensions/src/main/reactPolling.js b/packages/react-devtools-extensions/src/main/reactPolling.js\nindex 9bb034c..d4b3c22 100644\n--- a/packages/react-devtools-extensions/src/main/reactPolling.js\n+++ b/packages/react-devtools-extensions/src/main/reactPolling.js\n@@ -1,4 +1,4 @@\n-/* global chrome */\n+import {evalInInspectedWindow} from './evalInInspectedWindow';\n \n class CouldNotFindReactOnThePageError extends Error {\n   constructor() {\n@@ -26,8 +26,9 @@ export function startReactPolling(\n \n   // This function will call onSuccess only if React was found and polling is not aborted, onError will be called for every other case\n   function checkIfReactPresentInInspectedWindow(onSuccess, onError) {\n-    chrome.devtools.inspectedWindow.eval(\n-      'window.__REACT_DEVTOOLS_GLOBAL_HOOK__ && window.__REACT_DEVTOOLS_GLOBAL_HOOK__.renderers.size > 0',\n+    evalInInspectedWindow(\n+      'checkIfReactPresentInInspectedWindow',\n+      [],\n       (pageHasReact, exceptionInfo) => {\n         if (status === 'aborted') {\n           onError(\ndiff --git a/packages/react-devtools-extensions/src/main/sourceSelection.js b/packages/react-devtools-extensions/src/main/sourceSelection.js\nindex 0534a92..49ee99e 100644\n--- a/packages/react-devtools-extensions/src/main/sourceSelection.js\n+++ b/packages/react-devtools-extensions/src/main/sourceSelection.js\n@@ -1,27 +1,9 @@\n-/* global chrome */\n+import {evalInInspectedWindow} from './evalInInspectedWindow';\n \n export function viewAttributeSource(rendererID, elementID, path) {\n-  chrome.devtools.inspectedWindow.eval(\n-    '{' + // The outer block is important because it means we can declare local variables.\n-      'const renderer = window.__REACT_DEVTOOLS_GLOBAL_HOOK__.rendererInterfaces.get(' +\n-      JSON.stringify(rendererID) +\n-      ');' +\n-      'if (renderer) {' +\n-      '  const value = renderer.getElementAttributeByPath(' +\n-      JSON.stringify(elementID) +\n-      ',' +\n-      JSON.stringify(path) +\n-      ');' +\n-      '  if (value) {' +\n-      '    inspect(value);' +\n-      '    true;' +\n-      '  } else {' +\n-      '    false;' +\n-      '  }' +\n-      '} else {' +\n-      '  false;' +\n-      '}' +\n-      '}',\n+  evalInInspectedWindow(\n+    'viewAttributeSource',\n+    [{rendererID, elementID, path}],\n     (didInspect, evalError) => {\n       if (evalError) {\n         console.error(evalError);\n@@ -31,25 +13,9 @@ export function viewAttributeSource(rendererID, elementID, path) {\n }\n \n export function viewElementSource(rendererID, elementID) {\n-  chrome.devtools.inspectedWindow.eval(\n-    '{' + // The outer block is important because it means we can declare local variables.\n-      'const renderer = window.__REACT_DEVTOOLS_GLOBAL_HOOK__.rendererInterfaces.get(' +\n-      JSON.stringify(rendererID) +\n-      ');' +\n-      'if (renderer) {' +\n-      '  const value = renderer.getElementSourceFunctionById(' +\n-      JSON.stringify(elementID) +\n-      ');' +\n-      '  if (value) {' +\n-      '    inspect(value);' +\n-      '    true;' +\n-      '  } else {' +\n-      '    false;' +\n-      '  }' +\n-      '} else {' +\n-      '  false;' +\n-      '}' +\n-      '}',\n+  evalInInspectedWindow(\n+    'viewElementSource',\n+    [{rendererID, elementID}],\n     (didInspect, evalError) => {\n       if (evalError) {\n         console.error(evalError);\ndiff --git a/packages/react-devtools-extensions/webpack.config.js b/packages/react-devtools-extensions/webpack.config.js\nindex 191eabc..7b5acca 100644\n--- a/packages/react-devtools-extensions/webpack.config.js\n+++ b/packages/react-devtools-extensions/webpack.config.js\n@@ -69,6 +69,7 @@ module.exports = {\n     backend: './src/backend.js',\n     background: './src/background/index.js',\n     backendManager: './src/contentScripts/backendManager.js',\n+    fallbackEvalContext: './src/contentScripts/fallbackEvalContext.js',\n     fileFetcher: './src/contentScripts/fileFetcher.js',\n     main: './src/main/index.js',\n     panel: './src/panel.js',"}, {"role": "assistant", "content": "feat(devtools): add fallback eval context for CSP-restricted pages"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/content/guide/templates/pipes.md | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/adev/src/content/guide/templates/pipes.md b/adev/src/content/guide/templates/pipes.md\nindex 61e558c2..1f8e5cdf 100644\n--- a/adev/src/content/guide/templates/pipes.md\n+++ b/adev/src/content/guide/templates/pipes.md\n@@ -271,7 +271,7 @@ export class MyCustomTransformationPipe implements PipeTransform {\n \n When you want a pipe to detect changes within arrays or objects, it must be marked as an impure function by passing the `pure` flag with a value of `false`.\n \n-Avoid creating impure pipes unless absolutely necessary, as they can incur a significant performance penalty if used without care.\n+IMPORTANT: Avoid creating impure pipes unless absolutely necessary, as they can incur a significant performance penalty if used without care.\n \n ```angular-ts\n import { Pipe, PipeTransform } from '@angular/core';"}, {"role": "assistant", "content": "docs: add IMPORTANT prefix to pipe usage warning and"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/runtime/trace/recorder.go | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/runtime/trace/recorder.go b/src/runtime/trace/recorder.go\nindex a18d7641..8617231a 100644\n--- a/src/runtime/trace/recorder.go\n+++ b/src/runtime/trace/recorder.go\n@@ -112,7 +112,7 @@ func runtime_traceClockNow() uint64\n // frequency is nanoseconds per timestamp unit.\n type frequency float64\n \n-// mul multiplies an unprocessed to produce a time in nanoseconds.\n+// mul multiplies an unprocessed timestamp to produce a time in nanoseconds.\n func (f frequency) mul(t timestamp) eventTime {\n \treturn eventTime(float64(t) * float64(f))\n }"}, {"role": "assistant", "content": "docs: fix typo in frequency.mul comment"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 4 ++++\n 1 file changed, 4 insertions(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 50a83da..c4b88a4 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -7,6 +7,10 @@ hide:\n \n ## Latest Changes\n \n+### Translations\n+\n+* \ud83d\udd27 Add LLM prompt file for Simplified Chinese, generated from the existing translations. PR [#14549](https://github.com/fastapi/fastapi/pull/14549) by [@tiangolo](https://github.com/tiangolo).\n+\n ### Internal\n \n * \ud83d\udc77 Do not run translations on cron while finishing updating existing languages. PR [#14613](https://github.com/fastapi/fastapi/pull/14613) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: add chinese translation prompt to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/go.mod                                      |  2 +-\n src/cmd/go.sum                                      |  4 ++--\n .../x/tools/go/analysis/passes/modernize/doc.go     |  2 ++\n .../x/tools/go/analysis/passes/modernize/maps.go    | 21 ++++++++++++++++++++-\n .../tools/go/analysis/passes/modernize/modernize.go |  2 +-\n src/cmd/vendor/modules.txt                          |  2 +-\n 6 files changed, 27 insertions(+), 6 deletions(-)\n\ndiff --git a/src/cmd/go.mod b/src/cmd/go.mod\nindex c7d3cc61..85e8c4cb 100644\n--- a/src/cmd/go.mod\n+++ b/src/cmd/go.mod\n@@ -11,7 +11,7 @@ require (\n \tgolang.org/x/sys v0.39.0\n \tgolang.org/x/telemetry v0.0.0-20251128220624-abf20d0e57ec\n \tgolang.org/x/term v0.38.0\n-\tgolang.org/x/tools v0.39.1-0.20251205000126-062ef7b6ced2\n+\tgolang.org/x/tools v0.39.1-0.20251230210517-d44be789a05c\n )\n \n require (\ndiff --git a/src/cmd/go.sum b/src/cmd/go.sum\nindex b02c469a..61c88e52 100644\n--- a/src/cmd/go.sum\n+++ b/src/cmd/go.sum\n@@ -22,7 +22,7 @@ golang.org/x/term v0.38.0 h1:PQ5pkm/rLO6HnxFR7N2lJHOZX6Kez5Y1gDSJla6jo7Q=\n golang.org/x/term v0.38.0/go.mod h1:bSEAKrOT1W+VSu9TSCMtoGEOUcKxOKgl3LE5QEF/xVg=\n golang.org/x/text v0.32.0 h1:ZD01bjUt1FQ9WJ0ClOL5vxgxOI/sVCNgX1YtKwcY0mU=\n golang.org/x/text v0.32.0/go.mod h1:o/rUWzghvpD5TXrTIBuJU77MTaN0ljMWE47kxGJQ7jY=\n-golang.org/x/tools v0.39.1-0.20251205000126-062ef7b6ced2 h1:2Qqv605Nus9iUp3ErvEU/q92Q3HAzeROztzl9pzAno8=\n-golang.org/x/tools v0.39.1-0.20251205000126-062ef7b6ced2/go.mod h1:JnefbkDPyD8UU2kI5fuf8ZX4/yUeh9W877ZeBONxUqQ=\n+golang.org/x/tools v0.39.1-0.20251230210517-d44be789a05c h1:0pZej6BQOooNbOfjJEu4v5qx9hdwFX8HnvHCcNXcs2w=\n+golang.org/x/tools v0.39.1-0.20251230210517-d44be789a05c/go.mod h1:JnefbkDPyD8UU2kI5fuf8ZX4/yUeh9W877ZeBONxUqQ=\n rsc.io/markdown v0.0.0-20240306144322-0bf8f97ee8ef h1:mqLYrXCXYEZOop9/Dbo6RPX11539nwiCNBb1icVPmw8=\n rsc.io/markdown v0.0.0-20240306144322-0bf8f97ee8ef/go.mod h1:8xcPgWmwlZONN1D9bjxtHEjrUtSEa3fakVF8iaewYKQ=\ndiff --git a/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/doc.go b/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/doc.go\nindex 45aed790..f1202c7a 100644\n--- a/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/doc.go\n+++ b/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/doc.go\n@@ -80,6 +80,8 @@ or b.ResetTimer within the same function will also be removed.\n Caveats: The b.Loop() method is designed to prevent the compiler from\n optimizing away the benchmark loop, which can occasionally result in\n slower execution due to increased allocations in some specific cases.\n+Since its fix may change the performance of nanosecond-scale benchmarks,\n+bloop is disabled by default in the `go fix` analyzer suite; see golang/go#74967.\n \n # Analyzer any\n \ndiff --git a/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/maps.go b/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/maps.go\nindex f97541d4..795f5b6c 100644\n--- a/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/maps.go\n+++ b/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/maps.go\n@@ -231,9 +231,28 @@ func mapsloop(pass *analysis.Pass) (any, error) {\n \t\t\t\t// Have: for k, v := range x { lhs = rhs }\n \n \t\t\t\tassign := rng.Body.List[0].(*ast.AssignStmt)\n+\n+\t\t\t\t// usesKV reports whether e references vars k or v.\n+\t\t\t\tusesKV := func(e ast.Expr) bool {\n+\t\t\t\t\tk := info.Defs[rng.Key.(*ast.Ident)]\n+\t\t\t\t\tv := info.Defs[rng.Value.(*ast.Ident)]\n+\t\t\t\t\tfor n := range ast.Preorder(e) {\n+\t\t\t\t\t\tif id, ok := n.(*ast.Ident); ok {\n+\t\t\t\t\t\t\tobj := info.Uses[id]\n+\t\t\t\t\t\t\tif obj != nil && // don't rely on k, v being non-nil\n+\t\t\t\t\t\t\t\t(obj == k || obj == v) {\n+\t\t\t\t\t\t\t\treturn true\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t\treturn false\n+\t\t\t\t}\n+\n \t\t\t\tif index, ok := assign.Lhs[0].(*ast.IndexExpr); ok &&\n+\t\t\t\t\tlen(assign.Lhs) == 1 &&\n \t\t\t\t\tastutil.EqualSyntax(rng.Key, index.Index) &&\n-\t\t\t\t\tastutil.EqualSyntax(rng.Value, assign.Rhs[0]) {\n+\t\t\t\t\tastutil.EqualSyntax(rng.Value, assign.Rhs[0]) &&\n+\t\t\t\t\t!usesKV(index.X) { // reject (e.g.) f(k, v)[k] = v\n \t\t\t\t\tif tmap, ok := typeparams.CoreType(info.TypeOf(index.X)).(*types.Map); ok &&\n \t\t\t\t\t\ttypes.Identical(info.TypeOf(index), info.TypeOf(rng.Value)) && // m[k], v\n \t\t\t\t\t\ttypes.Identical(tmap.Key(), info.TypeOf(rng.Key)) {\ndiff --git a/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/modernize.go b/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/modernize.go\nindex 013ce79d..f09a2d26 100644\n--- a/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/modernize.go\n+++ b/src/cmd/vendor/golang.org/x/tools/go/analysis/passes/modernize/modernize.go\n@@ -34,7 +34,7 @@ var doc string\n var Suite = []*analysis.Analyzer{\n \tAnyAnalyzer,\n \t// AppendClippedAnalyzer, // not nil-preserving!\n-\tBLoopAnalyzer,\n+\t// BLoopAnalyzer, // may skew benchmark results, see golang/go#74967\n \tFmtAppendfAnalyzer,\n \tForVarAnalyzer,\n \tMapsLoopAnalyzer,\ndiff --git a/src/cmd/vendor/modules.txt b/src/cmd/vendor/modules.txt\nindex 7c122cd9..9c179c4b 100644\n--- a/src/cmd/vendor/modules.txt\n+++ b/src/cmd/vendor/modules.txt\n@@ -73,7 +73,7 @@ golang.org/x/text/internal/tag\n golang.org/x/text/language\n golang.org/x/text/transform\n golang.org/x/text/unicode/norm\n-# golang.org/x/tools v0.39.1-0.20251205000126-062ef7b6ced2\n+# golang.org/x/tools v0.39.1-0.20251230210517-d44be789a05c\n ## explicit; go 1.24.0\n golang.org/x/tools/cmd/bisect\n golang.org/x/tools/cover"}, {"role": "assistant", "content": "build(deps): update golang.org/x/tools"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/__tests__/ReactFlightDOMBrowser-test.js    | 33 ++++++----------------\n .../src/__tests__/ReactFlightDOMNode-test.js       | 16 ++++-------\n .../__tests__/ReactFlightAsyncDebugInfo-test.js    |  8 +++---\n 3 files changed, 19 insertions(+), 38 deletions(-)\n\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMBrowser-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMBrowser-test.js\nindex e2c1e74..412ec0c 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMBrowser-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMBrowser-test.js\n@@ -2820,15 +2820,16 @@ describe('ReactFlightDOMBrowser', () => {\n       },\n     });\n \n+    const app = ReactServer.createElement(\n+      ReactServer.Fragment,\n+      null,\n+      ReactServer.createElement(Paragraph, null, 'foo'),\n+      ReactServer.createElement(Paragraph, null, 'bar'),\n+    );\n     const stream = await serverAct(() =>\n       ReactServerDOMServer.renderToReadableStream(\n         {\n-          root: ReactServer.createElement(\n-            ReactServer.Fragment,\n-            null,\n-            ReactServer.createElement(Paragraph, null, 'foo'),\n-            ReactServer.createElement(Paragraph, null, 'bar'),\n-          ),\n+          root: app,\n         },\n         webpackMap,\n         {\n@@ -2900,27 +2901,11 @@ describe('ReactFlightDOMBrowser', () => {\n             \"name\": \"Paragraph\",\n             \"props\": {},\n             \"stack\": [\n-              [\n-                \"\",\n-                \"/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMBrowser-test.js\",\n-                2829,\n-                27,\n-                2823,\n-                34,\n-              ],\n-              [\n-                \"serverAct\",\n-                \"/packages/internal-test-utils/internalAct.js\",\n-                270,\n-                19,\n-                231,\n-                1,\n-              ],\n               [\n                 \"Object.<anonymous>\",\n                 \"/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMBrowser-test.js\",\n-                2823,\n-                18,\n+                2826,\n+                19,\n                 2810,\n                 89,\n               ],\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMNode-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMNode-test.js\nindex 1fe1cb1..805d204 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMNode-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMNode-test.js\n@@ -1216,11 +1216,7 @@ describe('ReactFlightDOMNode', () => {\n         const data1 = await getDynamicData1();\n         const data2 = await getDynamicData2();\n \n-        return (\n-          <p>\n-            {data1} {data2}\n-          </p>\n-        );\n+        return ReactServer.createElement('p', null, data1, ' ', data2);\n       }\n \n       function App() {\n@@ -1350,8 +1346,8 @@ describe('ReactFlightDOMNode', () => {\n               : '\\n') +\n             '    in body\\n' +\n             '    in html\\n' +\n-            '    in App (file://ReactFlightDOMNode-test.js:1233:25)\\n' +\n-            '    in ClientRoot (ReactFlightDOMNode-test.js:1308:16)',\n+            '    in App (file://ReactFlightDOMNode-test.js:1229:25)\\n' +\n+            '    in ClientRoot (ReactFlightDOMNode-test.js:1304:16)',\n         );\n       } else {\n         expect(\n@@ -1360,7 +1356,7 @@ describe('ReactFlightDOMNode', () => {\n           '\\n' +\n             '    in body\\n' +\n             '    in html\\n' +\n-            '    in ClientRoot (ReactFlightDOMNode-test.js:1308:16)',\n+            '    in ClientRoot (ReactFlightDOMNode-test.js:1304:16)',\n         );\n       }\n \n@@ -1371,7 +1367,7 @@ describe('ReactFlightDOMNode', () => {\n           ).toBe(\n             '\\n' +\n               '    in Dynamic (file://ReactFlightDOMNode-test.js:1216:27)\\n' +\n-              '    in App (file://ReactFlightDOMNode-test.js:1233:25)',\n+              '    in App (file://ReactFlightDOMNode-test.js:1229:25)',\n           );\n         } else {\n           expect(\n@@ -1379,7 +1375,7 @@ describe('ReactFlightDOMNode', () => {\n           ).toBe(\n             '' +\n               '\\n' +\n-              '    in App (file://ReactFlightDOMNode-test.js:1233:25)',\n+              '    in App (file://ReactFlightDOMNode-test.js:1229:25)',\n           );\n         }\n       } else {\ndiff --git a/packages/react-server/src/__tests__/ReactFlightAsyncDebugInfo-test.js b/packages/react-server/src/__tests__/ReactFlightAsyncDebugInfo-test.js\nindex 465eac9..2570c0d 100644\n--- a/packages/react-server/src/__tests__/ReactFlightAsyncDebugInfo-test.js\n+++ b/packages/react-server/src/__tests__/ReactFlightAsyncDebugInfo-test.js\n@@ -3155,7 +3155,7 @@ describe('ReactFlightAsyncDebugInfo', () => {\n     }\n \n     const stream = ReactServerDOMServer.renderToPipeableStream(\n-      <Component />,\n+      ReactServer.createElement(Component),\n       {},\n     );\n \n@@ -3192,7 +3192,7 @@ describe('ReactFlightAsyncDebugInfo', () => {\n                 \"Object.<anonymous>\",\n                 \"/packages/react-server/src/__tests__/ReactFlightAsyncDebugInfo-test.js\",\n                 3158,\n-                40,\n+                19,\n                 3146,\n                 36,\n               ],\n@@ -3216,7 +3216,7 @@ describe('ReactFlightAsyncDebugInfo', () => {\n                     \"Object.<anonymous>\",\n                     \"/packages/react-server/src/__tests__/ReactFlightAsyncDebugInfo-test.js\",\n                     3158,\n-                    40,\n+                    19,\n                     3146,\n                     36,\n                   ],\n@@ -3248,7 +3248,7 @@ describe('ReactFlightAsyncDebugInfo', () => {\n                   \"Object.<anonymous>\",\n                   \"/packages/react-server/src/__tests__/ReactFlightAsyncDebugInfo-test.js\",\n                   3158,\n-                  40,\n+                  19,\n                   3146,\n                   36,\n                 ],"}, {"role": "assistant", "content": "test: update flight test snapshots and line numbers"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/content/tools/libraries/angular-package-format.md | 2 ++\n 1 file changed, 2 insertions(+)\n\ndiff --git a/adev/src/content/tools/libraries/angular-package-format.md b/adev/src/content/tools/libraries/angular-package-format.md\nindex 9f29cfb2..4254feed 100644\n--- a/adev/src/content/tools/libraries/angular-package-format.md\n+++ b/adev/src/content/tools/libraries/angular-package-format.md\n@@ -206,6 +206,7 @@ The Angular compiler can generate index ES module files. Tools like Rollup can u\n \n FESM is a file format created by flattening all ES Modules accessible from an entrypoint into a single ES Module.\n It's formed by following all imports from a package and copying that code into a single file while preserving all public ES exports and removing all private imports.\n+However, in some cases, the FESM may depend on shared chunks that are shared between multiple entry points.\n \n The abbreviated name, FESM, pronounced _phe-som_, can be followed by a number such as FESM2020.\n The number refers to the language level of the JavaScript inside the module.\n@@ -300,6 +301,7 @@ Short for ECMAScript Modules \\(see above\\).\n ### FESM\n \n Short for Flattened ES Modules and consists of a file format created by flattening all ES Modules accessible from an entry point into a single ES Module.\n+Note that FESM is typically a single file, but it can depend on a shared chunk that is shared with other FESMs.\n \n ### Module ID\n "}, {"role": "assistant", "content": "docs: clarify that FESM can depend on shared chunks"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/reactivity/__tests__/readonly.spec.ts   | 13 ++++++\n packages/reactivity/src/arrayInstrumentations.ts | 54 ++++++++++++++++++++----\n 2 files changed, 58 insertions(+), 9 deletions(-)\n\ndiff --git a/packages/reactivity/__tests__/readonly.spec.ts b/packages/reactivity/__tests__/readonly.spec.ts\nindex a6f7542..96e688e 100644\n--- a/packages/reactivity/__tests__/readonly.spec.ts\n+++ b/packages/reactivity/__tests__/readonly.spec.ts\n@@ -172,6 +172,19 @@ describe('reactivity/readonly', () => {\n       expect(dummy).toBe(1)\n       expect(`target is readonly`).toHaveBeenWarnedTimes(2)\n     })\n+\n+    it('should maintain identity when iterating readonly ref array', () => {\n+      const list = readonly(ref([{}, {}, {}]))\n+      const computedList = computed(() => {\n+        const newList: any[] = []\n+        list.value.forEach(x => newList.push(x))\n+        return newList\n+      })\n+\n+      expect(list.value[0]).toBe(computedList.value[0])\n+      expect(isReadonly(computedList.value[0])).toBe(true)\n+      expect(isReactive(computedList.value[0])).toBe(true)\n+    })\n   })\n \n   const maps = [Map, WeakMap]\ndiff --git a/packages/reactivity/src/arrayInstrumentations.ts b/packages/reactivity/src/arrayInstrumentations.ts\nindex 981a10d..f37b056 100644\n--- a/packages/reactivity/src/arrayInstrumentations.ts\n+++ b/packages/reactivity/src/arrayInstrumentations.ts\n@@ -1,6 +1,14 @@\n import { TrackOpTypes } from './constants'\n import { endBatch, pauseTracking, resetTracking, startBatch } from './effect'\n-import { isProxy, isShallow, toRaw, toReactive } from './reactive'\n+import {\n+  isProxy,\n+  isReactive,\n+  isReadonly,\n+  isShallow,\n+  toRaw,\n+  toReactive,\n+  toReadonly,\n+} from './reactive'\n import { ARRAY_ITERATE_KEY, track } from './dep'\n import { isArray } from '@vue/shared'\n \n@@ -24,11 +32,18 @@ export function shallowReadArray<T>(arr: T[]): T[] {\n   return arr\n }\n \n+function toWrapped(target: unknown, item: unknown) {\n+  if (isReadonly(target)) {\n+    return isReactive(target) ? toReadonly(toReactive(item)) : toReadonly(item)\n+  }\n+  return toReactive(item)\n+}\n+\n export const arrayInstrumentations: Record<string | symbol, Function> = <any>{\n   __proto__: null,\n \n   [Symbol.iterator]() {\n-    return iterator(this, Symbol.iterator, toReactive)\n+    return iterator(this, Symbol.iterator, item => toWrapped(this, item))\n   },\n \n   concat(...args: unknown[]) {\n@@ -39,7 +54,7 @@ export const arrayInstrumentations: Record<string | symbol, Function> = <any>{\n \n   entries() {\n     return iterator(this, 'entries', (value: [number, unknown]) => {\n-      value[1] = toReactive(value[1])\n+      value[1] = toWrapped(this, value[1])\n       return value\n     })\n   },\n@@ -55,14 +70,28 @@ export const arrayInstrumentations: Record<string | symbol, Function> = <any>{\n     fn: (item: unknown, index: number, array: unknown[]) => unknown,\n     thisArg?: unknown,\n   ) {\n-    return apply(this, 'filter', fn, thisArg, v => v.map(toReactive), arguments)\n+    return apply(\n+      this,\n+      'filter',\n+      fn,\n+      thisArg,\n+      v => v.map((item: unknown) => toWrapped(this, item)),\n+      arguments,\n+    )\n   },\n \n   find(\n     fn: (item: unknown, index: number, array: unknown[]) => boolean,\n     thisArg?: unknown,\n   ) {\n-    return apply(this, 'find', fn, thisArg, toReactive, arguments)\n+    return apply(\n+      this,\n+      'find',\n+      fn,\n+      thisArg,\n+      item => toWrapped(this, item),\n+      arguments,\n+    )\n   },\n \n   findIndex(\n@@ -76,7 +105,14 @@ export const arrayInstrumentations: Record<string | symbol, Function> = <any>{\n     fn: (item: unknown, index: number, array: unknown[]) => boolean,\n     thisArg?: unknown,\n   ) {\n-    return apply(this, 'findLast', fn, thisArg, toReactive, arguments)\n+    return apply(\n+      this,\n+      'findLast',\n+      fn,\n+      thisArg,\n+      item => toWrapped(this, item),\n+      arguments,\n+    )\n   },\n \n   findLastIndex(\n@@ -189,7 +225,7 @@ export const arrayInstrumentations: Record<string | symbol, Function> = <any>{\n   },\n \n   values() {\n-    return iterator(this, 'values', toReactive)\n+    return iterator(this, 'values', item => toWrapped(this, item))\n   },\n }\n \n@@ -257,7 +293,7 @@ function apply(\n   if (arr !== self) {\n     if (needsWrap) {\n       wrappedFn = function (this: unknown, item, index) {\n-        return fn.call(this, toReactive(item), index, self)\n+        return fn.call(this, toWrapped(self, item), index, self)\n       }\n     } else if (fn.length > 2) {\n       wrappedFn = function (this: unknown, item, index) {\n@@ -281,7 +317,7 @@ function reduce(\n   if (arr !== self) {\n     if (!isShallow(self)) {\n       wrappedFn = function (this: unknown, acc, item, index) {\n-        return fn.call(this, acc, toReactive(item), index, self)\n+        return fn.call(this, acc, toWrapped(self, item), index, self)\n       }\n     } else if (fn.length > 3) {\n       wrappedFn = function (this: unknown, acc, item, index) {"}, {"role": "assistant", "content": "fix(reactivity): maintain readonly identity when iterating arrays"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .eslintrc.js                                       |  1 +\n packages/internal-test-utils/debugInfo.js          |  6 +----\n .../react-client/src/__tests__/ReactFlight-test.js |  5 +---\n .../src/__tests__/ReactFlightDOMEdge-test.js       | 28 +++++++++++++++-------\n scripts/jest/setupTests.js                         |  4 ++++\n 5 files changed, 27 insertions(+), 17 deletions(-)\n\ndiff --git a/.eslintrc.js b/.eslintrc.js\nindex 86ad482..dec7cd8 100644\n--- a/.eslintrc.js\n+++ b/.eslintrc.js\n@@ -635,6 +635,7 @@ module.exports = {\n     FocusOptions: 'readonly',\n     OptionalEffectTiming: 'readonly',\n \n+    __REACT_ROOT_PATH_TEST__: 'readonly',\n     spyOnDev: 'readonly',\n     spyOnDevAndProd: 'readonly',\n     spyOnProd: 'readonly',\ndiff --git a/packages/internal-test-utils/debugInfo.js b/packages/internal-test-utils/debugInfo.js\nindex 75183ce..b749c8d 100644\n--- a/packages/internal-test-utils/debugInfo.js\n+++ b/packages/internal-test-utils/debugInfo.js\n@@ -1,9 +1,5 @@\n 'use strict';\n \n-const path = require('path');\n-\n-const repoRoot = path.resolve(__dirname, '../../');\n-\n type DebugInfoConfig = {\n   ignoreProps?: boolean,\n   ignoreRscStreamInfo?: boolean,\n@@ -34,7 +30,7 @@ function normalizeStack(stack) {\n     const [name, file, line, col, enclosingLine, enclosingCol] = stack[i];\n     copy.push([\n       name,\n-      file.replace(repoRoot, ''),\n+      file.replace(__REACT_ROOT_PATH_TEST__, ''),\n       line,\n       col,\n       enclosingLine,\ndiff --git a/packages/react-client/src/__tests__/ReactFlight-test.js b/packages/react-client/src/__tests__/ReactFlight-test.js\nindex d642a02..b2dcd69 100644\n--- a/packages/react-client/src/__tests__/ReactFlight-test.js\n+++ b/packages/react-client/src/__tests__/ReactFlight-test.js\n@@ -10,8 +10,6 @@\n \n 'use strict';\n \n-const path = require('path');\n-\n if (typeof Blob === 'undefined') {\n   global.Blob = require('buffer').Blob;\n }\n@@ -33,9 +31,8 @@ function normalizeCodeLocInfo(str) {\n   );\n }\n \n-const repoRoot = path.resolve(__dirname, '../../../../');\n function normalizeReactCodeLocInfo(str) {\n-  const repoRootForRegexp = repoRoot.replace(/\\//g, '\\\\/');\n+  const repoRootForRegexp = __REACT_ROOT_PATH_TEST__.replace(/\\//g, '\\\\/');\n   const repoFileLocMatch = new RegExp(`${repoRootForRegexp}.+?:\\\\d+:\\\\d+`, 'g');\n   return str && str.replace(repoFileLocMatch, '**');\n }\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMEdge-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMEdge-test.js\nindex a7290f9..995f0da 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMEdge-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMEdge-test.js\n@@ -39,6 +39,10 @@ function normalizeCodeLocInfo(str) {\n   );\n }\n \n+function normalizeSerializedContent(str) {\n+  return str.replaceAll(__REACT_ROOT_PATH_TEST__, '**');\n+}\n+\n describe('ReactFlightDOMEdge', () => {\n   beforeEach(() => {\n     // Mock performance.now for timing tests\n@@ -481,8 +485,10 @@ describe('ReactFlightDOMEdge', () => {\n     );\n     const [stream1, stream2] = passThrough(stream).tee();\n \n-    const serializedContent = await readResult(stream1);\n-    expect(serializedContent.length).toBeLessThan(1100);\n+    const serializedContent = normalizeSerializedContent(\n+      await readResult(stream1),\n+    );\n+    expect(serializedContent.length).toBeLessThan(1075);\n \n     const result = await ReactServerDOMClient.createFromReadableStream(\n       stream2,\n@@ -551,9 +557,11 @@ describe('ReactFlightDOMEdge', () => {\n     );\n     const [stream1, stream2] = passThrough(stream).tee();\n \n-    const serializedContent = await readResult(stream1);\n+    const serializedContent = normalizeSerializedContent(\n+      await readResult(stream1),\n+    );\n \n-    expect(serializedContent.length).toBeLessThan(490);\n+    expect(serializedContent.length).toBeLessThan(465);\n     expect(timesRendered).toBeLessThan(5);\n \n     const model = await ReactServerDOMClient.createFromReadableStream(stream2, {\n@@ -623,8 +631,10 @@ describe('ReactFlightDOMEdge', () => {\n     );\n     const [stream1, stream2] = passThrough(stream).tee();\n \n-    const serializedContent = await readResult(stream1);\n-    expect(serializedContent.length).toBeLessThan(__DEV__ ? 680 : 400);\n+    const serializedContent = normalizeSerializedContent(\n+      await readResult(stream1),\n+    );\n+    expect(serializedContent.length).toBeLessThan(__DEV__ ? 630 : 400);\n     expect(timesRendered).toBeLessThan(5);\n \n     const model = await serverAct(() =>\n@@ -657,8 +667,10 @@ describe('ReactFlightDOMEdge', () => {\n         <ServerComponent recurse={20} />,\n       ),\n     );\n-    const serializedContent = await readResult(stream);\n-    const expectedDebugInfoSize = __DEV__ ? 320 * 20 : 0;\n+    const serializedContent = normalizeSerializedContent(\n+      await readResult(stream),\n+    );\n+    const expectedDebugInfoSize = __DEV__ ? 295 * 20 : 0;\n     expect(serializedContent.length).toBeLessThan(150 + expectedDebugInfoSize);\n   });\n \ndiff --git a/scripts/jest/setupTests.js b/scripts/jest/setupTests.js\nindex 758ac5e..c3d3408 100644\n--- a/scripts/jest/setupTests.js\n+++ b/scripts/jest/setupTests.js\n@@ -6,6 +6,7 @@ const {\n   resetAllUnexpectedConsoleCalls,\n   patchConsoleMethods,\n } = require('internal-test-utils/consoleMock');\n+const path = require('path');\n \n if (process.env.REACT_CLASS_EQUIVALENCE_TEST) {\n   // Inside the class equivalence tester, we have a custom environment, let's\n@@ -18,6 +19,9 @@ if (process.env.REACT_CLASS_EQUIVALENCE_TEST) {\n   const spyOn = jest.spyOn;\n   const noop = jest.fn;\n \n+  // Can be used to normalize paths in stackframes\n+  global.__REACT_ROOT_PATH_TEST__ = path.resolve(__dirname, '../..');\n+\n   // Spying on console methods in production builds can mask errors.\n   // This is why we added an explicit spyOnDev() helper.\n   // It's too easy to accidentally use the more familiar spyOn() helper though,"}, {"role": "assistant", "content": "test: normalize repo root path in test assertions"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/content/guide/components/queries.md | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/adev/src/content/guide/components/queries.md b/adev/src/content/guide/components/queries.md\nindex eb0ac018..badbc171 100644\n--- a/adev/src/content/guide/components/queries.md\n+++ b/adev/src/content/guide/components/queries.md\n@@ -107,7 +107,7 @@ By default, content queries find only _direct_ children of the component and do\n \n You can also query for multiple results with the `contentChildren` function.\n \n-```angular-ts {highlight: [14, 16, 17, 18, 19, 20]}\n+```angular-ts {highlight: [15, 16]}\n @Component({\n   selector: 'custom-menu-item',\n   /*...*/"}, {"role": "assistant", "content": "docs: correct line number highlighting in query examples"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/react-dom-bindings/src/client/ReactDOMComponentTree.js | 6 ++++++\n 1 file changed, 6 insertions(+)\n\ndiff --git a/packages/react-dom-bindings/src/client/ReactDOMComponentTree.js b/packages/react-dom-bindings/src/client/ReactDOMComponentTree.js\nindex 2063e5e..01e4fcd 100644\n--- a/packages/react-dom-bindings/src/client/ReactDOMComponentTree.js\n+++ b/packages/react-dom-bindings/src/client/ReactDOMComponentTree.js\n@@ -75,6 +75,9 @@ export function detachDeletedInstance(node: Instance): void {\n     delete (node: any)[internalEventHandlerListenersKey];\n     delete (node: any)[internalEventHandlesSetKey];\n     delete (node: any)[internalRootNodeResourcesKey];\n+    if (__DEV__) {\n+      delete (node: any)[internalInstanceKey];\n+    }\n     return;\n   }\n   // TODO: This function is only called on host components. I don't think all of\n@@ -97,6 +100,9 @@ export function precacheFiberNode(\n ): void {\n   if (enableInternalInstanceMap) {\n     internalInstanceMap.set(node, hostInst);\n+    if (__DEV__) {\n+      (node: any)[internalInstanceKey] = hostInst;\n+    }\n     return;\n   }\n   (node: any)[internalInstanceKey] = hostInst;"}, {"role": "assistant", "content": "fix(react-dom): add dev-mode instance key cleanup and caching"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/events/plugins/FormActionEventPlugin.js    | 32 ++--------------------\n .../ReactDOMFizzInstructionSetInlineCodeStrings.js |  2 +-\n .../ReactDOMFizzInstructionSetShared.js            | 20 +-------------\n .../react-dom/src/__tests__/ReactDOMForm-test.js   | 24 ++++++++++++----\n .../src/__tests__/ReactFlightDOMForm-test.js       | 12 +-------\n 5 files changed, 24 insertions(+), 66 deletions(-)\n\ndiff --git a/packages/react-dom-bindings/src/events/plugins/FormActionEventPlugin.js b/packages/react-dom-bindings/src/events/plugins/FormActionEventPlugin.js\nindex 496b55e..420d1d1 100644\n--- a/packages/react-dom-bindings/src/events/plugins/FormActionEventPlugin.js\n+++ b/packages/react-dom-bindings/src/events/plugins/FormActionEventPlugin.js\n@@ -45,30 +45,6 @@ function coerceFormActionProp(\n   }\n }\n \n-function createFormDataWithSubmitter(\n-  form: HTMLFormElement,\n-  submitter: HTMLInputElement | HTMLButtonElement,\n-) {\n-  // The submitter's value should be included in the FormData.\n-  // It should be in the document order in the form.\n-  // Since the FormData constructor invokes the formdata event it also\n-  // needs to be available before that happens so after construction it's too\n-  // late. We use a temporary fake node for the duration of this event.\n-  // TODO: FormData takes a second argument that it's the submitter but this\n-  // is fairly new so not all browsers support it yet. Switch to that technique\n-  // when available.\n-  const temp = submitter.ownerDocument.createElement('input');\n-  temp.name = submitter.name;\n-  temp.value = submitter.value;\n-  if (form.id) {\n-    temp.setAttribute('form', form.id);\n-  }\n-  (submitter.parentNode: any).insertBefore(temp, submitter);\n-  const formData = new FormData(form);\n-  (temp.parentNode: any).removeChild(temp);\n-  return formData;\n-}\n-\n /**\n  * This plugin invokes action functions on forms, inputs and buttons if\n  * the form doesn't prevent default.\n@@ -129,9 +105,7 @@ function extractEvents(\n       if (didCurrentEventScheduleTransition()) {\n         // We're going to set the pending form status, but because the submission\n         // was prevented, we should not fire the action function.\n-        const formData = submitter\n-          ? createFormDataWithSubmitter(form, submitter)\n-          : new FormData(form);\n+        const formData = new FormData(form, submitter);\n         const pendingState: FormStatus = {\n           pending: true,\n           data: formData,\n@@ -160,9 +134,7 @@ function extractEvents(\n       event.preventDefault();\n \n       // Dispatch the action and set a pending form status.\n-      const formData = submitter\n-        ? createFormDataWithSubmitter(form, submitter)\n-        : new FormData(form);\n+      const formData = new FormData(form, submitter);\n       const pendingState: FormStatus = {\n         pending: true,\n         data: formData,\ndiff --git a/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetInlineCodeStrings.js b/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetInlineCodeStrings.js\nindex cac2283..eca449b 100644\n--- a/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetInlineCodeStrings.js\n+++ b/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetInlineCodeStrings.js\n@@ -14,4 +14,4 @@ export const completeBoundaryWithStyles =\n export const completeSegment =\n   '$RS=function(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};';\n export const formReplaying =\n-  'addEventListener(\"submit\",function(a){if(!a.defaultPrevented){var c=a.target,d=a.submitter,e=c.action,b=d;if(d){var f=d.getAttribute(\"formAction\");null!=f&&(e=f,b=null)}\"javascript:throw new Error(\\'React form unexpectedly submitted.\\')\"===e&&(a.preventDefault(),b?(a=document.createElement(\"input\"),a.name=b.name,a.value=b.value,b.parentNode.insertBefore(a,b),b=new FormData(c),a.parentNode.removeChild(a)):b=new FormData(c),a=c.ownerDocument||c,(a.$$reactFormReplay=a.$$reactFormReplay||[]).push(c,d,b))}});';\n+  'addEventListener(\"submit\",function(a){if(!a.defaultPrevented){var b=a.target,d=a.submitter,c=b.action,e=d;if(d){var f=d.getAttribute(\"formAction\");null!=f&&(c=f,e=null)}\"javascript:throw new Error(\\'React form unexpectedly submitted.\\')\"===c&&(a.preventDefault(),a=new FormData(b,e),c=b.ownerDocument||b,(c.$$reactFormReplay=c.$$reactFormReplay||[]).push(b,d,a))}});';\ndiff --git a/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetShared.js b/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetShared.js\nindex efe3ad4..86d8801 100644\n--- a/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetShared.js\n+++ b/packages/react-dom-bindings/src/server/fizz-instruction-set/ReactDOMFizzInstructionSetShared.js\n@@ -634,25 +634,7 @@ export function listenToFormSubmissionsForReplaying() {\n     event.preventDefault();\n \n     // Take a snapshot of the FormData at the time of the event.\n-    let formData;\n-    if (formDataSubmitter) {\n-      // The submitter's value should be included in the FormData.\n-      // It should be in the document order in the form.\n-      // Since the FormData constructor invokes the formdata event it also\n-      // needs to be available before that happens so after construction it's too\n-      // late. We use a temporary fake node for the duration of this event.\n-      // TODO: FormData takes a second argument that it's the submitter but this\n-      // is fairly new so not all browsers support it yet. Switch to that technique\n-      // when available.\n-      const temp = document.createElement('input');\n-      temp.name = formDataSubmitter.name;\n-      temp.value = formDataSubmitter.value;\n-      formDataSubmitter.parentNode.insertBefore(temp, formDataSubmitter);\n-      formData = new FormData(form);\n-      temp.parentNode.removeChild(temp);\n-    } else {\n-      formData = new FormData(form);\n-    }\n+    const formData = new FormData(form, formDataSubmitter);\n \n     // Queue for replaying later. This field could potentially be shared with multiple\n     // Reacts on the same page since each one will preventDefault for the next one.\ndiff --git a/packages/react-dom/src/__tests__/ReactDOMForm-test.js b/packages/react-dom/src/__tests__/ReactDOMForm-test.js\nindex 96021e3..21995b6 100644\n--- a/packages/react-dom/src/__tests__/ReactDOMForm-test.js\n+++ b/packages/react-dom/src/__tests__/ReactDOMForm-test.js\n@@ -14,8 +14,8 @@ global.IS_REACT_ACT_ENVIRONMENT = true;\n // Our current version of JSDOM doesn't implement the event dispatching\n // so we polyfill it.\n const NativeFormData = global.FormData;\n-const FormDataPolyfill = function FormData(form) {\n-  const formData = new NativeFormData(form);\n+const FormDataPolyfill = function FormData(form, submitter) {\n+  const formData = new NativeFormData(form, submitter);\n   const formDataEvent = new Event('formdata', {\n     bubbles: true,\n     cancelable: false,\n@@ -489,11 +489,16 @@ describe('ReactDOMForm', () => {\n     const inputRef = React.createRef();\n     const buttonRef = React.createRef();\n     const outsideButtonRef = React.createRef();\n+    const imageButtonRef = React.createRef();\n     let button;\n+    let buttonX;\n+    let buttonY;\n     let title;\n \n     function action(formData) {\n       button = formData.get('button');\n+      buttonX = formData.get('button.x');\n+      buttonY = formData.get('button.y');\n       title = formData.get('title');\n     }\n \n@@ -508,6 +513,12 @@ describe('ReactDOMForm', () => {\n             <button name=\"button\" value=\"edit\" ref={buttonRef}>\n               Edit\n             </button>\n+            <input\n+              type=\"image\"\n+              name=\"button\"\n+              href=\"/some/image.png\"\n+              ref={imageButtonRef}\n+            />\n           </form>\n           <form id=\"form\" action={action}>\n             <input type=\"text\" name=\"title\" defaultValue=\"hello\" />\n@@ -546,9 +557,12 @@ describe('ReactDOMForm', () => {\n     expect(button).toBe('outside');\n     expect(title).toBe('hello');\n \n-    // Ensure that the type field got correctly restored\n-    expect(inputRef.current.getAttribute('type')).toBe('submit');\n-    expect(buttonRef.current.getAttribute('type')).toBe(null);\n+    await submit(imageButtonRef.current);\n+\n+    expect(button).toBe(null);\n+    expect(buttonX).toBe('0');\n+    expect(buttonY).toBe('0');\n+    expect(title).toBe('hello');\n   });\n \n   it('excludes the submitter name when the submitter is a function action', async () => {\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMForm-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMForm-test.js\nindex bb7c2c9..5cb8504 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMForm-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMForm-test.js\n@@ -121,17 +121,7 @@ describe('ReactFlightDOMForm', () => {\n       const method = (submitter && submitter.formMethod) || form.method;\n       const encType = (submitter && submitter.formEnctype) || form.enctype;\n       if (method === 'post' && encType === 'multipart/form-data') {\n-        let formData;\n-        if (submitter) {\n-          const temp = document.createElement('input');\n-          temp.name = submitter.name;\n-          temp.value = submitter.value;\n-          submitter.parentNode.insertBefore(temp, submitter);\n-          formData = new FormData(form);\n-          temp.parentNode.removeChild(temp);\n-        } else {\n-          formData = new FormData(form);\n-        }\n+        const formData = new FormData(form, submitter);\n         return POST(formData);\n       }\n       throw new Error('Navigate to: ' + action);"}, {"role": "assistant", "content": "refactor: use native FormData submitter parameter"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n package.json   |  4 ++--\n pnpm-lock.yaml | 24 ++++++++++++------------\n 2 files changed, 14 insertions(+), 14 deletions(-)\n\ndiff --git a/package.json b/package.json\nindex 6800cb1..b9ed27e 100644\n--- a/package.json\n+++ b/package.json\n@@ -64,8 +64,8 @@\n   \"devDependencies\": {\n     \"@babel/parser\": \"catalog:\",\n     \"@babel/types\": \"catalog:\",\n-    \"@rollup/plugin-alias\": \"^5.1.1\",\n-    \"@rollup/plugin-commonjs\": \"^28.0.9\",\n+    \"@rollup/plugin-alias\": \"^6.0.0\",\n+    \"@rollup/plugin-commonjs\": \"^29.0.0\",\n     \"@rollup/plugin-json\": \"^6.1.0\",\n     \"@rollup/plugin-node-resolve\": \"^16.0.3\",\n     \"@rollup/plugin-replace\": \"5.0.4\",\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 1cd7b36..c550a30 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -39,11 +39,11 @@ importers:\n         specifier: 'catalog:'\n         version: 7.28.5\n       '@rollup/plugin-alias':\n-        specifier: ^5.1.1\n-        version: 5.1.1(rollup@4.53.3)\n+        specifier: ^6.0.0\n+        version: 6.0.0(rollup@4.53.3)\n       '@rollup/plugin-commonjs':\n-        specifier: ^28.0.9\n-        version: 28.0.9(rollup@4.53.3)\n+        specifier: ^29.0.0\n+        version: 29.0.0(rollup@4.53.3)\n       '@rollup/plugin-json':\n         specifier: ^6.1.0\n         version: 6.1.0(rollup@4.53.3)\n@@ -1041,17 +1041,17 @@ packages:\n   '@rolldown/pluginutils@1.0.0-beta.53':\n     resolution: {integrity: sha512-vENRlFU4YbrwVqNDZ7fLvy+JR1CRkyr01jhSiDpE1u6py3OMzQfztQU2jxykW3ALNxO4kSlqIDeYyD0Y9RcQeQ==}\n \n-  '@rollup/plugin-alias@5.1.1':\n-    resolution: {integrity: sha512-PR9zDb+rOzkRb2VD+EuKB7UC41vU5DIwZ5qqCpk0KJudcWAyi8rvYOhS7+L5aZCspw1stTViLgN5v6FF1p5cgQ==}\n-    engines: {node: '>=14.0.0'}\n+  '@rollup/plugin-alias@6.0.0':\n+    resolution: {integrity: sha512-tPCzJOtS7uuVZd+xPhoy5W4vThe6KWXNmsFCNktaAh5RTqcLiSfT4huPQIXkgJ6YCOjJHvecOAzQxLFhPxKr+g==}\n+    engines: {node: '>=20.19.0'}\n     peerDependencies:\n-      rollup: ^1.20.0||^2.0.0||^3.0.0||^4.0.0\n+      rollup: '>=4.0.0'\n     peerDependenciesMeta:\n       rollup:\n         optional: true\n \n-  '@rollup/plugin-commonjs@28.0.9':\n-    resolution: {integrity: sha512-PIR4/OHZ79romx0BVVll/PkwWpJ7e5lsqFa3gFfcrFPWwLXLV39JVUzQV9RKjWerE7B845Hqjj9VYlQeieZ2dA==}\n+  '@rollup/plugin-commonjs@29.0.0':\n+    resolution: {integrity: sha512-U2YHaxR2cU/yAiwKJtJRhnyLk7cifnQw0zUpISsocBDoHDJn+HTV74ABqnwr5bEgWUwFZC9oFL6wLe21lHu5eQ==}\n     engines: {node: '>=16.0.0 || 14 >= 14.17'}\n     peerDependencies:\n       rollup: ^2.68.0||^3.0.0||^4.0.0\n@@ -4122,11 +4122,11 @@ snapshots:\n \n   '@rolldown/pluginutils@1.0.0-beta.53': {}\n \n-  '@rollup/plugin-alias@5.1.1(rollup@4.53.3)':\n+  '@rollup/plugin-alias@6.0.0(rollup@4.53.3)':\n     optionalDependencies:\n       rollup: 4.53.3\n \n-  '@rollup/plugin-commonjs@28.0.9(rollup@4.53.3)':\n+  '@rollup/plugin-commonjs@29.0.0(rollup@4.53.3)':\n     dependencies:\n       '@rollup/pluginutils': 5.1.0(rollup@4.53.3)\n       commondir: 1.0.1"}, {"role": "assistant", "content": "build(deps): update rollup plugins"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../runtime-core/__tests__/apiCreateApp.spec.ts    | 40 ++++++++++++++++++++++\n packages/runtime-core/src/renderer.ts              |  4 ++-\n 2 files changed, 43 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/runtime-core/__tests__/apiCreateApp.spec.ts b/packages/runtime-core/__tests__/apiCreateApp.spec.ts\nindex b578fa5..b4443f0 100644\n--- a/packages/runtime-core/__tests__/apiCreateApp.spec.ts\n+++ b/packages/runtime-core/__tests__/apiCreateApp.spec.ts\n@@ -645,6 +645,46 @@ describe('api: createApp', () => {\n     expect(order).toMatchObject(['render', 'render', 'post watcher'])\n   })\n \n+  // #14215\n+  test(\"unmount new app should not trigger other app's watcher\", async () => {\n+    const compWatcherTriggerFn = vi.fn()\n+    const data = ref(true)\n+    const foo = ref('')\n+\n+    const createNewApp = () => {\n+      const app = createApp({ render: () => h('new app') })\n+      const wrapper = nodeOps.createElement('div')\n+      app.mount(wrapper)\n+      return function destroy() {\n+        app.unmount()\n+      }\n+    }\n+\n+    const Comp = defineComponent({\n+      setup() {\n+        watch(() => foo.value, compWatcherTriggerFn)\n+        return () => h('div', 'comp')\n+      },\n+    })\n+\n+    const App = defineComponent({\n+      setup() {\n+        return () => (data.value ? h(Comp) : null)\n+      },\n+    })\n+\n+    createApp(App).mount(nodeOps.createElement('div'))\n+    await nextTick()\n+\n+    data.value = false\n+    const destroy = createNewApp()\n+    foo.value = 'bar'\n+    destroy()\n+    await nextTick()\n+\n+    expect(compWatcherTriggerFn).toBeCalledTimes(0)\n+  })\n+\n   // config.compilerOptions is tested in packages/vue since it is only\n   // supported in the full build.\n })\ndiff --git a/packages/runtime-core/src/renderer.ts b/packages/runtime-core/src/renderer.ts\nindex 6558796..d20bb2e 100644\n--- a/packages/runtime-core/src/renderer.ts\n+++ b/packages/runtime-core/src/renderer.ts\n@@ -2394,9 +2394,11 @@ function baseCreateRenderer(\n \n   let isFlushing = false\n   const render: RootRenderFunction = (vnode, container, namespace) => {\n+    let instance\n     if (vnode == null) {\n       if (container._vnode) {\n         unmount(container._vnode, null, null, true)\n+        instance = container._vnode.component\n       }\n     } else {\n       patch(\n@@ -2412,7 +2414,7 @@ function baseCreateRenderer(\n     container._vnode = vnode\n     if (!isFlushing) {\n       isFlushing = true\n-      flushPreFlushCbs()\n+      flushPreFlushCbs(instance)\n       flushPostFlushCbs()\n       isFlushing = false\n     }"}, {"role": "assistant", "content": "fix: prevent unmount from triggering other app's watchers"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_builtin_macros/messages.ftl   |  2 +\n compiler/rustc_builtin_macros/src/eii.rs     | 91 +++++++++-------------------\n compiler/rustc_builtin_macros/src/errors.rs  | 10 +++\n tests/ui/eii/error_statement_position.rs     | 15 ++---\n tests/ui/eii/error_statement_position.stderr | 13 +++-\n 5 files changed, 61 insertions(+), 70 deletions(-)"}, {"role": "assistant", "content": "refactor(eii): improve error handling and simplify macro implementation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../__snapshots__/transformExpressions.spec.ts.snap          | 10 ----------\n .../__tests__/transforms/transformExpressions.spec.ts        |  8 --------\n packages/compiler-core/src/transforms/transformExpression.ts | 12 ++++--------\n 3 files changed, 4 insertions(+), 26 deletions(-)\n\ndiff --git a/packages/compiler-core/__tests__/transforms/__snapshots__/transformExpressions.spec.ts.snap b/packages/compiler-core/__tests__/transforms/__snapshots__/transformExpressions.spec.ts.snap\nindex 8907962..5a94de5 100644\n--- a/packages/compiler-core/__tests__/transforms/__snapshots__/transformExpressions.spec.ts.snap\n+++ b/packages/compiler-core/__tests__/transforms/__snapshots__/transformExpressions.spec.ts.snap\n@@ -14,16 +14,6 @@ return function render(_ctx, _cache, $props, $setup, $data, $options) {\n }\"\n `;\n \n-exports[`compiler: expression transform > expression with type 1`] = `\n-\"const { openBlock: _openBlock, createElementBlock: _createElementBlock } = Vue\n-\n-return function render(_ctx, _cache) {\n-  return (_openBlock(), _createElementBlock(\"div\", {\n-    onClick: _ctx.handleClick\n-  }, null, 8 /* PROPS */, [\"onClick\"]))\n-}\"\n-`;\n-\n exports[`compiler: expression transform > should allow leak of var declarations in for loop 1`] = `\n \"const { openBlock: _openBlock, createElementBlock: _createElementBlock } = Vue\n \ndiff --git a/packages/compiler-core/__tests__/transforms/transformExpressions.spec.ts b/packages/compiler-core/__tests__/transforms/transformExpressions.spec.ts\nindex 47627ff..2f1e6eb 100644\n--- a/packages/compiler-core/__tests__/transforms/transformExpressions.spec.ts\n+++ b/packages/compiler-core/__tests__/transforms/transformExpressions.spec.ts\n@@ -754,12 +754,4 @@ describe('compiler: expression transform', () => {\n       expect(code).toMatch(`_ctx.bar`)\n     })\n   })\n-\n-  test('expression with type', () => {\n-    const { code } = compile(\n-      `<div @click=\"(<number>handleClick as any)\"></div>`,\n-    )\n-    expect(code).toMatch(`onClick: _ctx.handleClick`)\n-    expect(code).toMatchSnapshot()\n-  })\n })\ndiff --git a/packages/compiler-core/src/transforms/transformExpression.ts b/packages/compiler-core/src/transforms/transformExpression.ts\nindex be4b09b..9ae8897 100644\n--- a/packages/compiler-core/src/transforms/transformExpression.ts\n+++ b/packages/compiler-core/src/transforms/transformExpression.ts\n@@ -18,7 +18,6 @@ import {\n   createSimpleExpression,\n } from '../ast'\n import {\n-  TS_NODE_TYPES,\n   isInDestructureAssignment,\n   isInNewExpression,\n   isStaticProperty,\n@@ -348,18 +347,15 @@ export function processExpression(\n   // an ExpressionNode has the `.children` property, it will be used instead of\n   // `.content`.\n   const children: CompoundExpressionNode['children'] = []\n-  const isTSNode = TS_NODE_TYPES.includes(ast.type)\n   ids.sort((a, b) => a.start - b.start)\n   ids.forEach((id, i) => {\n     // range is offset by -1 due to the wrapping parens when parsed\n     const start = id.start - 1\n     const end = id.end - 1\n     const last = ids[i - 1]\n-    if (!(isTSNode && i === 0)) {\n-      const leadingText = rawExp.slice(last ? last.end - 1 : 0, start)\n-      if (leadingText.length || id.prefix) {\n-        children.push(leadingText + (id.prefix || ``))\n-      }\n+    const leadingText = rawExp.slice(last ? last.end - 1 : 0, start)\n+    if (leadingText.length || id.prefix) {\n+      children.push(leadingText + (id.prefix || ``))\n     }\n     const source = rawExp.slice(start, end)\n     children.push(\n@@ -376,7 +372,7 @@ export function processExpression(\n           : ConstantTypes.NOT_CONSTANT,\n       ),\n     )\n-    if (i === ids.length - 1 && end < rawExp.length && !isTSNode) {\n+    if (i === ids.length - 1 && end < rawExp.length) {\n       children.push(rawExp.slice(end))\n     }\n   })"}, {"role": "assistant", "content": "refactor(compiler-core): remove TypeScript expression type handling"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_codegen_llvm/src/mono_item.rs | 2 +-\n compiler/rustc_codegen_llvm/src/va_arg.rs    | 9 ---------\n compiler/rustc_span/src/symbol.rs            | 1 -\n compiler/rustc_target/src/asm/mod.rs         | 2 +-\n compiler/rustc_target/src/callconv/mod.rs    | 2 +-\n compiler/rustc_target/src/spec/mod.rs        | 7 ++-----\n compiler/rustc_target/src/target_features.rs | 8 +-------\n src/tools/miri/src/shims/alloc.rs            | 1 -\n 8 files changed, 6 insertions(+), 26 deletions(-)\n\ndiff --git a/compiler/rustc_codegen_llvm/src/mono_item.rs b/compiler/rustc_codegen_llvm/src/mono_item.rs\nindex 1878f4043ee..838db689e72 100644\n--- a/compiler/rustc_codegen_llvm/src/mono_item.rs\n+++ b/compiler/rustc_codegen_llvm/src/mono_item.rs\n@@ -144,7 +144,7 @@ fn should_assume_dso_local(&self, llval: &llvm::Value, is_declaration: bool) ->\n         }\n \n         // PowerPC64 prefers TOC indirection to avoid copy relocations.\n-        if matches!(self.tcx.sess.target.arch, Arch::PowerPC64 | Arch::PowerPC64LE) {\n+        if self.tcx.sess.target.arch == Arch::PowerPC64 {\n             return false;\n         }\n \ndiff --git a/compiler/rustc_codegen_llvm/src/va_arg.rs b/compiler/rustc_codegen_llvm/src/va_arg.rs\nindex 688f461e747..c7da2457ada 100644\n--- a/compiler/rustc_codegen_llvm/src/va_arg.rs\n+++ b/compiler/rustc_codegen_llvm/src/va_arg.rs\n@@ -1064,15 +1064,6 @@ pub(super) fn emit_va_arg<'ll, 'tcx>(\n             AllowHigherAlign::Yes,\n             ForceRightAdjust::Yes,\n         ),\n-        Arch::PowerPC64LE => emit_ptr_va_arg(\n-            bx,\n-            addr,\n-            target_ty,\n-            PassMode::Direct,\n-            SlotSize::Bytes8,\n-            AllowHigherAlign::Yes,\n-            ForceRightAdjust::No,\n-        ),\n         Arch::LoongArch32 => emit_ptr_va_arg(\n             bx,\n             addr,\ndiff --git a/compiler/rustc_span/src/symbol.rs b/compiler/rustc_span/src/symbol.rs\nindex b473d36a45f..c4f77cedbe0 100644\n--- a/compiler/rustc_span/src/symbol.rs\n+++ b/compiler/rustc_span/src/symbol.rs\n@@ -1723,7 +1723,6 @@\n         postfix_match,\n         powerpc,\n         powerpc64,\n-        powerpc64le,\n         powerpc_target_feature,\n         powf16,\n         powf32,\ndiff --git a/compiler/rustc_target/src/asm/mod.rs b/compiler/rustc_target/src/asm/mod.rs\nindex 0078866ab95..a10699bbce8 100644\n--- a/compiler/rustc_target/src/asm/mod.rs\n+++ b/compiler/rustc_target/src/asm/mod.rs\n@@ -261,7 +261,7 @@ pub fn from_arch(arch: &Arch) -> Option<Self> {\n             Arch::Mips | Arch::Mips32r6 => Some(Self::Mips),\n             Arch::Mips64 | Arch::Mips64r6 => Some(Self::Mips64),\n             Arch::PowerPC => Some(Self::PowerPC),\n-            Arch::PowerPC64 | Arch::PowerPC64LE => Some(Self::PowerPC64),\n+            Arch::PowerPC64 => Some(Self::PowerPC64),\n             Arch::S390x => Some(Self::S390x),\n             Arch::Sparc => Some(Self::Sparc),\n             Arch::Sparc64 => Some(Self::Sparc64),\ndiff --git a/compiler/rustc_target/src/callconv/mod.rs b/compiler/rustc_target/src/callconv/mod.rs\nindex 6faa57252ca..6c8e0e181c4 100644\n--- a/compiler/rustc_target/src/callconv/mod.rs\n+++ b/compiler/rustc_target/src/callconv/mod.rs\n@@ -702,7 +702,7 @@ pub fn adjust_for_foreign_abi<C>(&mut self, cx: &C, abi: ExternAbi)\n             Arch::RiscV32 | Arch::RiscV64 => riscv::compute_abi_info(cx, self),\n             Arch::Wasm32 | Arch::Wasm64 => wasm::compute_abi_info(cx, self),\n             Arch::Bpf => bpf::compute_abi_info(cx, self),\n-            arch @ (Arch::PowerPC64LE | Arch::SpirV | Arch::Other(_)) => {\n+            arch @ (Arch::SpirV | Arch::Other(_)) => {\n                 panic!(\"no lowering implemented for {arch}\")\n             }\n         }\ndiff --git a/compiler/rustc_target/src/spec/mod.rs b/compiler/rustc_target/src/spec/mod.rs\nindex 89c9fdc935c..57effe3a866 100644\n--- a/compiler/rustc_target/src/spec/mod.rs\n+++ b/compiler/rustc_target/src/spec/mod.rs\n@@ -1873,7 +1873,6 @@ pub enum Arch {\n         Nvptx64 = \"nvptx64\",\n         PowerPC = \"powerpc\",\n         PowerPC64 = \"powerpc64\",\n-        PowerPC64LE = \"powerpc64le\",\n         RiscV32 = \"riscv32\",\n         RiscV64 = \"riscv64\",\n         S390x = \"s390x\",\n@@ -1911,7 +1910,6 @@ pub fn desc_symbol(&self) -> Symbol {\n             Self::Nvptx64 => sym::nvptx64,\n             Self::PowerPC => sym::powerpc,\n             Self::PowerPC64 => sym::powerpc64,\n-            Self::PowerPC64LE => sym::powerpc64le,\n             Self::RiscV32 => sym::riscv32,\n             Self::RiscV64 => sym::riscv64,\n             Self::S390x => sym::s390x,\n@@ -1940,8 +1938,8 @@ pub fn supports_c_variadic_definitions(&self) -> bool {\n \n             AArch64 | AmdGpu | Arm | Arm64EC | Avr | CSky | Hexagon | LoongArch32 | LoongArch64\n             | M68k | Mips | Mips32r6 | Mips64 | Mips64r6 | Msp430 | Nvptx64 | PowerPC\n-            | PowerPC64 | PowerPC64LE | RiscV32 | RiscV64 | S390x | Sparc | Sparc64 | Wasm32\n-            | Wasm64 | X86 | X86_64 | Xtensa => true,\n+            | PowerPC64 | RiscV32 | RiscV64 | S390x | Sparc | Sparc64 | Wasm32 | Wasm64 | X86\n+            | X86_64 | Xtensa => true,\n         }\n     }\n }\n@@ -3436,7 +3434,6 @@ pub fn object_architecture(\n             Arch::Arm64EC => (Architecture::Aarch64, Some(object::SubArchitecture::Arm64EC)),\n             Arch::AmdGpu\n             | Arch::Nvptx64\n-            | Arch::PowerPC64LE\n             | Arch::SpirV\n             | Arch::Wasm32\n             | Arch::Wasm64\ndiff --git a/compiler/rustc_target/src/target_features.rs b/compiler/rustc_target/src/target_features.rs\nindex 40cc4f40a33..4eba426dda5 100644\n--- a/compiler/rustc_target/src/target_features.rs\n+++ b/compiler/rustc_target/src/target_features.rs\n@@ -986,7 +986,6 @@ pub fn rust_target_features(&self) -> &'static [(&'static str, Stability, Implie\n             Arch::AmdGpu\n             | Arch::Avr\n             | Arch::Msp430\n-            | Arch::PowerPC64LE\n             | Arch::SpirV\n             | Arch::Xtensa\n             | Arch::Other(_) => &[],\n@@ -1015,12 +1014,7 @@ pub fn features_for_correct_fixed_length_vector_abi(&self) -> &'static [(u64, &'\n             Arch::CSky => CSKY_FEATURES_FOR_CORRECT_FIXED_LENGTH_VECTOR_ABI,\n             // FIXME: for some tier3 targets, we are overly cautious and always give warnings\n             // when passing args in vector registers.\n-            Arch::Avr\n-            | Arch::Msp430\n-            | Arch::PowerPC64LE\n-            | Arch::SpirV\n-            | Arch::Xtensa\n-            | Arch::Other(_) => &[],\n+            Arch::Avr | Arch::Msp430 | Arch::SpirV | Arch::Xtensa | Arch::Other(_) => &[],\n         }\n     }\n \ndiff --git a/src/tools/miri/src/shims/alloc.rs b/src/tools/miri/src/shims/alloc.rs\nindex 94649dde473..b4d53c36d19 100644\n--- a/src/tools/miri/src/shims/alloc.rs\n+++ b/src/tools/miri/src/shims/alloc.rs\n@@ -52,7 +52,6 @@ fn malloc_align(&self, size: u64) -> Align {\n             | Arch::Bpf\n             | Arch::Msp430\n             | Arch::Nvptx64\n-            | Arch::PowerPC64LE\n             | Arch::SpirV\n             | Arch::Other(_)) => bug!(\"unsupported target architecture for malloc: `{arch}`\"),\n         };"}, {"role": "assistant", "content": "refactor: remove PowerPC64LE as separate arch variant"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_attr_parsing/src/attributes/cfg.rs | 1 -\n compiler/rustc_attr_parsing/src/attributes/doc.rs | 6 ------\n compiler/rustc_attr_parsing/src/parser.rs         | 8 +++-----\n 3 files changed, 3 insertions(+), 12 deletions(-)"}, {"role": "assistant", "content": "refactor: remove unused code from attribute parsing"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/go/internal/modcmd/edit.go           |  10 +-\n src/cmd/go/internal/modfetch/codehost/git.go |  20 +-\n src/cmd/go/internal/modfetch/codehost/vcs.go |  26 +-\n src/cmd/go/internal/modget/query.go          |   5 +-\n src/cmd/go/internal/modload/build.go         |  12 +-\n src/cmd/go/internal/modload/list.go          |  30 ++-\n src/cmd/go/internal/toolchain/select.go      |   7 +-\n src/cmd/go/internal/vcs/vcs.go               | 353 +++------------------------\n src/cmd/go/internal/vcs/vcs_test.go          |  36 +++\n src/cmd/go/internal/workcmd/edit.go          |   5 +-\n 10 files changed, 157 insertions(+), 347 deletions(-)\n\ndiff --git a/src/cmd/go/internal/modcmd/edit.go b/src/cmd/go/internal/modcmd/edit.go\nindex 69ebb148..cd15b822 100644\n--- a/src/cmd/go/internal/modcmd/edit.go\n+++ b/src/cmd/go/internal/modcmd/edit.go\n@@ -328,7 +328,10 @@ func runEdit(ctx context.Context, cmd *base.Command, args []string) {\n \n // parsePathVersion parses -flag=arg expecting arg to be path@version.\n func parsePathVersion(flag, arg string) (path, version string) {\n-\tbefore, after, found := strings.Cut(arg, \"@\")\n+\tbefore, after, found, err := modload.ParsePathVersion(arg)\n+\tif err != nil {\n+\t\tbase.Fatalf(\"go: -%s=%s: %v\", flag, arg, err)\n+\t}\n \tif !found {\n \t\tbase.Fatalf(\"go: -%s=%s: need path@version\", flag, arg)\n \t}\n@@ -362,7 +365,10 @@ func parsePathVersionOptional(adj, arg string, allowDirPath bool) (path, version\n \tif allowDirPath && modfile.IsDirectoryPath(arg) {\n \t\treturn arg, \"\", nil\n \t}\n-\tbefore, after, found := strings.Cut(arg, \"@\")\n+\tbefore, after, found, err := modload.ParsePathVersion(arg)\n+\tif err != nil {\n+\t\treturn \"\", \"\", err\n+\t}\n \tif !found {\n \t\tpath = arg\n \t} else {\ndiff --git a/src/cmd/go/internal/modfetch/codehost/git.go b/src/cmd/go/internal/modfetch/codehost/git.go\nindex 3d50dca3..6eb61772 100644\n--- a/src/cmd/go/internal/modfetch/codehost/git.go\n+++ b/src/cmd/go/internal/modfetch/codehost/git.go\n@@ -261,7 +261,7 @@ func (r *gitRepo) loadRefs(ctx context.Context) (map[string]string, error) {\n \t\t\tr.refsErr = err\n \t\t\treturn\n \t\t}\n-\t\tout, gitErr := r.runGit(ctx, \"git\", \"ls-remote\", \"-q\", r.remote)\n+\t\tout, gitErr := r.runGit(ctx, \"git\", \"ls-remote\", \"-q\", \"--end-of-options\", r.remote)\n \t\trelease()\n \n \t\tif gitErr != nil {\n@@ -530,7 +530,7 @@ func (r *gitRepo) stat(ctx context.Context, rev string) (info *RevInfo, err erro\n \t\t\tif fromTag && !slices.Contains(info.Tags, tag) {\n \t\t\t\t// The local repo includes the commit hash we want, but it is missing\n \t\t\t\t// the corresponding tag. Add that tag and try again.\n-\t\t\t\t_, err := r.runGit(ctx, \"git\", \"tag\", tag, hash)\n+\t\t\t\t_, err := r.runGit(ctx, \"git\", \"tag\", \"--end-of-options\", tag, hash)\n \t\t\t\tif err != nil {\n \t\t\t\t\treturn nil, err\n \t\t\t\t}\n@@ -579,7 +579,7 @@ func (r *gitRepo) stat(ctx context.Context, rev string) (info *RevInfo, err erro\n \t\t// an apparent Git bug introduced in Git 2.21 (commit 61c771),\n \t\t// which causes the handler for protocol version 1 to sometimes miss\n \t\t// tags that point to the requested commit (see https://go.dev/issue/56881).\n-\t\t_, err = r.runGit(ctx, \"git\", \"-c\", \"protocol.version=2\", \"fetch\", \"-f\", \"--depth=1\", r.remote, refspec)\n+\t\t_, err = r.runGit(ctx, \"git\", \"-c\", \"protocol.version=2\", \"fetch\", \"-f\", \"--depth=1\", \"--end-of-options\", r.remote, refspec)\n \t\trelease()\n \n \t\tif err == nil {\n@@ -625,12 +625,12 @@ func (r *gitRepo) fetchRefsLocked(ctx context.Context) error {\n \t\t}\n \t\tdefer release()\n \n-\t\tif _, err := r.runGit(ctx, \"git\", \"fetch\", \"-f\", r.remote, \"refs/heads/*:refs/heads/*\", \"refs/tags/*:refs/tags/*\"); err != nil {\n+\t\tif _, err := r.runGit(ctx, \"git\", \"fetch\", \"-f\", \"--end-of-options\", r.remote, \"refs/heads/*:refs/heads/*\", \"refs/tags/*:refs/tags/*\"); err != nil {\n \t\t\treturn err\n \t\t}\n \n \t\tif _, err := os.Stat(filepath.Join(r.dir, \"shallow\")); err == nil {\n-\t\t\tif _, err := r.runGit(ctx, \"git\", \"fetch\", \"--unshallow\", \"-f\", r.remote); err != nil {\n+\t\t\tif _, err := r.runGit(ctx, \"git\", \"fetch\", \"--unshallow\", \"-f\", \"--end-of-options\", r.remote); err != nil {\n \t\t\t\treturn err\n \t\t\t}\n \t\t}\n@@ -643,7 +643,7 @@ func (r *gitRepo) fetchRefsLocked(ctx context.Context) error {\n // statLocal returns a new RevInfo describing rev in the local git repository.\n // It uses version as info.Version.\n func (r *gitRepo) statLocal(ctx context.Context, version, rev string) (*RevInfo, error) {\n-\tout, err := r.runGit(ctx, \"git\", \"-c\", \"log.showsignature=false\", \"log\", \"--no-decorate\", \"-n1\", \"--format=format:%H %ct %D\", rev, \"--\")\n+\tout, err := r.runGit(ctx, \"git\", \"-c\", \"log.showsignature=false\", \"log\", \"--no-decorate\", \"-n1\", \"--format=format:%H %ct %D\", \"--end-of-options\", rev, \"--\")\n \tif err != nil {\n \t\t// Return info with Origin.RepoSum if possible to allow caching of negative lookup.\n \t\tvar info *RevInfo\n@@ -733,7 +733,7 @@ func (r *gitRepo) ReadFile(ctx context.Context, rev, file string, maxSize int64)\n \tif err != nil {\n \t\treturn nil, err\n \t}\n-\tout, err := r.runGit(ctx, \"git\", \"cat-file\", \"blob\", info.Name+\":\"+file)\n+\tout, err := r.runGit(ctx, \"git\", \"cat-file\", \"--end-of-options\", \"blob\", info.Name+\":\"+file)\n \tif err != nil {\n \t\treturn nil, fs.ErrNotExist\n \t}\n@@ -751,7 +751,7 @@ func (r *gitRepo) RecentTag(ctx context.Context, rev, prefix string, allowed fun\n \t// result is definitive.\n \tdescribe := func() (definitive bool) {\n \t\tvar out []byte\n-\t\tout, err = r.runGit(ctx, \"git\", \"for-each-ref\", \"--format\", \"%(refname)\", \"refs/tags\", \"--merged\", rev)\n+\t\tout, err = r.runGit(ctx, \"git\", \"for-each-ref\", \"--format=%(refname)\", \"--merged=\"+rev)\n \t\tif err != nil {\n \t\t\treturn true\n \t\t}\n@@ -903,7 +903,7 @@ func (r *gitRepo) ReadZip(ctx context.Context, rev, subdir string, maxSize int64\n \t// TODO: Use maxSize or drop it.\n \targs := []string{}\n \tif subdir != \"\" {\n-\t\targs = append(args, \"--\", subdir)\n+\t\targs = append(args, subdir)\n \t}\n \tinfo, err := r.Stat(ctx, rev) // download rev into local git repo\n \tif err != nil {\n@@ -925,7 +925,7 @@ func (r *gitRepo) ReadZip(ctx context.Context, rev, subdir string, maxSize int64\n \t// text file line endings. Setting -c core.autocrlf=input means only\n \t// translate files on the way into the repo, not on the way out (archive).\n \t// The -c core.eol=lf should be unnecessary but set it anyway.\n-\tarchive, err := r.runGit(ctx, \"git\", \"-c\", \"core.autocrlf=input\", \"-c\", \"core.eol=lf\", \"archive\", \"--format=zip\", \"--prefix=prefix/\", info.Name, args)\n+\tarchive, err := r.runGit(ctx, \"git\", \"-c\", \"core.autocrlf=input\", \"-c\", \"core.eol=lf\", \"archive\", \"--format=zip\", \"--prefix=prefix/\", \"--end-of-options\", info.Name, args)\n \tif err != nil {\n \t\tif bytes.Contains(err.(*RunError).Stderr, []byte(\"did not match any files\")) {\n \t\t\treturn nil, fs.ErrNotExist\ndiff --git a/src/cmd/go/internal/modfetch/codehost/vcs.go b/src/cmd/go/internal/modfetch/codehost/vcs.go\nindex aae1a60b..59264a3b 100644\n--- a/src/cmd/go/internal/modfetch/codehost/vcs.go\n+++ b/src/cmd/go/internal/modfetch/codehost/vcs.go\n@@ -188,6 +188,7 @@ var vcsCmds = map[string]*vcsCmd{\n \t\t\t\t\"hg\",\n \t\t\t\t\"--config=extensions.goreposum=\" + filepath.Join(cfg.GOROOT, \"lib/hg/goreposum.py\"),\n \t\t\t\t\"goreposum\",\n+\t\t\t\t\"--\",\n \t\t\t\tremote,\n \t\t\t}\n \t\t},\n@@ -196,6 +197,7 @@ var vcsCmds = map[string]*vcsCmd{\n \t\t\t\t\"hg\",\n \t\t\t\t\"--config=extensions.goreposum=\" + filepath.Join(cfg.GOROOT, \"lib/hg/goreposum.py\"),\n \t\t\t\t\"golookup\",\n+\t\t\t\t\"--\",\n \t\t\t\tremote,\n \t\t\t\tref,\n \t\t\t}\n@@ -216,26 +218,26 @@ var vcsCmds = map[string]*vcsCmd{\n \t\tbranchRE:           re(`(?m)^[^\\n]+$`),\n \t\tbadLocalRevRE:      re(`(?m)^(tip)$`),\n \t\tstatLocal: func(rev, remote string) []string {\n-\t\t\treturn []string{\"hg\", \"log\", \"-l1\", \"-r\", rev, \"--template\", \"{node} {date|hgdate} {tags}\"}\n+\t\t\treturn []string{\"hg\", \"log\", \"-l1\", fmt.Sprintf(\"--rev=%s\", rev), \"--template\", \"{node} {date|hgdate} {tags}\"}\n \t\t},\n \t\tparseStat: hgParseStat,\n \t\tfetch:     []string{\"hg\", \"pull\", \"-f\"},\n \t\tlatest:    \"tip\",\n \t\tdescendsFrom: func(rev, tag string) []string {\n-\t\t\treturn []string{\"hg\", \"log\", \"-r\", \"ancestors(\" + rev + \") and \" + tag}\n+\t\t\treturn []string{\"hg\", \"log\", \"--rev=ancestors(\" + rev + \") and \" + tag}\n \t\t},\n \t\trecentTags: func(rev string) []string {\n-\t\t\treturn []string{\"hg\", \"log\", \"-r\", \"ancestors(\" + rev + \") and tag()\", \"--template\", \"{tags}\\n\"}\n+\t\t\treturn []string{\"hg\", \"log\", \"--rev=ancestors(\" + rev + \") and tag()\", \"--template\", \"{tags}\\n\"}\n \t\t},\n \t\treadFile: func(rev, file, remote string) []string {\n-\t\t\treturn []string{\"hg\", \"cat\", \"-r\", rev, file}\n+\t\t\treturn []string{\"hg\", \"cat\", fmt.Sprintf(\"--rev=%s\", rev), \"--\", file}\n \t\t},\n \t\treadZip: func(rev, subdir, remote, target string) []string {\n \t\t\tpattern := []string{}\n \t\t\tif subdir != \"\" {\n-\t\t\t\tpattern = []string{\"-I\", subdir + \"/**\"}\n+\t\t\t\tpattern = []string{fmt.Sprintf(\"--include=%s\", subdir+\"/**\")}\n \t\t\t}\n-\t\t\treturn str.StringList(\"hg\", \"archive\", \"-t\", \"zip\", \"--no-decode\", \"-r\", rev, \"--prefix=prefix/\", pattern, \"--\", target)\n+\t\t\treturn str.StringList(\"hg\", \"archive\", \"-t\", \"zip\", \"--no-decode\", fmt.Sprintf(\"--rev=%s\", rev), \"--prefix=prefix/\", pattern, \"--\", target)\n \t\t},\n \t},\n \n@@ -275,19 +277,19 @@ var vcsCmds = map[string]*vcsCmd{\n \t\ttagRE:         re(`(?m)^\\S+`),\n \t\tbadLocalRevRE: re(`^revno:-`),\n \t\tstatLocal: func(rev, remote string) []string {\n-\t\t\treturn []string{\"bzr\", \"log\", \"-l1\", \"--long\", \"--show-ids\", \"-r\", rev}\n+\t\t\treturn []string{\"bzr\", \"log\", \"-l1\", \"--long\", \"--show-ids\", fmt.Sprintf(\"--revision=%s\", rev)}\n \t\t},\n \t\tparseStat: bzrParseStat,\n \t\tlatest:    \"revno:-1\",\n \t\treadFile: func(rev, file, remote string) []string {\n-\t\t\treturn []string{\"bzr\", \"cat\", \"-r\", rev, file}\n+\t\t\treturn []string{\"bzr\", \"cat\", fmt.Sprintf(\"--revision=%s\", rev), \"--\", file}\n \t\t},\n \t\treadZip: func(rev, subdir, remote, target string) []string {\n \t\t\textra := []string{}\n \t\t\tif subdir != \"\" {\n \t\t\t\textra = []string{\"./\" + subdir}\n \t\t\t}\n-\t\t\treturn str.StringList(\"bzr\", \"export\", \"--format=zip\", \"-r\", rev, \"--root=prefix/\", \"--\", target, extra)\n+\t\t\treturn str.StringList(\"bzr\", \"export\", \"--format=zip\", fmt.Sprintf(\"--revision=%s\", rev), \"--root=prefix/\", \"--\", target, extra)\n \t\t},\n \t},\n \n@@ -302,17 +304,17 @@ var vcsCmds = map[string]*vcsCmd{\n \t\t},\n \t\ttagRE: re(`XXXTODO`),\n \t\tstatLocal: func(rev, remote string) []string {\n-\t\t\treturn []string{\"fossil\", \"info\", \"-R\", \".fossil\", rev}\n+\t\t\treturn []string{\"fossil\", \"info\", \"-R\", \".fossil\", \"--\", rev}\n \t\t},\n \t\tparseStat: fossilParseStat,\n \t\tlatest:    \"trunk\",\n \t\treadFile: func(rev, file, remote string) []string {\n-\t\t\treturn []string{\"fossil\", \"cat\", \"-R\", \".fossil\", \"-r\", rev, file}\n+\t\t\treturn []string{\"fossil\", \"cat\", \"-R\", \".fossil\", fmt.Sprintf(\"-r=%s\", rev), \"--\", file}\n \t\t},\n \t\treadZip: func(rev, subdir, remote, target string) []string {\n \t\t\textra := []string{}\n \t\t\tif subdir != \"\" && !strings.ContainsAny(subdir, \"*?[],\") {\n-\t\t\t\textra = []string{\"--include\", subdir}\n+\t\t\t\textra = []string{fmt.Sprintf(\"--include=%s\", subdir)}\n \t\t\t}\n \t\t\t// Note that vcsRepo.ReadZip below rewrites this command\n \t\t\t// to run in a different directory, to work around a fossil bug.\ndiff --git a/src/cmd/go/internal/modget/query.go b/src/cmd/go/internal/modget/query.go\nindex 3086dbc1..e9807edd 100644\n--- a/src/cmd/go/internal/modget/query.go\n+++ b/src/cmd/go/internal/modget/query.go\n@@ -140,7 +140,10 @@ func errSet(err error) pathSet { return pathSet{err: err} }\n // newQuery returns a new query parsed from the raw argument,\n // which must be either path or path@version.\n func newQuery(loaderstate *modload.State, raw string) (*query, error) {\n-\tpattern, rawVers, found := strings.Cut(raw, \"@\")\n+\tpattern, rawVers, found, err := modload.ParsePathVersion(raw)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n \tif found && (strings.Contains(rawVers, \"@\") || rawVers == \"\") {\n \t\treturn nil, fmt.Errorf(\"invalid module version syntax %q\", raw)\n \t}\ndiff --git a/src/cmd/go/internal/modload/build.go b/src/cmd/go/internal/modload/build.go\nindex b560dd6a..cb437135 100644\n--- a/src/cmd/go/internal/modload/build.go\n+++ b/src/cmd/go/internal/modload/build.go\n@@ -12,7 +12,6 @@ import (\n \t\"io/fs\"\n \t\"os\"\n \t\"path/filepath\"\n-\t\"strings\"\n \n \t\"cmd/go/internal/base\"\n \t\"cmd/go/internal/cfg\"\n@@ -88,7 +87,16 @@ func ModuleInfo(loaderstate *State, ctx context.Context, path string) *modinfo.M\n \t\treturn nil\n \t}\n \n-\tif path, vers, found := strings.Cut(path, \"@\"); found {\n+\tpath, vers, found, err := ParsePathVersion(path)\n+\tif err != nil {\n+\t\treturn &modinfo.ModulePublic{\n+\t\t\tPath: path,\n+\t\t\tError: &modinfo.ModuleError{\n+\t\t\t\tErr: err.Error(),\n+\t\t\t},\n+\t\t}\n+\t}\n+\tif found {\n \t\tm := module.Version{Path: path, Version: vers}\n \t\treturn moduleInfo(loaderstate, ctx, nil, m, 0, nil)\n \t}\ndiff --git a/src/cmd/go/internal/modload/list.go b/src/cmd/go/internal/modload/list.go\nindex 316fda40..32f8c5fe 100644\n--- a/src/cmd/go/internal/modload/list.go\n+++ b/src/cmd/go/internal/modload/list.go\n@@ -150,7 +150,11 @@ func listModules(loaderstate *State, ctx context.Context, rs *Requirements, args\n \t\t\t}\n \t\t\tcontinue\n \t\t}\n-\t\tif path, vers, found := strings.Cut(arg, \"@\"); found {\n+\t\tpath, vers, found, err := ParsePathVersion(arg)\n+\t\tif err != nil {\n+\t\t\tbase.Fatalf(\"go: %v\", err)\n+\t\t}\n+\t\tif found {\n \t\t\tif vers == \"upgrade\" || vers == \"patch\" {\n \t\t\t\tif _, ok := rs.rootSelected(loaderstate, path); !ok || rs.pruning == unpruned {\n \t\t\t\t\tneedFullGraph = true\n@@ -176,7 +180,11 @@ func listModules(loaderstate *State, ctx context.Context, rs *Requirements, args\n \n \tmatchedModule := map[module.Version]bool{}\n \tfor _, arg := range args {\n-\t\tif path, vers, found := strings.Cut(arg, \"@\"); found {\n+\t\tpath, vers, found, err := ParsePathVersion(arg)\n+\t\tif err != nil {\n+\t\t\tbase.Fatalf(\"go: %v\", err)\n+\t\t}\n+\t\tif found {\n \t\t\tvar current string\n \t\t\tif mg == nil {\n \t\t\t\tcurrent, _ = rs.rootSelected(loaderstate, path)\n@@ -317,3 +325,21 @@ func modinfoError(path, vers string, err error) *modinfo.ModuleError {\n \n \treturn &modinfo.ModuleError{Err: err.Error()}\n }\n+\n+// ParsePathVersion parses arg expecting arg to be path@version. If there is no\n+// '@' in arg, found is false, vers is \"\", and path is arg. This mirrors the\n+// typical usage of strings.Cut. ParsePathVersion is meant to be a general\n+// replacement for strings.Cut in module version parsing. If the version is\n+// invalid, an error is returned. The version is considered invalid if it is\n+// prefixed with '-' or '/', which can cause security problems when constructing\n+// commands to execute that use the version.\n+func ParsePathVersion(arg string) (path, vers string, found bool, err error) {\n+\tpath, vers, found = strings.Cut(arg, \"@\")\n+\tif !found {\n+\t\treturn arg, \"\", false, nil\n+\t}\n+\tif len(vers) > 0 && (vers[0] == '-' || vers[0] == '/') {\n+\t\treturn \"\", \"\", false, fmt.Errorf(\"invalid module version %q\", vers)\n+\t}\n+\treturn path, vers, true, nil\n+}\ndiff --git a/src/cmd/go/internal/toolchain/select.go b/src/cmd/go/internal/toolchain/select.go\nindex 192fb62f..0cb93f67 100644\n--- a/src/cmd/go/internal/toolchain/select.go\n+++ b/src/cmd/go/internal/toolchain/select.go\n@@ -667,7 +667,10 @@ func maybeSwitchForGoInstallVersion(loaderstate *modload.State, minVers string)\n \tif !strings.Contains(pkgArg, \"@\") || build.IsLocalImport(pkgArg) || filepath.IsAbs(pkgArg) {\n \t\treturn\n \t}\n-\tpath, version, _ := strings.Cut(pkgArg, \"@\")\n+\tpath, version, _, err := modload.ParsePathVersion(pkgArg)\n+\tif err != nil {\n+\t\tbase.Fatalf(\"go: %v\", err)\n+\t}\n \tif path == \"\" || version == \"\" || gover.IsToolchain(path) {\n \t\treturn\n \t}\n@@ -702,7 +705,7 @@ func maybeSwitchForGoInstallVersion(loaderstate *modload.State, minVers string)\n \t\tallowed = nil\n \t}\n \tnoneSelected := func(path string) (version string) { return \"none\" }\n-\t_, err := modload.QueryPackages(loaderstate, ctx, path, version, noneSelected, allowed)\n+\t_, err = modload.QueryPackages(loaderstate, ctx, path, version, noneSelected, allowed)\n \tif errors.Is(err, gover.ErrTooNew) {\n \t\t// Run early switch, same one go install or go run would eventually do,\n \t\t// if it understood all the command-line flags.\ndiff --git a/src/cmd/go/internal/vcs/vcs.go b/src/cmd/go/internal/vcs/vcs.go\nindex 7c198c5f..9e8efaf2 100644\n--- a/src/cmd/go/internal/vcs/vcs.go\n+++ b/src/cmd/go/internal/vcs/vcs.go\n@@ -17,7 +17,6 @@ import (\n \t\"os\"\n \t\"os/exec\"\n \t\"path/filepath\"\n-\t\"regexp\"\n \t\"strconv\"\n \t\"strings\"\n \t\"sync\"\n@@ -41,20 +40,10 @@ type Cmd struct {\n \tEnv       []string   // any environment values to set/override\n \tRootNames []rootName // filename and mode indicating the root of a checkout directory\n \n-\tCreateCmd   []string // commands to download a fresh copy of a repository\n-\tDownloadCmd []string // commands to download updates into an existing repository\n-\n-\tTagCmd         []tagCmd // commands to list tags\n-\tTagLookupCmd   []tagCmd // commands to lookup tags before running tagSyncCmd\n-\tTagSyncCmd     []string // commands to sync to specific tag\n-\tTagSyncDefault []string // commands to sync to default tag\n-\n \tScheme  []string\n \tPingCmd string\n \n-\tRemoteRepo  func(v *Cmd, rootDir string) (remoteRepo string, err error)\n-\tResolveRepo func(v *Cmd, rootDir, remoteRepo string) (realRepo string, err error)\n-\tStatus      func(v *Cmd, rootDir string) (Status, error)\n+\tStatus func(v *Cmd, rootDir string) (Status, error)\n }\n \n // Status is the current state of a local repository.\n@@ -157,40 +146,16 @@ var vcsHg = &Cmd{\n \tName: \"Mercurial\",\n \tCmd:  \"hg\",\n \n-\t// HGPLAIN=1 turns off additional output that a user may have enabled via\n-\t// config options or certain extensions.\n-\tEnv: []string{\"HGPLAIN=1\"},\n+\t// HGPLAIN=+strictflags turns off additional output that a user may have\n+\t// enabled via config options or certain extensions.\n+\tEnv: []string{\"HGPLAIN=+strictflags\"},\n \tRootNames: []rootName{\n \t\t{filename: \".hg\", isDir: true},\n \t},\n \n-\tCreateCmd:   []string{\"clone -U -- {repo} {dir}\"},\n-\tDownloadCmd: []string{\"pull\"},\n-\n-\t// We allow both tag and branch names as 'tags'\n-\t// for selecting a version. This lets people have\n-\t// a go.release.r60 branch and a go1 branch\n-\t// and make changes in both, without constantly\n-\t// editing .hgtags.\n-\tTagCmd: []tagCmd{\n-\t\t{\"tags\", `^(\\S+)`},\n-\t\t{\"branches\", `^(\\S+)`},\n-\t},\n-\tTagSyncCmd:     []string{\"update -r {tag}\"},\n-\tTagSyncDefault: []string{\"update default\"},\n-\n-\tScheme:     []string{\"https\", \"http\", \"ssh\"},\n-\tPingCmd:    \"identify -- {scheme}://{repo}\",\n-\tRemoteRepo: hgRemoteRepo,\n-\tStatus:     hgStatus,\n-}\n-\n-func hgRemoteRepo(vcsHg *Cmd, rootDir string) (remoteRepo string, err error) {\n-\tout, err := vcsHg.runOutput(rootDir, \"paths default\")\n-\tif err != nil {\n-\t\treturn \"\", err\n-\t}\n-\treturn strings.TrimSpace(string(out)), nil\n+\tScheme:  []string{\"https\", \"http\", \"ssh\"},\n+\tPingCmd: \"identify -- {scheme}://{repo}\",\n+\tStatus:  hgStatus,\n }\n \n func hgStatus(vcsHg *Cmd, rootDir string) (Status, error) {\n@@ -253,25 +218,6 @@ var vcsGit = &Cmd{\n \t\t{filename: \".git\", isDir: true},\n \t},\n \n-\tCreateCmd:   []string{\"clone -- {repo} {dir}\", \"-go-internal-cd {dir} submodule update --init --recursive\"},\n-\tDownloadCmd: []string{\"pull --ff-only\", \"submodule update --init --recursive\"},\n-\n-\tTagCmd: []tagCmd{\n-\t\t// tags/xxx matches a git tag named xxx\n-\t\t// origin/xxx matches a git branch named xxx on the default remote repository\n-\t\t{\"show-ref\", `(?:tags|origin)/(\\S+)$`},\n-\t},\n-\tTagLookupCmd: []tagCmd{\n-\t\t{\"show-ref tags/{tag} origin/{tag}\", `((?:tags|origin)/\\S+)$`},\n-\t},\n-\tTagSyncCmd: []string{\"checkout {tag}\", \"submodule update --init --recursive\"},\n-\t// both createCmd and downloadCmd update the working dir.\n-\t// No need to do more here. We used to 'checkout master'\n-\t// but that doesn't work if the default branch is not named master.\n-\t// DO NOT add 'checkout master' here.\n-\t// See golang.org/issue/9032.\n-\tTagSyncDefault: []string{\"submodule update --init --recursive\"},\n-\n \tScheme: []string{\"git\", \"https\", \"http\", \"git+ssh\", \"ssh\"},\n \n \t// Leave out the '--' separator in the ls-remote command: git 2.7.4 does not\n@@ -280,54 +226,7 @@ var vcsGit = &Cmd{\n \t// See golang.org/issue/33836.\n \tPingCmd: \"ls-remote {scheme}://{repo}\",\n \n-\tRemoteRepo: gitRemoteRepo,\n-\tStatus:     gitStatus,\n-}\n-\n-// scpSyntaxRe matches the SCP-like addresses used by Git to access\n-// repositories by SSH.\n-var scpSyntaxRe = lazyregexp.New(`^(\\w+)@([\\w.-]+):(.*)$`)\n-\n-func gitRemoteRepo(vcsGit *Cmd, rootDir string) (remoteRepo string, err error) {\n-\tconst cmd = \"config remote.origin.url\"\n-\toutb, err := vcsGit.run1(rootDir, cmd, nil, false)\n-\tif err != nil {\n-\t\t// if it doesn't output any message, it means the config argument is correct,\n-\t\t// but the config value itself doesn't exist\n-\t\tif outb != nil && len(outb) == 0 {\n-\t\t\treturn \"\", errors.New(\"remote origin not found\")\n-\t\t}\n-\t\treturn \"\", err\n-\t}\n-\tout := strings.TrimSpace(string(outb))\n-\n-\tvar repoURL *urlpkg.URL\n-\tif m := scpSyntaxRe.FindStringSubmatch(out); m != nil {\n-\t\t// Match SCP-like syntax and convert it to a URL.\n-\t\t// Eg, \"git@github.com:user/repo\" becomes\n-\t\t// \"ssh://git@github.com/user/repo\".\n-\t\trepoURL = &urlpkg.URL{\n-\t\t\tScheme: \"ssh\",\n-\t\t\tUser:   urlpkg.User(m[1]),\n-\t\t\tHost:   m[2],\n-\t\t\tPath:   m[3],\n-\t\t}\n-\t} else {\n-\t\trepoURL, err = urlpkg.Parse(out)\n-\t\tif err != nil {\n-\t\t\treturn \"\", err\n-\t\t}\n-\t}\n-\n-\t// Iterate over insecure schemes too, because this function simply\n-\t// reports the state of the repo. If we can't see insecure schemes then\n-\t// we can't report the actual repo URL.\n-\tfor _, s := range vcsGit.Scheme {\n-\t\tif repoURL.Scheme == s {\n-\t\t\treturn repoURL.String(), nil\n-\t\t}\n-\t}\n-\treturn \"\", errors.New(\"unable to parse output of git \" + cmd)\n+\tStatus: gitStatus,\n }\n \n func gitStatus(vcsGit *Cmd, rootDir string) (Status, error) {\n@@ -367,62 +266,9 @@ var vcsBzr = &Cmd{\n \t\t{filename: \".bzr\", isDir: true},\n \t},\n \n-\tCreateCmd: []string{\"branch -- {repo} {dir}\"},\n-\n-\t// Without --overwrite bzr will not pull tags that changed.\n-\t// Replace by --overwrite-tags after http://pad.lv/681792 goes in.\n-\tDownloadCmd: []string{\"pull --overwrite\"},\n-\n-\tTagCmd:         []tagCmd{{\"tags\", `^(\\S+)`}},\n-\tTagSyncCmd:     []string{\"update -r {tag}\"},\n-\tTagSyncDefault: []string{\"update -r revno:-1\"},\n-\n-\tScheme:      []string{\"https\", \"http\", \"bzr\", \"bzr+ssh\"},\n-\tPingCmd:     \"info -- {scheme}://{repo}\",\n-\tRemoteRepo:  bzrRemoteRepo,\n-\tResolveRepo: bzrResolveRepo,\n-\tStatus:      bzrStatus,\n-}\n-\n-func bzrRemoteRepo(vcsBzr *Cmd, rootDir string) (remoteRepo string, err error) {\n-\toutb, err := vcsBzr.runOutput(rootDir, \"config parent_location\")\n-\tif err != nil {\n-\t\treturn \"\", err\n-\t}\n-\treturn strings.TrimSpace(string(outb)), nil\n-}\n-\n-func bzrResolveRepo(vcsBzr *Cmd, rootDir, remoteRepo string) (realRepo string, err error) {\n-\toutb, err := vcsBzr.runOutput(rootDir, \"info \"+remoteRepo)\n-\tif err != nil {\n-\t\treturn \"\", err\n-\t}\n-\tout := string(outb)\n-\n-\t// Expect:\n-\t// ...\n-\t//   (branch root|repository branch): <URL>\n-\t// ...\n-\n-\tfound := false\n-\tfor _, prefix := range []string{\"\\n  branch root: \", \"\\n  repository branch: \"} {\n-\t\ti := strings.Index(out, prefix)\n-\t\tif i >= 0 {\n-\t\t\tout = out[i+len(prefix):]\n-\t\t\tfound = true\n-\t\t\tbreak\n-\t\t}\n-\t}\n-\tif !found {\n-\t\treturn \"\", fmt.Errorf(\"unable to parse output of bzr info\")\n-\t}\n-\n-\ti := strings.Index(out, \"\\n\")\n-\tif i < 0 {\n-\t\treturn \"\", fmt.Errorf(\"unable to parse output of bzr info\")\n-\t}\n-\tout = out[:i]\n-\treturn strings.TrimSpace(out), nil\n+\tScheme:  []string{\"https\", \"http\", \"bzr\", \"bzr+ssh\"},\n+\tPingCmd: \"info -- {scheme}://{repo}\",\n+\tStatus:  bzrStatus,\n }\n \n func bzrStatus(vcsBzr *Cmd, rootDir string) (Status, error) {\n@@ -490,46 +336,12 @@ var vcsSvn = &Cmd{\n \t\t{filename: \".svn\", isDir: true},\n \t},\n \n-\tCreateCmd:   []string{\"checkout -- {repo} {dir}\"},\n-\tDownloadCmd: []string{\"update\"},\n-\n \t// There is no tag command in subversion.\n \t// The branch information is all in the path names.\n \n-\tScheme:     []string{\"https\", \"http\", \"svn\", \"svn+ssh\"},\n-\tPingCmd:    \"info -- {scheme}://{repo}\",\n-\tRemoteRepo: svnRemoteRepo,\n-\tStatus:     svnStatus,\n-}\n-\n-func svnRemoteRepo(vcsSvn *Cmd, rootDir string) (remoteRepo string, err error) {\n-\toutb, err := vcsSvn.runOutput(rootDir, \"info\")\n-\tif err != nil {\n-\t\treturn \"\", err\n-\t}\n-\tout := string(outb)\n-\n-\t// Expect:\n-\t//\n-\t//\t ...\n-\t// \tURL: <URL>\n-\t// \t...\n-\t//\n-\t// Note that we're not using the Repository Root line,\n-\t// because svn allows checking out subtrees.\n-\t// The URL will be the URL of the subtree (what we used with 'svn co')\n-\t// while the Repository Root may be a much higher parent.\n-\ti := strings.Index(out, \"\\nURL: \")\n-\tif i < 0 {\n-\t\treturn \"\", fmt.Errorf(\"unable to parse output of svn info\")\n-\t}\n-\tout = out[i+len(\"\\nURL: \"):]\n-\ti = strings.Index(out, \"\\n\")\n-\tif i < 0 {\n-\t\treturn \"\", fmt.Errorf(\"unable to parse output of svn info\")\n-\t}\n-\tout = out[:i]\n-\treturn strings.TrimSpace(out), nil\n+\tScheme:  []string{\"https\", \"http\", \"svn\", \"svn+ssh\"},\n+\tPingCmd: \"info -- {scheme}://{repo}\",\n+\tStatus:  svnStatus,\n }\n \n func svnStatus(vcsSvn *Cmd, rootDir string) (Status, error) {\n@@ -574,24 +386,8 @@ var vcsFossil = &Cmd{\n \t\t{filename: \"_FOSSIL_\", isDir: false},\n \t},\n \n-\tCreateCmd:   []string{\"-go-internal-mkdir {dir} clone -- {repo} \" + filepath.Join(\"{dir}\", fossilRepoName), \"-go-internal-cd {dir} open .fossil\"},\n-\tDownloadCmd: []string{\"up\"},\n-\n-\tTagCmd:         []tagCmd{{\"tag ls\", `(.*)`}},\n-\tTagSyncCmd:     []string{\"up tag:{tag}\"},\n-\tTagSyncDefault: []string{\"up trunk\"},\n-\n-\tScheme:     []string{\"https\", \"http\"},\n-\tRemoteRepo: fossilRemoteRepo,\n-\tStatus:     fossilStatus,\n-}\n-\n-func fossilRemoteRepo(vcsFossil *Cmd, rootDir string) (remoteRepo string, err error) {\n-\tout, err := vcsFossil.runOutput(rootDir, \"remote-url\")\n-\tif err != nil {\n-\t\treturn \"\", err\n-\t}\n-\treturn strings.TrimSpace(string(out)), nil\n+\tScheme: []string{\"https\", \"http\"},\n+\tStatus: fossilStatus,\n }\n \n var errFossilInfo = errors.New(\"unable to parse output of fossil info\")\n@@ -692,7 +488,7 @@ func (v *Cmd) run1(dir string, cmdline string, keyval []string, verbose bool) ([\n \t\targs[i] = expand(m, arg)\n \t}\n \n-\tif len(args) >= 2 && args[0] == \"-go-internal-mkdir\" {\n+\tif len(args) >= 2 && args[0] == \"--go-internal-mkdir\" {\n \t\tvar err error\n \t\tif filepath.IsAbs(args[1]) {\n \t\t\terr = os.Mkdir(args[1], fs.ModePerm)\n@@ -705,7 +501,7 @@ func (v *Cmd) run1(dir string, cmdline string, keyval []string, verbose bool) ([\n \t\targs = args[2:]\n \t}\n \n-\tif len(args) >= 2 && args[0] == \"-go-internal-cd\" {\n+\tif len(args) >= 2 && args[0] == \"--go-internal-cd\" {\n \t\tif filepath.IsAbs(args[1]) {\n \t\t\tdir = args[1]\n \t\t} else {\n@@ -766,99 +562,6 @@ func (v *Cmd) Ping(scheme, repo string) error {\n \treturn v.runVerboseOnly(dir, v.PingCmd, \"scheme\", scheme, \"repo\", repo)\n }\n \n-// Create creates a new copy of repo in dir.\n-// The parent of dir must exist; dir must not.\n-func (v *Cmd) Create(dir, repo string) error {\n-\trelease, err := base.AcquireNet()\n-\tif err != nil {\n-\t\treturn err\n-\t}\n-\tdefer release()\n-\n-\tfor _, cmd := range v.CreateCmd {\n-\t\tif err := v.run(filepath.Dir(dir), cmd, \"dir\", dir, \"repo\", repo); err != nil {\n-\t\t\treturn err\n-\t\t}\n-\t}\n-\treturn nil\n-}\n-\n-// Download downloads any new changes for the repo in dir.\n-func (v *Cmd) Download(dir string) error {\n-\trelease, err := base.AcquireNet()\n-\tif err != nil {\n-\t\treturn err\n-\t}\n-\tdefer release()\n-\n-\tfor _, cmd := range v.DownloadCmd {\n-\t\tif err := v.run(dir, cmd); err != nil {\n-\t\t\treturn err\n-\t\t}\n-\t}\n-\treturn nil\n-}\n-\n-// Tags returns the list of available tags for the repo in dir.\n-func (v *Cmd) Tags(dir string) ([]string, error) {\n-\tvar tags []string\n-\tfor _, tc := range v.TagCmd {\n-\t\tout, err := v.runOutput(dir, tc.cmd)\n-\t\tif err != nil {\n-\t\t\treturn nil, err\n-\t\t}\n-\t\tre := regexp.MustCompile(`(?m-s)` + tc.pattern)\n-\t\tfor _, m := range re.FindAllStringSubmatch(string(out), -1) {\n-\t\t\ttags = append(tags, m[1])\n-\t\t}\n-\t}\n-\treturn tags, nil\n-}\n-\n-// TagSync syncs the repo in dir to the named tag,\n-// which either is a tag returned by tags or is v.tagDefault.\n-func (v *Cmd) TagSync(dir, tag string) error {\n-\tif v.TagSyncCmd == nil {\n-\t\treturn nil\n-\t}\n-\tif tag != \"\" {\n-\t\tfor _, tc := range v.TagLookupCmd {\n-\t\t\tout, err := v.runOutput(dir, tc.cmd, \"tag\", tag)\n-\t\t\tif err != nil {\n-\t\t\t\treturn err\n-\t\t\t}\n-\t\t\tre := regexp.MustCompile(`(?m-s)` + tc.pattern)\n-\t\t\tm := re.FindStringSubmatch(string(out))\n-\t\t\tif len(m) > 1 {\n-\t\t\t\ttag = m[1]\n-\t\t\t\tbreak\n-\t\t\t}\n-\t\t}\n-\t}\n-\n-\trelease, err := base.AcquireNet()\n-\tif err != nil {\n-\t\treturn err\n-\t}\n-\tdefer release()\n-\n-\tif tag == \"\" && v.TagSyncDefault != nil {\n-\t\tfor _, cmd := range v.TagSyncDefault {\n-\t\t\tif err := v.run(dir, cmd); err != nil {\n-\t\t\t\treturn err\n-\t\t\t}\n-\t\t}\n-\t\treturn nil\n-\t}\n-\n-\tfor _, cmd := range v.TagSyncCmd {\n-\t\tif err := v.run(dir, cmd, \"tag\", tag); err != nil {\n-\t\t\treturn err\n-\t\t}\n-\t}\n-\treturn nil\n-}\n-\n // A vcsPath describes how to convert an import path into a\n // version control system and repository name.\n type vcsPath struct {\n@@ -1385,6 +1088,10 @@ func repoRootForImportDynamic(importPath string, mod ModuleMode, security web.Se\n \t\t}\n \t}\n \n+\tif err := validateRepoSubDir(mmi.SubDir); err != nil {\n+\t\treturn nil, fmt.Errorf(\"%s: invalid subdirectory %q: %v\", resp.URL, mmi.SubDir, err)\n+\t}\n+\n \tif err := validateRepoRoot(mmi.RepoRoot); err != nil {\n \t\treturn nil, fmt.Errorf(\"%s: invalid repo root %q: %v\", resp.URL, mmi.RepoRoot, err)\n \t}\n@@ -1416,6 +1123,22 @@ func repoRootForImportDynamic(importPath string, mod ModuleMode, security web.Se\n \treturn rr, nil\n }\n \n+// validateRepoSubDir returns an error if subdir is not a valid subdirectory path.\n+// We consider a subdirectory path to be valid as long as it doesn't have a leading\n+// slash (/) or hyphen (-).\n+func validateRepoSubDir(subdir string) error {\n+\tif subdir == \"\" {\n+\t\treturn nil\n+\t}\n+\tif subdir[0] == '/' {\n+\t\treturn errors.New(\"leading slash\")\n+\t}\n+\tif subdir[0] == '-' {\n+\t\treturn errors.New(\"leading hyphen\")\n+\t}\n+\treturn nil\n+}\n+\n // validateRepoRoot returns an error if repoRoot does not seem to be\n // a valid URL with scheme.\n func validateRepoRoot(repoRoot string) error {\ndiff --git a/src/cmd/go/internal/vcs/vcs_test.go b/src/cmd/go/internal/vcs/vcs_test.go\nindex 361d85bc..ab70e517 100644\n--- a/src/cmd/go/internal/vcs/vcs_test.go\n+++ b/src/cmd/go/internal/vcs/vcs_test.go\n@@ -507,6 +507,42 @@ func TestValidateRepoRoot(t *testing.T) {\n \t}\n }\n \n+func TestValidateRepoSubDir(t *testing.T) {\n+\ttests := []struct {\n+\t\tsubdir string\n+\t\tok     bool\n+\t}{\n+\t\t{\n+\t\t\tsubdir: \"\",\n+\t\t\tok:     true,\n+\t\t},\n+\t\t{\n+\t\t\tsubdir: \"sub/dir\",\n+\t\t\tok:     true,\n+\t\t},\n+\t\t{\n+\t\t\tsubdir: \"/leading/slash\",\n+\t\t\tok:     false,\n+\t\t},\n+\t\t{\n+\t\t\tsubdir: \"-leading/hyphen\",\n+\t\t\tok:     false,\n+\t\t},\n+\t}\n+\n+\tfor _, test := range tests {\n+\t\terr := validateRepoSubDir(test.subdir)\n+\t\tok := err == nil\n+\t\tif ok != test.ok {\n+\t\t\twant := \"error\"\n+\t\t\tif test.ok {\n+\t\t\t\twant = \"nil\"\n+\t\t\t}\n+\t\t\tt.Errorf(\"validateRepoSubDir(%q) = %q, want %s\", test.subdir, err, want)\n+\t\t}\n+\t}\n+}\n+\n var govcsTests = []struct {\n \tgovcs string\n \tpath  string\ndiff --git a/src/cmd/go/internal/workcmd/edit.go b/src/cmd/go/internal/workcmd/edit.go\nindex b18098ba..9b62dbb1 100644\n--- a/src/cmd/go/internal/workcmd/edit.go\n+++ b/src/cmd/go/internal/workcmd/edit.go\n@@ -279,7 +279,10 @@ func allowedVersionArg(arg string) bool {\n // parsePathVersionOptional parses path[@version], using adj to\n // describe any errors.\n func parsePathVersionOptional(adj, arg string, allowDirPath bool) (path, version string, err error) {\n-\tbefore, after, found := strings.Cut(arg, \"@\")\n+\tbefore, after, found, err := modload.ParsePathVersion(arg)\n+\tif err != nil {\n+\t\treturn \"\", \"\", err\n+\t}\n \tif !found {\n \t\tpath = arg\n \t} else {"}, {"role": "assistant", "content": "fix(modload): add ParsePathVersion to reject versions prefixed with - or"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/encoding/gob/doc.go | 20 ++++++++++----------\n 1 file changed, 10 insertions(+), 10 deletions(-)\n\ndiff --git a/src/encoding/gob/doc.go b/src/encoding/gob/doc.go\nindex c7468068..390f2508 100644\n--- a/src/encoding/gob/doc.go\n+++ b/src/encoding/gob/doc.go\n@@ -153,16 +153,16 @@ are transmitted, even if all the elements are zero.\n \n Structs are sent as a sequence of (field number, field value) pairs. The field\n value is sent using the standard gob encoding for its type, recursively. If a\n-field has the zero value for its type (except for arrays; see above), it is omitted\n-from the transmission. The field number is defined by the type of the encoded\n-struct: the first field of the encoded type is field 0, the second is field 1,\n-etc. When encoding a value, the field numbers are delta encoded for efficiency\n-and the fields are always sent in order of increasing field number; the deltas are\n-therefore unsigned. The initialization for the delta encoding sets the field\n-number to -1, so an unsigned integer field 0 with value 7 is transmitted as unsigned\n-delta = 1, unsigned value = 7 or (01 07). Finally, after all the fields have been\n-sent a terminating mark denotes the end of the struct. That mark is a delta=0\n-value, which has representation (00).\n+field has the zero value for its type (except for arrays; see above) or it's a\n+pointer to a zero value, it is omitted from the transmission. The field number\n+is defined by the type of the encoded struct: the first field of the encoded type\n+is field 0, the second is field 1, etc. When encoding a value, the field numbers\n+are delta encoded for efficiency and the fields are always sent in order of\n+increasing field number; the deltas are therefore unsigned. The initialization\n+for the delta encoding sets the field number to -1, so an unsigned integer field 0\n+with value 7 is transmitted as unsigned delta = 1, unsigned value = 7 or (01 07).\n+Finally, after all the fields have been sent a terminating mark denotes the end\n+of the struct. That mark is a delta=0 value, which has representation (00).\n \n Interface types are not checked for compatibility; all interface types are\n treated, for transmission, as members of a single \"interface\" type, analogous to"}, {"role": "assistant", "content": "docs(gob): clarify zero value pointer omission in encoding"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n CHANGELOG.md                          | 14 ++++++++++++++\n package.json                          |  2 +-\n packages/compiler-core/package.json   |  2 +-\n packages/compiler-dom/package.json    |  2 +-\n packages/compiler-sfc/package.json    |  2 +-\n packages/compiler-ssr/package.json    |  2 +-\n packages/reactivity/package.json      |  2 +-\n packages/runtime-core/package.json    |  2 +-\n packages/runtime-dom/package.json     |  2 +-\n packages/server-renderer/package.json |  2 +-\n packages/shared/package.json          |  2 +-\n packages/vue-compat/package.json      |  2 +-\n packages/vue/package.json             |  2 +-\n 13 files changed, 26 insertions(+), 12 deletions(-)\n\ndiff --git a/CHANGELOG.md b/CHANGELOG.md\nindex 3a07176..1417d29 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -1,3 +1,17 @@\n+## [3.5.25](https://github.com/vuejs/core/compare/v3.5.24...v3.5.25) (2025-11-24)\n+\n+\n+### Bug Fixes\n+\n+* **compiler:** share logic for comments and whitespace ([#13550](https://github.com/vuejs/core/issues/13550)) ([2214f7a](https://github.com/vuejs/core/commit/2214f7ab2940bcb751cd20130c020d895db6c042))\n+* **provide:** warn when using `provide` after mounting ([#13954](https://github.com/vuejs/core/issues/13954)) ([247b2c2](https://github.com/vuejs/core/commit/247b2c2067afc4dee52f9f7bc194f3aab347ac55)), closes [#13921](https://github.com/vuejs/core/issues/13921) [#13924](https://github.com/vuejs/core/issues/13924)\n+* **reactivity:** correctly wrap iterated array items to preserve their readonly status ([#14120](https://github.com/vuejs/core/issues/14120)) ([301020b](https://github.com/vuejs/core/commit/301020b481e85d03b0c96000f3221372063c41c6))\n+* **reactivity:** toRef edge cases for ref unwrapping ([#12420](https://github.com/vuejs/core/issues/12420)) ([0d2357e](https://github.com/vuejs/core/commit/0d2357e6974678d5484751c869f429dc6ea85582))\n+* **runtime-core:** keep options API typing intact when expose is used ([#14118](https://github.com/vuejs/core/issues/14118)) ([8f82f23](https://github.com/vuejs/core/commit/8f82f238463160284e504d1751d61b72dabb395e)), closes [#14117](https://github.com/vuejs/core/issues/14117) [vuejs/language-tools#5069](https://github.com/vuejs/language-tools/issues/5069)\n+* **suspense:** defer clearing fallback vnode el in case it has dirs ([#14080](https://github.com/vuejs/core/issues/14080)) ([c0f63dd](https://github.com/vuejs/core/commit/c0f63ddbfa8fa221d66b683b5c26e471851c2b50)), closes [#14078](https://github.com/vuejs/core/issues/14078)\n+\n+\n+\n ## [3.5.24](https://github.com/vuejs/core/compare/v3.5.23...v3.5.24) (2025-11-07)\n \n \ndiff --git a/package.json b/package.json\nindex 2ba9d2b..0c98e2b 100644\n--- a/package.json\n+++ b/package.json\n@@ -1,6 +1,6 @@\n {\n   \"private\": true,\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"packageManager\": \"pnpm@10.20.0\",\n   \"type\": \"module\",\n   \"scripts\": {\ndiff --git a/packages/compiler-core/package.json b/packages/compiler-core/package.json\nindex 2ff4004..b7f8fb4 100644\n--- a/packages/compiler-core/package.json\n+++ b/packages/compiler-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-core\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"@vue/compiler-core\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/compiler-core.esm-bundler.js\",\ndiff --git a/packages/compiler-dom/package.json b/packages/compiler-dom/package.json\nindex 8dec245..45f169b 100644\n--- a/packages/compiler-dom/package.json\n+++ b/packages/compiler-dom/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-dom\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"@vue/compiler-dom\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/compiler-dom.esm-bundler.js\",\ndiff --git a/packages/compiler-sfc/package.json b/packages/compiler-sfc/package.json\nindex e822d6e..2661f7b 100644\n--- a/packages/compiler-sfc/package.json\n+++ b/packages/compiler-sfc/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-sfc\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"@vue/compiler-sfc\",\n   \"main\": \"dist/compiler-sfc.cjs.js\",\n   \"module\": \"dist/compiler-sfc.esm-browser.js\",\ndiff --git a/packages/compiler-ssr/package.json b/packages/compiler-ssr/package.json\nindex 6d5d3f4..89bf859 100644\n--- a/packages/compiler-ssr/package.json\n+++ b/packages/compiler-ssr/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-ssr\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"@vue/compiler-ssr\",\n   \"main\": \"dist/compiler-ssr.cjs.js\",\n   \"types\": \"dist/compiler-ssr.d.ts\",\ndiff --git a/packages/reactivity/package.json b/packages/reactivity/package.json\nindex a5d36a0..c4507ff 100644\n--- a/packages/reactivity/package.json\n+++ b/packages/reactivity/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/reactivity\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"@vue/reactivity\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/reactivity.esm-bundler.js\",\ndiff --git a/packages/runtime-core/package.json b/packages/runtime-core/package.json\nindex 7c11de3..0e57c1d 100644\n--- a/packages/runtime-core/package.json\n+++ b/packages/runtime-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/runtime-core\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"@vue/runtime-core\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/runtime-core.esm-bundler.js\",\ndiff --git a/packages/runtime-dom/package.json b/packages/runtime-dom/package.json\nindex 9aab9f0..663ba52 100644\n--- a/packages/runtime-dom/package.json\n+++ b/packages/runtime-dom/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/runtime-dom\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"@vue/runtime-dom\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/runtime-dom.esm-bundler.js\",\ndiff --git a/packages/server-renderer/package.json b/packages/server-renderer/package.json\nindex 61d8ec3..45dbfc3 100644\n--- a/packages/server-renderer/package.json\n+++ b/packages/server-renderer/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/server-renderer\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"@vue/server-renderer\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/server-renderer.esm-bundler.js\",\ndiff --git a/packages/shared/package.json b/packages/shared/package.json\nindex 6863722..68dbe15 100644\n--- a/packages/shared/package.json\n+++ b/packages/shared/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/shared\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"internal utils shared across @vue packages\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/shared.esm-bundler.js\",\ndiff --git a/packages/vue-compat/package.json b/packages/vue-compat/package.json\nindex e39861a..d9f76bc 100644\n--- a/packages/vue-compat/package.json\n+++ b/packages/vue-compat/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compat\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"Vue 3 compatibility build for Vue 2\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/vue.runtime.esm-bundler.js\",\ndiff --git a/packages/vue/package.json b/packages/vue/package.json\nindex ee136ff..c520af8 100644\n--- a/packages/vue/package.json\n+++ b/packages/vue/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"vue\",\n-  \"version\": \"3.5.24\",\n+  \"version\": \"3.5.25\",\n   \"description\": \"The progressive JavaScript framework for building modern web UI.\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/vue.runtime.esm-bundler.js\","}, {"role": "assistant", "content": "chore(release): v3.5.25"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-dom/src/jsx.ts | 36 +++++++++++++++++++++++-------------\n 1 file changed, 23 insertions(+), 13 deletions(-)\n\ndiff --git a/packages/runtime-dom/src/jsx.ts b/packages/runtime-dom/src/jsx.ts\nindex eb43ccb..550926b 100644\n--- a/packages/runtime-dom/src/jsx.ts\n+++ b/packages/runtime-dom/src/jsx.ts\n@@ -286,6 +286,19 @@ export interface HTMLAttributes extends AriaAttributes, EventHandlers<Events> {\n   contextmenu?: string | undefined\n   dir?: string | undefined\n   draggable?: Booleanish | undefined\n+  enterkeyhint?:\n+    | 'enter'\n+    | 'done'\n+    | 'go'\n+    | 'next'\n+    | 'previous'\n+    | 'search'\n+    | 'send'\n+    | undefined\n+  /**\n+   * @deprecated Use `enterkeyhint` instead.\n+   */\n+  enterKeyHint?: HTMLAttributes['enterkeyhint']\n   hidden?: Booleanish | '' | 'hidden' | 'until-found' | undefined\n   id?: string | undefined\n   inert?: Booleanish | undefined\n@@ -346,6 +359,14 @@ export interface HTMLAttributes extends AriaAttributes, EventHandlers<Events> {\n    * @see https://html.spec.whatwg.org/multipage/custom-elements.html#attr-is\n    */\n   is?: string | undefined\n+  /**\n+   * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/exportparts\n+   */\n+  exportparts?: string\n+  /**\n+   * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/part\n+   */\n+  part?: string\n }\n \n type HTMLAttributeReferrerPolicy =\n@@ -498,6 +519,7 @@ export interface ImgHTMLAttributes extends HTMLAttributes {\n   alt?: string | undefined\n   crossorigin?: 'anonymous' | 'use-credentials' | '' | undefined\n   decoding?: 'async' | 'auto' | 'sync' | undefined\n+  fetchpriority?: 'high' | 'low' | 'auto' | undefined\n   height?: Numberish | undefined\n   loading?: 'eager' | 'lazy' | undefined\n   referrerpolicy?: HTMLAttributeReferrerPolicy | undefined\n@@ -547,19 +569,6 @@ export interface InputHTMLAttributes extends HTMLAttributes {\n   checked?: Booleanish | any[] | Set<any> | undefined // for IDE v-model multi-checkbox support\n   crossorigin?: string | undefined\n   disabled?: Booleanish | undefined\n-  enterkeyhint?:\n-    | 'enter'\n-    | 'done'\n-    | 'go'\n-    | 'next'\n-    | 'previous'\n-    | 'search'\n-    | 'send'\n-    | undefined\n-  /**\n-   * @deprecated Use `enterkeyhint` instead.\n-   */\n-  enterKeyHint?: InputHTMLAttributes['enterkeyhint']\n   form?: string | undefined\n   formaction?: string | undefined\n   formenctype?: string | undefined\n@@ -1292,6 +1301,7 @@ export interface IntrinsicElementAttributes {\n   polyline: SVGAttributes\n   radialGradient: SVGAttributes\n   rect: SVGAttributes\n+  set: SVGAttributes\n   stop: SVGAttributes\n   switch: SVGAttributes\n   symbol: SVGAttributes"}, {"role": "assistant", "content": "refactor(runtime-dom): move enterkeyhint to HTMLAttributes and add"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n CHANGELOG.md | 14 ++++++++++++++\n 1 file changed, 14 insertions(+)\n\ndiff --git a/CHANGELOG.md b/CHANGELOG.md\nindex b6b603e0..596420e2 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -1,3 +1,17 @@\n+<a name=\"21.0.9\"></a>\n+# 21.0.9 (2026-01-14)\n+### forms\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [82d556a8fb](https://github.com/angular/angular/commit/82d556a8fb38cd2024e3d098c55254305ba12b6b) | fix | Ensure the control instruction comes after the other bindings |\n+| [0055f3cc79](https://github.com/angular/angular/commit/0055f3cc79f387b8dec6ce5e1a33fad5486f9341) | fix | Rename signal form [field] to [formField] |\n+### migrations\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [e4bfa5c9e7](https://github.com/angular/angular/commit/e4bfa5c9e7feec48d3c4e9425a21a2ccf6532bdb) | fix | prevent duplicate imports in common-to-standalone migration |\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"21.1.0-rc.0\"></a>\n # 21.1.0-rc.0 (2026-01-08)\n ### common"}, {"role": "assistant", "content": "docs: release notes for the v21.0.9 release"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_codegen_llvm/src/attributes.rs      | 11 +-------\n library/alloc/src/slice.rs                         |  8 +++---\n library/alloc/src/vec/mod.rs                       |  6 +----\n .../lib-optimizations/append-elements.rs           | 30 ----------------------\n 4 files changed, 5 insertions(+), 50 deletions(-)"}, {"role": "assistant", "content": "refactor: remove redundant code and simplify slice/vec operations"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/compile/internal/ssa/_gen/simdAMD64.rules  |  40 ++++----\n .../compile/internal/ssa/_gen/simdgenericOps.go    |  40 ++++----\n src/cmd/compile/internal/ssa/opGen.go              |  80 ++++++++--------\n src/cmd/compile/internal/ssa/rewriteAMD64.go       |  40 ++++----\n src/cmd/compile/internal/ssagen/simdintrinsics.go  |  40 ++++----\n .../_gen/simdgen/ops/Converts/categories.yaml      |  40 ++++----\n .../archsimd/_gen/simdgen/ops/Converts/go.yaml     |  40 ++++----\n src/simd/archsimd/ops_amd64.go                     | 104 ++++++++++-----------\n 8 files changed, 212 insertions(+), 212 deletions(-)\n\ndiff --git a/src/cmd/compile/internal/ssa/_gen/simdAMD64.rules b/src/cmd/compile/internal/ssa/_gen/simdAMD64.rules\nindex a7a6a3f7..8a5b70da 100644\n--- a/src/cmd/compile/internal/ssa/_gen/simdAMD64.rules\n+++ b/src/cmd/compile/internal/ssa/_gen/simdAMD64.rules\n@@ -376,26 +376,26 @@\n (ExpandUint64x2 x mask) => (VPEXPANDQMasked128 x (VPMOVVec64x2ToM <types.TypeMask> mask))\n (ExpandUint64x4 x mask) => (VPEXPANDQMasked256 x (VPMOVVec64x4ToM <types.TypeMask> mask))\n (ExpandUint64x8 x mask) => (VPEXPANDQMasked512 x (VPMOVVec64x8ToM <types.TypeMask> mask))\n-(ExtendLo2ToInt64x2Int8x16 ...) => (VPMOVSXBQ128 ...)\n-(ExtendLo2ToInt64x2Int16x8 ...) => (VPMOVSXWQ128 ...)\n-(ExtendLo2ToInt64x2Int32x4 ...) => (VPMOVSXDQ128 ...)\n-(ExtendLo2ToUint64x2Uint8x16 ...) => (VPMOVZXBQ128 ...)\n-(ExtendLo2ToUint64x2Uint16x8 ...) => (VPMOVZXWQ128 ...)\n-(ExtendLo2ToUint64x2Uint32x4 ...) => (VPMOVZXDQ128 ...)\n-(ExtendLo4ToInt32x4Int8x16 ...) => (VPMOVSXBD128 ...)\n-(ExtendLo4ToInt32x4Int16x8 ...) => (VPMOVSXWD128 ...)\n-(ExtendLo4ToInt64x4Int8x16 ...) => (VPMOVSXBQ256 ...)\n-(ExtendLo4ToInt64x4Int16x8 ...) => (VPMOVSXWQ256 ...)\n-(ExtendLo4ToUint32x4Uint8x16 ...) => (VPMOVZXBD128 ...)\n-(ExtendLo4ToUint32x4Uint16x8 ...) => (VPMOVZXWD128 ...)\n-(ExtendLo4ToUint64x4Uint8x16 ...) => (VPMOVZXBQ256 ...)\n-(ExtendLo4ToUint64x4Uint16x8 ...) => (VPMOVZXWQ256 ...)\n-(ExtendLo8ToInt16x8Int8x16 ...) => (VPMOVSXBW128 ...)\n-(ExtendLo8ToInt32x8Int8x16 ...) => (VPMOVSXBD256 ...)\n-(ExtendLo8ToInt64x8Int8x16 ...) => (VPMOVSXBQ512 ...)\n-(ExtendLo8ToUint16x8Uint8x16 ...) => (VPMOVZXBW128 ...)\n-(ExtendLo8ToUint32x8Uint8x16 ...) => (VPMOVZXBD256 ...)\n-(ExtendLo8ToUint64x8Uint8x16 ...) => (VPMOVZXBQ512 ...)\n+(ExtendLo2ToInt64Int8x16 ...) => (VPMOVSXBQ128 ...)\n+(ExtendLo2ToInt64Int16x8 ...) => (VPMOVSXWQ128 ...)\n+(ExtendLo2ToInt64Int32x4 ...) => (VPMOVSXDQ128 ...)\n+(ExtendLo2ToUint64Uint8x16 ...) => (VPMOVZXBQ128 ...)\n+(ExtendLo2ToUint64Uint16x8 ...) => (VPMOVZXWQ128 ...)\n+(ExtendLo2ToUint64Uint32x4 ...) => (VPMOVZXDQ128 ...)\n+(ExtendLo4ToInt32Int8x16 ...) => (VPMOVSXBD128 ...)\n+(ExtendLo4ToInt32Int16x8 ...) => (VPMOVSXWD128 ...)\n+(ExtendLo4ToInt64Int8x16 ...) => (VPMOVSXBQ256 ...)\n+(ExtendLo4ToInt64Int16x8 ...) => (VPMOVSXWQ256 ...)\n+(ExtendLo4ToUint32Uint8x16 ...) => (VPMOVZXBD128 ...)\n+(ExtendLo4ToUint32Uint16x8 ...) => (VPMOVZXWD128 ...)\n+(ExtendLo4ToUint64Uint8x16 ...) => (VPMOVZXBQ256 ...)\n+(ExtendLo4ToUint64Uint16x8 ...) => (VPMOVZXWQ256 ...)\n+(ExtendLo8ToInt16Int8x16 ...) => (VPMOVSXBW128 ...)\n+(ExtendLo8ToInt32Int8x16 ...) => (VPMOVSXBD256 ...)\n+(ExtendLo8ToInt64Int8x16 ...) => (VPMOVSXBQ512 ...)\n+(ExtendLo8ToUint16Uint8x16 ...) => (VPMOVZXBW128 ...)\n+(ExtendLo8ToUint32Uint8x16 ...) => (VPMOVZXBD256 ...)\n+(ExtendLo8ToUint64Uint8x16 ...) => (VPMOVZXBQ512 ...)\n (ExtendToInt16Int8x16 ...) => (VPMOVSXBW256 ...)\n (ExtendToInt16Int8x32 ...) => (VPMOVSXBW512 ...)\n (ExtendToInt32Int8x16 ...) => (VPMOVSXBD512 ...)\ndiff --git a/src/cmd/compile/internal/ssa/_gen/simdgenericOps.go b/src/cmd/compile/internal/ssa/_gen/simdgenericOps.go\nindex fd43f3d6..af1007cd 100644\n--- a/src/cmd/compile/internal/ssa/_gen/simdgenericOps.go\n+++ b/src/cmd/compile/internal/ssa/_gen/simdgenericOps.go\n@@ -364,26 +364,26 @@ func simdGenericOps() []opData {\n \t\t{name: \"ExpandUint64x2\", argLength: 2, commutative: false},\n \t\t{name: \"ExpandUint64x4\", argLength: 2, commutative: false},\n \t\t{name: \"ExpandUint64x8\", argLength: 2, commutative: false},\n-\t\t{name: \"ExtendLo2ToInt64x2Int8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo2ToInt64x2Int16x8\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo2ToInt64x2Int32x4\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo2ToUint64x2Uint8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo2ToUint64x2Uint16x8\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo2ToUint64x2Uint32x4\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo4ToInt32x4Int8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo4ToInt32x4Int16x8\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo4ToInt64x4Int8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo4ToInt64x4Int16x8\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo4ToUint32x4Uint8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo4ToUint32x4Uint16x8\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo4ToUint64x4Uint8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo4ToUint64x4Uint16x8\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo8ToInt16x8Int8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo8ToInt32x8Int8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo8ToInt64x8Int8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo8ToUint16x8Uint8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo8ToUint32x8Uint8x16\", argLength: 1, commutative: false},\n-\t\t{name: \"ExtendLo8ToUint64x8Uint8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo2ToInt64Int8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo2ToInt64Int16x8\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo2ToInt64Int32x4\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo2ToUint64Uint8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo2ToUint64Uint16x8\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo2ToUint64Uint32x4\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo4ToInt32Int8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo4ToInt32Int16x8\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo4ToInt64Int8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo4ToInt64Int16x8\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo4ToUint32Uint8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo4ToUint32Uint16x8\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo4ToUint64Uint8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo4ToUint64Uint16x8\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo8ToInt16Int8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo8ToInt32Int8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo8ToInt64Int8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo8ToUint16Uint8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo8ToUint32Uint8x16\", argLength: 1, commutative: false},\n+\t\t{name: \"ExtendLo8ToUint64Uint8x16\", argLength: 1, commutative: false},\n \t\t{name: \"ExtendToInt16Int8x16\", argLength: 1, commutative: false},\n \t\t{name: \"ExtendToInt16Int8x32\", argLength: 1, commutative: false},\n \t\t{name: \"ExtendToInt32Int8x16\", argLength: 1, commutative: false},\ndiff --git a/src/cmd/compile/internal/ssa/opGen.go b/src/cmd/compile/internal/ssa/opGen.go\nindex f318adfd..d2ba15f7 100644\n--- a/src/cmd/compile/internal/ssa/opGen.go\n+++ b/src/cmd/compile/internal/ssa/opGen.go\n@@ -6518,26 +6518,26 @@ const (\n \tOpExpandUint64x2\n \tOpExpandUint64x4\n \tOpExpandUint64x8\n-\tOpExtendLo2ToInt64x2Int8x16\n-\tOpExtendLo2ToInt64x2Int16x8\n-\tOpExtendLo2ToInt64x2Int32x4\n-\tOpExtendLo2ToUint64x2Uint8x16\n-\tOpExtendLo2ToUint64x2Uint16x8\n-\tOpExtendLo2ToUint64x2Uint32x4\n-\tOpExtendLo4ToInt32x4Int8x16\n-\tOpExtendLo4ToInt32x4Int16x8\n-\tOpExtendLo4ToInt64x4Int8x16\n-\tOpExtendLo4ToInt64x4Int16x8\n-\tOpExtendLo4ToUint32x4Uint8x16\n-\tOpExtendLo4ToUint32x4Uint16x8\n-\tOpExtendLo4ToUint64x4Uint8x16\n-\tOpExtendLo4ToUint64x4Uint16x8\n-\tOpExtendLo8ToInt16x8Int8x16\n-\tOpExtendLo8ToInt32x8Int8x16\n-\tOpExtendLo8ToInt64x8Int8x16\n-\tOpExtendLo8ToUint16x8Uint8x16\n-\tOpExtendLo8ToUint32x8Uint8x16\n-\tOpExtendLo8ToUint64x8Uint8x16\n+\tOpExtendLo2ToInt64Int8x16\n+\tOpExtendLo2ToInt64Int16x8\n+\tOpExtendLo2ToInt64Int32x4\n+\tOpExtendLo2ToUint64Uint8x16\n+\tOpExtendLo2ToUint64Uint16x8\n+\tOpExtendLo2ToUint64Uint32x4\n+\tOpExtendLo4ToInt32Int8x16\n+\tOpExtendLo4ToInt32Int16x8\n+\tOpExtendLo4ToInt64Int8x16\n+\tOpExtendLo4ToInt64Int16x8\n+\tOpExtendLo4ToUint32Uint8x16\n+\tOpExtendLo4ToUint32Uint16x8\n+\tOpExtendLo4ToUint64Uint8x16\n+\tOpExtendLo4ToUint64Uint16x8\n+\tOpExtendLo8ToInt16Int8x16\n+\tOpExtendLo8ToInt32Int8x16\n+\tOpExtendLo8ToInt64Int8x16\n+\tOpExtendLo8ToUint16Uint8x16\n+\tOpExtendLo8ToUint32Uint8x16\n+\tOpExtendLo8ToUint64Uint8x16\n \tOpExtendToInt16Int8x16\n \tOpExtendToInt16Int8x32\n \tOpExtendToInt32Int8x16\n@@ -90896,102 +90896,102 @@ var opcodeTable = [...]opInfo{\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo2ToInt64x2Int8x16\",\n+\t\tname:    \"ExtendLo2ToInt64Int8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo2ToInt64x2Int16x8\",\n+\t\tname:    \"ExtendLo2ToInt64Int16x8\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo2ToInt64x2Int32x4\",\n+\t\tname:    \"ExtendLo2ToInt64Int32x4\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo2ToUint64x2Uint8x16\",\n+\t\tname:    \"ExtendLo2ToUint64Uint8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo2ToUint64x2Uint16x8\",\n+\t\tname:    \"ExtendLo2ToUint64Uint16x8\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo2ToUint64x2Uint32x4\",\n+\t\tname:    \"ExtendLo2ToUint64Uint32x4\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo4ToInt32x4Int8x16\",\n+\t\tname:    \"ExtendLo4ToInt32Int8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo4ToInt32x4Int16x8\",\n+\t\tname:    \"ExtendLo4ToInt32Int16x8\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo4ToInt64x4Int8x16\",\n+\t\tname:    \"ExtendLo4ToInt64Int8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo4ToInt64x4Int16x8\",\n+\t\tname:    \"ExtendLo4ToInt64Int16x8\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo4ToUint32x4Uint8x16\",\n+\t\tname:    \"ExtendLo4ToUint32Uint8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo4ToUint32x4Uint16x8\",\n+\t\tname:    \"ExtendLo4ToUint32Uint16x8\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo4ToUint64x4Uint8x16\",\n+\t\tname:    \"ExtendLo4ToUint64Uint8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo4ToUint64x4Uint16x8\",\n+\t\tname:    \"ExtendLo4ToUint64Uint16x8\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo8ToInt16x8Int8x16\",\n+\t\tname:    \"ExtendLo8ToInt16Int8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo8ToInt32x8Int8x16\",\n+\t\tname:    \"ExtendLo8ToInt32Int8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo8ToInt64x8Int8x16\",\n+\t\tname:    \"ExtendLo8ToInt64Int8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo8ToUint16x8Uint8x16\",\n+\t\tname:    \"ExtendLo8ToUint16Uint8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo8ToUint32x8Uint8x16\",\n+\t\tname:    \"ExtendLo8ToUint32Uint8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\n \t{\n-\t\tname:    \"ExtendLo8ToUint64x8Uint8x16\",\n+\t\tname:    \"ExtendLo8ToUint64Uint8x16\",\n \t\targLen:  1,\n \t\tgeneric: true,\n \t},\ndiff --git a/src/cmd/compile/internal/ssa/rewriteAMD64.go b/src/cmd/compile/internal/ssa/rewriteAMD64.go\nindex 5fed6a80..0c044100 100644\n--- a/src/cmd/compile/internal/ssa/rewriteAMD64.go\n+++ b/src/cmd/compile/internal/ssa/rewriteAMD64.go\n@@ -3274,64 +3274,64 @@ func rewriteValueAMD64(v *Value) bool {\n \t\treturn rewriteValueAMD64_OpExpandUint8x32(v)\n \tcase OpExpandUint8x64:\n \t\treturn rewriteValueAMD64_OpExpandUint8x64(v)\n-\tcase OpExtendLo2ToInt64x2Int16x8:\n+\tcase OpExtendLo2ToInt64Int16x8:\n \t\tv.Op = OpAMD64VPMOVSXWQ128\n \t\treturn true\n-\tcase OpExtendLo2ToInt64x2Int32x4:\n+\tcase OpExtendLo2ToInt64Int32x4:\n \t\tv.Op = OpAMD64VPMOVSXDQ128\n \t\treturn true\n-\tcase OpExtendLo2ToInt64x2Int8x16:\n+\tcase OpExtendLo2ToInt64Int8x16:\n \t\tv.Op = OpAMD64VPMOVSXBQ128\n \t\treturn true\n-\tcase OpExtendLo2ToUint64x2Uint16x8:\n+\tcase OpExtendLo2ToUint64Uint16x8:\n \t\tv.Op = OpAMD64VPMOVZXWQ128\n \t\treturn true\n-\tcase OpExtendLo2ToUint64x2Uint32x4:\n+\tcase OpExtendLo2ToUint64Uint32x4:\n \t\tv.Op = OpAMD64VPMOVZXDQ128\n \t\treturn true\n-\tcase OpExtendLo2ToUint64x2Uint8x16:\n+\tcase OpExtendLo2ToUint64Uint8x16:\n \t\tv.Op = OpAMD64VPMOVZXBQ128\n \t\treturn true\n-\tcase OpExtendLo4ToInt32x4Int16x8:\n+\tcase OpExtendLo4ToInt32Int16x8:\n \t\tv.Op = OpAMD64VPMOVSXWD128\n \t\treturn true\n-\tcase OpExtendLo4ToInt32x4Int8x16:\n+\tcase OpExtendLo4ToInt32Int8x16:\n \t\tv.Op = OpAMD64VPMOVSXBD128\n \t\treturn true\n-\tcase OpExtendLo4ToInt64x4Int16x8:\n+\tcase OpExtendLo4ToInt64Int16x8:\n \t\tv.Op = OpAMD64VPMOVSXWQ256\n \t\treturn true\n-\tcase OpExtendLo4ToInt64x4Int8x16:\n+\tcase OpExtendLo4ToInt64Int8x16:\n \t\tv.Op = OpAMD64VPMOVSXBQ256\n \t\treturn true\n-\tcase OpExtendLo4ToUint32x4Uint16x8:\n+\tcase OpExtendLo4ToUint32Uint16x8:\n \t\tv.Op = OpAMD64VPMOVZXWD128\n \t\treturn true\n-\tcase OpExtendLo4ToUint32x4Uint8x16:\n+\tcase OpExtendLo4ToUint32Uint8x16:\n \t\tv.Op = OpAMD64VPMOVZXBD128\n \t\treturn true\n-\tcase OpExtendLo4ToUint64x4Uint16x8:\n+\tcase OpExtendLo4ToUint64Uint16x8:\n \t\tv.Op = OpAMD64VPMOVZXWQ256\n \t\treturn true\n-\tcase OpExtendLo4ToUint64x4Uint8x16:\n+\tcase OpExtendLo4ToUint64Uint8x16:\n \t\tv.Op = OpAMD64VPMOVZXBQ256\n \t\treturn true\n-\tcase OpExtendLo8ToInt16x8Int8x16:\n+\tcase OpExtendLo8ToInt16Int8x16:\n \t\tv.Op = OpAMD64VPMOVSXBW128\n \t\treturn true\n-\tcase OpExtendLo8ToInt32x8Int8x16:\n+\tcase OpExtendLo8ToInt32Int8x16:\n \t\tv.Op = OpAMD64VPMOVSXBD256\n \t\treturn true\n-\tcase OpExtendLo8ToInt64x8Int8x16:\n+\tcase OpExtendLo8ToInt64Int8x16:\n \t\tv.Op = OpAMD64VPMOVSXBQ512\n \t\treturn true\n-\tcase OpExtendLo8ToUint16x8Uint8x16:\n+\tcase OpExtendLo8ToUint16Uint8x16:\n \t\tv.Op = OpAMD64VPMOVZXBW128\n \t\treturn true\n-\tcase OpExtendLo8ToUint32x8Uint8x16:\n+\tcase OpExtendLo8ToUint32Uint8x16:\n \t\tv.Op = OpAMD64VPMOVZXBD256\n \t\treturn true\n-\tcase OpExtendLo8ToUint64x8Uint8x16:\n+\tcase OpExtendLo8ToUint64Uint8x16:\n \t\tv.Op = OpAMD64VPMOVZXBQ512\n \t\treturn true\n \tcase OpExtendToInt16Int8x16:\ndiff --git a/src/cmd/compile/internal/ssagen/simdintrinsics.go b/src/cmd/compile/internal/ssagen/simdintrinsics.go\nindex 8b9fe3af..5a957612 100644\n--- a/src/cmd/compile/internal/ssagen/simdintrinsics.go\n+++ b/src/cmd/compile/internal/ssagen/simdintrinsics.go\n@@ -388,26 +388,26 @@ func simdIntrinsics(addF func(pkg, fn string, b intrinsicBuilder, archFamilies .\n \taddF(simdPackage, \"Uint64x2.Expand\", opLen2(ssa.OpExpandUint64x2, types.TypeVec128), sys.AMD64)\n \taddF(simdPackage, \"Uint64x4.Expand\", opLen2(ssa.OpExpandUint64x4, types.TypeVec256), sys.AMD64)\n \taddF(simdPackage, \"Uint64x8.Expand\", opLen2(ssa.OpExpandUint64x8, types.TypeVec512), sys.AMD64)\n-\taddF(simdPackage, \"Int8x16.ExtendLo2ToInt64x2\", opLen1(ssa.OpExtendLo2ToInt64x2Int8x16, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Int16x8.ExtendLo2ToInt64x2\", opLen1(ssa.OpExtendLo2ToInt64x2Int16x8, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Int32x4.ExtendLo2ToInt64x2\", opLen1(ssa.OpExtendLo2ToInt64x2Int32x4, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Uint8x16.ExtendLo2ToUint64x2\", opLen1(ssa.OpExtendLo2ToUint64x2Uint8x16, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Uint16x8.ExtendLo2ToUint64x2\", opLen1(ssa.OpExtendLo2ToUint64x2Uint16x8, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Uint32x4.ExtendLo2ToUint64x2\", opLen1(ssa.OpExtendLo2ToUint64x2Uint32x4, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Int8x16.ExtendLo4ToInt32x4\", opLen1(ssa.OpExtendLo4ToInt32x4Int8x16, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Int16x8.ExtendLo4ToInt32x4\", opLen1(ssa.OpExtendLo4ToInt32x4Int16x8, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Int8x16.ExtendLo4ToInt64x4\", opLen1(ssa.OpExtendLo4ToInt64x4Int8x16, types.TypeVec256), sys.AMD64)\n-\taddF(simdPackage, \"Int16x8.ExtendLo4ToInt64x4\", opLen1(ssa.OpExtendLo4ToInt64x4Int16x8, types.TypeVec256), sys.AMD64)\n-\taddF(simdPackage, \"Uint8x16.ExtendLo4ToUint32x4\", opLen1(ssa.OpExtendLo4ToUint32x4Uint8x16, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Uint16x8.ExtendLo4ToUint32x4\", opLen1(ssa.OpExtendLo4ToUint32x4Uint16x8, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Uint8x16.ExtendLo4ToUint64x4\", opLen1(ssa.OpExtendLo4ToUint64x4Uint8x16, types.TypeVec256), sys.AMD64)\n-\taddF(simdPackage, \"Uint16x8.ExtendLo4ToUint64x4\", opLen1(ssa.OpExtendLo4ToUint64x4Uint16x8, types.TypeVec256), sys.AMD64)\n-\taddF(simdPackage, \"Int8x16.ExtendLo8ToInt16x8\", opLen1(ssa.OpExtendLo8ToInt16x8Int8x16, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Int8x16.ExtendLo8ToInt32x8\", opLen1(ssa.OpExtendLo8ToInt32x8Int8x16, types.TypeVec256), sys.AMD64)\n-\taddF(simdPackage, \"Int8x16.ExtendLo8ToInt64x8\", opLen1(ssa.OpExtendLo8ToInt64x8Int8x16, types.TypeVec512), sys.AMD64)\n-\taddF(simdPackage, \"Uint8x16.ExtendLo8ToUint16x8\", opLen1(ssa.OpExtendLo8ToUint16x8Uint8x16, types.TypeVec128), sys.AMD64)\n-\taddF(simdPackage, \"Uint8x16.ExtendLo8ToUint32x8\", opLen1(ssa.OpExtendLo8ToUint32x8Uint8x16, types.TypeVec256), sys.AMD64)\n-\taddF(simdPackage, \"Uint8x16.ExtendLo8ToUint64x8\", opLen1(ssa.OpExtendLo8ToUint64x8Uint8x16, types.TypeVec512), sys.AMD64)\n+\taddF(simdPackage, \"Int8x16.ExtendLo2ToInt64\", opLen1(ssa.OpExtendLo2ToInt64Int8x16, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Int16x8.ExtendLo2ToInt64\", opLen1(ssa.OpExtendLo2ToInt64Int16x8, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Int32x4.ExtendLo2ToInt64\", opLen1(ssa.OpExtendLo2ToInt64Int32x4, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Uint8x16.ExtendLo2ToUint64\", opLen1(ssa.OpExtendLo2ToUint64Uint8x16, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Uint16x8.ExtendLo2ToUint64\", opLen1(ssa.OpExtendLo2ToUint64Uint16x8, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Uint32x4.ExtendLo2ToUint64\", opLen1(ssa.OpExtendLo2ToUint64Uint32x4, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Int8x16.ExtendLo4ToInt32\", opLen1(ssa.OpExtendLo4ToInt32Int8x16, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Int16x8.ExtendLo4ToInt32\", opLen1(ssa.OpExtendLo4ToInt32Int16x8, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Int8x16.ExtendLo4ToInt64\", opLen1(ssa.OpExtendLo4ToInt64Int8x16, types.TypeVec256), sys.AMD64)\n+\taddF(simdPackage, \"Int16x8.ExtendLo4ToInt64\", opLen1(ssa.OpExtendLo4ToInt64Int16x8, types.TypeVec256), sys.AMD64)\n+\taddF(simdPackage, \"Uint8x16.ExtendLo4ToUint32\", opLen1(ssa.OpExtendLo4ToUint32Uint8x16, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Uint16x8.ExtendLo4ToUint32\", opLen1(ssa.OpExtendLo4ToUint32Uint16x8, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Uint8x16.ExtendLo4ToUint64\", opLen1(ssa.OpExtendLo4ToUint64Uint8x16, types.TypeVec256), sys.AMD64)\n+\taddF(simdPackage, \"Uint16x8.ExtendLo4ToUint64\", opLen1(ssa.OpExtendLo4ToUint64Uint16x8, types.TypeVec256), sys.AMD64)\n+\taddF(simdPackage, \"Int8x16.ExtendLo8ToInt16\", opLen1(ssa.OpExtendLo8ToInt16Int8x16, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Int8x16.ExtendLo8ToInt32\", opLen1(ssa.OpExtendLo8ToInt32Int8x16, types.TypeVec256), sys.AMD64)\n+\taddF(simdPackage, \"Int8x16.ExtendLo8ToInt64\", opLen1(ssa.OpExtendLo8ToInt64Int8x16, types.TypeVec512), sys.AMD64)\n+\taddF(simdPackage, \"Uint8x16.ExtendLo8ToUint16\", opLen1(ssa.OpExtendLo8ToUint16Uint8x16, types.TypeVec128), sys.AMD64)\n+\taddF(simdPackage, \"Uint8x16.ExtendLo8ToUint32\", opLen1(ssa.OpExtendLo8ToUint32Uint8x16, types.TypeVec256), sys.AMD64)\n+\taddF(simdPackage, \"Uint8x16.ExtendLo8ToUint64\", opLen1(ssa.OpExtendLo8ToUint64Uint8x16, types.TypeVec512), sys.AMD64)\n \taddF(simdPackage, \"Int8x16.ExtendToInt16\", opLen1(ssa.OpExtendToInt16Int8x16, types.TypeVec256), sys.AMD64)\n \taddF(simdPackage, \"Int8x32.ExtendToInt16\", opLen1(ssa.OpExtendToInt16Int8x32, types.TypeVec512), sys.AMD64)\n \taddF(simdPackage, \"Int8x16.ExtendToInt32\", opLen1(ssa.OpExtendToInt32Int8x16, types.TypeVec512), sys.AMD64)\ndiff --git a/src/simd/archsimd/_gen/simdgen/ops/Converts/categories.yaml b/src/simd/archsimd/_gen/simdgen/ops/Converts/categories.yaml\nindex 88e48409..698e6d99 100644\n--- a/src/simd/archsimd/_gen/simdgen/ops/Converts/categories.yaml\n+++ b/src/simd/archsimd/_gen/simdgen/ops/Converts/categories.yaml\n@@ -135,83 +135,83 @@\n   documentation: !string |-\n     // NAME zero-extends element values to uint64.\n # low-part only Int <-> Int conversions\n-- go: ExtendLo8ToUint16x8\n+- go: ExtendLo8ToUint16\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 8 lowest vector element values to uint16.\n-- go: ExtendLo8ToInt16x8\n+- go: ExtendLo8ToInt16\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 8 lowest vector element values to int16.\n-- go: ExtendLo4ToUint32x4\n+- go: ExtendLo4ToUint32\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 4 lowest vector element values to uint32.\n-- go: ExtendLo4ToInt32x4\n+- go: ExtendLo4ToInt32\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 4 lowest vector element values to int32.\n-- go: ExtendLo2ToUint64x2\n+- go: ExtendLo2ToUint64\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 2 lowest vector element values to uint64.\n-- go: ExtendLo2ToInt64x2\n+- go: ExtendLo2ToInt64\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 2 lowest vector element values to int64.\n-- go: ExtendLo2ToUint64x2\n+- go: ExtendLo2ToUint64\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 2 lowest vector element values to uint64.\n-- go: ExtendLo4ToUint64x4\n+- go: ExtendLo4ToUint64\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 4 lowest vector element values to uint64.\n-- go: ExtendLo2ToInt64x2\n+- go: ExtendLo2ToInt64\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 2 lowest vector element values to int64.\n-- go: ExtendLo4ToInt64x4\n+- go: ExtendLo4ToInt64\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 4 lowest vector element values to int64.\n-- go: ExtendLo4ToUint32x4\n+- go: ExtendLo4ToUint32\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 4 lowest vector element values to uint32.\n-- go: ExtendLo8ToUint32x8\n+- go: ExtendLo8ToUint32\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 8 lowest vector element values to uint32.\n-- go: ExtendLo4ToInt32x4\n+- go: ExtendLo4ToInt32\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 4 lowest vector element values to int32.\n-- go: ExtendLo8ToInt32x8\n+- go: ExtendLo8ToInt32\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 8 lowest vector element values to int32.\n-- go: ExtendLo2ToUint64x2\n+- go: ExtendLo2ToUint64\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 2 lowest vector element values to uint64.\n-- go: ExtendLo4ToUint64x4\n+- go: ExtendLo4ToUint64\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 4 lowest vector element values to uint64.\n-- go: ExtendLo8ToUint64x8\n+- go: ExtendLo8ToUint64\n   commutative: false\n   documentation: !string |-\n     // NAME zero-extends 8 lowest vector element values to uint64.\n-- go: ExtendLo2ToInt64x2\n+- go: ExtendLo2ToInt64\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 2 lowest vector element values to int64.\n-- go: ExtendLo4ToInt64x4\n+- go: ExtendLo4ToInt64\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 4 lowest vector element values to int64.\n-- go: ExtendLo8ToInt64x8\n+- go: ExtendLo8ToInt64\n   commutative: false\n   documentation: !string |-\n     // NAME sign-extends 8 lowest vector element values to int64.\ndiff --git a/src/simd/archsimd/_gen/simdgen/ops/Converts/go.yaml b/src/simd/archsimd/_gen/simdgen/ops/Converts/go.yaml\nindex f436be23..2f19d126 100644\n--- a/src/simd/archsimd/_gen/simdgen/ops/Converts/go.yaml\n+++ b/src/simd/archsimd/_gen/simdgen/ops/Converts/go.yaml\n@@ -491,7 +491,7 @@\n \n # low-part only conversions.\n # uint8->uint16\n-- go: ExtendLo8ToUint16x8\n+- go: ExtendLo8ToUint16\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXBW\"\n   in:\n@@ -499,7 +499,7 @@\n   out:\n   - *u16x8\n # int8->int16\n-- go: ExtendLo8ToInt16x8\n+- go: ExtendLo8ToInt16\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXBW\"\n   in:\n@@ -507,7 +507,7 @@\n   out:\n   - *i16x8\n # uint16->uint32\n-- go: ExtendLo4ToUint32x4\n+- go: ExtendLo4ToUint32\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXWD\"\n   in:\n@@ -515,7 +515,7 @@\n   out:\n   - *u32x4\n # int16->int32\n-- go: ExtendLo4ToInt32x4\n+- go: ExtendLo4ToInt32\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXWD\"\n   in:\n@@ -523,7 +523,7 @@\n   out:\n   - *i32x4\n # uint32 -> uint64\n-- go: ExtendLo2ToUint64x2\n+- go: ExtendLo2ToUint64\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXDQ\"\n   in:\n@@ -534,7 +534,7 @@\n     elemBits: 64\n     bits: 128\n # int32 -> int64\n-- go: ExtendLo2ToInt64x2\n+- go: ExtendLo2ToInt64\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXDQ\"\n   in:\n@@ -545,14 +545,14 @@\n     elemBits: 64\n     bits: 128\n # uint16 -> uint64\n-- go: ExtendLo2ToUint64x2\n+- go: ExtendLo2ToUint64\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXWQ\"\n   in:\n   - *u16x8\n   out:\n   - *u64x2\n-- go: ExtendLo4ToUint64x4\n+- go: ExtendLo4ToUint64\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXWQ\"\n   in:\n@@ -560,14 +560,14 @@\n   out:\n   - *u64x4\n # int16 -> int64\n-- go: ExtendLo2ToInt64x2\n+- go: ExtendLo2ToInt64\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXWQ\"\n   in:\n   - *i16x8\n   out:\n   - *i64x2\n-- go: ExtendLo4ToInt64x4\n+- go: ExtendLo4ToInt64\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXWQ\"\n   in:\n@@ -575,14 +575,14 @@\n   out:\n   - *i64x4\n # uint8 -> uint32\n-- go: ExtendLo4ToUint32x4\n+- go: ExtendLo4ToUint32\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXBD\"\n   in:\n   - *u8x16\n   out:\n   - *u32x4\n-- go: ExtendLo8ToUint32x8\n+- go: ExtendLo8ToUint32\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXBD\"\n   in:\n@@ -590,14 +590,14 @@\n   out:\n   - *u32x8\n # int8 -> int32\n-- go: ExtendLo4ToInt32x4\n+- go: ExtendLo4ToInt32\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXBD\"\n   in:\n   - *i8x16\n   out:\n   - *i32x4\n-- go: ExtendLo8ToInt32x8\n+- go: ExtendLo8ToInt32\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXBD\"\n   in:\n@@ -605,21 +605,21 @@\n   out:\n   - *i32x8\n # uint8 -> uint64\n-- go: ExtendLo2ToUint64x2\n+- go: ExtendLo2ToUint64\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXBQ\"\n   in:\n   - *u8x16\n   out:\n   - *u64x2\n-- go: ExtendLo4ToUint64x4\n+- go: ExtendLo4ToUint64\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXBQ\"\n   in:\n   - *u8x16\n   out:\n   - *u64x4\n-- go: ExtendLo8ToUint64x8\n+- go: ExtendLo8ToUint64\n   regexpTag: \"convert\"\n   asm: \"VPMOVZXBQ\"\n   in:\n@@ -627,21 +627,21 @@\n   out:\n   - *u64x8\n # int8 -> int64\n-- go: ExtendLo2ToInt64x2\n+- go: ExtendLo2ToInt64\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXBQ\"\n   in:\n   - *i8x16\n   out:\n   - *i64x2\n-- go: ExtendLo4ToInt64x4\n+- go: ExtendLo4ToInt64\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXBQ\"\n   in:\n   - *i8x16\n   out:\n   - *i64x4\n-- go: ExtendLo8ToInt64x8\n+- go: ExtendLo8ToInt64\n   regexpTag: \"convert\"\n   asm: \"VPMOVSXBQ\"\n   in:\ndiff --git a/src/simd/archsimd/ops_amd64.go b/src/simd/archsimd/ops_amd64.go\nindex 20ae3b1c..522a98ca 100644\n--- a/src/simd/archsimd/ops_amd64.go\n+++ b/src/simd/archsimd/ops_amd64.go\n@@ -2325,129 +2325,129 @@ func (x Uint64x4) Expand(mask Mask64x4) Uint64x4\n // Asm: VPEXPANDQ, CPU Feature: AVX512\n func (x Uint64x8) Expand(mask Mask64x8) Uint64x8\n \n-/* ExtendLo2ToInt64x2 */\n+/* ExtendLo2ToInt64 */\n \n-// ExtendLo2ToInt64x2 sign-extends 2 lowest vector element values to int64.\n+// ExtendLo2ToInt64 sign-extends 2 lowest vector element values to int64.\n //\n // Asm: VPMOVSXBQ, CPU Feature: AVX\n-func (x Int8x16) ExtendLo2ToInt64x2() Int64x2\n+func (x Int8x16) ExtendLo2ToInt64() Int64x2\n \n-// ExtendLo2ToInt64x2 sign-extends 2 lowest vector element values to int64.\n+// ExtendLo2ToInt64 sign-extends 2 lowest vector element values to int64.\n //\n // Asm: VPMOVSXWQ, CPU Feature: AVX\n-func (x Int16x8) ExtendLo2ToInt64x2() Int64x2\n+func (x Int16x8) ExtendLo2ToInt64() Int64x2\n \n-// ExtendLo2ToInt64x2 sign-extends 2 lowest vector element values to int64.\n+// ExtendLo2ToInt64 sign-extends 2 lowest vector element values to int64.\n //\n // Asm: VPMOVSXDQ, CPU Feature: AVX\n-func (x Int32x4) ExtendLo2ToInt64x2() Int64x2\n+func (x Int32x4) ExtendLo2ToInt64() Int64x2\n \n-/* ExtendLo2ToUint64x2 */\n+/* ExtendLo2ToUint64 */\n \n-// ExtendLo2ToUint64x2 zero-extends 2 lowest vector element values to uint64.\n+// ExtendLo2ToUint64 zero-extends 2 lowest vector element values to uint64.\n //\n // Asm: VPMOVZXBQ, CPU Feature: AVX\n-func (x Uint8x16) ExtendLo2ToUint64x2() Uint64x2\n+func (x Uint8x16) ExtendLo2ToUint64() Uint64x2\n \n-// ExtendLo2ToUint64x2 zero-extends 2 lowest vector element values to uint64.\n+// ExtendLo2ToUint64 zero-extends 2 lowest vector element values to uint64.\n //\n // Asm: VPMOVZXWQ, CPU Feature: AVX\n-func (x Uint16x8) ExtendLo2ToUint64x2() Uint64x2\n+func (x Uint16x8) ExtendLo2ToUint64() Uint64x2\n \n-// ExtendLo2ToUint64x2 zero-extends 2 lowest vector element values to uint64.\n+// ExtendLo2ToUint64 zero-extends 2 lowest vector element values to uint64.\n //\n // Asm: VPMOVZXDQ, CPU Feature: AVX\n-func (x Uint32x4) ExtendLo2ToUint64x2() Uint64x2\n+func (x Uint32x4) ExtendLo2ToUint64() Uint64x2\n \n-/* ExtendLo4ToInt32x4 */\n+/* ExtendLo4ToInt32 */\n \n-// ExtendLo4ToInt32x4 sign-extends 4 lowest vector element values to int32.\n+// ExtendLo4ToInt32 sign-extends 4 lowest vector element values to int32.\n //\n // Asm: VPMOVSXBD, CPU Feature: AVX\n-func (x Int8x16) ExtendLo4ToInt32x4() Int32x4\n+func (x Int8x16) ExtendLo4ToInt32() Int32x4\n \n-// ExtendLo4ToInt32x4 sign-extends 4 lowest vector element values to int32.\n+// ExtendLo4ToInt32 sign-extends 4 lowest vector element values to int32.\n //\n // Asm: VPMOVSXWD, CPU Feature: AVX\n-func (x Int16x8) ExtendLo4ToInt32x4() Int32x4\n+func (x Int16x8) ExtendLo4ToInt32() Int32x4\n \n-/* ExtendLo4ToInt64x4 */\n+/* ExtendLo4ToInt64 */\n \n-// ExtendLo4ToInt64x4 sign-extends 4 lowest vector element values to int64.\n+// ExtendLo4ToInt64 sign-extends 4 lowest vector element values to int64.\n //\n // Asm: VPMOVSXBQ, CPU Feature: AVX2\n-func (x Int8x16) ExtendLo4ToInt64x4() Int64x4\n+func (x Int8x16) ExtendLo4ToInt64() Int64x4\n \n-// ExtendLo4ToInt64x4 sign-extends 4 lowest vector element values to int64.\n+// ExtendLo4ToInt64 sign-extends 4 lowest vector element values to int64.\n //\n // Asm: VPMOVSXWQ, CPU Feature: AVX2\n-func (x Int16x8) ExtendLo4ToInt64x4() Int64x4\n+func (x Int16x8) ExtendLo4ToInt64() Int64x4\n \n-/* ExtendLo4ToUint32x4 */\n+/* ExtendLo4ToUint32 */\n \n-// ExtendLo4ToUint32x4 zero-extends 4 lowest vector element values to uint32.\n+// ExtendLo4ToUint32 zero-extends 4 lowest vector element values to uint32.\n //\n // Asm: VPMOVZXBD, CPU Feature: AVX\n-func (x Uint8x16) ExtendLo4ToUint32x4() Uint32x4\n+func (x Uint8x16) ExtendLo4ToUint32() Uint32x4\n \n-// ExtendLo4ToUint32x4 zero-extends 4 lowest vector element values to uint32.\n+// ExtendLo4ToUint32 zero-extends 4 lowest vector element values to uint32.\n //\n // Asm: VPMOVZXWD, CPU Feature: AVX\n-func (x Uint16x8) ExtendLo4ToUint32x4() Uint32x4\n+func (x Uint16x8) ExtendLo4ToUint32() Uint32x4\n \n-/* ExtendLo4ToUint64x4 */\n+/* ExtendLo4ToUint64 */\n \n-// ExtendLo4ToUint64x4 zero-extends 4 lowest vector element values to uint64.\n+// ExtendLo4ToUint64 zero-extends 4 lowest vector element values to uint64.\n //\n // Asm: VPMOVZXBQ, CPU Feature: AVX2\n-func (x Uint8x16) ExtendLo4ToUint64x4() Uint64x4\n+func (x Uint8x16) ExtendLo4ToUint64() Uint64x4\n \n-// ExtendLo4ToUint64x4 zero-extends 4 lowest vector element values to uint64.\n+// ExtendLo4ToUint64 zero-extends 4 lowest vector element values to uint64.\n //\n // Asm: VPMOVZXWQ, CPU Feature: AVX2\n-func (x Uint16x8) ExtendLo4ToUint64x4() Uint64x4\n+func (x Uint16x8) ExtendLo4ToUint64() Uint64x4\n \n-/* ExtendLo8ToInt16x8 */\n+/* ExtendLo8ToInt16 */\n \n-// ExtendLo8ToInt16x8 sign-extends 8 lowest vector element values to int16.\n+// ExtendLo8ToInt16 sign-extends 8 lowest vector element values to int16.\n //\n // Asm: VPMOVSXBW, CPU Feature: AVX\n-func (x Int8x16) ExtendLo8ToInt16x8() Int16x8\n+func (x Int8x16) ExtendLo8ToInt16() Int16x8\n \n-/* ExtendLo8ToInt32x8 */\n+/* ExtendLo8ToInt32 */\n \n-// ExtendLo8ToInt32x8 sign-extends 8 lowest vector element values to int32.\n+// ExtendLo8ToInt32 sign-extends 8 lowest vector element values to int32.\n //\n // Asm: VPMOVSXBD, CPU Feature: AVX2\n-func (x Int8x16) ExtendLo8ToInt32x8() Int32x8\n+func (x Int8x16) ExtendLo8ToInt32() Int32x8\n \n-/* ExtendLo8ToInt64x8 */\n+/* ExtendLo8ToInt64 */\n \n-// ExtendLo8ToInt64x8 sign-extends 8 lowest vector element values to int64.\n+// ExtendLo8ToInt64 sign-extends 8 lowest vector element values to int64.\n //\n // Asm: VPMOVSXBQ, CPU Feature: AVX512\n-func (x Int8x16) ExtendLo8ToInt64x8() Int64x8\n+func (x Int8x16) ExtendLo8ToInt64() Int64x8\n \n-/* ExtendLo8ToUint16x8 */\n+/* ExtendLo8ToUint16 */\n \n-// ExtendLo8ToUint16x8 zero-extends 8 lowest vector element values to uint16.\n+// ExtendLo8ToUint16 zero-extends 8 lowest vector element values to uint16.\n //\n // Asm: VPMOVZXBW, CPU Feature: AVX\n-func (x Uint8x16) ExtendLo8ToUint16x8() Uint16x8\n+func (x Uint8x16) ExtendLo8ToUint16() Uint16x8\n \n-/* ExtendLo8ToUint32x8 */\n+/* ExtendLo8ToUint32 */\n \n-// ExtendLo8ToUint32x8 zero-extends 8 lowest vector element values to uint32.\n+// ExtendLo8ToUint32 zero-extends 8 lowest vector element values to uint32.\n //\n // Asm: VPMOVZXBD, CPU Feature: AVX2\n-func (x Uint8x16) ExtendLo8ToUint32x8() Uint32x8\n+func (x Uint8x16) ExtendLo8ToUint32() Uint32x8\n \n-/* ExtendLo8ToUint64x8 */\n+/* ExtendLo8ToUint64 */\n \n-// ExtendLo8ToUint64x8 zero-extends 8 lowest vector element values to uint64.\n+// ExtendLo8ToUint64 zero-extends 8 lowest vector element values to uint64.\n //\n // Asm: VPMOVZXBQ, CPU Feature: AVX512\n-func (x Uint8x16) ExtendLo8ToUint64x8() Uint64x8\n+func (x Uint8x16) ExtendLo8ToUint64() Uint64x8\n \n /* ExtendToInt16 */\n "}, {"role": "assistant", "content": "refactor(simd): simplify ExtendLo op names by removing output vector"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../__tests__/compileScript/resolveType.spec.ts        |  6 +++++-\n packages/compiler-sfc/src/script/resolveType.ts        | 12 ++++--------\n packages/compiler-sfc/src/script/utils.ts              | 18 ++++++++++++++++++\n 3 files changed, 27 insertions(+), 9 deletions(-)\n\ndiff --git a/packages/compiler-sfc/__tests__/compileScript/resolveType.spec.ts b/packages/compiler-sfc/__tests__/compileScript/resolveType.spec.ts\nindex eff2f01..557f6ec 100644\n--- a/packages/compiler-sfc/__tests__/compileScript/resolveType.spec.ts\n+++ b/packages/compiler-sfc/__tests__/compileScript/resolveType.spec.ts\n@@ -20,6 +20,8 @@ describe('resolveType', () => {\n       foo: number // property\n       bar(): void // method\n       'baz': string // string literal key\n+      [\\`qux\\`]: boolean // template literal key\n+      123: symbol // numeric literal key\n       (e: 'foo'): void // call signature\n       (e: 'bar'): void\n     }>()`)\n@@ -27,6 +29,8 @@ describe('resolveType', () => {\n       foo: ['Number'],\n       bar: ['Function'],\n       baz: ['String'],\n+      qux: ['Boolean'],\n+      123: ['Symbol'],\n     })\n     expect(calls?.length).toBe(2)\n   })\n@@ -195,7 +199,7 @@ describe('resolveType', () => {\n     type T = 'foo' | 'bar'\n     type S = 'x' | 'y'\n     defineProps<{\n-      [\\`_\\${T}_\\${S}_\\`]: string\n+      [K in \\`_\\${T}_\\${S}_\\`]: string\n     }>()\n     `).props,\n     ).toStrictEqual({\ndiff --git a/packages/compiler-sfc/src/script/resolveType.ts b/packages/compiler-sfc/src/script/resolveType.ts\nindex b40c7cd..9cb4ce8 100644\n--- a/packages/compiler-sfc/src/script/resolveType.ts\n+++ b/packages/compiler-sfc/src/script/resolveType.ts\n@@ -29,6 +29,7 @@ import {\n   createGetCanonicalFileName,\n   getId,\n   getImportedName,\n+  getStringLiteralKey,\n   joinPaths,\n   normalizePath,\n } from './utils'\n@@ -336,13 +337,9 @@ function typeElementsToMap(\n         Object.assign(scope.types, typeParameters)\n       }\n       ;(e as MaybeWithScope)._ownerScope = scope\n-      const name = getId(e.key)\n-      if (name && !e.computed) {\n+      const name = getStringLiteralKey(e)\n+      if (name !== null) {\n         res.props[name] = e as ResolvedElements['props'][string]\n-      } else if (e.key.type === 'TemplateLiteral') {\n-        for (const key of resolveTemplateKeys(ctx, e.key, scope)) {\n-          res.props[key] = e as ResolvedElements['props'][string]\n-        }\n       } else {\n         ctx.error(\n           `Unsupported computed key in type referenced by a macro`,\n@@ -2029,8 +2026,7 @@ function findStaticPropertyType(node: TSTypeLiteral, key: string) {\n   const prop = node.members.find(\n     m =>\n       m.type === 'TSPropertySignature' &&\n-      !m.computed &&\n-      getId(m.key) === key &&\n+      getStringLiteralKey(m) === key &&\n       m.typeAnnotation,\n   )\n   return prop && prop.typeAnnotation!.typeAnnotation\ndiff --git a/packages/compiler-sfc/src/script/utils.ts b/packages/compiler-sfc/src/script/utils.ts\nindex 1b7da0e..bda64dc 100644\n--- a/packages/compiler-sfc/src/script/utils.ts\n+++ b/packages/compiler-sfc/src/script/utils.ts\n@@ -7,6 +7,8 @@ import type {\n   ImportSpecifier,\n   Node,\n   StringLiteral,\n+  TSMethodSignature,\n+  TSPropertySignature,\n } from '@babel/types'\n import path from 'path'\n \n@@ -79,6 +81,22 @@ export function getId(node: Expression) {\n       : null\n }\n \n+export function getStringLiteralKey(\n+  node: TSPropertySignature | TSMethodSignature,\n+): string | null {\n+  return node.computed\n+    ? node.key.type === 'TemplateLiteral' && !node.key.expressions.length\n+      ? node.key.quasis.map(q => q.value.cooked).join('')\n+      : null\n+    : node.key.type === 'Identifier'\n+      ? node.key.name\n+      : node.key.type === 'StringLiteral'\n+        ? node.key.value\n+        : node.key.type === 'NumericLiteral'\n+          ? String(node.key.value)\n+          : null\n+}\n+\n const identity = (str: string) => str\n const fileNameLowerCaseRegExp = /[^\\u0130\\u0131\\u00DFa-z0-9\\\\/:\\-_\\. ]+/g\n const toLowerCase = (str: string) => str.toLowerCase()"}, {"role": "assistant", "content": "fix(compiler-sfc): support template and numeric literal keys in type"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n vscode-ng-language-service/package.json | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/vscode-ng-language-service/package.json b/vscode-ng-language-service/package.json\nindex a920c794..2597f8f6 100644\n--- a/vscode-ng-language-service/package.json\n+++ b/vscode-ng-language-service/package.json\n@@ -257,7 +257,7 @@\n     \"test:inspect-common\": \"bazel run --config=debug //vscode-ng-language-service/common/tests:test\",\n     \"test:inspect-server\": \"bazel run --config=debug //vscode-ng-language-service/server/src/tests:test\",\n     \"test:inspect-syntaxes\": \"bazel run --config=debug //vscode-ng-language-service/syntaxes/test:test\",\n-    \"release\": \"node tools/release.mts\"\n+    \"release\": \"tsx tools/release.mts\"\n   },\n   \"dependencies\": {\n     \"@angular/language-service\": \"workspace:*\","}, {"role": "assistant", "content": "build: use tsx for release script"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../marked/extensions/docs-card/docs-card.mts      | 24 +++++++++++-----------\n .../pipeline/shared/marked/renderer.mts            |  2 ++\n .../shared/marked/test/heading/heading.spec.mts    | 17 +++++++++++++--\n .../shared/marked/test/renderer-context.mts        |  1 +\n .../shared/marked/transformations/heading.mts      |  4 +++-\n .../shared/marked/transformations/link.mts         | 14 ++-----------\n 6 files changed, 35 insertions(+), 27 deletions(-)\n\ndiff --git a/adev/shared-docs/pipeline/shared/marked/extensions/docs-card/docs-card.mts b/adev/shared-docs/pipeline/shared/marked/extensions/docs-card/docs-card.mts\nindex 457936a0..f21fa846 100644\n--- a/adev/shared-docs/pipeline/shared/marked/extensions/docs-card/docs-card.mts\n+++ b/adev/shared-docs/pipeline/shared/marked/extensions/docs-card/docs-card.mts\n@@ -6,9 +6,9 @@\n  * found in the LICENSE file at https://angular.dev/license\n  */\n \n-import {Tokens, Token, RendererThis, TokenizerThis} from 'marked';\n-import {loadWorkspaceRelativeFile, anchorTarget} from '../../helpers.mjs';\n-import {setInsideLink} from '../../transformations/link.mjs';\n+import {RendererThis, Token, TokenizerThis, Tokens} from 'marked';\n+import {anchorTarget, loadWorkspaceRelativeFile} from '../../helpers.mjs';\n+import {AdevDocsRenderer} from '../../renderer.mjs';\n \n interface DocsCardToken extends Tokens.Generic {\n   type: 'docs-card';\n@@ -67,11 +67,13 @@ export const docsCardExtension = {\n     return undefined;\n   },\n   renderer(this: RendererThis, token: DocsCardToken) {\n-    return token.imgSrc ? getCardWithSvgIllustration(this, token) : getStandardCard(this, token);\n+    return token.imgSrc\n+      ? getCardWithSvgIllustration(this, token)\n+      : getStandardCard(this.parser.renderer as AdevDocsRenderer, token);\n   },\n };\n \n-function getStandardCard(renderer: RendererThis, token: DocsCardToken) {\n+function getStandardCard(renderer: AdevDocsRenderer, token: DocsCardToken) {\n   if (token.iconImgSrc && token.href) {\n     // We can assume that all icons are svg files since they are custom.\n     // We need to read svg content, instead of renering svg with `img`,\n@@ -110,13 +112,11 @@ function getStandardCard(renderer: RendererThis, token: DocsCardToken) {\n   `;\n }\n \n-function parseWithoutCreatingLinks(renderer: RendererThis, token: DocsCardToken) {\n-  setInsideLink(true);\n-  try {\n-    return renderer.parser.parse(token.tokens);\n-  } finally {\n-    setInsideLink(false);\n-  }\n+function parseWithoutCreatingLinks(renderer: AdevDocsRenderer, token: DocsCardToken) {\n+  renderer.context.disableAutoLinking = true;\n+  const parsed = renderer.parser.parse(token.tokens);\n+  renderer.context.disableAutoLinking = false;\n+  return parsed;\n }\n \n function getCardWithSvgIllustration(renderer: RendererThis, token: DocsCardToken) {\ndiff --git a/adev/shared-docs/pipeline/shared/marked/renderer.mts b/adev/shared-docs/pipeline/shared/marked/renderer.mts\nindex dc884fae..fe07d2a8 100644\n--- a/adev/shared-docs/pipeline/shared/marked/renderer.mts\n+++ b/adev/shared-docs/pipeline/shared/marked/renderer.mts\n@@ -31,6 +31,8 @@ export interface RendererContext {\n   apiEntries?: Record<string, {moduleName: string; aliases?: string[]}>;\n   highlighter: HighlighterGeneric<any, any>;\n   headerIds: Map<string, number>;\n+  /** In the case we want to disable auto-linking because anchor blocks might be incompatible where some code blocks are being rendered */\n+  disableAutoLinking: boolean;\n }\n \n /**\ndiff --git a/adev/shared-docs/pipeline/shared/marked/test/heading/heading.spec.mts b/adev/shared-docs/pipeline/shared/marked/test/heading/heading.spec.mts\nindex 16faedf0..dd3bb563 100644\n--- a/adev/shared-docs/pipeline/shared/marked/test/heading/heading.spec.mts\n+++ b/adev/shared-docs/pipeline/shared/marked/test/heading/heading.spec.mts\n@@ -6,10 +6,10 @@\n  * found in the LICENSE file at https://angular.dev/license\n  */\n \n-import {parseMarkdown} from '../../parse.mjs';\n-import {resolve} from 'node:path';\n import {readFile} from 'fs/promises';\n import {JSDOM} from 'jsdom';\n+import {resolve} from 'node:path';\n+import {parseMarkdown} from '../../parse.mjs';\n import {rendererContext} from '../renderer-context.mjs';\n \n describe('markdown to html', () => {\n@@ -118,4 +118,17 @@ describe('markdown to html', () => {\n \n     expect(h2.firstElementChild!.innerHTML).toBe('Query for the <code>&lt;h1&gt;</code>');\n   });\n+\n+  it('shoud now link symbols in headings', () => {\n+    const markdownDocument = JSDOM.fragment(\n+      parseMarkdown('## Hello **NEW** `Router` ', rendererContext),\n+    );\n+    const h2 = markdownDocument.querySelector('h2')!;\n+\n+    // The anchor element should be to only child, no nested anchor\n+    expect(h2.children.length).toBe(1);\n+\n+    // We ensure that we still style the heading content\n+    expect(markdownDocument.querySelector('strong')).toBeDefined();\n+  });\n });\ndiff --git a/adev/shared-docs/pipeline/shared/marked/test/renderer-context.mts b/adev/shared-docs/pipeline/shared/marked/test/renderer-context.mts\nindex dfaf5ce1..d202cb00 100644\n--- a/adev/shared-docs/pipeline/shared/marked/test/renderer-context.mts\n+++ b/adev/shared-docs/pipeline/shared/marked/test/renderer-context.mts\n@@ -25,6 +25,7 @@ export const rendererContext: RendererContext = {\n     Router: {moduleName: 'angular/router'},\n   },\n   headerIds: new Map<string, number>(),\n+  disableAutoLinking: false,\n };\n \n export async function setHighlighter() {\ndiff --git a/adev/shared-docs/pipeline/shared/marked/transformations/heading.mts b/adev/shared-docs/pipeline/shared/marked/transformations/heading.mts\nindex 3bd651ee..f5ed377e 100644\n--- a/adev/shared-docs/pipeline/shared/marked/transformations/heading.mts\n+++ b/adev/shared-docs/pipeline/shared/marked/transformations/heading.mts\n@@ -13,7 +13,9 @@ export function headingRender(\n   this: AdevDocsRenderer,\n   {depth, tokens, text: headingText, raw}: Tokens.Heading,\n ): string {\n-  const parsedText = this?.parser.parseInline(tokens);\n+  this.context.disableAutoLinking = true;\n+  const parsedText = this?.parser.parseInline(tokens, this);\n+  this.context.disableAutoLinking = false;\n   if (depth === 1) {\n     return `\n     <header class=\"docs-header\">\ndiff --git a/adev/shared-docs/pipeline/shared/marked/transformations/link.mts b/adev/shared-docs/pipeline/shared/marked/transformations/link.mts\nindex 50263558..d01b65ab 100644\n--- a/adev/shared-docs/pipeline/shared/marked/transformations/link.mts\n+++ b/adev/shared-docs/pipeline/shared/marked/transformations/link.mts\n@@ -6,20 +6,10 @@\n  * found in the LICENSE file at https://angular.dev/license\n  */\n \n+import {Tokens} from 'marked';\n import {anchorTarget} from '../helpers.mjs';\n-import {Renderer, Tokens} from 'marked';\n import {AdevDocsRenderer} from '../renderer.mjs';\n \n-/**\n- * Tracks whether the current renderer is inside a link.\n- *\n- * This is necessary because nested links are invalid HTML and can cause rendering issues.\n- */\n-let insideLink = false;\n-export function setInsideLink(value: boolean) {\n-  insideLink = value;\n-}\n-\n export function linkRender(this: AdevDocsRenderer, {href, title, tokens}: Tokens.Link) {\n   // We have render-time check that we don't create absolute links (which are rendered as external links)\n   // in our guides\n@@ -40,7 +30,7 @@ export function linkRender(this: AdevDocsRenderer, {href, title, tokens}: Tokens\n     );\n   }\n \n-  if (insideLink) {\n+  if (this.context.disableAutoLinking) {\n     return this.parser.parseInline(tokens);\n   }\n "}, {"role": "assistant", "content": "docs(docs-infra): prevent heading from linking symbols"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/HIR/Environment.ts                         |  9 ++-\n .../Validation/ValidateExhaustiveDependencies.ts   | 35 +++++++--\n .../error.exhaustive-deps-effect-events.expect.md  |  2 +-\n .../error.exhaustive-deps-effect-events.js         |  2 +-\n ...lid-exhaustive-effect-deps-extra-only.expect.md | 83 +++++++++++++++++++++\n ...or.invalid-exhaustive-effect-deps-extra-only.js | 24 +++++++\n ...d-exhaustive-effect-deps-missing-only.expect.md | 84 ++++++++++++++++++++++\n ....invalid-exhaustive-effect-deps-missing-only.js | 24 +++++++\n .../error.invalid-exhaustive-effect-deps.expect.md |  2 +-\n .../error.invalid-exhaustive-effect-deps.js        |  2 +-\n ...onreactive-stable-types-as-extra-deps.expect.md |  4 +-\n ...allow-nonreactive-stable-types-as-extra-deps.js |  2 +-\n .../exhaustive-deps-effect-events.expect.md        |  4 +-\n .../exhaustive-deps-effect-events.js               |  2 +-\n fixtures/eslint-v9/index.js                        | 13 ++++\n fixtures/eslint-v9/yarn.lock                       | 22 ++++--\n .../src/shared/RunReactCompiler.ts                 |  1 +\n 17 files changed, 293 insertions(+), 22 deletions(-)\n\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/HIR/Environment.ts b/compiler/packages/babel-plugin-react-compiler/src/HIR/Environment.ts\nindex 05105ae..d6c0e24 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/HIR/Environment.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/HIR/Environment.ts\n@@ -225,8 +225,15 @@ export const EnvironmentConfigSchema = z.object({\n \n   /**\n    * Validate that dependencies supplied to effect hooks are exhaustive.\n+   * Can be:\n+   * - 'off': No validation (default)\n+   * - 'all': Validate and report both missing and extra dependencies\n+   * - 'missing-only': Only report missing dependencies\n+   * - 'extra-only': Only report extra/unnecessary dependencies\n    */\n-  validateExhaustiveEffectDependencies: z.boolean().default(false),\n+  validateExhaustiveEffectDependencies: z\n+    .enum(['off', 'all', 'missing-only', 'extra-only'])\n+    .default('off'),\n \n   /**\n    * When this is true, rather than pruning existing manual memoization but ensuring or validating\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\nindex e364c02..e72de6c 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\n@@ -141,6 +141,7 @@ export function validateExhaustiveDependencies(\n         reactive,\n         startMemo.depsLoc,\n         ErrorCategory.MemoDependencies,\n+        'all',\n       );\n       if (diagnostic != null) {\n         error.pushDiagnostic(diagnostic);\n@@ -159,7 +160,7 @@ export function validateExhaustiveDependencies(\n       onStartMemoize,\n       onFinishMemoize,\n       onEffect: (inferred, manual, manualMemoLoc) => {\n-        if (env.config.validateExhaustiveEffectDependencies === false) {\n+        if (env.config.validateExhaustiveEffectDependencies === 'off') {\n           return;\n         }\n         if (DEBUG) {\n@@ -195,12 +196,17 @@ export function validateExhaustiveDependencies(\n             });\n           }\n         }\n+        const effectReportMode =\n+          typeof env.config.validateExhaustiveEffectDependencies === 'string'\n+            ? env.config.validateExhaustiveEffectDependencies\n+            : 'all';\n         const diagnostic = validateDependencies(\n           Array.from(inferred),\n           manualDeps,\n           reactive,\n           manualMemoLoc,\n           ErrorCategory.EffectExhaustiveDependencies,\n+          effectReportMode,\n         );\n         if (diagnostic != null) {\n           error.pushDiagnostic(diagnostic);\n@@ -220,6 +226,7 @@ function validateDependencies(\n   category:\n     | ErrorCategory.MemoDependencies\n     | ErrorCategory.EffectExhaustiveDependencies,\n+  exhaustiveDepsReportMode: 'all' | 'missing-only' | 'extra-only',\n ): CompilerDiagnostic | null {\n   // Sort dependencies by name and path, with shorter/non-optional paths first\n   inferred.sort((a, b) => {\n@@ -370,9 +377,20 @@ function validateDependencies(\n     extra.push(dep);\n   }\n \n-  if (missing.length !== 0 || extra.length !== 0) {\n+  // Filter based on report mode\n+  const filteredMissing =\n+    exhaustiveDepsReportMode === 'extra-only' ? [] : missing;\n+  const filteredExtra =\n+    exhaustiveDepsReportMode === 'missing-only' ? [] : extra;\n+\n+  if (filteredMissing.length !== 0 || filteredExtra.length !== 0) {\n     let suggestion: CompilerSuggestion | null = null;\n-    if (manualMemoLoc != null && typeof manualMemoLoc !== 'symbol') {\n+    if (\n+      manualMemoLoc != null &&\n+      typeof manualMemoLoc !== 'symbol' &&\n+      manualMemoLoc.start.index != null &&\n+      manualMemoLoc.end.index != null\n+    ) {\n       suggestion = {\n         description: 'Update dependencies',\n         range: [manualMemoLoc.start.index, manualMemoLoc.end.index],\n@@ -388,8 +406,13 @@ function validateDependencies(\n           .join(', ')}]`,\n       };\n     }\n-    const diagnostic = createDiagnostic(category, missing, extra, suggestion);\n-    for (const dep of missing) {\n+    const diagnostic = createDiagnostic(\n+      category,\n+      filteredMissing,\n+      filteredExtra,\n+      suggestion,\n+    );\n+    for (const dep of filteredMissing) {\n       let reactiveStableValueHint = '';\n       if (isStableType(dep.identifier)) {\n         reactiveStableValueHint =\n@@ -402,7 +425,7 @@ function validateDependencies(\n         loc: dep.loc,\n       });\n     }\n-    for (const dep of extra) {\n+    for (const dep of filteredExtra) {\n       if (dep.root.kind === 'Global') {\n         diagnostic.withDetails({\n           kind: 'error',\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.exhaustive-deps-effect-events.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.exhaustive-deps-effect-events.expect.md\nindex e2ab53d..d0a626e 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.exhaustive-deps-effect-events.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.exhaustive-deps-effect-events.expect.md\n@@ -2,7 +2,7 @@\n ## Input\n \n ```javascript\n-// @validateExhaustiveEffectDependencies\n+// @validateExhaustiveEffectDependencies:\"all\"\n import {useEffect, useEffectEvent} from 'react';\n \n function Component({x, y, z}) {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.exhaustive-deps-effect-events.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.exhaustive-deps-effect-events.js\nindex f8e9c8d..03e4a32 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.exhaustive-deps-effect-events.js\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.exhaustive-deps-effect-events.js\n@@ -1,4 +1,4 @@\n-// @validateExhaustiveEffectDependencies\n+// @validateExhaustiveEffectDependencies:\"all\"\n import {useEffect, useEffectEvent} from 'react';\n \n function Component({x, y, z}) {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-extra-only.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-extra-only.expect.md\nnew file mode 100644\nindex 0000000..f9aac96\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-extra-only.expect.md\n@@ -0,0 +1,83 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveEffectDependencies:\"extra-only\"\n+import {useEffect} from 'react';\n+\n+function Component({x, y, z}) {\n+  // no error: missing dep not reported in extra-only mode\n+  useEffect(() => {\n+    log(x);\n+  }, []);\n+\n+  // error: extra dep - y\n+  useEffect(() => {\n+    log(x);\n+  }, [x, y]);\n+\n+  // error: extra dep - y (missing dep - z not reported)\n+  useEffect(() => {\n+    log(x, z);\n+  }, [x, y]);\n+\n+  // error: extra dep - x.y\n+  useEffect(() => {\n+    log(x);\n+  }, [x.y]);\n+}\n+\n+```\n+\n+\n+## Error\n+\n+```\n+Found 3 errors:\n+\n+Error: Found extra effect dependencies\n+\n+Extra dependencies can cause an effect to fire more often than it should, resulting in performance problems such as excessive renders and side effects.\n+\n+error.invalid-exhaustive-effect-deps-extra-only.ts:13:9\n+  11 |   useEffect(() => {\n+  12 |     log(x);\n+> 13 |   }, [x, y]);\n+     |          ^ Unnecessary dependency `y`\n+  14 |\n+  15 |   // error: extra dep - y (missing dep - z not reported)\n+  16 |   useEffect(() => {\n+\n+Inferred dependencies: `[x]`\n+\n+Error: Found extra effect dependencies\n+\n+Extra dependencies can cause an effect to fire more often than it should, resulting in performance problems such as excessive renders and side effects.\n+\n+error.invalid-exhaustive-effect-deps-extra-only.ts:18:9\n+  16 |   useEffect(() => {\n+  17 |     log(x, z);\n+> 18 |   }, [x, y]);\n+     |          ^ Unnecessary dependency `y`\n+  19 |\n+  20 |   // error: extra dep - x.y\n+  21 |   useEffect(() => {\n+\n+Inferred dependencies: `[x, z]`\n+\n+Error: Found extra effect dependencies\n+\n+Extra dependencies can cause an effect to fire more often than it should, resulting in performance problems such as excessive renders and side effects.\n+\n+error.invalid-exhaustive-effect-deps-extra-only.ts:23:6\n+  21 |   useEffect(() => {\n+  22 |     log(x);\n+> 23 |   }, [x.y]);\n+     |       ^^^ Overly precise dependency `x.y`, use `x` instead\n+  24 | }\n+  25 |\n+\n+Inferred dependencies: `[x]`\n+```\n+          \n+      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-extra-only.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-extra-only.js\nnew file mode 100644\nindex 0000000..fcdc4c1\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-extra-only.js\n@@ -0,0 +1,24 @@\n+// @validateExhaustiveEffectDependencies:\"extra-only\"\n+import {useEffect} from 'react';\n+\n+function Component({x, y, z}) {\n+  // no error: missing dep not reported in extra-only mode\n+  useEffect(() => {\n+    log(x);\n+  }, []);\n+\n+  // error: extra dep - y\n+  useEffect(() => {\n+    log(x);\n+  }, [x, y]);\n+\n+  // error: extra dep - y (missing dep - z not reported)\n+  useEffect(() => {\n+    log(x, z);\n+  }, [x, y]);\n+\n+  // error: extra dep - x.y\n+  useEffect(() => {\n+    log(x);\n+  }, [x.y]);\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-missing-only.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-missing-only.expect.md\nnew file mode 100644\nindex 0000000..5a104f5\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-missing-only.expect.md\n@@ -0,0 +1,84 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveEffectDependencies:\"missing-only\"\n+import {useEffect} from 'react';\n+\n+function Component({x, y, z}) {\n+  // error: missing dep - x\n+  useEffect(() => {\n+    log(x);\n+  }, []);\n+\n+  // no error: extra dep not reported in missing-only mode\n+  useEffect(() => {\n+    log(x);\n+  }, [x, y]);\n+\n+  // error: missing dep - z (extra dep - y not reported)\n+  useEffect(() => {\n+    log(x, z);\n+  }, [x, y]);\n+\n+  // error: missing dep x\n+  useEffect(() => {\n+    log(x);\n+  }, [x.y]);\n+}\n+\n+```\n+\n+\n+## Error\n+\n+```\n+Found 3 errors:\n+\n+Error: Found missing effect dependencies\n+\n+Missing dependencies can cause an effect to fire less often than it should.\n+\n+error.invalid-exhaustive-effect-deps-missing-only.ts:7:8\n+   5 |   // error: missing dep - x\n+   6 |   useEffect(() => {\n+>  7 |     log(x);\n+     |         ^ Missing dependency `x`\n+   8 |   }, []);\n+   9 |\n+  10 |   // no error: extra dep not reported in missing-only mode\n+\n+Inferred dependencies: `[x]`\n+\n+Error: Found missing effect dependencies\n+\n+Missing dependencies can cause an effect to fire less often than it should.\n+\n+error.invalid-exhaustive-effect-deps-missing-only.ts:17:11\n+  15 |   // error: missing dep - z (extra dep - y not reported)\n+  16 |   useEffect(() => {\n+> 17 |     log(x, z);\n+     |            ^ Missing dependency `z`\n+  18 |   }, [x, y]);\n+  19 |\n+  20 |   // error: missing dep x\n+\n+Inferred dependencies: `[x, z]`\n+\n+Error: Found missing effect dependencies\n+\n+Missing dependencies can cause an effect to fire less often than it should.\n+\n+error.invalid-exhaustive-effect-deps-missing-only.ts:22:8\n+  20 |   // error: missing dep x\n+  21 |   useEffect(() => {\n+> 22 |     log(x);\n+     |         ^ Missing dependency `x`\n+  23 |   }, [x.y]);\n+  24 | }\n+  25 |\n+\n+Inferred dependencies: `[x]`\n+```\n+          \n+      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-missing-only.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-missing-only.js\nnew file mode 100644\nindex 0000000..7b333f9\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps-missing-only.js\n@@ -0,0 +1,24 @@\n+// @validateExhaustiveEffectDependencies:\"missing-only\"\n+import {useEffect} from 'react';\n+\n+function Component({x, y, z}) {\n+  // error: missing dep - x\n+  useEffect(() => {\n+    log(x);\n+  }, []);\n+\n+  // no error: extra dep not reported in missing-only mode\n+  useEffect(() => {\n+    log(x);\n+  }, [x, y]);\n+\n+  // error: missing dep - z (extra dep - y not reported)\n+  useEffect(() => {\n+    log(x, z);\n+  }, [x, y]);\n+\n+  // error: missing dep x\n+  useEffect(() => {\n+    log(x);\n+  }, [x.y]);\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps.expect.md\nindex 78332c7..55dcd92 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps.expect.md\n@@ -2,7 +2,7 @@\n ## Input\n \n ```javascript\n-// @validateExhaustiveEffectDependencies\n+// @validateExhaustiveEffectDependencies:\"all\"\n import {useEffect} from 'react';\n \n function Component({x, y, z}) {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps.js\nindex b508117..e810fd3 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps.js\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-effect-deps.js\n@@ -1,4 +1,4 @@\n-// @validateExhaustiveEffectDependencies\n+// @validateExhaustiveEffectDependencies:\"all\"\n import {useEffect} from 'react';\n \n function Component({x, y, z}) {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.expect.md\nindex 2c449dd..a5b500d 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.expect.md\n@@ -2,7 +2,7 @@\n ## Input\n \n ```javascript\n-// @validateExhaustiveMemoizationDependencies @validateExhaustiveEffectDependencies\n+// @validateExhaustiveMemoizationDependencies @validateExhaustiveEffectDependencies:\"all\"\n import {\n   useCallback,\n   useTransition,\n@@ -69,7 +69,7 @@ export const FIXTURE_ENTRYPOINT = {\n ## Code\n \n ```javascript\n-import { c as _c } from \"react/compiler-runtime\"; // @validateExhaustiveMemoizationDependencies @validateExhaustiveEffectDependencies\n+import { c as _c } from \"react/compiler-runtime\"; // @validateExhaustiveMemoizationDependencies @validateExhaustiveEffectDependencies:\"all\"\n import {\n   useCallback,\n   useTransition,\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.js\nindex 721832e..75ea6ed 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.js\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.js\n@@ -1,4 +1,4 @@\n-// @validateExhaustiveMemoizationDependencies @validateExhaustiveEffectDependencies\n+// @validateExhaustiveMemoizationDependencies @validateExhaustiveEffectDependencies:\"all\"\n import {\n   useCallback,\n   useTransition,\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-effect-events.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-effect-events.expect.md\nindex 3b0e696..a633db2 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-effect-events.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-effect-events.expect.md\n@@ -2,7 +2,7 @@\n ## Input\n \n ```javascript\n-// @validateExhaustiveEffectDependencies\n+// @validateExhaustiveEffectDependencies:\"all\"\n import {useEffect, useEffectEvent} from 'react';\n \n function Component({x, y, z}) {\n@@ -30,7 +30,7 @@ function Component({x, y, z}) {\n ## Code\n \n ```javascript\n-import { c as _c } from \"react/compiler-runtime\"; // @validateExhaustiveEffectDependencies\n+import { c as _c } from \"react/compiler-runtime\"; // @validateExhaustiveEffectDependencies:\"all\"\n import { useEffect, useEffectEvent } from \"react\";\n \n function Component(t0) {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-effect-events.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-effect-events.js\nindex 1c8c710..ef3853b 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-effect-events.js\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-effect-events.js\n@@ -1,4 +1,4 @@\n-// @validateExhaustiveEffectDependencies\n+// @validateExhaustiveEffectDependencies:\"all\"\n import {useEffect, useEffectEvent} from 'react';\n \n function Component({x, y, z}) {\ndiff --git a/fixtures/eslint-v9/index.js b/fixtures/eslint-v9/index.js\nindex 5a43235..601b68a 100644\n--- a/fixtures/eslint-v9/index.js\n+++ b/fixtures/eslint-v9/index.js\n@@ -167,3 +167,16 @@ function InvalidUseMemo({items}) {\n   const sorted = useMemo(() => [...items].sort(), []);\n   return <div>{sorted.length}</div>;\n }\n+\n+// Invalid: missing/extra deps in useEffect\n+function InvalidEffectDeps({a, b}) {\n+  useEffect(() => {\n+    console.log(a);\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, []);\n+\n+  useEffect(() => {\n+    console.log(a);\n+    // TODO: eslint-disable-next-line react-hooks/exhaustive-effect-dependencies\n+  }, [a, b]);\n+}\ndiff --git a/fixtures/eslint-v9/yarn.lock b/fixtures/eslint-v9/yarn.lock\nindex 936b533..964edad 100644\n--- a/fixtures/eslint-v9/yarn.lock\n+++ b/fixtures/eslint-v9/yarn.lock\n@@ -603,6 +603,18 @@ has-flag@^4.0.0:\n   resolved \"https://registry.yarnpkg.com/has-flag/-/has-flag-4.0.0.tgz#944771fd9c81c81265c4d6941860da06bb59479b\"\n   integrity sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==\n \n+hermes-estree@0.25.1:\n+  version \"0.25.1\"\n+  resolved \"https://registry.yarnpkg.com/hermes-estree/-/hermes-estree-0.25.1.tgz#6aeec17d1983b4eabf69721f3aa3eb705b17f480\"\n+  integrity sha512-0wUoCcLp+5Ev5pDW2OriHC2MJCbwLwuRx+gAqMTOkGKJJiBCLjtrvy4PWUGn6MIVefecRpzoOZ/UV6iGdOr+Cw==\n+\n+hermes-parser@^0.25.1:\n+  version \"0.25.1\"\n+  resolved \"https://registry.yarnpkg.com/hermes-parser/-/hermes-parser-0.25.1.tgz#5be0e487b2090886c62bd8a11724cd766d5f54d1\"\n+  integrity sha512-6pEjquH3rqaI6cYAXYPcz9MS4rY6R4ngRgrgfDshRptUZIc3lw0MCIJIGDj9++mfySOuPTHB4nrSW99BCvOPIA==\n+  dependencies:\n+    hermes-estree \"0.25.1\"\n+\n ignore@^5.2.0:\n   version \"5.3.2\"\n   resolved \"https://registry.yarnpkg.com/ignore/-/ignore-5.3.2.tgz#3cd40e729f3643fd87cb04e50bf0eb722bc596f5\"\n@@ -877,12 +889,12 @@ yocto-queue@^0.1.0:\n   resolved \"https://registry.yarnpkg.com/yocto-queue/-/yocto-queue-0.1.0.tgz#0294eb3dee05028d31ee1a5fa2c556a6aaf10a1b\"\n   integrity sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==\n \n-\"zod-validation-error@^3.0.3 || ^4.0.0\":\n+\"zod-validation-error@^3.5.0 || ^4.0.0\":\n   version \"4.0.2\"\n   resolved \"https://registry.yarnpkg.com/zod-validation-error/-/zod-validation-error-4.0.2.tgz#bc605eba49ce0fcd598c127fee1c236be3f22918\"\n   integrity sha512-Q6/nZLe6jxuU80qb/4uJ4t5v2VEZ44lzQjPDhYJNztRQ4wyWc6VF3D3Kb/fAuPetZQnhS3hnajCf9CsWesghLQ==\n \n-\"zod@^3.22.4 || ^4.0.0\":\n-  version \"4.1.11\"\n-  resolved \"https://registry.yarnpkg.com/zod/-/zod-4.1.11.tgz#4aab62f76cfd45e6c6166519ba31b2ea019f75f5\"\n-  integrity sha512-WPsqwxITS2tzx1bzhIKsEs19ABD5vmCVa4xBo2tq/SrV4RNZtfws1EnCWQXM6yh8bD08a1idvkB5MZSBiZsjwg==\n+\"zod@^3.25.0 || ^4.0.0\":\n+  version \"4.2.0\"\n+  resolved \"https://registry.yarnpkg.com/zod/-/zod-4.2.0.tgz#01e86f2c2b6d525a1b9fa6dbe78beccad082118f\"\n+  integrity sha512-Bd5fw9wlIhtqCCxotZgdTOMwGm1a0u75wARVEY9HMs1X17trvA/lMi4+MGK5EUfYkXVTbX8UDiDKW4OgzHVUZw==\ndiff --git a/packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts b/packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts\nindex 1cf08cb..acd50a3 100644\n--- a/packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts\n+++ b/packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts\n@@ -42,6 +42,7 @@ const COMPILER_OPTIONS: PluginOptions = {\n     // Temporarily enabled for internal testing\n     enableUseKeyedState: true,\n     enableVerboseNoSetStateInEffect: true,\n+    validateExhaustiveEffectDependencies: 'extra-only',\n   },\n };\n "}, {"role": "assistant", "content": "feat(compiler): add granular modes for effect dependency validation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_codegen_llvm/src/attributes.rs      | 11 +++++++-\n library/alloc/src/slice.rs                         |  8 +++---\n library/alloc/src/vec/mod.rs                       |  6 ++++-\n .../lib-optimizations/append-elements.rs           | 30 ++++++++++++++++++++++\n 4 files changed, 50 insertions(+), 5 deletions(-)"}, {"role": "assistant", "content": "feat(codegen): add LLVM attributes for slice append optimization"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/compile/internal/amd64/ssa.go             |   8 +-\n src/cmd/compile/internal/ssa/_gen/AMD64.rules     |  24 ++--\n src/cmd/compile/internal/ssa/_gen/AMD64Ops.go     |   9 ++\n src/cmd/compile/internal/ssa/opGen.go             |  84 ++++++++++++\n src/cmd/compile/internal/ssa/rewriteAMD64.go      | 150 ++++------------------\n src/simd/archsimd/_gen/simdgen/gen_simdTypes.go   |  29 ++++-\n src/simd/archsimd/internal/simd_test/simd_test.go |  77 ++++++++++-\n src/simd/archsimd/types_amd64.go                  |  12 +-\n 8 files changed, 242 insertions(+), 151 deletions(-)\n\ndiff --git a/src/cmd/compile/internal/amd64/ssa.go b/src/cmd/compile/internal/amd64/ssa.go\nindex 5ddcb84c..e9a566d7 100644\n--- a/src/cmd/compile/internal/amd64/ssa.go\n+++ b/src/cmd/compile/internal/amd64/ssa.go\n@@ -1845,7 +1845,13 @@ func ssaGenValue(s *ssagen.State, v *ssa.Value) {\n \t\tssa.OpAMD64VPMOVVec32x16ToM,\n \t\tssa.OpAMD64VPMOVVec64x2ToM,\n \t\tssa.OpAMD64VPMOVVec64x4ToM,\n-\t\tssa.OpAMD64VPMOVVec64x8ToM:\n+\t\tssa.OpAMD64VPMOVVec64x8ToM,\n+\t\tssa.OpAMD64VPMOVMSKB128,\n+\t\tssa.OpAMD64VPMOVMSKB256,\n+\t\tssa.OpAMD64VMOVMSKPS128,\n+\t\tssa.OpAMD64VMOVMSKPS256,\n+\t\tssa.OpAMD64VMOVMSKPD128,\n+\t\tssa.OpAMD64VMOVMSKPD256:\n \t\tp := s.Prog(v.Op.Asm())\n \t\tp.From.Type = obj.TYPE_REG\n \t\tp.From.Reg = simdReg(v.Args[0])\ndiff --git a/src/cmd/compile/internal/ssa/_gen/AMD64.rules b/src/cmd/compile/internal/ssa/_gen/AMD64.rules\nindex 9cd23c62..b49e85b5 100644\n--- a/src/cmd/compile/internal/ssa/_gen/AMD64.rules\n+++ b/src/cmd/compile/internal/ssa/_gen/AMD64.rules\n@@ -1679,21 +1679,21 @@\n (Cvt8toMask64x8 <t> x) => (VPMOVMToVec64x8 <types.TypeVec512> (KMOVBk <t> x))\n \n // masks to integers\n-(CvtMask8x16to16 <t> x) => (KMOVWi <t> (VPMOVVec8x16ToM <types.TypeMask> x))\n-(CvtMask8x32to32 <t> x) => (KMOVDi <t> (VPMOVVec8x32ToM <types.TypeMask> x))\n-(CvtMask8x64to64 <t> x) => (KMOVQi <t> (VPMOVVec8x64ToM <types.TypeMask> x))\n+(CvtMask8x16to16 ...) => (VPMOVMSKB128 ...)\n+(CvtMask8x32to32 ...) => (VPMOVMSKB256 ...)\n+(CvtMask8x64to64 x) => (KMOVQi (VPMOVVec8x64ToM <types.TypeMask> x))\n \n-(CvtMask16x8to8 <t> x) => (KMOVBi <t> (VPMOVVec16x8ToM <types.TypeMask> x))\n-(CvtMask16x16to16 <t> x) => (KMOVWi <t> (VPMOVVec16x16ToM <types.TypeMask> x))\n-(CvtMask16x32to32 <t> x) => (KMOVDi <t> (VPMOVVec16x32ToM <types.TypeMask> x))\n+(CvtMask16x8to8 x) => (KMOVBi (VPMOVVec16x8ToM <types.TypeMask> x))\n+(CvtMask16x16to16 x) => (KMOVWi (VPMOVVec16x16ToM <types.TypeMask> x))\n+(CvtMask16x32to32 x) => (KMOVDi (VPMOVVec16x32ToM <types.TypeMask> x))\n \n-(CvtMask32x4to8 <t> x) => (KMOVBi <t> (VPMOVVec32x4ToM <types.TypeMask> x))\n-(CvtMask32x8to8 <t> x) => (KMOVBi <t> (VPMOVVec32x8ToM <types.TypeMask> x))\n-(CvtMask32x16to16 <t> x) => (KMOVWi <t> (VPMOVVec32x16ToM <types.TypeMask> x))\n+(CvtMask32x4to8 ...) => (VMOVMSKPS128 ...)\n+(CvtMask32x8to8 ...) => (VMOVMSKPS256 ...)\n+(CvtMask32x16to16 x) => (KMOVWi (VPMOVVec32x16ToM <types.TypeMask> x))\n \n-(CvtMask64x2to8 <t> x) => (KMOVBi <t> (VPMOVVec64x2ToM <types.TypeMask> x))\n-(CvtMask64x4to8 <t> x) => (KMOVBi <t> (VPMOVVec64x4ToM <types.TypeMask> x))\n-(CvtMask64x8to8 <t> x) => (KMOVBi <t> (VPMOVVec64x8ToM <types.TypeMask> x))\n+(CvtMask64x2to8 ...) => (VMOVMSKPD128 ...)\n+(CvtMask64x4to8 ...) => (VMOVMSKPD256 ...)\n+(CvtMask64x8to8 x) => (KMOVBi (VPMOVVec64x8ToM <types.TypeMask> x))\n \n // optimizations\n (MOVBstore [off] {sym} ptr (KMOVBi mask) mem) => (KMOVBstore [off] {sym} ptr mask mem)\ndiff --git a/src/cmd/compile/internal/ssa/_gen/AMD64Ops.go b/src/cmd/compile/internal/ssa/_gen/AMD64Ops.go\nindex 2fb4fdfc..b13eb5aa 100644\n--- a/src/cmd/compile/internal/ssa/_gen/AMD64Ops.go\n+++ b/src/cmd/compile/internal/ssa/_gen/AMD64Ops.go\n@@ -1368,6 +1368,7 @@ func init() {\n \t\t{name: \"VPMASK64load512\", argLength: 3, reg: vloadk, asm: \"VMOVDQU64\", aux: \"SymOff\", faultOnNilArg0: true, symEffect: \"Read\"},    // load from arg0+auxint+aux, arg1=k mask, arg2 = mem\n \t\t{name: \"VPMASK64store512\", argLength: 4, reg: vstorek, asm: \"VMOVDQU64\", aux: \"SymOff\", faultOnNilArg0: true, symEffect: \"Write\"}, // store, *(arg0+auxint+aux) = arg2, arg1=k mask, arg3 = mem\n \n+\t\t// AVX512 moves between int-vector and mask registers\n \t\t{name: \"VPMOVMToVec8x16\", argLength: 1, reg: kv, asm: \"VPMOVM2B\"},\n \t\t{name: \"VPMOVMToVec8x32\", argLength: 1, reg: kv, asm: \"VPMOVM2B\"},\n \t\t{name: \"VPMOVMToVec8x64\", argLength: 1, reg: kw, asm: \"VPMOVM2B\"},\n@@ -1400,6 +1401,14 @@ func init() {\n \t\t{name: \"VPMOVVec64x4ToM\", argLength: 1, reg: vk, asm: \"VPMOVQ2M\"},\n \t\t{name: \"VPMOVVec64x8ToM\", argLength: 1, reg: wk, asm: \"VPMOVQ2M\"},\n \n+\t\t// AVX1/2 moves from int-vector to bitmask (extracting sign bits)\n+\t\t{name: \"VPMOVMSKB128\", argLength: 1, reg: vgp, asm: \"VPMOVMSKB\"},\n+\t\t{name: \"VPMOVMSKB256\", argLength: 1, reg: vgp, asm: \"VPMOVMSKB\"},\n+\t\t{name: \"VMOVMSKPS128\", argLength: 1, reg: vgp, asm: \"VMOVMSKPS\"},\n+\t\t{name: \"VMOVMSKPS256\", argLength: 1, reg: vgp, asm: \"VMOVMSKPS\"},\n+\t\t{name: \"VMOVMSKPD128\", argLength: 1, reg: vgp, asm: \"VMOVMSKPD\"},\n+\t\t{name: \"VMOVMSKPD256\", argLength: 1, reg: vgp, asm: \"VMOVMSKPD\"},\n+\n \t\t// X15 is the zero register up to 128-bit. For larger values, we zero it on the fly.\n \t\t{name: \"Zero128\", argLength: 0, reg: x15only, zeroWidth: true, fixedReg: true},\n \t\t{name: \"Zero256\", argLength: 0, reg: v01, asm: \"VPXOR\"},\ndiff --git a/src/cmd/compile/internal/ssa/opGen.go b/src/cmd/compile/internal/ssa/opGen.go\nindex abaf7911..7b70dc26 100644\n--- a/src/cmd/compile/internal/ssa/opGen.go\n+++ b/src/cmd/compile/internal/ssa/opGen.go\n@@ -1214,6 +1214,12 @@ const (\n \tOpAMD64VPMOVVec64x2ToM\n \tOpAMD64VPMOVVec64x4ToM\n \tOpAMD64VPMOVVec64x8ToM\n+\tOpAMD64VPMOVMSKB128\n+\tOpAMD64VPMOVMSKB256\n+\tOpAMD64VMOVMSKPS128\n+\tOpAMD64VMOVMSKPS256\n+\tOpAMD64VMOVMSKPD128\n+\tOpAMD64VMOVMSKPD256\n \tOpAMD64Zero128\n \tOpAMD64Zero256\n \tOpAMD64Zero512\n@@ -20351,6 +20357,84 @@ var opcodeTable = [...]opInfo{\n \t\t\t},\n \t\t},\n \t},\n+\t{\n+\t\tname:   \"VPMOVMSKB128\",\n+\t\targLen: 1,\n+\t\tasm:    x86.AVPMOVMSKB,\n+\t\treg: regInfo{\n+\t\t\tinputs: []inputInfo{\n+\t\t\t\t{0, 2147418112}, // X0 X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 X12 X13 X14\n+\t\t\t},\n+\t\t\toutputs: []outputInfo{\n+\t\t\t\t{0, 49135}, // AX CX DX BX BP SI DI R8 R9 R10 R11 R12 R13 R15\n+\t\t\t},\n+\t\t},\n+\t},\n+\t{\n+\t\tname:   \"VPMOVMSKB256\",\n+\t\targLen: 1,\n+\t\tasm:    x86.AVPMOVMSKB,\n+\t\treg: regInfo{\n+\t\t\tinputs: []inputInfo{\n+\t\t\t\t{0, 2147418112}, // X0 X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 X12 X13 X14\n+\t\t\t},\n+\t\t\toutputs: []outputInfo{\n+\t\t\t\t{0, 49135}, // AX CX DX BX BP SI DI R8 R9 R10 R11 R12 R13 R15\n+\t\t\t},\n+\t\t},\n+\t},\n+\t{\n+\t\tname:   \"VMOVMSKPS128\",\n+\t\targLen: 1,\n+\t\tasm:    x86.AVMOVMSKPS,\n+\t\treg: regInfo{\n+\t\t\tinputs: []inputInfo{\n+\t\t\t\t{0, 2147418112}, // X0 X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 X12 X13 X14\n+\t\t\t},\n+\t\t\toutputs: []outputInfo{\n+\t\t\t\t{0, 49135}, // AX CX DX BX BP SI DI R8 R9 R10 R11 R12 R13 R15\n+\t\t\t},\n+\t\t},\n+\t},\n+\t{\n+\t\tname:   \"VMOVMSKPS256\",\n+\t\targLen: 1,\n+\t\tasm:    x86.AVMOVMSKPS,\n+\t\treg: regInfo{\n+\t\t\tinputs: []inputInfo{\n+\t\t\t\t{0, 2147418112}, // X0 X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 X12 X13 X14\n+\t\t\t},\n+\t\t\toutputs: []outputInfo{\n+\t\t\t\t{0, 49135}, // AX CX DX BX BP SI DI R8 R9 R10 R11 R12 R13 R15\n+\t\t\t},\n+\t\t},\n+\t},\n+\t{\n+\t\tname:   \"VMOVMSKPD128\",\n+\t\targLen: 1,\n+\t\tasm:    x86.AVMOVMSKPD,\n+\t\treg: regInfo{\n+\t\t\tinputs: []inputInfo{\n+\t\t\t\t{0, 2147418112}, // X0 X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 X12 X13 X14\n+\t\t\t},\n+\t\t\toutputs: []outputInfo{\n+\t\t\t\t{0, 49135}, // AX CX DX BX BP SI DI R8 R9 R10 R11 R12 R13 R15\n+\t\t\t},\n+\t\t},\n+\t},\n+\t{\n+\t\tname:   \"VMOVMSKPD256\",\n+\t\targLen: 1,\n+\t\tasm:    x86.AVMOVMSKPD,\n+\t\treg: regInfo{\n+\t\t\tinputs: []inputInfo{\n+\t\t\t\t{0, 2147418112}, // X0 X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 X12 X13 X14\n+\t\t\t},\n+\t\t\toutputs: []outputInfo{\n+\t\t\t\t{0, 49135}, // AX CX DX BX BP SI DI R8 R9 R10 R11 R12 R13 R15\n+\t\t\t},\n+\t\t},\n+\t},\n \t{\n \t\tname:      \"Zero128\",\n \t\targLen:    0,\ndiff --git a/src/cmd/compile/internal/ssa/rewriteAMD64.go b/src/cmd/compile/internal/ssa/rewriteAMD64.go\nindex 3eb2a627..e84bf19c 100644\n--- a/src/cmd/compile/internal/ssa/rewriteAMD64.go\n+++ b/src/cmd/compile/internal/ssa/rewriteAMD64.go\n@@ -3050,19 +3050,25 @@ func rewriteValueAMD64(v *Value) bool {\n \tcase OpCvtMask32x16to16:\n \t\treturn rewriteValueAMD64_OpCvtMask32x16to16(v)\n \tcase OpCvtMask32x4to8:\n-\t\treturn rewriteValueAMD64_OpCvtMask32x4to8(v)\n+\t\tv.Op = OpAMD64VMOVMSKPS128\n+\t\treturn true\n \tcase OpCvtMask32x8to8:\n-\t\treturn rewriteValueAMD64_OpCvtMask32x8to8(v)\n+\t\tv.Op = OpAMD64VMOVMSKPS256\n+\t\treturn true\n \tcase OpCvtMask64x2to8:\n-\t\treturn rewriteValueAMD64_OpCvtMask64x2to8(v)\n+\t\tv.Op = OpAMD64VMOVMSKPD128\n+\t\treturn true\n \tcase OpCvtMask64x4to8:\n-\t\treturn rewriteValueAMD64_OpCvtMask64x4to8(v)\n+\t\tv.Op = OpAMD64VMOVMSKPD256\n+\t\treturn true\n \tcase OpCvtMask64x8to8:\n \t\treturn rewriteValueAMD64_OpCvtMask64x8to8(v)\n \tcase OpCvtMask8x16to16:\n-\t\treturn rewriteValueAMD64_OpCvtMask8x16to16(v)\n+\t\tv.Op = OpAMD64VPMOVMSKB128\n+\t\treturn true\n \tcase OpCvtMask8x32to32:\n-\t\treturn rewriteValueAMD64_OpCvtMask8x32to32(v)\n+\t\tv.Op = OpAMD64VPMOVMSKB256\n+\t\treturn true\n \tcase OpCvtMask8x64to64:\n \t\treturn rewriteValueAMD64_OpCvtMask8x64to64(v)\n \tcase OpDiv128u:\n@@ -68722,13 +68728,11 @@ func rewriteValueAMD64_OpCvt8toMask64x8(v *Value) bool {\n func rewriteValueAMD64_OpCvtMask16x16to16(v *Value) bool {\n \tv_0 := v.Args[0]\n \tb := v.Block\n-\t// match: (CvtMask16x16to16 <t> x)\n-\t// result: (KMOVWi <t> (VPMOVVec16x16ToM <types.TypeMask> x))\n+\t// match: (CvtMask16x16to16 x)\n+\t// result: (KMOVWi (VPMOVVec16x16ToM <types.TypeMask> x))\n \tfor {\n-\t\tt := v.Type\n \t\tx := v_0\n \t\tv.reset(OpAMD64KMOVWi)\n-\t\tv.Type = t\n \t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec16x16ToM, types.TypeMask)\n \t\tv0.AddArg(x)\n \t\tv.AddArg(v0)\n@@ -68738,13 +68742,11 @@ func rewriteValueAMD64_OpCvtMask16x16to16(v *Value) bool {\n func rewriteValueAMD64_OpCvtMask16x32to32(v *Value) bool {\n \tv_0 := v.Args[0]\n \tb := v.Block\n-\t// match: (CvtMask16x32to32 <t> x)\n-\t// result: (KMOVDi <t> (VPMOVVec16x32ToM <types.TypeMask> x))\n+\t// match: (CvtMask16x32to32 x)\n+\t// result: (KMOVDi (VPMOVVec16x32ToM <types.TypeMask> x))\n \tfor {\n-\t\tt := v.Type\n \t\tx := v_0\n \t\tv.reset(OpAMD64KMOVDi)\n-\t\tv.Type = t\n \t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec16x32ToM, types.TypeMask)\n \t\tv0.AddArg(x)\n \t\tv.AddArg(v0)\n@@ -68754,13 +68756,11 @@ func rewriteValueAMD64_OpCvtMask16x32to32(v *Value) bool {\n func rewriteValueAMD64_OpCvtMask16x8to8(v *Value) bool {\n \tv_0 := v.Args[0]\n \tb := v.Block\n-\t// match: (CvtMask16x8to8 <t> x)\n-\t// result: (KMOVBi <t> (VPMOVVec16x8ToM <types.TypeMask> x))\n+\t// match: (CvtMask16x8to8 x)\n+\t// result: (KMOVBi (VPMOVVec16x8ToM <types.TypeMask> x))\n \tfor {\n-\t\tt := v.Type\n \t\tx := v_0\n \t\tv.reset(OpAMD64KMOVBi)\n-\t\tv.Type = t\n \t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec16x8ToM, types.TypeMask)\n \t\tv0.AddArg(x)\n \t\tv.AddArg(v0)\n@@ -68770,141 +68770,39 @@ func rewriteValueAMD64_OpCvtMask16x8to8(v *Value) bool {\n func rewriteValueAMD64_OpCvtMask32x16to16(v *Value) bool {\n \tv_0 := v.Args[0]\n \tb := v.Block\n-\t// match: (CvtMask32x16to16 <t> x)\n-\t// result: (KMOVWi <t> (VPMOVVec32x16ToM <types.TypeMask> x))\n+\t// match: (CvtMask32x16to16 x)\n+\t// result: (KMOVWi (VPMOVVec32x16ToM <types.TypeMask> x))\n \tfor {\n-\t\tt := v.Type\n \t\tx := v_0\n \t\tv.reset(OpAMD64KMOVWi)\n-\t\tv.Type = t\n \t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec32x16ToM, types.TypeMask)\n \t\tv0.AddArg(x)\n \t\tv.AddArg(v0)\n \t\treturn true\n \t}\n }\n-func rewriteValueAMD64_OpCvtMask32x4to8(v *Value) bool {\n-\tv_0 := v.Args[0]\n-\tb := v.Block\n-\t// match: (CvtMask32x4to8 <t> x)\n-\t// result: (KMOVBi <t> (VPMOVVec32x4ToM <types.TypeMask> x))\n-\tfor {\n-\t\tt := v.Type\n-\t\tx := v_0\n-\t\tv.reset(OpAMD64KMOVBi)\n-\t\tv.Type = t\n-\t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec32x4ToM, types.TypeMask)\n-\t\tv0.AddArg(x)\n-\t\tv.AddArg(v0)\n-\t\treturn true\n-\t}\n-}\n-func rewriteValueAMD64_OpCvtMask32x8to8(v *Value) bool {\n-\tv_0 := v.Args[0]\n-\tb := v.Block\n-\t// match: (CvtMask32x8to8 <t> x)\n-\t// result: (KMOVBi <t> (VPMOVVec32x8ToM <types.TypeMask> x))\n-\tfor {\n-\t\tt := v.Type\n-\t\tx := v_0\n-\t\tv.reset(OpAMD64KMOVBi)\n-\t\tv.Type = t\n-\t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec32x8ToM, types.TypeMask)\n-\t\tv0.AddArg(x)\n-\t\tv.AddArg(v0)\n-\t\treturn true\n-\t}\n-}\n-func rewriteValueAMD64_OpCvtMask64x2to8(v *Value) bool {\n-\tv_0 := v.Args[0]\n-\tb := v.Block\n-\t// match: (CvtMask64x2to8 <t> x)\n-\t// result: (KMOVBi <t> (VPMOVVec64x2ToM <types.TypeMask> x))\n-\tfor {\n-\t\tt := v.Type\n-\t\tx := v_0\n-\t\tv.reset(OpAMD64KMOVBi)\n-\t\tv.Type = t\n-\t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec64x2ToM, types.TypeMask)\n-\t\tv0.AddArg(x)\n-\t\tv.AddArg(v0)\n-\t\treturn true\n-\t}\n-}\n-func rewriteValueAMD64_OpCvtMask64x4to8(v *Value) bool {\n-\tv_0 := v.Args[0]\n-\tb := v.Block\n-\t// match: (CvtMask64x4to8 <t> x)\n-\t// result: (KMOVBi <t> (VPMOVVec64x4ToM <types.TypeMask> x))\n-\tfor {\n-\t\tt := v.Type\n-\t\tx := v_0\n-\t\tv.reset(OpAMD64KMOVBi)\n-\t\tv.Type = t\n-\t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec64x4ToM, types.TypeMask)\n-\t\tv0.AddArg(x)\n-\t\tv.AddArg(v0)\n-\t\treturn true\n-\t}\n-}\n func rewriteValueAMD64_OpCvtMask64x8to8(v *Value) bool {\n \tv_0 := v.Args[0]\n \tb := v.Block\n-\t// match: (CvtMask64x8to8 <t> x)\n-\t// result: (KMOVBi <t> (VPMOVVec64x8ToM <types.TypeMask> x))\n+\t// match: (CvtMask64x8to8 x)\n+\t// result: (KMOVBi (VPMOVVec64x8ToM <types.TypeMask> x))\n \tfor {\n-\t\tt := v.Type\n \t\tx := v_0\n \t\tv.reset(OpAMD64KMOVBi)\n-\t\tv.Type = t\n \t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec64x8ToM, types.TypeMask)\n \t\tv0.AddArg(x)\n \t\tv.AddArg(v0)\n \t\treturn true\n \t}\n }\n-func rewriteValueAMD64_OpCvtMask8x16to16(v *Value) bool {\n-\tv_0 := v.Args[0]\n-\tb := v.Block\n-\t// match: (CvtMask8x16to16 <t> x)\n-\t// result: (KMOVWi <t> (VPMOVVec8x16ToM <types.TypeMask> x))\n-\tfor {\n-\t\tt := v.Type\n-\t\tx := v_0\n-\t\tv.reset(OpAMD64KMOVWi)\n-\t\tv.Type = t\n-\t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec8x16ToM, types.TypeMask)\n-\t\tv0.AddArg(x)\n-\t\tv.AddArg(v0)\n-\t\treturn true\n-\t}\n-}\n-func rewriteValueAMD64_OpCvtMask8x32to32(v *Value) bool {\n-\tv_0 := v.Args[0]\n-\tb := v.Block\n-\t// match: (CvtMask8x32to32 <t> x)\n-\t// result: (KMOVDi <t> (VPMOVVec8x32ToM <types.TypeMask> x))\n-\tfor {\n-\t\tt := v.Type\n-\t\tx := v_0\n-\t\tv.reset(OpAMD64KMOVDi)\n-\t\tv.Type = t\n-\t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec8x32ToM, types.TypeMask)\n-\t\tv0.AddArg(x)\n-\t\tv.AddArg(v0)\n-\t\treturn true\n-\t}\n-}\n func rewriteValueAMD64_OpCvtMask8x64to64(v *Value) bool {\n \tv_0 := v.Args[0]\n \tb := v.Block\n-\t// match: (CvtMask8x64to64 <t> x)\n-\t// result: (KMOVQi <t> (VPMOVVec8x64ToM <types.TypeMask> x))\n+\t// match: (CvtMask8x64to64 x)\n+\t// result: (KMOVQi (VPMOVVec8x64ToM <types.TypeMask> x))\n \tfor {\n-\t\tt := v.Type\n \t\tx := v_0\n \t\tv.reset(OpAMD64KMOVQi)\n-\t\tv.Type = t\n \t\tv0 := b.NewValue0(v.Pos, OpAMD64VPMOVVec8x64ToM, types.TypeMask)\n \t\tv0.AddArg(x)\n \t\tv.AddArg(v0)\ndiff --git a/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go b/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\nindex d8c44812..dd3a75eb 100644\n--- a/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\n+++ b/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\n@@ -93,6 +93,33 @@ func (x simdType) MaskedStoreDoc() string {\n \t}\n }\n \n+func (x simdType) ToBitsDoc() string {\n+\tif x.Size == 512 || x.ElemBits() == 16 {\n+\t\treturn fmt.Sprintf(\"// Asm: KMOV%s, CPU Features: AVX512\", x.IntelSizeSuffix())\n+\t}\n+\t// 128/256 bit vectors with 8, 32, 64 bit elements\n+\tvar asm string\n+\tvar feat string\n+\tswitch x.ElemBits() {\n+\tcase 8:\n+\t\tasm = \"VPMOVMSKB\"\n+\t\tif x.Size == 256 {\n+\t\t\tfeat = \"AVX2\"\n+\t\t} else {\n+\t\t\tfeat = \"AVX\"\n+\t\t}\n+\tcase 32:\n+\t\tasm = \"VMOVMSKPS\"\n+\t\tfeat = \"AVX\"\n+\tcase 64:\n+\t\tasm = \"VMOVMSKPD\"\n+\t\tfeat = \"AVX\"\n+\tdefault:\n+\t\tpanic(\"unexpected ElemBits\")\n+\t}\n+\treturn fmt.Sprintf(\"// Asm: %s, CPU Features: %s\", asm, feat)\n+}\n+\n func compareSimdTypes(x, y simdType) int {\n \t// \"vreg\" then \"mask\"\n \tif c := -compareNatural(x.Type, y.Type); c != 0 {\n@@ -210,7 +237,7 @@ func {{.Name}}FromBits(y uint{{.LanesContainer}}) {{.Name}}\n // Only the lower {{.Lanes}} bits of y are used.\n {{- end}}\n //\n-// Asm: KMOV{{.IntelSizeSuffix}}, CPU Features: AVX512\n+{{.ToBitsDoc}}\n func (x {{.Name}}) ToBits() uint{{.LanesContainer}}\n `\n \ndiff --git a/src/simd/archsimd/internal/simd_test/simd_test.go b/src/simd/archsimd/internal/simd_test/simd_test.go\nindex 671ec05e..36bde924 100644\n--- a/src/simd/archsimd/internal/simd_test/simd_test.go\n+++ b/src/simd/archsimd/internal/simd_test/simd_test.go\n@@ -379,12 +379,79 @@ func TestBitMaskFromBitsLoad(t *testing.T) {\n }\n \n func TestBitMaskToBits(t *testing.T) {\n-\tif !archsimd.X86.AVX512() {\n-\t\tt.Skip(\"Test requires X86.AVX512, not available on this hardware\")\n-\t\treturn\n+\tint8s := []int8{\n+\t\t0, 1, 1, 0, 0, 1, 0, 1,\n+\t\t1, 0, 1, 1, 0, 0, 1, 0,\n+\t\t1, 0, 0, 1, 1, 0, 1, 0,\n+\t\t0, 1, 1, 0, 0, 1, 0, 1,\n+\t\t1, 0, 0, 1, 0, 1, 1, 0,\n+\t\t0, 1, 0, 1, 1, 0, 0, 1,\n+\t\t1, 0, 1, 0, 0, 1, 1, 0,\n+\t\t0, 1, 1, 0, 1, 0, 0, 1,\n+\t}\n+\tint16s := make([]int16, 32)\n+\tfor i := range int16s {\n+\t\tint16s[i] = int16(int8s[i])\n+\t}\n+\tint32s := make([]int32, 16)\n+\tfor i := range int32s {\n+\t\tint32s[i] = int32(int8s[i])\n+\t}\n+\tint64s := make([]int64, 8)\n+\tfor i := range int64s {\n+\t\tint64s[i] = int64(int8s[i])\n+\t}\n+\twant64 := uint64(0)\n+\tfor i := range int8s {\n+\t\twant64 |= uint64(int8s[i]) << i\n+\t}\n+\twant32 := uint32(want64)\n+\twant16 := uint16(want64)\n+\twant8 := uint8(want64)\n+\twant4 := want8 & 0b1111\n+\twant2 := want4 & 0b11\n+\n+\tif v := archsimd.LoadInt8x16Slice(int8s[:16]).ToMask().ToBits(); v != want16 {\n+\t\tt.Errorf(\"want %b, got %b\", want16, v)\n+\t}\n+\tif v := archsimd.LoadInt32x4Slice(int32s[:4]).ToMask().ToBits(); v != want4 {\n+\t\tt.Errorf(\"want %b, got %b\", want4, v)\n+\t}\n+\tif v := archsimd.LoadInt32x8Slice(int32s[:8]).ToMask().ToBits(); v != want8 {\n+\t\tt.Errorf(\"want %b, got %b\", want8, v)\n+\t}\n+\tif v := archsimd.LoadInt64x2Slice(int64s[:2]).ToMask().ToBits(); v != want2 {\n+\t\tt.Errorf(\"want %b, got %b\", want2, v)\n+\t}\n+\tif v := archsimd.LoadInt64x4Slice(int64s[:4]).ToMask().ToBits(); v != want4 {\n+\t\tt.Errorf(\"want %b, got %b\", want4, v)\n \t}\n-\tif v := archsimd.LoadInt16x8Slice([]int16{1, 0, 1, 0, 0, 0, 0, 0}).ToMask().ToBits(); v != 0b101 {\n-\t\tt.Errorf(\"Want 0b101, got %b\", v)\n+\n+\tif archsimd.X86.AVX2() {\n+\t\tif v := archsimd.LoadInt8x32Slice(int8s[:32]).ToMask().ToBits(); v != want32 {\n+\t\t\tt.Errorf(\"want %b, got %b\", want32, v)\n+\t\t}\n+\t}\n+\n+\tif archsimd.X86.AVX512() {\n+\t\tif v := archsimd.LoadInt8x64Slice(int8s).ToMask().ToBits(); v != want64 {\n+\t\t\tt.Errorf(\"want %b, got %b\", want64, v)\n+\t\t}\n+\t\tif v := archsimd.LoadInt16x8Slice(int16s[:8]).ToMask().ToBits(); v != want8 {\n+\t\t\tt.Errorf(\"want %b, got %b\", want8, v)\n+\t\t}\n+\t\tif v := archsimd.LoadInt16x16Slice(int16s[:16]).ToMask().ToBits(); v != want16 {\n+\t\t\tt.Errorf(\"want %b, got %b\", want16, v)\n+\t\t}\n+\t\tif v := archsimd.LoadInt16x32Slice(int16s).ToMask().ToBits(); v != want32 {\n+\t\t\tt.Errorf(\"want %b, got %b\", want32, v)\n+\t\t}\n+\t\tif v := archsimd.LoadInt32x16Slice(int32s).ToMask().ToBits(); v != want16 {\n+\t\t\tt.Errorf(\"want %b, got %b\", want16, v)\n+\t\t}\n+\t\tif v := archsimd.LoadInt64x8Slice(int64s).ToMask().ToBits(); v != want8 {\n+\t\t\tt.Errorf(\"want %b, got %b\", want8, v)\n+\t\t}\n \t}\n }\n \ndiff --git a/src/simd/archsimd/types_amd64.go b/src/simd/archsimd/types_amd64.go\nindex f39549c7..3d0a49dc 100644\n--- a/src/simd/archsimd/types_amd64.go\n+++ b/src/simd/archsimd/types_amd64.go\n@@ -308,7 +308,7 @@ func Mask8x16FromBits(y uint16) Mask8x16\n \n // ToBits constructs a bitmap from a Mask8x16, where 1 means set for the indexed element, 0 means unset.\n //\n-// Asm: KMOVB, CPU Features: AVX512\n+// Asm: VPMOVMSKB, CPU Features: AVX\n func (x Mask8x16) ToBits() uint16\n \n // Mask16x8 is a mask for a SIMD vector of 8 16-bit elements.\n@@ -342,7 +342,7 @@ func Mask32x4FromBits(y uint8) Mask32x4\n // ToBits constructs a bitmap from a Mask32x4, where 1 means set for the indexed element, 0 means unset.\n // Only the lower 4 bits of y are used.\n //\n-// Asm: KMOVD, CPU Features: AVX512\n+// Asm: VMOVMSKPS, CPU Features: AVX\n func (x Mask32x4) ToBits() uint8\n \n // Mask64x2 is a mask for a SIMD vector of 2 64-bit elements.\n@@ -360,7 +360,7 @@ func Mask64x2FromBits(y uint8) Mask64x2\n // ToBits constructs a bitmap from a Mask64x2, where 1 means set for the indexed element, 0 means unset.\n // Only the lower 2 bits of y are used.\n //\n-// Asm: KMOVQ, CPU Features: AVX512\n+// Asm: VMOVMSKPD, CPU Features: AVX\n func (x Mask64x2) ToBits() uint8\n \n // v256 is a tag type that tells the compiler that this is really 256-bit SIMD\n@@ -667,7 +667,7 @@ func Mask8x32FromBits(y uint32) Mask8x32\n \n // ToBits constructs a bitmap from a Mask8x32, where 1 means set for the indexed element, 0 means unset.\n //\n-// Asm: KMOVB, CPU Features: AVX512\n+// Asm: VPMOVMSKB, CPU Features: AVX2\n func (x Mask8x32) ToBits() uint32\n \n // Mask16x16 is a mask for a SIMD vector of 16 16-bit elements.\n@@ -699,7 +699,7 @@ func Mask32x8FromBits(y uint8) Mask32x8\n \n // ToBits constructs a bitmap from a Mask32x8, where 1 means set for the indexed element, 0 means unset.\n //\n-// Asm: KMOVD, CPU Features: AVX512\n+// Asm: VMOVMSKPS, CPU Features: AVX\n func (x Mask32x8) ToBits() uint8\n \n // Mask64x4 is a mask for a SIMD vector of 4 64-bit elements.\n@@ -717,7 +717,7 @@ func Mask64x4FromBits(y uint8) Mask64x4\n // ToBits constructs a bitmap from a Mask64x4, where 1 means set for the indexed element, 0 means unset.\n // Only the lower 4 bits of y are used.\n //\n-// Asm: KMOVQ, CPU Features: AVX512\n+// Asm: VMOVMSKPD, CPU Features: AVX\n func (x Mask64x4) ToBits() uint8\n \n // v512 is a tag type that tells the compiler that this is really 512-bit SIMD"}, {"role": "assistant", "content": "feat(simd): add AVX1/2 movmsk instructions for mask-to-int conversion"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/client/ReactFiberConfigDOM.js              | 39 ++++++++++------------\n 1 file changed, 17 insertions(+), 22 deletions(-)\n\ndiff --git a/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js b/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js\nindex e4c45cc..66e4696 100644\n--- a/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js\n+++ b/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js\n@@ -1996,26 +1996,6 @@ export function hasInstanceAffectedParent(\n   return oldRect.height !== newRect.height || oldRect.width !== newRect.width;\n }\n \n-function cancelAllViewTransitionAnimations(scope: Element) {\n-  // In Safari, we need to manually cancel all manually start animations\n-  // or it'll block or interfer with future transitions.\n-  // $FlowFixMe[prop-missing]\n-  const animations = scope.getAnimations({subtree: true});\n-  for (let i = 0; i < animations.length; i++) {\n-    const anim = animations[i];\n-    const effect: KeyframeEffect = (anim.effect: any);\n-    // $FlowFixMe\n-    const pseudo: ?string = effect.pseudoElement;\n-    if (\n-      pseudo != null &&\n-      pseudo.startsWith('::view-transition') &&\n-      effect.target === scope\n-    ) {\n-      anim.cancel();\n-    }\n-  }\n-}\n-\n // How long to wait for new fonts to load before just committing anyway.\n // This freezes the screen. It needs to be short enough that it doesn't cause too much of\n // an issue when it's a new load and slow, yet long enough that you have a chance to load\n@@ -2210,6 +2190,8 @@ export function startViewTransition(\n     // $FlowFixMe[prop-missing]\n     ownerDocument.__reactViewTransition = transition;\n \n+    const viewTransitionAnimations: Array<Animation> = [];\n+\n     const readyCallback = () => {\n       const documentElement: Element = (ownerDocument.documentElement: any);\n       // Loop through all View Transition Animations.\n@@ -2224,6 +2206,7 @@ export function startViewTransition(\n           pseudoElement != null &&\n           pseudoElement.startsWith('::view-transition')\n         ) {\n+          viewTransitionAnimations.push(animation);\n           const keyframes = effect.getKeyframes();\n           // Next, we're going to try to optimize this animation in case the auto-generated\n           // width/height keyframes are unnecessary.\n@@ -2315,7 +2298,12 @@ export function startViewTransition(\n     };\n     transition.ready.then(readyCallback, handleError);\n     transition.finished.finally(() => {\n-      cancelAllViewTransitionAnimations((ownerDocument.documentElement: any));\n+      for (let i = 0; i < viewTransitionAnimations.length; i++) {\n+        // In Safari, we need to manually cancel all manually started animations\n+        // or it'll block or interfer with future transitions.\n+        // We can't use getAnimations() due to #35336 so we collect them in an array.\n+        viewTransitionAnimations[i].cancel();\n+      }\n       // $FlowFixMe[prop-missing]\n       if (ownerDocument.__reactViewTransition === transition) {\n         // $FlowFixMe[prop-missing]\n@@ -2549,6 +2537,7 @@ export function startGestureTransition(\n     // $FlowFixMe[prop-missing]\n     ownerDocument.__reactViewTransition = transition;\n     const customTimelineCleanup: Array<() => void> = []; // Cleanup Animations started in a CustomTimeline\n+    const viewTransitionAnimations: Array<Animation> = [];\n     const readyCallback = () => {\n       const documentElement: Element = (ownerDocument.documentElement: any);\n       // Loop through all View Transition Animations.\n@@ -2566,6 +2555,7 @@ export function startGestureTransition(\n         const pseudoElement: ?string = effect.pseudoElement;\n         if (pseudoElement == null) {\n         } else if (pseudoElement.startsWith('::view-transition')) {\n+          viewTransitionAnimations.push(animations[i]);\n           const timing = effect.getTiming();\n           const duration =\n             // $FlowFixMe[prop-missing]\n@@ -2743,7 +2733,12 @@ export function startGestureTransition(\n     };\n     transition.ready.then(readyForAnimations, handleError);\n     transition.finished.finally(() => {\n-      cancelAllViewTransitionAnimations((ownerDocument.documentElement: any));\n+      for (let i = 0; i < viewTransitionAnimations.length; i++) {\n+        // In Safari, we need to manually cancel all manually started animations\n+        // or it'll block or interfer with future transitions.\n+        // We can't use getAnimations() due to #35336 so we collect them in an array.\n+        viewTransitionAnimations[i].cancel();\n+      }\n       for (let i = 0; i < customTimelineCleanup.length; i++) {\n         const cleanup = customTimelineCleanup[i];\n         cleanup();"}, {"role": "assistant", "content": "refactor: collect view transition animations in array instead of"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/librustdoc/passes/collect_intra_doc_links.rs  | 624 +++++++++++-----------\n tests/rustdoc-html/intra-doc/adt-through-alias.rs |  71 +++\n tests/rustdoc-html/intra-doc/associated-items.rs  |   9 +-\n 3 files changed, 400 insertions(+), 304 deletions(-)"}, {"role": "assistant", "content": "refactor(rustdoc): improve intra-doc link collection"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../content/guide/forms/signals/field-state-management.md   | 10 +++++-----\n adev/src/content/guide/forms/signals/validation.md          | 13 +++++++++++++\n packages/forms/signals/src/api/structure.ts                 |  7 ++++---\n 3 files changed, 22 insertions(+), 8 deletions(-)\n\ndiff --git a/adev/src/content/guide/forms/signals/field-state-management.md b/adev/src/content/guide/forms/signals/field-state-management.md\nindex 093c6039..bfc9ddb6 100644\n--- a/adev/src/content/guide/forms/signals/field-state-management.md\n+++ b/adev/src/content/guide/forms/signals/field-state-management.md\n@@ -109,11 +109,11 @@ When checking validity in code, use `invalid()` instead of `!valid()` if you wan\n \n Access the array of validation errors with `errors()`. Each error object contains:\n \n-| Property  | Description                                                     |\n-| --------- | --------------------------------------------------------------- |\n-| `kind`    | The validation rule that failed (such as \"required\" or \"email\") |\n-| `message` | Optional human-readable error message                           |\n-| `field`   | Reference to the `FieldTree` where the error occurred           |\n+| Property    | Description                                                     |\n+| ----------- | --------------------------------------------------------------- |\n+| `kind`      | The validation rule that failed (such as \"required\" or \"email\") |\n+| `message`   | Optional human-readable error message                           |\n+| `fieldTree` | Reference to the `FieldTree` where the error occurred           |\n \n NOTE: The `message` property is optional. Validators can provide custom error messages, but if not specified, you may need to map error `kind` values to your own messages.\n \ndiff --git a/adev/src/content/guide/forms/signals/validation.md b/adev/src/content/guide/forms/signals/validation.md\nindex b1e0aa26..991a02a0 100644\n--- a/adev/src/content/guide/forms/signals/validation.md\n+++ b/adev/src/content/guide/forms/signals/validation.md\n@@ -461,6 +461,19 @@ export class UrlFormComponent {\n }\n ```\n \n+For submission errors that target specific fields, use the `fieldTree` property:\n+\n+```ts\n+// In a submit function\n+return [\n+  {\n+    fieldTree: registrationForm.username, // Target specific field\n+    kind: 'server',\n+    message: 'Username already taken',\n+  },\n+];\n+```\n+\n The validator function receives a `FieldContext` object with:\n \n | Property        | Type       | Description                                 |\ndiff --git a/packages/forms/signals/src/api/structure.ts b/packages/forms/signals/src/api/structure.ts\nindex 917e7081..8cf03ff9 100644\n--- a/packages/forms/signals/src/api/structure.ts\n+++ b/packages/forms/signals/src/api/structure.ts\n@@ -332,7 +332,7 @@ export function applyWhenValue(\n /**\n  * Submits a given `FieldTree` using the given action function and applies any submission errors\n  * resulting from the action to the field. Submission errors returned by the `action` will be integrated\n- * into the field as a `ValidationError` on the sub-field indicated by the `field` property of the\n+ * into the field as a `ValidationError` on the sub-field indicated by the `fieldTree` property of the\n  * submission error.\n  *\n  * @example\n@@ -341,8 +341,9 @@ export function applyWhenValue(\n  *   const result = await myClient.registerNewUser(registrationForm().value());\n  *   if (result.errorCode === myClient.ErrorCode.USERNAME_TAKEN) {\n  *     return [{\n- *       field: registrationForm.username,\n- *       error: {kind: 'server', message: 'Username already taken'}\n+ *       fieldTree: registrationForm.username,\n+ *       kind: 'server',\n+ *       message: 'Username already taken'\n  *     }];\n  *   }\n  *   return undefined;"}, {"role": "assistant", "content": "docs(forms): Clarify returning errors from submit functions"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/bootstrap/Cargo.toml      | 2 +-\n src/build_helper/Cargo.toml   | 7 +++++--\n src/build_helper/src/lib.rs   | 1 +\n src/ci/citool/Cargo.toml      | 2 +-\n src/tools/opt-dist/Cargo.toml | 2 +-\n 5 files changed, 9 insertions(+), 5 deletions(-)"}, {"role": "assistant", "content": "build: update cargo dependencies"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n lib/fips140/fips140.sum                     |   2 +-\n lib/fips140/{v1.1.0-rc1.zip => v1.26.0.zip} | Bin 678896 -> 676132 bytes\n 2 files changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/lib/fips140/fips140.sum b/lib/fips140/fips140.sum\nindex c4d185da..050957af 100644\n--- a/lib/fips140/fips140.sum\n+++ b/lib/fips140/fips140.sum\n@@ -10,4 +10,4 @@\n #\tgo test cmd/go/internal/fips140 -update\n #\n v1.0.0-c2097c7c.zip daf3614e0406f67ae6323c902db3f953a1effb199142362a039e7526dfb9368b\n-v1.1.0-rc1.zip ea94f8c3885294c9efe1bd8f9b6e86daeb25b6aff2aeb20707cd9a5101f6f54e\n+v1.26.0.zip 9b28f847fdf1db4a36cb2b2f8ec09443c039383f085630a03ecfaddf6db7ea23\ndiff --git a/lib/fips140/v1.1.0-rc1.zip b/lib/fips140/v1.26.0.zip\nsimilarity index 83%\nrename from lib/fips140/v1.1.0-rc1.zip\nrename to lib/fips140/v1.26.0.zip\nindex d4264bdb..f53ade80 100644\nBinary files a/lib/fips140/v1.1.0-rc1.zip and b/lib/fips140/v1.26.0.zip differ"}, {"role": "assistant", "content": "build(deps): update fips140 to v1.26.0"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/content/guide/animations/migration.md | 8 ++++----\n 1 file changed, 4 insertions(+), 4 deletions(-)\n\ndiff --git a/adev/src/content/guide/animations/migration.md b/adev/src/content/guide/animations/migration.md\nindex 7872a9b5..69d0b479 100644\n--- a/adev/src/content/guide/animations/migration.md\n+++ b/adev/src/content/guide/animations/migration.md\n@@ -126,20 +126,20 @@ The animations package offered the previously mentioned pattern matching for ent\n     <docs-code header=\"insert-remove.component.css\" path=\"adev/src/content/examples/animations/src/app/animations-package/insert-remove.component.css\" />\n </docs-code-multifile>\n \n-Here's how the same thing can be accomplished without the animations package using `animate.enter`.\n-\n #### With Native CSS\n \n+Here's how the same thing can be accomplished without the animations package using `animate.enter`.\n+\n <docs-code-multifile preview path=\"adev/src/content/examples/animations/src/app/native-css/insert.component.ts\">\n     <docs-code header=\"insert.component.ts\" path=\"adev/src/content/examples/animations/src/app/native-css/insert.component.ts\" />\n     <docs-code header=\"insert.component.html\" path=\"adev/src/content/examples/animations/src/app/native-css/insert.component.html\" />\n     <docs-code header=\"insert.component.css\" path=\"adev/src/content/examples/animations/src/app/native-css/insert.component.css\"  />\n </docs-code-multifile>\n \n-Use `animate.leave` to animate elements as they leave the view, which will apply the specified CSS classes to the element as it leaves the view.\n-\n #### With Native CSS\n \n+Use `animate.leave` to animate elements as they leave the view, which will apply the specified CSS classes to the element as it leaves the view.\n+\n <docs-code-multifile preview path=\"adev/src/content/examples/animations/src/app/native-css/remove.component.ts\">\n     <docs-code header=\"remove.component.ts\" path=\"adev/src/content/examples/animations/src/app/native-css/remove.component.ts\" />\n     <docs-code header=\"remove.component.html\" path=\"adev/src/content/examples/animations/src/app/native-css/remove.component.html\" />"}, {"role": "assistant", "content": "docs: improve separation between enter and leave example"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 19efeec..52166f4 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -22,6 +22,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udc77 Tweak CI input names. PR [#14688](https://github.com/fastapi/fastapi/pull/14688) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd28 Refactor translation script to allow committing in place. PR [#14687](https://github.com/fastapi/fastapi/pull/14687) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc1b Fix translation script path. PR [#14685](https://github.com/fastapi/fastapi/pull/14685) by [@tiangolo](https://github.com/tiangolo).\n * \u2705 Enable tests in CI for scripts. PR [#14684](https://github.com/fastapi/fastapi/pull/14684) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/content/guide/signals/overview.md | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/adev/src/content/guide/signals/overview.md b/adev/src/content/guide/signals/overview.md\nindex cffc0924..7180209b 100644\n--- a/adev/src/content/guide/signals/overview.md\n+++ b/adev/src/content/guide/signals/overview.md\n@@ -188,7 +188,7 @@ effect(() => {\n \n ## Advanced derivations\n \n-While `computed` handles simple readonly derivations, you might find youself needing a writable state that is dependant on other signals.\n+While `computed` handles simple readonly derivations, you might find yourself needing a writable state that is dependant on other signals.\n For more information see the [Dependent state with linkedSignal](/guide/signals/linked-signal) guide.\n \n All signal APIs are synchronous\u2014 `signal`, `computed`, `input`, etc. However, applications often need to deal with data that is available asynchronously. A `Resource` gives you a way to incorporate async data into your application's signal-based code and still allow you to access its data synchronously. For more information see the [Async reactivity with resources](/guide/signals/resource) guide."}, {"role": "assistant", "content": "docs: fix spelling mistake in documentation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 1380d7f..9c4fe05 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -9,6 +9,7 @@ hide:\n \n ### Translations\n \n+* \ud83d\udd27 Add LLM prompt file for Turkish, generated from the existing translations. PR [#14547](https://github.com/fastapi/fastapi/pull/14547) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd27 Add LLM prompt file for Traditional Chinese, generated from the existing translations. PR [#14550](https://github.com/fastapi/fastapi/pull/14550) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd27 Add LLM prompt file for Simplified Chinese, generated from the existing translations. PR [#14549](https://github.com/fastapi/fastapi/pull/14549) by [@tiangolo](https://github.com/tiangolo).\n "}, {"role": "assistant", "content": "docs: add turkish llm prompt file to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/react-client/src/ReactFlightClient.js     | 271 +++++++++++----------\n .../react-client/src/ReactFlightReplyClient.js     |  30 ++-\n .../src/ReactFlightESMReferences.js                |   8 +\n .../src/ReactFlightParcelReferences.js             |   8 +\n .../src/ReactFlightTurbopackReferences.js          |   8 +\n .../src/ReactFlightUnbundledReferences.js          |   8 +\n .../src/ReactFlightWebpackReferences.js            |   8 +\n .../src/__tests__/ReactFlightDOM-test.js           |  19 +-\n .../src/__tests__/ReactFlightDOMEdge-test.js       |  32 ++-\n .../src/__tests__/ReactFlightDOMNode-test.js       |  50 ++--\n .../src/__tests__/ReactFlightDOMReplyEdge-test.js  |  49 +++-\n .../react-server/src/ReactFlightReplyServer.js     | 182 +++++++-------\n packages/react-server/src/ReactFlightServer.js     |   2 +-\n scripts/error-codes/codes.json                     |   6 +-\n 14 files changed, 441 insertions(+), 240 deletions(-)\n\ndiff --git a/packages/react-client/src/ReactFlightClient.js b/packages/react-client/src/ReactFlightClient.js\nindex 49da30c..0db63ec 100644\n--- a/packages/react-client/src/ReactFlightClient.js\n+++ b/packages/react-client/src/ReactFlightClient.js\n@@ -894,6 +894,7 @@ function resolveModuleChunk<T>(\n   const resolvedChunk: ResolvedModuleChunk<T> = (chunk: any);\n   resolvedChunk.status = RESOLVED_MODULE;\n   resolvedChunk.value = value;\n+  resolvedChunk.reason = null;\n   if (__DEV__) {\n     const debugInfo = getModuleDebugInfo(value);\n     if (debugInfo !== null) {\n@@ -1114,6 +1115,8 @@ export function reportGlobalError(\n     // because we won't be getting any new data to resolve it.\n     if (chunk.status === PENDING) {\n       triggerErrorOnChunk(response, chunk, error);\n+    } else if (chunk.status === INITIALIZED && chunk.reason !== null) {\n+      chunk.reason.error(error);\n     }\n   });\n   if (__DEV__) {\n@@ -1462,15 +1465,95 @@ function fulfillReference(\n ): void {\n   const {handler, parentObject, key, map, path} = reference;\n \n-  for (let i = 1; i < path.length; i++) {\n+  try {\n+    for (let i = 1; i < path.length; i++) {\n+      while (\n+        typeof value === 'object' &&\n+        value !== null &&\n+        value.$$typeof === REACT_LAZY_TYPE\n+      ) {\n+        // We never expect to see a Lazy node on this path because we encode those as\n+        // separate models. This must mean that we have inserted an extra lazy node\n+        // e.g. to replace a blocked element. We must instead look for it inside.\n+        const referencedChunk: SomeChunk<any> = value._payload;\n+        if (referencedChunk === handler.chunk) {\n+          // This is a reference to the thing we're currently blocking. We can peak\n+          // inside of it to get the value.\n+          value = handler.value;\n+          continue;\n+        } else {\n+          switch (referencedChunk.status) {\n+            case RESOLVED_MODEL:\n+              initializeModelChunk(referencedChunk);\n+              break;\n+            case RESOLVED_MODULE:\n+              initializeModuleChunk(referencedChunk);\n+              break;\n+          }\n+          switch (referencedChunk.status) {\n+            case INITIALIZED: {\n+              value = referencedChunk.value;\n+              continue;\n+            }\n+            case BLOCKED: {\n+              // It is possible that we're blocked on our own chunk if it's a cycle.\n+              // Before adding the listener to the inner chunk, let's check if it would\n+              // result in a cycle.\n+              const cyclicHandler = resolveBlockedCycle(\n+                referencedChunk,\n+                reference,\n+              );\n+              if (cyclicHandler !== null) {\n+                // This reference points back to this chunk. We can resolve the cycle by\n+                // using the value from that handler.\n+                value = cyclicHandler.value;\n+                continue;\n+              }\n+              // Fallthrough\n+            }\n+            case PENDING: {\n+              // If we're not yet initialized we need to skip what we've already drilled\n+              // through and then wait for the next value to become available.\n+              path.splice(0, i - 1);\n+              // Add \"listener\" to our new chunk dependency.\n+              if (referencedChunk.value === null) {\n+                referencedChunk.value = [reference];\n+              } else {\n+                referencedChunk.value.push(reference);\n+              }\n+              if (referencedChunk.reason === null) {\n+                referencedChunk.reason = [reference];\n+              } else {\n+                referencedChunk.reason.push(reference);\n+              }\n+              return;\n+            }\n+            case HALTED: {\n+              // Do nothing. We couldn't fulfill.\n+              // TODO: Mark downstreams as halted too.\n+              return;\n+            }\n+            default: {\n+              rejectReference(\n+                response,\n+                reference.handler,\n+                referencedChunk.reason,\n+              );\n+              return;\n+            }\n+          }\n+        }\n+      }\n+      value = value[path[i]];\n+    }\n+\n     while (\n       typeof value === 'object' &&\n       value !== null &&\n       value.$$typeof === REACT_LAZY_TYPE\n     ) {\n-      // We never expect to see a Lazy node on this path because we encode those as\n-      // separate models. This must mean that we have inserted an extra lazy node\n-      // e.g. to replace a blocked element. We must instead look for it inside.\n+      // If what we're referencing is a Lazy it must be because we inserted one as a virtual node\n+      // while it was blocked by other data. If it's no longer blocked, we can unwrap it.\n       const referencedChunk: SomeChunk<any> = value._payload;\n       if (referencedChunk === handler.chunk) {\n         // This is a reference to the thing we're currently blocking. We can peak\n@@ -1491,132 +1574,57 @@ function fulfillReference(\n             value = referencedChunk.value;\n             continue;\n           }\n-          case BLOCKED: {\n-            // It is possible that we're blocked on our own chunk if it's a cycle.\n-            // Before adding the listener to the inner chunk, let's check if it would\n-            // result in a cycle.\n-            const cyclicHandler = resolveBlockedCycle(\n-              referencedChunk,\n-              reference,\n-            );\n-            if (cyclicHandler !== null) {\n-              // This reference points back to this chunk. We can resolve the cycle by\n-              // using the value from that handler.\n-              value = cyclicHandler.value;\n-              continue;\n-            }\n-            // Fallthrough\n-          }\n-          case PENDING: {\n-            // If we're not yet initialized we need to skip what we've already drilled\n-            // through and then wait for the next value to become available.\n-            path.splice(0, i - 1);\n-            // Add \"listener\" to our new chunk dependency.\n-            if (referencedChunk.value === null) {\n-              referencedChunk.value = [reference];\n-            } else {\n-              referencedChunk.value.push(reference);\n-            }\n-            if (referencedChunk.reason === null) {\n-              referencedChunk.reason = [reference];\n-            } else {\n-              referencedChunk.reason.push(reference);\n-            }\n-            return;\n-          }\n-          case HALTED: {\n-            // Do nothing. We couldn't fulfill.\n-            // TODO: Mark downstreams as halted too.\n-            return;\n-          }\n-          default: {\n-            rejectReference(\n-              response,\n-              reference.handler,\n-              referencedChunk.reason,\n-            );\n-            return;\n-          }\n         }\n       }\n+      break;\n     }\n-    value = value[path[i]];\n-  }\n \n-  while (\n-    typeof value === 'object' &&\n-    value !== null &&\n-    value.$$typeof === REACT_LAZY_TYPE\n-  ) {\n-    // If what we're referencing is a Lazy it must be because we inserted one as a virtual node\n-    // while it was blocked by other data. If it's no longer blocked, we can unwrap it.\n-    const referencedChunk: SomeChunk<any> = value._payload;\n-    if (referencedChunk === handler.chunk) {\n-      // This is a reference to the thing we're currently blocking. We can peak\n-      // inside of it to get the value.\n-      value = handler.value;\n-      continue;\n-    } else {\n-      switch (referencedChunk.status) {\n-        case RESOLVED_MODEL:\n-          initializeModelChunk(referencedChunk);\n+    const mappedValue = map(response, value, parentObject, key);\n+    parentObject[key] = mappedValue;\n+\n+    // If this is the root object for a model reference, where `handler.value`\n+    // is a stale `null`, the resolved value can be used directly.\n+    if (key === '' && handler.value === null) {\n+      handler.value = mappedValue;\n+    }\n+\n+    // If the parent object is an unparsed React element tuple, we also need to\n+    // update the props and owner of the parsed element object (i.e.\n+    // handler.value).\n+    if (\n+      parentObject[0] === REACT_ELEMENT_TYPE &&\n+      typeof handler.value === 'object' &&\n+      handler.value !== null &&\n+      handler.value.$$typeof === REACT_ELEMENT_TYPE\n+    ) {\n+      const element: any = handler.value;\n+      switch (key) {\n+        case '3':\n+          transferReferencedDebugInfo(handler.chunk, fulfilledChunk);\n+          element.props = mappedValue;\n+          break;\n+        case '4':\n+          // This path doesn't call transferReferencedDebugInfo because this reference is to a debug chunk.\n+          if (__DEV__) {\n+            element._owner = mappedValue;\n+          }\n           break;\n-        case RESOLVED_MODULE:\n-          initializeModuleChunk(referencedChunk);\n+        case '5':\n+          // This path doesn't call transferReferencedDebugInfo because this reference is to a debug chunk.\n+          if (__DEV__) {\n+            element._debugStack = mappedValue;\n+          }\n+          break;\n+        default:\n+          transferReferencedDebugInfo(handler.chunk, fulfilledChunk);\n           break;\n       }\n-      switch (referencedChunk.status) {\n-        case INITIALIZED: {\n-          value = referencedChunk.value;\n-          continue;\n-        }\n-      }\n-    }\n-    break;\n-  }\n-\n-  const mappedValue = map(response, value, parentObject, key);\n-  parentObject[key] = mappedValue;\n-\n-  // If this is the root object for a model reference, where `handler.value`\n-  // is a stale `null`, the resolved value can be used directly.\n-  if (key === '' && handler.value === null) {\n-    handler.value = mappedValue;\n-  }\n-\n-  // If the parent object is an unparsed React element tuple, we also need to\n-  // update the props and owner of the parsed element object (i.e.\n-  // handler.value).\n-  if (\n-    parentObject[0] === REACT_ELEMENT_TYPE &&\n-    typeof handler.value === 'object' &&\n-    handler.value !== null &&\n-    handler.value.$$typeof === REACT_ELEMENT_TYPE\n-  ) {\n-    const element: any = handler.value;\n-    switch (key) {\n-      case '3':\n-        transferReferencedDebugInfo(handler.chunk, fulfilledChunk);\n-        element.props = mappedValue;\n-        break;\n-      case '4':\n-        // This path doesn't call transferReferencedDebugInfo because this reference is to a debug chunk.\n-        if (__DEV__) {\n-          element._owner = mappedValue;\n-        }\n-        break;\n-      case '5':\n-        // This path doesn't call transferReferencedDebugInfo because this reference is to a debug chunk.\n-        if (__DEV__) {\n-          element._debugStack = mappedValue;\n-        }\n-        break;\n-      default:\n-        transferReferencedDebugInfo(handler.chunk, fulfilledChunk);\n-        break;\n+    } else if (__DEV__ && !reference.isDebug) {\n+      transferReferencedDebugInfo(handler.chunk, fulfilledChunk);\n     }\n-  } else if (__DEV__ && !reference.isDebug) {\n-    transferReferencedDebugInfo(handler.chunk, fulfilledChunk);\n+  } catch (error) {\n+    rejectReference(response, reference.handler, error);\n+    return;\n   }\n \n   handler.deps--;\n@@ -1882,6 +1890,7 @@ function loadServerReference<A: Iterable<any>, T>(\n       const initializedChunk: InitializedChunk<T> = (chunk: any);\n       initializedChunk.status = INITIALIZED;\n       initializedChunk.value = handler.value;\n+      initializedChunk.reason = null;\n       if (resolveListeners !== null) {\n         wakeChunk(response, resolveListeners, handler.value, initializedChunk);\n       } else {\n@@ -2359,7 +2368,7 @@ function parseModelString(\n         // Symbol\n         return Symbol.for(value.slice(2));\n       }\n-      case 'F': {\n+      case 'h': {\n         // Server Reference\n         const ref = value.slice(2);\n         return getOutlinedModel(\n@@ -3138,6 +3147,7 @@ function startReadableStream<T>(\n   streamState: StreamState,\n ): void {\n   let controller: ReadableStreamController = (null: any);\n+  let closed = false;\n   const stream = new ReadableStream({\n     type: type,\n     start(c) {\n@@ -3195,6 +3205,10 @@ function startReadableStream<T>(\n       }\n     },\n     close(json: UninitializedModel): void {\n+      if (closed) {\n+        return;\n+      }\n+      closed = true;\n       if (previousBlockedChunk === null) {\n         controller.close();\n       } else {\n@@ -3205,6 +3219,10 @@ function startReadableStream<T>(\n       }\n     },\n     error(error: mixed): void {\n+      if (closed) {\n+        return;\n+      }\n+      closed = true;\n       if (previousBlockedChunk === null) {\n         // $FlowFixMe[incompatible-call]\n         controller.error(error);\n@@ -3265,6 +3283,7 @@ function startAsyncIterable<T>(\n           (chunk: any);\n         initializedChunk.status = INITIALIZED;\n         initializedChunk.value = {done: false, value: value};\n+        initializedChunk.reason = null;\n         if (resolveListeners !== null) {\n           wakeChunkIfInitialized(\n             response,\n@@ -3294,6 +3313,9 @@ function startAsyncIterable<T>(\n       nextWriteIndex++;\n     },\n     close(value: UninitializedModel): void {\n+      if (closed) {\n+        return;\n+      }\n       closed = true;\n       if (nextWriteIndex === buffer.length) {\n         buffer[nextWriteIndex] = createResolvedIteratorResultChunk(\n@@ -3321,6 +3343,9 @@ function startAsyncIterable<T>(\n       }\n     },\n     error(error: Error): void {\n+      if (closed) {\n+        return;\n+      }\n       closed = true;\n       if (nextWriteIndex === buffer.length) {\n         buffer[nextWriteIndex] =\ndiff --git a/packages/react-client/src/ReactFlightReplyClient.js b/packages/react-client/src/ReactFlightReplyClient.js\nindex f75f54f..4dc13ce 100644\n--- a/packages/react-client/src/ReactFlightReplyClient.js\n+++ b/packages/react-client/src/ReactFlightReplyClient.js\n@@ -104,7 +104,7 @@ function serializePromiseID(id: number): string {\n }\n \n function serializeServerReferenceID(id: number): string {\n-  return '$F' + id.toString(16);\n+  return '$h' + id.toString(16);\n }\n \n function serializeTemporaryReferenceMarker(): string {\n@@ -112,7 +112,6 @@ function serializeTemporaryReferenceMarker(): string {\n }\n \n function serializeFormDataReference(id: number): string {\n-  // Why K? F is \"Function\". D is \"Date\". What else?\n   return '$K' + id.toString(16);\n }\n \n@@ -474,8 +473,22 @@ export function processReply(\n         }\n       }\n \n+      const existingReference = writtenObjects.get(value);\n+\n       // $FlowFixMe[method-unbinding]\n       if (typeof value.then === 'function') {\n+        if (existingReference !== undefined) {\n+          if (modelRoot === value) {\n+            // This is the ID we're currently emitting so we need to write it\n+            // once but if we discover it again, we refer to it by id.\n+            modelRoot = null;\n+          } else {\n+            // We've already emitted this as an outlined object, so we can\n+            // just refer to that by its existing ID.\n+            return existingReference;\n+          }\n+        }\n+\n         // We assume that any object with a .then property is a \"Thenable\" type,\n         // or a Promise type. Either of which can be represented by a Promise.\n         if (formData === null) {\n@@ -484,11 +497,19 @@ export function processReply(\n         }\n         pendingParts++;\n         const promiseId = nextPartId++;\n+        const promiseReference = serializePromiseID(promiseId);\n+        writtenObjects.set(value, promiseReference);\n         const thenable: Thenable<any> = (value: any);\n         thenable.then(\n           partValue => {\n             try {\n-              const partJSON = serializeModel(partValue, promiseId);\n+              const previousReference = writtenObjects.get(partValue);\n+              let partJSON;\n+              if (previousReference !== undefined) {\n+                partJSON = JSON.stringify(previousReference);\n+              } else {\n+                partJSON = serializeModel(partValue, promiseId);\n+              }\n               // $FlowFixMe[incompatible-type] We know it's not null because we assigned it above.\n               const data: FormData = formData;\n               data.append(formFieldPrefix + promiseId, partJSON);\n@@ -504,10 +525,9 @@ export function processReply(\n           // that throws on the server instead.\n           reject,\n         );\n-        return serializePromiseID(promiseId);\n+        return promiseReference;\n       }\n \n-      const existingReference = writtenObjects.get(value);\n       if (existingReference !== undefined) {\n         if (modelRoot === value) {\n           // This is the ID we're currently emitting so we need to write it\ndiff --git a/packages/react-server-dom-esm/src/ReactFlightESMReferences.js b/packages/react-server-dom-esm/src/ReactFlightESMReferences.js\nindex 6c2737e..8ad9f22 100644\n--- a/packages/react-server-dom-esm/src/ReactFlightESMReferences.js\n+++ b/packages/react-server-dom-esm/src/ReactFlightESMReferences.js\n@@ -88,6 +88,12 @@ function bind(this: ServerReference<any>): any {\n   return newFn;\n }\n \n+const serverReferenceToString = {\n+  value: () => 'function () { [omitted code] }',\n+  configurable: true,\n+  writable: true,\n+};\n+\n export function registerServerReference<T: Function>(\n   reference: T,\n   id: string,\n@@ -111,12 +117,14 @@ export function registerServerReference<T: Function>(\n             configurable: true,\n           },\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         }\n       : {\n           $$typeof,\n           $$id,\n           $$bound,\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         }) as PropertyDescriptorMap,\n   );\n }\ndiff --git a/packages/react-server-dom-parcel/src/ReactFlightParcelReferences.js b/packages/react-server-dom-parcel/src/ReactFlightParcelReferences.js\nindex 3e7b603..3dd67e7 100644\n--- a/packages/react-server-dom-parcel/src/ReactFlightParcelReferences.js\n+++ b/packages/react-server-dom-parcel/src/ReactFlightParcelReferences.js\n@@ -95,6 +95,12 @@ function bind(this: ServerReference<any>): any {\n   return newFn;\n }\n \n+const serverReferenceToString = {\n+  value: () => 'function () { [omitted code] }',\n+  configurable: true,\n+  writable: true,\n+};\n+\n export function registerServerReference<T>(\n   reference: ServerReference<T>,\n   id: string,\n@@ -118,12 +124,14 @@ export function registerServerReference<T>(\n             configurable: true,\n           },\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         }\n       : {\n           $$typeof,\n           $$id,\n           $$bound,\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         }) as PropertyDescriptorMap,\n   );\n }\ndiff --git a/packages/react-server-dom-turbopack/src/ReactFlightTurbopackReferences.js b/packages/react-server-dom-turbopack/src/ReactFlightTurbopackReferences.js\nindex 1b4525a..082a9c0 100644\n--- a/packages/react-server-dom-turbopack/src/ReactFlightTurbopackReferences.js\n+++ b/packages/react-server-dom-turbopack/src/ReactFlightTurbopackReferences.js\n@@ -102,6 +102,12 @@ function bind(this: ServerReference<any>): any {\n   return newFn;\n }\n \n+const serverReferenceToString = {\n+  value: () => 'function () { [omitted code] }',\n+  configurable: true,\n+  writable: true,\n+};\n+\n export function registerServerReference<T: Function>(\n   reference: T,\n   id: string,\n@@ -125,12 +131,14 @@ export function registerServerReference<T: Function>(\n             configurable: true,\n           },\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         }\n       : {\n           $$typeof,\n           $$id,\n           $$bound,\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         }) as PropertyDescriptorMap,\n   );\n }\ndiff --git a/packages/react-server-dom-unbundled/src/ReactFlightUnbundledReferences.js b/packages/react-server-dom-unbundled/src/ReactFlightUnbundledReferences.js\nindex de43741..07646e1 100644\n--- a/packages/react-server-dom-unbundled/src/ReactFlightUnbundledReferences.js\n+++ b/packages/react-server-dom-unbundled/src/ReactFlightUnbundledReferences.js\n@@ -102,6 +102,12 @@ function bind(this: ServerReference<any>): any {\n   return newFn;\n }\n \n+const serverReferenceToString = {\n+  value: () => 'function () { [omitted code] }',\n+  configurable: true,\n+  writable: true,\n+};\n+\n export function registerServerReference<T: Function>(\n   reference: T,\n   id: string,\n@@ -125,12 +131,14 @@ export function registerServerReference<T: Function>(\n             configurable: true,\n           },\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         } as PropertyDescriptorMap)\n       : ({\n           $$typeof,\n           $$id,\n           $$bound,\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         } as PropertyDescriptorMap),\n   );\n }\ndiff --git a/packages/react-server-dom-webpack/src/ReactFlightWebpackReferences.js b/packages/react-server-dom-webpack/src/ReactFlightWebpackReferences.js\nindex de43741..07646e1 100644\n--- a/packages/react-server-dom-webpack/src/ReactFlightWebpackReferences.js\n+++ b/packages/react-server-dom-webpack/src/ReactFlightWebpackReferences.js\n@@ -102,6 +102,12 @@ function bind(this: ServerReference<any>): any {\n   return newFn;\n }\n \n+const serverReferenceToString = {\n+  value: () => 'function () { [omitted code] }',\n+  configurable: true,\n+  writable: true,\n+};\n+\n export function registerServerReference<T: Function>(\n   reference: T,\n   id: string,\n@@ -125,12 +131,14 @@ export function registerServerReference<T: Function>(\n             configurable: true,\n           },\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         } as PropertyDescriptorMap)\n       : ({\n           $$typeof,\n           $$id,\n           $$bound,\n           bind: {value: bind, configurable: true},\n+          toString: serverReferenceToString,\n         } as PropertyDescriptorMap),\n   );\n }\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOM-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOM-test.js\nindex f1a8e41..6aa3758 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOM-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOM-test.js\n@@ -156,6 +156,23 @@ describe('ReactFlightDOM', () => {\n     };\n   }\n \n+  function createUnclosingStream(\n+    stream: ReadableStream<Uint8Array>,\n+  ): ReadableStream<Uint8Array> {\n+    const reader = stream.getReader();\n+\n+    const s = new ReadableStream({\n+      async pull(controller) {\n+        const {done, value} = await reader.read();\n+        if (!done) {\n+          controller.enqueue(value);\n+        }\n+      },\n+    });\n+\n+    return s;\n+  }\n+\n   const theInfinitePromise = new Promise(() => {});\n   function InfiniteSuspend() {\n     throw theInfinitePromise;\n@@ -2970,7 +2987,7 @@ describe('ReactFlightDOM', () => {\n     const {prelude} = await pendingResult;\n \n     const result = await ReactServerDOMClient.createFromReadableStream(\n-      Readable.toWeb(prelude),\n+      createUnclosingStream(Readable.toWeb(prelude)),\n     );\n \n     const iterator = result.multiShotIterable[Symbol.asyncIterator]();\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMEdge-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMEdge-test.js\nindex 5f7dfa5..a7290f9 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMEdge-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMEdge-test.js\n@@ -228,7 +228,7 @@ describe('ReactFlightDOMEdge', () => {\n \n   async function createBufferedUnclosingStream(\n     stream: ReadableStream<Uint8Array>,\n-  ): ReadableStream<Uint8Array> {\n+  ): Promise<ReadableStream<Uint8Array>> {\n     const chunks: Array<Uint8Array> = [];\n     const reader = stream.getReader();\n     while (true) {\n@@ -2309,4 +2309,34 @@ describe('ReactFlightDOMEdge', () => {\n     const result = await response;\n     expect(result).toEqual({obj: obj, node: 'hi'});\n   });\n+\n+  it('does not leak the server reference code', async () => {\n+    function foo() {\n+      return 'foo';\n+    }\n+\n+    const bar = () => {\n+      return 'bar';\n+    };\n+\n+    const anonymous = (\n+      () => () =>\n+        'anonymous'\n+    )();\n+\n+    expect(\n+      ReactServerDOMServer.registerServerReference(foo, 'foo-id').toString(),\n+    ).toBe('function () { [omitted code] }');\n+\n+    expect(\n+      ReactServerDOMServer.registerServerReference(bar, 'bar-id').toString(),\n+    ).toBe('function () { [omitted code] }');\n+\n+    expect(\n+      ReactServerDOMServer.registerServerReference(\n+        anonymous,\n+        'anonymous-id',\n+      ).toString(),\n+    ).toBe('function () { [omitted code] }');\n+  });\n });\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMNode-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMNode-test.js\nindex 805d204..bca803c 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMNode-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMNode-test.js\n@@ -140,7 +140,7 @@ describe('ReactFlightDOMNode', () => {\n \n   async function createBufferedUnclosingStream(\n     stream: ReadableStream<Uint8Array>,\n-  ): ReadableStream<Uint8Array> {\n+  ): Promise<ReadableStream<Uint8Array>> {\n     const chunks: Array<Uint8Array> = [];\n     const reader = stream.getReader();\n     while (true) {\n@@ -407,7 +407,7 @@ describe('ReactFlightDOMNode', () => {\n     );\n   });\n \n-  it('should cancels the underlying ReadableStream when we are cancelled', async () => {\n+  it('should cancel the underlying and transported ReadableStreams when we are cancelled', async () => {\n     let controller;\n     let cancelReason;\n     const s = new ReadableStream({\n@@ -431,16 +431,30 @@ describe('ReactFlightDOMNode', () => {\n       ),\n     );\n \n-    const writable = new Stream.PassThrough(streamOptions);\n-    rscStream.pipe(writable);\n+    const readable = new Stream.PassThrough(streamOptions);\n+    rscStream.pipe(readable);\n+\n+    const result = await ReactServerDOMClient.createFromNodeStream(readable, {\n+      moduleMap: {},\n+      moduleLoading: webpackModuleLoading,\n+    });\n+    const reader = result.getReader();\n \n     controller.enqueue('hi');\n \n+    await serverAct(async () => {\n+      // We should be able to read the part we already emitted before the abort\n+      expect(await reader.read()).toEqual({\n+        value: 'hi',\n+        done: false,\n+      });\n+    });\n+\n     const reason = new Error('aborted');\n-    writable.destroy(reason);\n+    readable.destroy(reason);\n \n     await new Promise(resolve => {\n-      writable.on('error', () => {\n+      readable.on('error', () => {\n         resolve();\n       });\n     });\n@@ -448,9 +462,17 @@ describe('ReactFlightDOMNode', () => {\n     expect(cancelReason.message).toBe(\n       'The destination stream errored while writing data.',\n     );\n+\n+    let error = null;\n+    try {\n+      await reader.read();\n+    } catch (x) {\n+      error = x;\n+    }\n+    expect(error).toBe(reason);\n   });\n \n-  it('should cancels the underlying ReadableStream when we abort', async () => {\n+  it('should cancel the underlying and transported ReadableStreams when we abort', async () => {\n     const errors = [];\n     let controller;\n     let cancelReason;\n@@ -1342,12 +1364,12 @@ describe('ReactFlightDOMNode', () => {\n           '\\n' +\n             '    in Dynamic' +\n             (gate(flags => flags.enableAsyncDebugInfo)\n-              ? ' (file://ReactFlightDOMNode-test.js:1216:27)\\n'\n+              ? ' (file://ReactFlightDOMNode-test.js:1238:27)\\n'\n               : '\\n') +\n             '    in body\\n' +\n             '    in html\\n' +\n-            '    in App (file://ReactFlightDOMNode-test.js:1229:25)\\n' +\n-            '    in ClientRoot (ReactFlightDOMNode-test.js:1304:16)',\n+            '    in App (file://ReactFlightDOMNode-test.js:1251:25)\\n' +\n+            '    in ClientRoot (ReactFlightDOMNode-test.js:1326:16)',\n         );\n       } else {\n         expect(\n@@ -1356,7 +1378,7 @@ describe('ReactFlightDOMNode', () => {\n           '\\n' +\n             '    in body\\n' +\n             '    in html\\n' +\n-            '    in ClientRoot (ReactFlightDOMNode-test.js:1304:16)',\n+            '    in ClientRoot (ReactFlightDOMNode-test.js:1326:16)',\n         );\n       }\n \n@@ -1366,8 +1388,8 @@ describe('ReactFlightDOMNode', () => {\n             normalizeCodeLocInfo(ownerStack, {preserveLocation: true}),\n           ).toBe(\n             '\\n' +\n-              '    in Dynamic (file://ReactFlightDOMNode-test.js:1216:27)\\n' +\n-              '    in App (file://ReactFlightDOMNode-test.js:1229:25)',\n+              '    in Dynamic (file://ReactFlightDOMNode-test.js:1238:27)\\n' +\n+              '    in App (file://ReactFlightDOMNode-test.js:1251:25)',\n           );\n         } else {\n           expect(\n@@ -1375,7 +1397,7 @@ describe('ReactFlightDOMNode', () => {\n           ).toBe(\n             '' +\n               '\\n' +\n-              '    in App (file://ReactFlightDOMNode-test.js:1229:25)',\n+              '    in App (file://ReactFlightDOMNode-test.js:1251:25)',\n           );\n         }\n       } else {\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMReplyEdge-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMReplyEdge-test.js\nindex b874383..ac5aff0 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMReplyEdge-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMReplyEdge-test.js\n@@ -135,7 +135,7 @@ describe('ReactFlightDOMReplyEdge', () => {\n     expect(await resultBlob.arrayBuffer()).toEqual(await blob.arrayBuffer());\n   });\n \n-  it('should supports ReadableStreams with typed arrays', async () => {\n+  it('should support ReadableStreams with typed arrays', async () => {\n     const buffer = new Uint8Array([\n       123, 4, 10, 5, 100, 255, 244, 45, 56, 67, 43, 124, 67, 89, 100, 20,\n     ]).buffer;\n@@ -239,6 +239,53 @@ describe('ReactFlightDOMReplyEdge', () => {\n     expect(streamedBuffers.flatMap(t => Array.from(t))).toEqual(expectedBytes);\n   });\n \n+  it('should cancel the transported ReadableStream when we are cancelled', async () => {\n+    const s = new ReadableStream({\n+      start(controller) {\n+        controller.enqueue('hi');\n+        controller.close();\n+      },\n+    });\n+\n+    const body = await ReactServerDOMClient.encodeReply(s);\n+\n+    const iterable = {\n+      async *[Symbol.asyncIterator]() {\n+        // eslint-disable-next-line no-for-of-loops/no-for-of-loops\n+        for (const entry of body) {\n+          if (entry[1] === 'C') {\n+            // Return before finishing the stream.\n+            return;\n+          }\n+          yield entry;\n+        }\n+      },\n+    };\n+\n+    const result = await ReactServerDOMServer.decodeReplyFromAsyncIterable(\n+      iterable,\n+      webpackServerMap,\n+    );\n+\n+    const reader = result.getReader();\n+\n+    // We should be able to read the part we already emitted before the abort\n+    expect(await reader.read()).toEqual({\n+      value: 'hi',\n+      done: false,\n+    });\n+\n+    let error = null;\n+    try {\n+      await reader.read();\n+    } catch (x) {\n+      error = x;\n+    }\n+\n+    expect(error).not.toBe(null);\n+    expect(error.message).toBe('Connection closed.');\n+  });\n+\n   it('should abort when parsing an incomplete payload', async () => {\n     const infinitePromise = new Promise(() => {});\n     const controller = new AbortController();\ndiff --git a/packages/react-server/src/ReactFlightReplyServer.js b/packages/react-server/src/ReactFlightReplyServer.js\nindex 742cae6..1831a35 100644\n--- a/packages/react-server/src/ReactFlightReplyServer.js\n+++ b/packages/react-server/src/ReactFlightReplyServer.js\n@@ -33,6 +33,7 @@ import {\n import {ASYNC_ITERATOR} from 'shared/ReactSymbols';\n \n import hasOwnProperty from 'shared/hasOwnProperty';\n+import getPrototypeOf from 'shared/getPrototypeOf';\n \n interface FlightStreamController {\n   enqueueModel(json: string): void;\n@@ -128,6 +129,24 @@ ReactPromise.prototype.then = function <T>(\n   switch (chunk.status) {\n     case INITIALIZED:\n       if (typeof resolve === 'function') {\n+        let inspectedValue = chunk.value;\n+        // Recursively check if the value is itself a ReactPromise and if so if it points\n+        // back to itself. This helps catch recursive thenables early error.\n+        while (inspectedValue instanceof ReactPromise) {\n+          if (inspectedValue === chunk) {\n+            if (typeof reject === 'function') {\n+              reject(new Error('Cannot have cyclic thenables.'));\n+            }\n+            return;\n+          }\n+          if (inspectedValue.status === INITIALIZED) {\n+            inspectedValue = inspectedValue.value;\n+          } else {\n+            // If this is lazily resolved, pending or blocked, it'll eventually become\n+            // initialized and break the loop. Rejected also breaks it.\n+            break;\n+          }\n+        }\n         resolve(chunk.value);\n       }\n       break;\n@@ -156,6 +175,9 @@ ReactPromise.prototype.then = function <T>(\n   }\n };\n \n+const ObjectPrototype = Object.prototype;\n+const ArrayPrototype = Array.prototype;\n+\n export type Response = {\n   _bundlerConfig: ServerManifest,\n   _prefix: string,\n@@ -506,6 +528,7 @@ function loadServerReference<A: Iterable<any>, T>(\n       const initializedChunk: InitializedChunk<T> = (chunk: any);\n       initializedChunk.status = INITIALIZED;\n       initializedChunk.value = handler.value;\n+      initializedChunk.reason = null;\n       if (resolveListeners !== null) {\n         wakeChunk(response, resolveListeners, handler.value);\n       }\n@@ -674,6 +697,7 @@ function initializeModelChunk<T>(chunk: ResolvedModelChunk<T>): void {\n     const initializedChunk: InitializedChunk<T> = (chunk: any);\n     initializedChunk.status = INITIALIZED;\n     initializedChunk.value = value;\n+    initializedChunk.reason = null;\n   } catch (error) {\n     const erroredChunk: ErroredChunk<T> = (chunk: any);\n     erroredChunk.status = ERRORED;\n@@ -694,6 +718,8 @@ export function reportGlobalError(response: Response, error: Error): void {\n     // because we won't be getting any new data to resolve it.\n     if (chunk.status === PENDING) {\n       triggerErrorOnChunk(response, chunk, error);\n+    } else if (chunk.status === INITIALIZED && chunk.reason !== null) {\n+      chunk.reason.error(error);\n     }\n   });\n }\n@@ -728,57 +754,34 @@ function fulfillReference(\n ): void {\n   const {handler, parentObject, key, map, path} = reference;\n \n-  for (let i = 1; i < path.length; i++) {\n-    // The server doesn't have any lazy references but we unwrap Chunks here in the same way as the client.\n-    while (value instanceof ReactPromise) {\n-      const referencedChunk: SomeChunk<any> = value;\n-      switch (referencedChunk.status) {\n-        case RESOLVED_MODEL:\n-          initializeModelChunk(referencedChunk);\n-          break;\n-      }\n-      switch (referencedChunk.status) {\n-        case INITIALIZED: {\n-          value = referencedChunk.value;\n-          continue;\n-        }\n-        case BLOCKED:\n-        case PENDING: {\n-          // If we're not yet initialized we need to skip what we've already drilled\n-          // through and then wait for the next value to become available.\n-          path.splice(0, i - 1);\n-          // Add \"listener\" to our new chunk dependency.\n-          if (referencedChunk.value === null) {\n-            referencedChunk.value = [reference];\n-          } else {\n-            referencedChunk.value.push(reference);\n-          }\n-          if (referencedChunk.reason === null) {\n-            referencedChunk.reason = [reference];\n-          } else {\n-            referencedChunk.reason.push(reference);\n-          }\n-          return;\n-        }\n-        default: {\n-          rejectReference(response, reference.handler, referencedChunk.reason);\n-          return;\n-        }\n+  try {\n+    for (let i = 1; i < path.length; i++) {\n+      // The server doesn't have any lazy references so we don't expect to go through a Promise.\n+      const name = path[i];\n+      if (\n+        typeof value === 'object' &&\n+        value !== null &&\n+        (getPrototypeOf(value) === ObjectPrototype ||\n+          getPrototypeOf(value) === ArrayPrototype) &&\n+        hasOwnProperty.call(value, name)\n+      ) {\n+        value = value[name];\n+      } else {\n+        throw new Error('Invalid reference.');\n       }\n     }\n-    const name = path[i];\n-    if (typeof value === 'object' && hasOwnProperty.call(value, name)) {\n-      value = value[name];\n-    }\n-  }\n \n-  const mappedValue = map(response, value, parentObject, key);\n-  parentObject[key] = mappedValue;\n+    const mappedValue = map(response, value, parentObject, key);\n+    parentObject[key] = mappedValue;\n \n-  // If this is the root object for a model reference, where `handler.value`\n-  // is a stale `null`, the resolved value can be used directly.\n-  if (key === '' && handler.value === null) {\n-    handler.value = mappedValue;\n+    // If this is the root object for a model reference, where `handler.value`\n+    // is a stale `null`, the resolved value can be used directly.\n+    if (key === '' && handler.value === null) {\n+      handler.value = mappedValue;\n+    }\n+  } catch (error) {\n+    rejectReference(response, reference.handler, error);\n+    return;\n   }\n \n   // There are no Elements or Debug Info to transfer here.\n@@ -889,53 +892,17 @@ function getOutlinedModel<T>(\n     case INITIALIZED:\n       let value = chunk.value;\n       for (let i = 1; i < path.length; i++) {\n-        // The server doesn't have any lazy references but we unwrap Chunks here in the same way as the client.\n-        while (value instanceof ReactPromise) {\n-          const referencedChunk: SomeChunk<any> = value;\n-          switch (referencedChunk.status) {\n-            case RESOLVED_MODEL:\n-              initializeModelChunk(referencedChunk);\n-              break;\n-          }\n-          switch (referencedChunk.status) {\n-            case INITIALIZED: {\n-              value = referencedChunk.value;\n-              break;\n-            }\n-            case BLOCKED:\n-            case PENDING: {\n-              return waitForReference(\n-                referencedChunk,\n-                parentObject,\n-                key,\n-                response,\n-                map,\n-                path.slice(i - 1),\n-              );\n-            }\n-            default: {\n-              // This is an error. Instead of erroring directly, we're going to encode this on\n-              // an initialization handler so that we can catch it at the nearest Element.\n-              if (initializingHandler) {\n-                initializingHandler.errored = true;\n-                initializingHandler.value = null;\n-                initializingHandler.reason = referencedChunk.reason;\n-              } else {\n-                initializingHandler = {\n-                  chunk: null,\n-                  value: null,\n-                  reason: referencedChunk.reason,\n-                  deps: 0,\n-                  errored: true,\n-                };\n-              }\n-              return (null: any);\n-            }\n-          }\n-        }\n         const name = path[i];\n-        if (typeof value === 'object' && hasOwnProperty.call(value, name)) {\n+        if (\n+          typeof value === 'object' &&\n+          value !== null &&\n+          (getPrototypeOf(value) === ObjectPrototype ||\n+            getPrototypeOf(value) === ArrayPrototype) &&\n+          hasOwnProperty.call(value, name)\n+        ) {\n           value = value[name];\n+        } else {\n+          throw new Error('Invalid reference.');\n         }\n       }\n       const chunkValue = map(response, value, parentObject, key);\n@@ -1006,6 +973,11 @@ function parseTypedArray<T: $ArrayBufferView | ArrayBuffer>(\n   const id = parseInt(reference.slice(2), 16);\n   const prefix = response._prefix;\n   const key = prefix + id;\n+  const chunks = response._chunks;\n+  if (chunks.has(id)) {\n+    throw new Error('Already initialized typed array.');\n+  }\n+\n   // We should have this backingEntry in the store already because we emitted\n   // it before referencing it. It should be a Blob.\n   // TODO: Use getOutlinedModel to allow us to emit the Blob later. We should be able to do that now.\n@@ -1055,6 +1027,7 @@ function parseTypedArray<T: $ArrayBufferView | ArrayBuffer>(\n       const initializedChunk: InitializedChunk<T> = (chunk: any);\n       initializedChunk.status = INITIALIZED;\n       initializedChunk.value = handler.value;\n+      initializedChunk.reason = null;\n       if (resolveListeners !== null) {\n         wakeChunk(response, resolveListeners, handler.value);\n       }\n@@ -1116,8 +1089,13 @@ function parseReadableStream<T>(\n   parentKey: string,\n ): ReadableStream {\n   const id = parseInt(reference.slice(2), 16);\n+  const chunks = response._chunks;\n+  if (chunks.has(id)) {\n+    throw new Error('Already initialized stream.');\n+  }\n \n   let controller: ReadableStreamController = (null: any);\n+  let closed = false;\n   const stream = new ReadableStream({\n     type: type,\n     start(c) {\n@@ -1166,6 +1144,10 @@ function parseReadableStream<T>(\n       }\n     },\n     close(json: string): void {\n+      if (closed) {\n+        return;\n+      }\n+      closed = true;\n       if (previousBlockedChunk === null) {\n         controller.close();\n       } else {\n@@ -1176,6 +1158,10 @@ function parseReadableStream<T>(\n       }\n     },\n     error(error: mixed): void {\n+      if (closed) {\n+        return;\n+      }\n+      closed = true;\n       if (previousBlockedChunk === null) {\n         // $FlowFixMe[incompatible-call]\n         controller.error(error);\n@@ -1218,6 +1204,10 @@ function parseAsyncIterable<T>(\n   parentKey: string,\n ): $AsyncIterable<T, T, void> | $AsyncIterator<T, T, void> {\n   const id = parseInt(reference.slice(2), 16);\n+  const chunks = response._chunks;\n+  if (chunks.has(id)) {\n+    throw new Error('Already initialized stream.');\n+  }\n \n   const buffer: Array<SomeChunk<IteratorResult<T, T>>> = [];\n   let closed = false;\n@@ -1241,6 +1231,9 @@ function parseAsyncIterable<T>(\n       nextWriteIndex++;\n     },\n     close(value: string): void {\n+      if (closed) {\n+        return;\n+      }\n       closed = true;\n       if (nextWriteIndex === buffer.length) {\n         buffer[nextWriteIndex] = createResolvedIteratorResultChunk(\n@@ -1268,6 +1261,9 @@ function parseAsyncIterable<T>(\n       }\n     },\n     error(error: Error): void {\n+      if (closed) {\n+        return;\n+      }\n       closed = true;\n       if (nextWriteIndex === buffer.length) {\n         buffer[nextWriteIndex] =\n@@ -1329,7 +1325,7 @@ function parseModelString(\n         const chunk = getChunk(response, id);\n         return chunk;\n       }\n-      case 'F': {\n+      case 'h': {\n         // Server Reference\n         const ref = value.slice(2);\n         return getOutlinedModel(response, ref, obj, key, loadServerReference);\ndiff --git a/packages/react-server/src/ReactFlightServer.js b/packages/react-server/src/ReactFlightServer.js\nindex d5b534a..0219136 100644\n--- a/packages/react-server/src/ReactFlightServer.js\n+++ b/packages/react-server/src/ReactFlightServer.js\n@@ -2797,7 +2797,7 @@ function serializePromiseID(id: number): string {\n }\n \n function serializeServerReferenceID(id: number): string {\n-  return '$F' + id.toString(16);\n+  return '$h' + id.toString(16);\n }\n \n function serializeSymbolReference(name: string): string {\ndiff --git a/scripts/error-codes/codes.json b/scripts/error-codes/codes.json\nindex e87d750..d8c8e0b 100644\n--- a/scripts/error-codes/codes.json\n+++ b/scripts/error-codes/codes.json\n@@ -551,5 +551,9 @@\n   \"563\": \"This render completed successfully. All cacheSignals are now aborted to allow clean up of any unused resources.\",\n   \"564\": \"Unknown command. The debugChannel was not wired up properly.\",\n   \"565\": \"resolveDebugMessage/closeDebugChannel should not be called for a Request that wasn't kept alive. This is a bug in React.\",\n-  \"566\": \"FragmentInstance.scrollIntoView() does not support scrollIntoViewOptions. Use the alignToTop boolean instead.\"\n+  \"566\": \"FragmentInstance.scrollIntoView() does not support scrollIntoViewOptions. Use the alignToTop boolean instead.\",\n+  \"567\": \"Already initialized stream.\",\n+  \"568\": \"Already initialized typed array.\",\n+  \"569\": \"Cannot have cyclic thenables.\",\n+  \"570\": \"Invalid reference.\"\n }"}, {"role": "assistant", "content": "refactor(flight): improve stream handling and server reference"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n pnpm-lock.yaml | 74 ++++++++++++----------------------------------------------\n 1 file changed, 15 insertions(+), 59 deletions(-)\n\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 78db215..25d0dba 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -24,9 +24,6 @@ catalogs:\n     source-map-js:\n       specifier: ^1.2.1\n       version: 1.2.1\n-    vite:\n-      specifier: ^5.4.15\n-      version: 5.4.15\n \n importers:\n \n@@ -175,7 +172,7 @@ importers:\n         version: 8.49.0(eslint@9.39.2)(typescript@5.6.3)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n+        version: 5.4.21(@types/node@24.10.4)(sass@1.96.0)\n       vitest:\n         specifier: ^3.2.4\n         version: 3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0)\n@@ -218,10 +215,10 @@ importers:\n     devDependencies:\n       '@vitejs/plugin-vue':\n         specifier: 'catalog:'\n-        version: 6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)\n+        version: 6.0.3(vite@5.4.21(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n+        version: 5.4.21(@types/node@24.10.4)(sass@1.96.0)\n \n   packages-private/template-explorer:\n     dependencies:\n@@ -236,10 +233,10 @@ importers:\n     devDependencies:\n       '@vitejs/plugin-vue':\n         specifier: 'catalog:'\n-        version: 6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)\n+        version: 6.0.3(vite@5.4.21(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n+        version: 5.4.21(@types/node@24.10.4)(sass@1.96.0)\n       vue:\n         specifier: workspace:*\n         version: link:../../packages/vue\n@@ -3458,39 +3455,8 @@ packages:\n     engines: {node: ^18.0.0 || ^20.0.0 || >=22.0.0}\n     hasBin: true\n \n-  vite@5.4.15:\n-    resolution: {integrity: sha512-6ANcZRivqL/4WtwPGTKNaosuNJr5tWiftOC7liM7G9+rMb8+oeJeyzymDu4rTN93seySBmbjSfsS3Vzr19KNtA==}\n-    engines: {node: ^18.0.0 || >=20.0.0}\n-    hasBin: true\n-    peerDependencies:\n-      '@types/node': ^18.0.0 || >=20.0.0\n-      less: '*'\n-      lightningcss: ^1.21.0\n-      sass: '*'\n-      sass-embedded: '*'\n-      stylus: '*'\n-      sugarss: '*'\n-      terser: ^5.4.0\n-    peerDependenciesMeta:\n-      '@types/node':\n-        optional: true\n-      less:\n-        optional: true\n-      lightningcss:\n-        optional: true\n-      sass:\n-        optional: true\n-      sass-embedded:\n-        optional: true\n-      stylus:\n-        optional: true\n-      sugarss:\n-        optional: true\n-      terser:\n-        optional: true\n-\n-  vite@5.4.19:\n-    resolution: {integrity: sha512-qO3aKv3HoQC8QKiNSTuUM1l9o/XX3+c+VTgLHbJWHZGeTPVAg2XwazI9UWzoxjIJCGCV2zU60uqMzjeLZuULqA==}\n+  vite@5.4.21:\n+    resolution: {integrity: sha512-o5a9xKjbtuhY6Bi5S3+HvbRERmouabWbyUcpXXUA1u+GNUKoROi9byOJ8M0nHbHYHkYICiMlqxkg1KkYmm25Sw==}\n     engines: {node: ^18.0.0 || >=20.0.0}\n     hasBin: true\n     peerDependencies:\n@@ -4457,10 +4423,10 @@ snapshots:\n   '@unrs/resolver-binding-win32-x64-msvc@1.11.1':\n     optional: true\n \n-  '@vitejs/plugin-vue@6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)':\n+  '@vitejs/plugin-vue@6.0.3(vite@5.4.21(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)':\n     dependencies:\n       '@rolldown/pluginutils': 1.0.0-beta.53\n-      vite: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n+      vite: 5.4.21(@types/node@24.10.4)(sass@1.96.0)\n       vue: link:packages/vue\n \n   '@vitest/coverage-v8@3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0))':\n@@ -4501,13 +4467,13 @@ snapshots:\n       chai: 5.2.0\n       tinyrainbow: 2.0.0\n \n-  '@vitest/mocker@3.2.4(vite@5.4.19(@types/node@24.10.4)(sass@1.96.0))':\n+  '@vitest/mocker@3.2.4(vite@5.4.21(@types/node@24.10.4)(sass@1.96.0))':\n     dependencies:\n       '@vitest/spy': 3.2.4\n       estree-walker: 3.0.3\n       magic-string: 0.30.21\n     optionalDependencies:\n-      vite: 5.4.19(@types/node@24.10.4)(sass@1.96.0)\n+      vite: 5.4.21(@types/node@24.10.4)(sass@1.96.0)\n \n   '@vitest/pretty-format@3.2.4':\n     dependencies:\n@@ -6565,7 +6531,7 @@ snapshots:\n       debug: 4.4.3\n       es-module-lexer: 1.7.0\n       pathe: 2.0.3\n-      vite: 5.4.19(@types/node@24.10.4)(sass@1.96.0)\n+      vite: 5.4.21(@types/node@24.10.4)(sass@1.96.0)\n     transitivePeerDependencies:\n       - '@types/node'\n       - less\n@@ -6577,17 +6543,7 @@ snapshots:\n       - supports-color\n       - terser\n \n-  vite@5.4.15(@types/node@24.10.4)(sass@1.96.0):\n-    dependencies:\n-      esbuild: 0.21.5\n-      postcss: 8.5.6\n-      rollup: 4.53.3\n-    optionalDependencies:\n-      '@types/node': 24.10.4\n-      fsevents: 2.3.3\n-      sass: 1.96.0\n-\n-  vite@5.4.19(@types/node@24.10.4)(sass@1.96.0):\n+  vite@5.4.21(@types/node@24.10.4)(sass@1.96.0):\n     dependencies:\n       esbuild: 0.21.5\n       postcss: 8.5.6\n@@ -6601,7 +6557,7 @@ snapshots:\n     dependencies:\n       '@types/chai': 5.2.2\n       '@vitest/expect': 3.2.4\n-      '@vitest/mocker': 3.2.4(vite@5.4.19(@types/node@24.10.4)(sass@1.96.0))\n+      '@vitest/mocker': 3.2.4(vite@5.4.21(@types/node@24.10.4)(sass@1.96.0))\n       '@vitest/pretty-format': 3.2.4\n       '@vitest/runner': 3.2.4\n       '@vitest/snapshot': 3.2.4\n@@ -6619,7 +6575,7 @@ snapshots:\n       tinyglobby: 0.2.14\n       tinypool: 1.1.1\n       tinyrainbow: 2.0.0\n-      vite: 5.4.19(@types/node@24.10.4)(sass@1.96.0)\n+      vite: 5.4.21(@types/node@24.10.4)(sass@1.96.0)\n       vite-node: 3.2.4(@types/node@24.10.4)(sass@1.96.0)\n       why-is-node-running: 2.3.0\n     optionalDependencies:"}, {"role": "assistant", "content": "build(deps): update vite to 5.4.21"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_codegen_gcc/src/lib.rs              |  3 +-\n compiler/rustc_codegen_llvm/src/lib.rs             |  2 +-\n .../rustc_codegen_ssa/src/back/symbol_export.rs    | 18 ++++-----\n compiler/rustc_codegen_ssa/src/lib.rs              |  6 +--\n compiler/rustc_const_eval/src/lib.rs               | 16 ++++----\n compiler/rustc_interface/src/passes.rs             | 46 +++++++++++-----------\n compiler/rustc_metadata/src/rmeta/mod.rs           |  2 +-\n compiler/rustc_middle/src/util/mod.rs              | 17 --------\n compiler/rustc_mir_build/src/lib.rs                | 12 +++---\n compiler/rustc_mir_transform/src/lib.rs            |  6 +--\n compiler/rustc_monomorphize/src/collector.rs       |  2 +-\n compiler/rustc_monomorphize/src/lib.rs             |  2 +-\n compiler/rustc_monomorphize/src/partitioning.rs    |  8 ++--\n compiler/rustc_passes/src/lib.rs                   |  2 +-\n src/librustdoc/core.rs                             |  9 +++--\n src/tools/miri/src/bin/miri.rs                     |  2 +-\n tests/ui-fulldeps/obtain-borrowck.rs               |  6 +--\n 17 files changed, 72 insertions(+), 87 deletions(-)"}, {"role": "assistant", "content": "refactor: simplify compiler provider callback signatures"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n scripts/doc_parsing_utils.py                         | 20 ++++++++++++--------\n scripts/docs.py                                      |  2 +-\n scripts/notify_translations.py                       |  2 +-\n scripts/test.sh                                      |  2 +-\n scripts/tests/test_translation_fixer/conftest.py     | 10 ++++++++++\n .../test_code_blocks_lines_number_mismatch.py        | 16 ++++++++--------\n .../test_code_blocks/test_code_blocks_mermaid.py     |  8 ++++----\n .../test_code_blocks_number_mismatch.py              | 12 ++++++++----\n .../test_code_blocks_wrong_lang_code.py              | 12 ++++++------\n .../test_code_includes/test_number_mismatch.py       | 12 ++++++++----\n .../test_complex_doc/test_compex_doc.py              |  4 ++--\n .../test_header_level_mismatch.py                    |  8 ++++----\n .../test_header_number_mismatch.py                   | 12 ++++++++----\n .../test_html_links_number_mismatch.py               | 12 ++++++++----\n .../test_mkd_links_number_mismatch.py                | 12 ++++++++----\n 15 files changed, 89 insertions(+), 55 deletions(-)\n\ndiff --git a/scripts/doc_parsing_utils.py b/scripts/doc_parsing_utils.py\nindex 857d808..79f2e9e 100644\n--- a/scripts/doc_parsing_utils.py\n+++ b/scripts/doc_parsing_utils.py\n@@ -1,5 +1,5 @@\n import re\n-from typing import TypedDict\n+from typing import TypedDict, Union\n \n CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n@@ -50,8 +50,8 @@ class MarkdownLinkInfo(TypedDict):\n     line_no: int\n     url: str\n     text: str\n-    title: str | None\n-    attributes: str | None\n+    title: Union[str, None]\n+    attributes: Union[str, None]\n     full_match: str\n \n \n@@ -285,7 +285,11 @@ def _add_lang_code_to_url(url: str, lang_code: str) -> str:\n \n \n def _construct_markdown_link(\n-    url: str, text: str, title: str | None, attributes: str | None, lang_code: str\n+    url: str,\n+    text: str,\n+    title: Union[str, None],\n+    attributes: Union[str, None],\n+    lang_code: str,\n ) -> str:\n     \"\"\"\n     Construct a markdown link, adjusting the URL for the given language code if needed.\n@@ -545,7 +549,7 @@ def extract_multiline_code_blocks(text: list[str]) -> list[MultilineCodeBlockInf\n     return blocks\n \n \n-def _split_hash_comment(line: str) -> tuple[str, str | None]:\n+def _split_hash_comment(line: str) -> tuple[str, Union[str, None]]:\n     match = HASH_COMMENT_RE.match(line)\n     if match:\n         code = match.group(\"code\").rstrip()\n@@ -554,7 +558,7 @@ def _split_hash_comment(line: str) -> tuple[str, str | None]:\n     return line.rstrip(), None\n \n \n-def _split_slashes_comment(line: str) -> tuple[str, str | None]:\n+def _split_slashes_comment(line: str) -> tuple[str, Union[str, None]]:\n     match = SLASHES_COMMENT_RE.match(line)\n     if match:\n         code = match.group(\"code\").rstrip()\n@@ -600,8 +604,8 @@ def replace_multiline_code_block(\n \n     code_block: list[str] = []\n     for line_a, line_b in zip(block_a[\"content\"], block_b[\"content\"]):\n-        line_a_comment: str | None = None\n-        line_b_comment: str | None = None\n+        line_a_comment: Union[str, None] = None\n+        line_b_comment: Union[str, None] = None\n \n         # Handle comments based on language\n         if block_language in {\ndiff --git a/scripts/docs.py b/scripts/docs.py\nindex fbde1ec..84cf01c 100644\n--- a/scripts/docs.py\n+++ b/scripts/docs.py\n@@ -239,7 +239,7 @@ def generate_readme() -> None:\n     Generate README.md content from main index.md\n     \"\"\"\n     readme_path = Path(\"README.md\")\n-    old_content = readme_path.read_text()\n+    old_content = readme_path.read_text(\"utf-8\")\n     new_content = generate_readme_content()\n     if new_content != old_content:\n         print(\"README.md outdated from the latest index.md\")\ndiff --git a/scripts/notify_translations.py b/scripts/notify_translations.py\nindex 2ca740a..74cdf0d 100644\n--- a/scripts/notify_translations.py\n+++ b/scripts/notify_translations.py\n@@ -316,7 +316,7 @@ def main() -> None:\n         raise RuntimeError(\n             f\"No github event file available at: {settings.github_event_path}\"\n         )\n-    contents = settings.github_event_path.read_text()\n+    contents = settings.github_event_path.read_text(\"utf-8\")\n     github_event = PartialGitHubEvent.model_validate_json(contents)\n     logging.info(f\"Using GitHub event: {github_event}\")\n     number = (\ndiff --git a/scripts/test.sh b/scripts/test.sh\nindex 7d17add..0bffcd1 100755\n--- a/scripts/test.sh\n+++ b/scripts/test.sh\n@@ -4,4 +4,4 @@ set -e\n set -x\n \n export PYTHONPATH=./docs_src\n-coverage run -m pytest tests ${@}\n+coverage run -m pytest tests scripts/tests/ ${@}\ndiff --git a/scripts/tests/test_translation_fixer/conftest.py b/scripts/tests/test_translation_fixer/conftest.py\nindex b2c745d..006f519 100644\n--- a/scripts/tests/test_translation_fixer/conftest.py\n+++ b/scripts/tests/test_translation_fixer/conftest.py\n@@ -1,9 +1,19 @@\n import shutil\n+import sys\n from pathlib import Path\n \n import pytest\n from typer.testing import CliRunner\n \n+skip_on_windows = pytest.mark.skipif(\n+    sys.platform == \"win32\", reason=\"Skipping on Windows\"\n+)\n+\n+\n+def pytest_collection_modifyitems(items: list[pytest.Item]) -> None:\n+    for item in items:\n+        item.add_marker(skip_on_windows)\n+\n \n @pytest.fixture(name=\"runner\")\n def get_runner():\ndiff --git a/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_lines_number_mismatch.py b/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_lines_number_mismatch.py\nindex 906c8a5..9cdbe83 100644\n--- a/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_lines_number_mismatch.py\n+++ b/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_lines_number_mismatch.py\n@@ -22,10 +22,10 @@ def test_gt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(\n-        f\"{data_path}/translated_doc_lines_number_gt.md\"\n-    ).read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_lines_number_gt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\n@@ -46,10 +46,10 @@ def test_lt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     # assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(\n-        f\"{data_path}/translated_doc_lines_number_lt.md\"\n-    ).read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_lines_number_lt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_mermaid.py b/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_mermaid.py\nindex 75c589f..8b80c70 100644\n--- a/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_mermaid.py\n+++ b/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_mermaid.py\n@@ -22,10 +22,10 @@ def test_translated(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 0, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n     expected_content = Path(\n         f\"{data_path}/translated_doc_mermaid_translated.md\"\n-    ).read_text()\n+    ).read_text(\"utf-8\")\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert (\n@@ -50,10 +50,10 @@ def test_not_translated(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 0, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n     expected_content = Path(\n         f\"{data_path}/translated_doc_mermaid_not_translated.md\"\n-    ).read_text()\n+    ).read_text(\"utf-8\")\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert (\"Skipping mermaid code block replacement\") not in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_number_mismatch.py b/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_number_mismatch.py\nindex b05dac9..ad5767c 100644\n--- a/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_number_mismatch.py\n+++ b/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_number_mismatch.py\n@@ -22,8 +22,10 @@ def test_gt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\n@@ -45,8 +47,10 @@ def test_lt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     # assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_wrong_lang_code.py b/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_wrong_lang_code.py\nindex 6c2b18c..85d73e3 100644\n--- a/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_wrong_lang_code.py\n+++ b/scripts/tests/test_translation_fixer/test_code_blocks/test_code_blocks_wrong_lang_code.py\n@@ -22,10 +22,10 @@ def test_wrong_lang_code_1(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(\n-        f\"{data_path}/translated_doc_wrong_lang_code.md\"\n-    ).read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_wrong_lang_code.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\n@@ -46,10 +46,10 @@ def test_wrong_lang_code_2(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n     expected_content = Path(\n         f\"{data_path}/translated_doc_wrong_lang_code_2.md\"\n-    ).read_text()\n+    ).read_text(\"utf-8\")\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_code_includes/test_number_mismatch.py b/scripts/tests/test_translation_fixer/test_code_includes/test_number_mismatch.py\nindex 5e3eee5..1020b89 100644\n--- a/scripts/tests/test_translation_fixer/test_code_includes/test_number_mismatch.py\n+++ b/scripts/tests/test_translation_fixer/test_code_includes/test_number_mismatch.py\n@@ -22,8 +22,10 @@ def test_gt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\n@@ -45,8 +47,10 @@ def test_lt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_complex_doc/test_compex_doc.py b/scripts/tests/test_translation_fixer/test_complex_doc/test_compex_doc.py\nindex 86cc4d5..cc7bcad 100644\n--- a/scripts/tests/test_translation_fixer/test_complex_doc/test_compex_doc.py\n+++ b/scripts/tests/test_translation_fixer/test_complex_doc/test_compex_doc.py\n@@ -22,8 +22,8 @@ def test_fix(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 0, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = (data_path / \"translated_doc_expected.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = (data_path / \"translated_doc_expected.md\").read_text(\"utf-8\")\n     assert fixed_content == expected_content\n \n     assert \"Fixing multiline code blocks in\" in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_header_permalinks/test_header_level_mismatch.py b/scripts/tests/test_translation_fixer/test_header_permalinks/test_header_level_mismatch.py\nindex 9fe2f7b..99d27db 100644\n--- a/scripts/tests/test_translation_fixer/test_header_permalinks/test_header_level_mismatch.py\n+++ b/scripts/tests/test_translation_fixer/test_header_permalinks/test_header_level_mismatch.py\n@@ -22,10 +22,10 @@ def test_level_mismatch_1(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n     expected_content = Path(\n         f\"{data_path}/translated_doc_level_mismatch_1.md\"\n-    ).read_text()\n+    ).read_text(\"utf-8\")\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\n@@ -47,10 +47,10 @@ def test_level_mismatch_2(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n     expected_content = Path(\n         f\"{data_path}/translated_doc_level_mismatch_2.md\"\n-    ).read_text()\n+    ).read_text(\"utf-8\")\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_header_permalinks/test_header_number_mismatch.py b/scripts/tests/test_translation_fixer/test_header_permalinks/test_header_number_mismatch.py\nindex c0e78d0..c4d0346 100644\n--- a/scripts/tests/test_translation_fixer/test_header_permalinks/test_header_number_mismatch.py\n+++ b/scripts/tests/test_translation_fixer/test_header_permalinks/test_header_number_mismatch.py\n@@ -22,8 +22,10 @@ def test_gt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\n@@ -45,8 +47,10 @@ def test_lt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_html_links/test_html_links_number_mismatch.py b/scripts/tests/test_translation_fixer/test_html_links/test_html_links_number_mismatch.py\nindex 271e5d2..11dcea1 100644\n--- a/scripts/tests/test_translation_fixer/test_html_links/test_html_links_number_mismatch.py\n+++ b/scripts/tests/test_translation_fixer/test_html_links/test_html_links_number_mismatch.py\n@@ -20,8 +20,10 @@ def test_gt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\n@@ -43,8 +45,10 @@ def test_lt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     # assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\ndiff --git a/scripts/tests/test_translation_fixer/test_markdown_links/test_mkd_links_number_mismatch.py b/scripts/tests/test_translation_fixer/test_markdown_links/test_mkd_links_number_mismatch.py\nindex 0f4952f..c72e012 100644\n--- a/scripts/tests/test_translation_fixer/test_markdown_links/test_mkd_links_number_mismatch.py\n+++ b/scripts/tests/test_translation_fixer/test_markdown_links/test_mkd_links_number_mismatch.py\n@@ -22,8 +22,10 @@ def test_gt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_gt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output\n@@ -45,8 +47,10 @@ def test_lt(runner: CliRunner, root_dir: Path, copy_test_files):\n     )\n     # assert result.exit_code == 1, result.output\n \n-    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text()\n-    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text()\n+    fixed_content = (root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\").read_text(\"utf-8\")\n+    expected_content = Path(f\"{data_path}/translated_doc_number_lt.md\").read_text(\n+        \"utf-8\"\n+    )\n \n     assert fixed_content == expected_content  # Translated doc remains unchanged\n     assert \"Error processing docs/lang/docs/doc.md\" in result.output"}, {"role": "assistant", "content": "fix: add explicit utf-8 encoding and improve cross-platform"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n packages/compiler/src/render3/r3_identifiers.ts    |  3 ++\n .../src/template/pipeline/src/instruction.ts       |  8 ++++\n .../src/template/pipeline/src/phases/chaining.ts   |  1 +\n packages/core/src/core_render3_private_export.ts   |  2 +\n packages/core/src/render3/index.ts                 |  2 +\n packages/core/src/render3/instructions/all.ts      |  1 +\n .../src/render3/instructions/callback_storage.ts   | 45 ++++++++++++++++++++++\n packages/core/src/render3/jit/environment.ts       |  2 +\n 8 files changed, 64 insertions(+)\n\ndiff --git a/packages/compiler/src/render3/r3_identifiers.ts b/packages/compiler/src/render3/r3_identifiers.ts\nindex 28a1b369..67fc9e9b 100644\n--- a/packages/compiler/src/render3/r3_identifiers.ts\n+++ b/packages/compiler/src/render3/r3_identifiers.ts\n@@ -421,6 +421,9 @@ export class Identifiers {\n   static storeLet: o.ExternalReference = {name: '\u0275\u0275storeLet', moduleName: CORE};\n   static readContextLet: o.ExternalReference = {name: '\u0275\u0275readContextLet', moduleName: CORE};\n \n+  static storeCallback: o.ExternalReference = {name: '\u0275\u0275storeCallback', moduleName: CORE};\n+  static getCallback: o.ExternalReference = {name: '\u0275\u0275getCallback', moduleName: CORE};\n+\n   static attachSourceLocations: o.ExternalReference = {\n     name: '\u0275\u0275attachSourceLocations',\n     moduleName: CORE,\ndiff --git a/packages/compiler/src/template/pipeline/src/instruction.ts b/packages/compiler/src/template/pipeline/src/instruction.ts\nindex d7c326e5..d05ac780 100644\n--- a/packages/compiler/src/template/pipeline/src/instruction.ts\n+++ b/packages/compiler/src/template/pipeline/src/instruction.ts\n@@ -940,6 +940,14 @@ export function attachSourceLocation(\n   return call(Identifiers.attachSourceLocations, [o.literal(templatePath), locations], null);\n }\n \n+export function storeCallback(slotOffset: number, expression: o.Expression): ir.CreateOp {\n+  return call(Identifiers.storeCallback, [o.literal(slotOffset), expression], null);\n+}\n+\n+export function getCallback(slotOffset: number): o.Expression {\n+  return o.importExpr(Identifiers.getCallback).callFn([o.literal(slotOffset)]);\n+}\n+\n /**\n  * Collates the string an expression arguments for an interpolation instruction.\n  */\ndiff --git a/packages/compiler/src/template/pipeline/src/phases/chaining.ts b/packages/compiler/src/template/pipeline/src/phases/chaining.ts\nindex 16b91e50..d8a4fa12 100644\n--- a/packages/compiler/src/template/pipeline/src/phases/chaining.ts\n+++ b/packages/compiler/src/template/pipeline/src/phases/chaining.ts\n@@ -47,6 +47,7 @@ const CHAIN_COMPATIBILITY = new Map<o.ExternalReference, o.ExternalReference>([\n   [R3.animationLeave, R3.animationLeave],\n   [R3.animationEnterListener, R3.animationEnterListener],\n   [R3.animationLeaveListener, R3.animationLeaveListener],\n+  [R3.storeCallback, R3.storeCallback],\n ]);\n \n /**\ndiff --git a/packages/core/src/core_render3_private_export.ts b/packages/core/src/core_render3_private_export.ts\nindex 63805889..3898c82d 100644\n--- a/packages/core/src/core_render3_private_export.ts\n+++ b/packages/core/src/core_render3_private_export.ts\n@@ -239,6 +239,8 @@ export {\n   \u0275\u0275animateEnterListener,\n   \u0275\u0275animateLeave,\n   \u0275\u0275animateLeaveListener,\n+  \u0275\u0275storeCallback,\n+  \u0275\u0275getCallback,\n } from './render3/index';\n export {CONTAINER_HEADER_OFFSET as \u0275CONTAINER_HEADER_OFFSET} from './render3/interfaces/container';\n export {LContext as \u0275LContext} from './render3/interfaces/context';\ndiff --git a/packages/core/src/render3/index.ts b/packages/core/src/render3/index.ts\nindex a86dd2f5..09549a2a 100644\n--- a/packages/core/src/render3/index.ts\n+++ b/packages/core/src/render3/index.ts\n@@ -165,6 +165,8 @@ export {\n   \u0275\u0275animateEnterListener,\n   \u0275\u0275animateLeave,\n   \u0275\u0275animateLeaveListener,\n+  \u0275\u0275storeCallback,\n+  \u0275\u0275getCallback,\n } from './instructions/all';\n export {\n   \u0275\u0275deferEnableTimerScheduling,\ndiff --git a/packages/core/src/render3/instructions/all.ts b/packages/core/src/render3/instructions/all.ts\nindex 762de4f7..06d26347 100644\n--- a/packages/core/src/render3/instructions/all.ts\n+++ b/packages/core/src/render3/instructions/all.ts\n@@ -63,3 +63,4 @@ export * from './two_way';\n export * from './let_declaration';\n export * from './attach_source_locations';\n export * from './value_interpolation';\n+export * from './callback_storage';\ndiff --git a/packages/core/src/render3/instructions/callback_storage.ts b/packages/core/src/render3/instructions/callback_storage.ts\nnew file mode 100644\nindex 00000000..e121a3eb\n--- /dev/null\n+++ b/packages/core/src/render3/instructions/callback_storage.ts\n@@ -0,0 +1,45 @@\n+/*!\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.dev/license\n+ */\n+\n+import {assertFunction, assertNotDefined} from '../../util/assert';\n+import {HEADER_OFFSET} from '../interfaces/view';\n+import {getContextLView, getLView, getTView} from '../state';\n+import {load, store} from '../util/view_utils';\n+\n+/**\n+ * Creation instruction that stores a callback function so it can be reused later.\n+ *\n+ * @param slotOffset the offset from binding root to the reserved slot\n+ * @param declaration Function to be stored.\n+ * @returns Itself for chaining purposes.\n+ *\n+ * @codeGenApi\n+ */\n+export function \u0275\u0275storeCallback(index: number, declaration: Function): typeof \u0275\u0275storeCallback {\n+  const tView = getTView();\n+  const lView = getLView();\n+  const adjustedIndex = index + HEADER_OFFSET;\n+  ngDevMode &&\n+    assertNotDefined(lView[adjustedIndex], 'Expected callback not to have been initialized.');\n+  store(tView, lView, adjustedIndex, declaration);\n+  return \u0275\u0275storeCallback;\n+}\n+\n+/**\n+ * Retrieves a callback stored by `\u0275\u0275storeCallback`.\n+ *\n+ * @param slotOffset the offset from binding root to the reserved slot\n+ *\n+ * @codeGenApi\n+ */\n+export function \u0275\u0275getCallback(index: number): Function {\n+  const contextLView = getContextLView();\n+  const value = load<Function>(contextLView, HEADER_OFFSET + index);\n+  ngDevMode && assertFunction(value, 'Expected stored callback to be a function.');\n+  return value;\n+}\ndiff --git a/packages/core/src/render3/jit/environment.ts b/packages/core/src/render3/jit/environment.ts\nindex bf37779c..1cff9710 100644\n--- a/packages/core/src/render3/jit/environment.ts\n+++ b/packages/core/src/render3/jit/environment.ts\n@@ -166,6 +166,8 @@ export const angularCoreEnv: {[name: string]: unknown} = (() => ({\n   '\u0275setClassDebugInfo': r3.\u0275setClassDebugInfo,\n   '\u0275\u0275declareLet': r3.\u0275\u0275declareLet,\n   '\u0275\u0275storeLet': r3.\u0275\u0275storeLet,\n+  '\u0275\u0275storeCallback': r3.\u0275\u0275storeCallback,\n+  '\u0275\u0275getCallback': r3.\u0275\u0275getCallback,\n   '\u0275\u0275readContextLet': r3.\u0275\u0275readContextLet,\n   '\u0275\u0275attachSourceLocations': r3.\u0275\u0275attachSourceLocations,\n   '\u0275\u0275interpolate': r3.\u0275\u0275interpolate,"}, {"role": "assistant", "content": "refactor(core): add instructions for callback storage and retrieval"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../__tests__/rendererOptimizedMode.spec.ts        | 60 +++++++++++++++++++++-\n packages/runtime-core/src/renderer.ts              |  3 +-\n 2 files changed, 61 insertions(+), 2 deletions(-)\n\ndiff --git a/packages/runtime-core/__tests__/rendererOptimizedMode.spec.ts b/packages/runtime-core/__tests__/rendererOptimizedMode.spec.ts\nindex 1d8bb84..afcc6dc 100644\n--- a/packages/runtime-core/__tests__/rendererOptimizedMode.spec.ts\n+++ b/packages/runtime-core/__tests__/rendererOptimizedMode.spec.ts\n@@ -29,7 +29,7 @@ import {\n   setBlockTracking,\n   withCtx,\n } from '@vue/runtime-test'\n-import { PatchFlags, SlotFlags } from '@vue/shared'\n+import { PatchFlags, SlotFlags, toDisplayString } from '@vue/shared'\n import { SuspenseImpl } from '../src/components/Suspense'\n \n describe('renderer: optimized mode', () => {\n@@ -1402,4 +1402,62 @@ describe('renderer: optimized mode', () => {\n     expect(inner(root)).toBe('<!--v-if-->')\n     expect(beforeUnmountSpy).toHaveBeenCalledTimes(1)\n   })\n+\n+  // #12411\n+  test('handle patch stable fragment with non-reactive v-for source', async () => {\n+    const count = ref(0)\n+    const foo: any = []\n+    function updateFoo() {\n+      for (let n = 0; n < 3; n++) {\n+        foo[n] = n + 1 + '_foo'\n+      }\n+    }\n+    const Comp = {\n+      setup() {\n+        return () => {\n+          // <div>{{ count }}</div>\n+          // <div v-for='item in foo'>{{ item }}</div>\n+          return (\n+            openBlock(),\n+            createElementBlock(\n+              Fragment,\n+              null,\n+              [\n+                createElementVNode(\n+                  'div',\n+                  null,\n+                  toDisplayString(count.value),\n+                  PatchFlags.TEXT,\n+                ),\n+                (openBlock(),\n+                createElementBlock(\n+                  Fragment,\n+                  null,\n+                  renderList(foo, item => {\n+                    return createElementVNode(\n+                      'div',\n+                      null,\n+                      toDisplayString(item),\n+                      PatchFlags.TEXT,\n+                    )\n+                  }),\n+                  PatchFlags.STABLE_FRAGMENT,\n+                )),\n+              ],\n+              PatchFlags.STABLE_FRAGMENT,\n+            )\n+          )\n+        }\n+      },\n+    }\n+\n+    render(h(Comp), root)\n+    expect(inner(root)).toBe('<div>0</div>')\n+    updateFoo()\n+    count.value++\n+    await nextTick()\n+    expect(inner(root)).toBe(\n+      '<div>1</div><div>1_foo</div><div>2_foo</div><div>3_foo</div>',\n+    )\n+  })\n })\ndiff --git a/packages/runtime-core/src/renderer.ts b/packages/runtime-core/src/renderer.ts\nindex 0aa797c..6558796 100644\n--- a/packages/runtime-core/src/renderer.ts\n+++ b/packages/runtime-core/src/renderer.ts\n@@ -1115,7 +1115,8 @@ function baseCreateRenderer(\n         dynamicChildren &&\n         // #2715 the previous fragment could've been a BAILed one as a result\n         // of renderSlot() with no valid children\n-        n1.dynamicChildren\n+        n1.dynamicChildren &&\n+        n1.dynamicChildren.length === dynamicChildren.length\n       ) {\n         // a stable fragment (template root or <template v-for>) doesn't need to\n         // patch children order, but it may contain dynamicChildren."}, {"role": "assistant", "content": "fix: handle stable fragment patch with non-reactive v-for source"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/build-docs.yml | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/.github/workflows/build-docs.yml b/.github/workflows/build-docs.yml\nindex d1b3893..77bce05 100644\n--- a/.github/workflows/build-docs.yml\n+++ b/.github/workflows/build-docs.yml\n@@ -91,7 +91,7 @@ jobs:\n         run: uv sync --locked --no-dev --group docs\n       - name: Update Languages\n         run: uv run ./scripts/docs.py update-languages\n-      - uses: actions/cache@v4\n+      - uses: actions/cache@v5\n         with:\n           key: mkdocs-cards-${{ matrix.lang }}-${{ github.ref }}\n           path: docs/${{ matrix.lang }}/.cache"}, {"role": "assistant", "content": "ci: update actions/cache to v5"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/shared-docs/pipeline/shared/linking.mts | 3 +++\n 1 file changed, 3 insertions(+)\n\ndiff --git a/adev/shared-docs/pipeline/shared/linking.mts b/adev/shared-docs/pipeline/shared/linking.mts\nindex a51a59bb..87ddb02e 100644\n--- a/adev/shared-docs/pipeline/shared/linking.mts\n+++ b/adev/shared-docs/pipeline/shared/linking.mts\n@@ -20,6 +20,9 @@ const LINK_EXEMPT = new Set([\n   'hidden',\n   'state',\n   'group',\n+  'animation',\n+  'transition',\n+  'trigger',\n ]);\n \n export function shouldLinkSymbol(symbol: string): boolean {"}, {"role": "assistant", "content": "docs(docs-infra): Exempts animation-related symbols from linking"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_parse/src/parser/item.rs            |  1 +\n .../macro/kw-in-const-item-pos-recovery-149692.rs  | 11 ++++++++\n .../kw-in-const-item-pos-recovery-149692.stderr    | 11 ++++++++\n .../parser/macro/kw-in-item-pos-recovery-149692.rs | 19 ++++++++++++++\n .../macro/kw-in-item-pos-recovery-149692.stderr    | 29 ++++++++++++++++++++++\n 5 files changed, 71 insertions(+)"}, {"role": "assistant", "content": "fix(parser): add recovery for keyword in item position"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/renovate.json5                  |  4 ---\n packages/compiler-core/package.json     |  2 +-\n packages/compiler-core/src/parser.ts    |  2 +-\n packages/compiler-core/src/tokenizer.ts |  2 +-\n pnpm-lock.yaml                          | 44 +++++++++++++++++++++++++++------\n rollup.config.js                        |  2 +-\n 6 files changed, 40 insertions(+), 16 deletions(-)\n\ndiff --git a/.github/renovate.json5 b/.github/renovate.json5\nindex aad4afa..0e2be25 100644\n--- a/.github/renovate.json5\n+++ b/.github/renovate.json5\n@@ -67,9 +67,5 @@\n     // pinned\n     // only used in example for e2e tests\n     'marked',\n-\n-    // pinned, 5.0+ has exports issues\n-    // https://github.com/vuejs/core/issues/11603\n-    'entities',\n   ],\n }\ndiff --git a/packages/compiler-core/package.json b/packages/compiler-core/package.json\nindex b7f8fb4..bb65b2a 100644\n--- a/packages/compiler-core/package.json\n+++ b/packages/compiler-core/package.json\n@@ -48,7 +48,7 @@\n   \"dependencies\": {\n     \"@babel/parser\": \"catalog:\",\n     \"@vue/shared\": \"workspace:*\",\n-    \"entities\": \"^4.5.0\",\n+    \"entities\": \"^7.0.0\",\n     \"estree-walker\": \"catalog:\",\n     \"source-map-js\": \"catalog:\"\n   },\ndiff --git a/packages/compiler-core/src/parser.ts b/packages/compiler-core/src/parser.ts\nindex debf11f..078d37d 100644\n--- a/packages/compiler-core/src/parser.ts\n+++ b/packages/compiler-core/src/parser.ts\n@@ -46,7 +46,7 @@ import {\n   isStaticArgOf,\n   isVPre,\n } from './utils'\n-import { decodeHTML } from 'entities/lib/decode.js'\n+import { decodeHTML } from 'entities/decode'\n import {\n   type ParserOptions as BabelOptions,\n   parse,\ndiff --git a/packages/compiler-core/src/tokenizer.ts b/packages/compiler-core/src/tokenizer.ts\nindex b8a7479..48afe9d 100644\n--- a/packages/compiler-core/src/tokenizer.ts\n+++ b/packages/compiler-core/src/tokenizer.ts\n@@ -36,7 +36,7 @@ import {\n   EntityDecoder,\n   fromCodePoint,\n   htmlDecodeTree,\n-} from 'entities/lib/decode.js'\n+} from 'entities/decode'\n \n export enum ParseMode {\n   BASE,\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 73f20d1..78db215 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -253,8 +253,8 @@ importers:\n         specifier: workspace:*\n         version: link:../shared\n       entities:\n-        specifier: ^4.5.0\n-        version: 4.5.0\n+        specifier: ^7.0.0\n+        version: 7.0.0\n       estree-walker:\n         specifier: 'catalog:'\n         version: 2.0.2\n@@ -964,30 +964,35 @@ packages:\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm]\n     os: [linux]\n+    libc: [glibc]\n \n   '@parcel/watcher-linux-arm64-glibc@2.4.1':\n     resolution: {integrity: sha512-BJ7mH985OADVLpbrzCLgrJ3TOpiZggE9FMblfO65PlOCdG++xJpKUJ0Aol74ZUIYfb8WsRlUdgrZxKkz3zXWYA==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@parcel/watcher-linux-arm64-musl@2.4.1':\n     resolution: {integrity: sha512-p4Xb7JGq3MLgAfYhslU2SjoV9G0kI0Xry0kuxeG/41UfpjHGOhv7UoUDAz/jb1u2elbhazy4rRBL8PegPJFBhA==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [musl]\n \n   '@parcel/watcher-linux-x64-glibc@2.4.1':\n     resolution: {integrity: sha512-s9O3fByZ/2pyYDPoLM6zt92yu6P4E39a03zvO0qCHOTjxmt3GHRMLuRZEWhWLASTMSrrnVNWdVI/+pUElJBBBg==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [x64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@parcel/watcher-linux-x64-musl@2.4.1':\n     resolution: {integrity: sha512-L2nZTYR1myLNST0O632g0Dx9LyMNHrn6TOt76sYxWLdff3cB22/GZX2UPtJnaqQPdCRoszoY5rcOj4oMTtp5fQ==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [x64]\n     os: [linux]\n+    libc: [musl]\n \n   '@parcel/watcher-win32-arm64@2.4.1':\n     resolution: {integrity: sha512-Uq2BPp5GWhrq/lcuItCHoqxjULU1QYEcyjSO5jqqOK8RNFDBQnenMMx4gAl3v8GiWa59E9+uDM7yZ6LxwUIfRg==}\n@@ -1120,56 +1125,67 @@ packages:\n     resolution: {integrity: sha512-k9oD15soC/Ln6d2Wv/JOFPzZXIAIFLp6B+i14KhxAfnq76ajt0EhYc5YPeX6W1xJkAdItcVT+JhKl1QZh44/qw==}\n     cpu: [arm]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-arm-musleabihf@4.53.3':\n     resolution: {integrity: sha512-vTNlKq+N6CK/8UktsrFuc+/7NlEYVxgaEgRXVUVK258Z5ymho29skzW1sutgYjqNnquGwVUObAaxae8rZ6YMhg==}\n     cpu: [arm]\n     os: [linux]\n+    libc: [musl]\n \n   '@rollup/rollup-linux-arm64-gnu@4.53.3':\n     resolution: {integrity: sha512-RGrFLWgMhSxRs/EWJMIFM1O5Mzuz3Xy3/mnxJp/5cVhZ2XoCAxJnmNsEyeMJtpK+wu0FJFWz+QF4mjCA7AUQ3w==}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-arm64-musl@4.53.3':\n     resolution: {integrity: sha512-kASyvfBEWYPEwe0Qv4nfu6pNkITLTb32p4yTgzFCocHnJLAHs+9LjUu9ONIhvfT/5lv4YS5muBHyuV84epBo/A==}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [musl]\n \n   '@rollup/rollup-linux-loong64-gnu@4.53.3':\n     resolution: {integrity: sha512-JiuKcp2teLJwQ7vkJ95EwESWkNRFJD7TQgYmCnrPtlu50b4XvT5MOmurWNrCj3IFdyjBQ5p9vnrX4JM6I8OE7g==}\n     cpu: [loong64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-ppc64-gnu@4.53.3':\n     resolution: {integrity: sha512-EoGSa8nd6d3T7zLuqdojxC20oBfNT8nexBbB/rkxgKj5T5vhpAQKKnD+h3UkoMuTyXkP5jTjK/ccNRmQrPNDuw==}\n     cpu: [ppc64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-riscv64-gnu@4.53.3':\n     resolution: {integrity: sha512-4s+Wped2IHXHPnAEbIB0YWBv7SDohqxobiiPA1FIWZpX+w9o2i4LezzH/NkFUl8LRci/8udci6cLq+jJQlh+0g==}\n     cpu: [riscv64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-riscv64-musl@4.53.3':\n     resolution: {integrity: sha512-68k2g7+0vs2u9CxDt5ktXTngsxOQkSEV/xBbwlqYcUrAVh6P9EgMZvFsnHy4SEiUl46Xf0IObWVbMvPrr2gw8A==}\n     cpu: [riscv64]\n     os: [linux]\n+    libc: [musl]\n \n   '@rollup/rollup-linux-s390x-gnu@4.53.3':\n     resolution: {integrity: sha512-VYsFMpULAz87ZW6BVYw3I6sWesGpsP9OPcyKe8ofdg9LHxSbRMd7zrVrr5xi/3kMZtpWL/wC+UIJWJYVX5uTKg==}\n     cpu: [s390x]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-x64-gnu@4.53.3':\n     resolution: {integrity: sha512-3EhFi1FU6YL8HTUJZ51imGJWEX//ajQPfqWLI3BQq4TlvHy4X0MOr5q3D2Zof/ka0d5FNdPwZXm3Yyib/UEd+w==}\n     cpu: [x64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-x64-musl@4.53.3':\n     resolution: {integrity: sha512-eoROhjcc6HbZCJr+tvVT8X4fW3/5g/WkGvvmwz/88sDtSJzO7r/blvoBDgISDiCjDRZmHpwud7h+6Q9JxFwq1Q==}\n     cpu: [x64]\n     os: [linux]\n+    libc: [musl]\n \n   '@rollup/rollup-openharmony-arm64@4.53.3':\n     resolution: {integrity: sha512-OueLAWgrNSPGAdUdIjSWXw+u/02BRTcnfw9PN41D2vq/JSEPnJnVuBgw18VkN8wcd4fjUs+jFHVM4t9+kBSNLw==}\n@@ -1219,24 +1235,28 @@ packages:\n     engines: {node: '>=10'}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@swc/core-linux-arm64-musl@1.15.4':\n     resolution: {integrity: sha512-Ly95wc+VXDhl08pjAoPUhVu5vNbuPMbURknRZa5QOZuiizJ6DkaSI0/zsEc26PpC6HTc4prNLY3ARVwZ7j/IJQ==}\n     engines: {node: '>=10'}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [musl]\n \n   '@swc/core-linux-x64-gnu@1.15.4':\n     resolution: {integrity: sha512-7pIG0BnaMn4zTpHeColPwyrWoTY9Drr+ISZQIgYHUKh3oaPtNCrXb289ScGbPPPjLsSfcGTeOy2pXmNczMC+yg==}\n     engines: {node: '>=10'}\n     cpu: [x64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@swc/core-linux-x64-musl@1.15.4':\n     resolution: {integrity: sha512-oaqTV25V9H+PpSkvTcK25q6Q56FvXc6d2xBu486dv9LAPCHWgeAworE8WpBLV26g8rubcN5nGhO5HwSunXA7Ww==}\n     engines: {node: '>=10'}\n     cpu: [x64]\n     os: [linux]\n+    libc: [musl]\n \n   '@swc/core-win32-arm64-msvc@1.15.4':\n     resolution: {integrity: sha512-VcPuUJw27YbGo1HcOaAriI50dpM3ZZeDW3x2cMnJW6vtkeyzUFk1TADmTwFax0Fn+yicCxhaWjnFE3eAzGAxIQ==}\n@@ -1415,41 +1435,49 @@ packages:\n     resolution: {integrity: sha512-34gw7PjDGB9JgePJEmhEqBhWvCiiWCuXsL9hYphDF7crW7UgI05gyBAi6MF58uGcMOiOqSJ2ybEeCvHcq0BCmQ==}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-arm64-musl@1.11.1':\n     resolution: {integrity: sha512-RyMIx6Uf53hhOtJDIamSbTskA99sPHS96wxVE/bJtePJJtpdKGXO1wY90oRdXuYOGOTuqjT8ACccMc4K6QmT3w==}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [musl]\n \n   '@unrs/resolver-binding-linux-ppc64-gnu@1.11.1':\n     resolution: {integrity: sha512-D8Vae74A4/a+mZH0FbOkFJL9DSK2R6TFPC9M+jCWYia/q2einCubX10pecpDiTmkJVUH+y8K3BZClycD8nCShA==}\n     cpu: [ppc64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-riscv64-gnu@1.11.1':\n     resolution: {integrity: sha512-frxL4OrzOWVVsOc96+V3aqTIQl1O2TjgExV4EKgRY09AJ9leZpEg8Ak9phadbuX0BA4k8U5qtvMSQQGGmaJqcQ==}\n     cpu: [riscv64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-riscv64-musl@1.11.1':\n     resolution: {integrity: sha512-mJ5vuDaIZ+l/acv01sHoXfpnyrNKOk/3aDoEdLO/Xtn9HuZlDD6jKxHlkN8ZhWyLJsRBxfv9GYM2utQ1SChKew==}\n     cpu: [riscv64]\n     os: [linux]\n+    libc: [musl]\n \n   '@unrs/resolver-binding-linux-s390x-gnu@1.11.1':\n     resolution: {integrity: sha512-kELo8ebBVtb9sA7rMe1Cph4QHreByhaZ2QEADd9NzIQsYNQpt9UkM9iqr2lhGr5afh885d/cB5QeTXSbZHTYPg==}\n     cpu: [s390x]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-x64-gnu@1.11.1':\n     resolution: {integrity: sha512-C3ZAHugKgovV5YvAMsxhq0gtXuwESUKc5MhEtjBpLoHPLYM+iuwSj3lflFwK3DPm68660rZ7G8BMcwSro7hD5w==}\n     cpu: [x64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-x64-musl@1.11.1':\n     resolution: {integrity: sha512-rV0YSoyhK2nZ4vEswT/QwqzqQXw5I6CjoaYMOX0TqBlWhojUf8P94mvI7nuJTeaCkkds3QE4+zS8Ko+GdXuZtA==}\n     cpu: [x64]\n     os: [linux]\n+    libc: [musl]\n \n   '@unrs/resolver-binding-wasm32-wasi@1.11.1':\n     resolution: {integrity: sha512-5u4RkfxJm+Ng7IWgkzi3qrFOvLvQYnPBmjmZQ8+szTK/b31fQCnleNl1GgEt7nIsZRIf5PLhPwT0WM+q45x/UQ==}\n@@ -2009,14 +2037,14 @@ packages:\n     resolution: {integrity: sha512-rRqJg/6gd538VHvR3PSrdRBb/1Vy2YfzHqzvbhGIQpDRKIa4FgV/54b5Q1xYSxOOwKvjXweS26E0Q+nAMwp2pQ==}\n     engines: {node: '>=8.6'}\n \n-  entities@4.5.0:\n-    resolution: {integrity: sha512-V0hjH4dGPh9Ao5p0MoRY6BVqtwCjhz6vI5LT8AJ55H+4g9/4vbHx1I54fS0XuclLhDHArPQCiMjDxjaL8fPxhw==}\n-    engines: {node: '>=0.12'}\n-\n   entities@6.0.1:\n     resolution: {integrity: sha512-aN97NXWF6AWBTahfVOIrB/NShkzi5H7F9r1s9mD3cDj4Ko5f2qhhVoYMibXF7GlLveb/D2ioWay8lxI97Ven3g==}\n     engines: {node: '>=0.12'}\n \n+  entities@7.0.0:\n+    resolution: {integrity: sha512-FDWG5cmEYf2Z00IkYRhbFrwIwvdFKH07uV8dvNy0omp/Qb1xcyCWp2UDtcwJF4QZZvk0sLudP6/hAu42TaqVhQ==}\n+    engines: {node: '>=0.12'}\n+\n   env-paths@2.2.1:\n     resolution: {integrity: sha512-+h1lkLKhZMTYjog1VEpJNG7NZJWcuc2DDk/qsqSTRRCOXiLjeQ1d1/udrUGhqMxUgAlwKNZ0cf2uqan5GLuS2A==}\n     engines: {node: '>=6'}\n@@ -4964,10 +4992,10 @@ snapshots:\n       ansi-colors: 4.1.3\n       strip-ansi: 6.0.1\n \n-  entities@4.5.0: {}\n-\n   entities@6.0.1: {}\n \n+  entities@7.0.0: {}\n+\n   env-paths@2.2.1: {}\n \n   environment@1.1.0: {}\ndiff --git a/rollup.config.js b/rollup.config.js\nindex 8f1f85b..c591781 100644\n--- a/rollup.config.js\n+++ b/rollup.config.js\n@@ -259,7 +259,7 @@ function createConfig(format, output, plugins = []) {\n       'source-map-js',\n       '@babel/parser',\n       'estree-walker',\n-      'entities/lib/decode.js',\n+      'entities/decode',\n     ]\n \n     if (isGlobalBuild || isBrowserESMBuild || isCompatPackage) {"}, {"role": "assistant", "content": "build(deps): update entities to v7.0.0"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/zh-hant/llm-prompt.md | 54 ++++++++++++++++++++++++++++++++++++++++++++++\n 1 file changed, 54 insertions(+)\n\ndiff --git a/docs/zh-hant/llm-prompt.md b/docs/zh-hant/llm-prompt.md\nnew file mode 100644\nindex 0000000..0435011\n--- /dev/null\n+++ b/docs/zh-hant/llm-prompt.md\n@@ -0,0 +1,54 @@\n+### Target language\n+\n+Translate to Traditional Chinese (\u7e41\u9ad4\u4e2d\u6587).\n+\n+Language code: zh-hant.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Traditional Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using \u201c\u4f60/\u4f60\u7684\u201d).\n+\n+### Headings\n+\n+1) Follow existing Traditional Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Traditional Chinese docs (they often mix English terms like \u201cFastAPI\u201d with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+3) For more details, please follow the [Chinese Copywriting Guidelines](https://github.com/sparanoid/chinese-copywriting-guidelines).\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over `\u2026\u2026`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+1. Should avoid using simplified Chinese characters and terms. Always examine if the translation can be easily comprehended by the Traditional Chinese readers.\n+2. For some Python-specific terms like \"pickle\", \"list\", \"dict\" etc, we don't have to translate them.\n+3. Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): \u8acb\u6c42\n+- response (HTTP): \u56de\u61c9\n+- path operation: \u8def\u5f91\u64cd\u4f5c\n+- path operation function: \u8def\u5f91\u64cd\u4f5c\u51fd\u5f0f\n+\n+The translation can optionally include the original English text only in the first occurrence of each page (e.g. \"\u8def\u5f91\u64cd\u4f5c (path operation)\") if the translation is hard to be comprehended by most of the Chinese readers.\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) Many Traditional Chinese docs currently omit titles in `///` blocks; that is OK.\n+3) If a generic title is present, prefer these canonical titles:\n+\n+- `/// note | \u6ce8\u610f`\n+\n+Notes:\n+\n+- `details` blocks exist; keep `/// details` as-is and translate only the title after `|`.\n+- Example canonical titles used in existing docs:\n+  - `/// details | \u4e0a\u8ff0\u6307\u4ee4\u7684\u542b\u7fa9`\n+  - `/// details | \u95dc\u65bc `requirements.txt``"}, {"role": "assistant", "content": "docs: add traditional chinese translation guidelines"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n scripts/jest/setupTests.js | 7 +++++++\n 1 file changed, 7 insertions(+)\n\ndiff --git a/scripts/jest/setupTests.js b/scripts/jest/setupTests.js\nindex 1e8d8e5..758ac5e 100644\n--- a/scripts/jest/setupTests.js\n+++ b/scripts/jest/setupTests.js\n@@ -136,6 +136,13 @@ if (process.env.REACT_CLASS_EQUIVALENCE_TEST) {\n           }\n           return Reflect.set(target, key, value, receiver);\n         },\n+        get(target, key, receiver) {\n+          if (key === 'stack') {\n+            // https://github.com/nodejs/node/issues/60862\n+            return Reflect.get(target, key);\n+          }\n+          return Reflect.get(target, key, receiver);\n+        },\n       });\n       originalErrorInstances.set(proxy, error);\n       return proxy;"}, {"role": "assistant", "content": "fix(test): handle node proxy stack property issue"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 5090a9e..08bc292 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -19,6 +19,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udc1b Fix translation script path. PR [#14685](https://github.com/fastapi/fastapi/pull/14685) by [@tiangolo](https://github.com/tiangolo).\n * \u2705 Enable tests in CI for scripts. PR [#14684](https://github.com/fastapi/fastapi/pull/14684) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd27 Add pre-commit local script to fix language translations. PR [#14683](https://github.com/fastapi/fastapi/pull/14683) by [@tiangolo](https://github.com/tiangolo).\n * \u2b06\ufe0f  Migrate to uv. PR [#14676](https://github.com/fastapi/fastapi/pull/14676) by [@DoctorJohn](https://github.com/DoctorJohn)."}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n INSTALL.md | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)"}, {"role": "assistant", "content": "docs: fix typo in install guide"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/compile/internal/inline/inl.go         |  3 ++\n src/cmd/compile/testdata/script/issue77033.txt | 40 ++++++++++++++++++++++++++\n 2 files changed, 43 insertions(+)\n\ndiff --git a/src/cmd/compile/internal/inline/inl.go b/src/cmd/compile/internal/inline/inl.go\nindex 33f9c325..4fa9cf07 100644\n--- a/src/cmd/compile/internal/inline/inl.go\n+++ b/src/cmd/compile/internal/inline/inl.go\n@@ -516,6 +516,9 @@ opSwitch:\n \t\t\t\t\t\tbreak opSwitch\n \t\t\t\t\tcase \"panicrangestate\":\n \t\t\t\t\t\tcheap = true\n+\t\t\t\t\tcase \"deferrangefunc\":\n+\t\t\t\t\t\tv.reason = \"defer call in range func\"\n+\t\t\t\t\t\treturn true\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\ndiff --git a/src/cmd/compile/testdata/script/issue77033.txt b/src/cmd/compile/testdata/script/issue77033.txt\nnew file mode 100644\nindex 00000000..3b977e54\n--- /dev/null\n+++ b/src/cmd/compile/testdata/script/issue77033.txt\n@@ -0,0 +1,40 @@\n+go test -bench=Foo -cpuprofile=default.pgo\n+go test -bench=Foo -pgo=default.pgo\n+! stdout 'FAIL'\n+\n+-- main_test.go --\n+package main\n+\n+import (\n+\t\"testing\"\n+)\n+\n+var a int\n+\n+func save(x int) {\n+\ta = x\n+}\n+\n+func foo() {\n+\tfor i := range yield1 {\n+\t\tdefer save(i)\n+\t}\n+}\n+\n+func yield1(yield func(int) bool) {\n+\tyield(1)\n+}\n+\n+func BenchmarkFoo(b *testing.B) {\n+\tfor i := 0; i < b.N; i++ {\n+\t\tfoo()\n+\t}\n+\tif a != 1 {\n+\t\tb.Fatalf(\"a = %d; want 1\", a)\n+\t}\n+}\n+\n+-- go.mod --\n+module demo\n+\n+go 1.24"}, {"role": "assistant", "content": "fix(compile): prevent inlining defer in range func"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_codegen_llvm/src/attributes.rs      | 11 +-------\n library/alloc/src/slice.rs                         |  8 +++---\n library/alloc/src/vec/mod.rs                       |  6 +----\n .../lib-optimizations/append-elements.rs           | 30 ----------------------\n tests/rustdoc-gui/utils.goml                       | 30 +++++++++++++++++-----\n 5 files changed, 29 insertions(+), 56 deletions(-)"}, {"role": "assistant", "content": "refactor: remove unused code and improve test utils"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../__tests__/components/Suspense.spec.ts          | 95 ++++++++++++++++++++++\n packages/runtime-core/src/renderer.ts              | 18 +++-\n 2 files changed, 111 insertions(+), 2 deletions(-)\n\ndiff --git a/packages/runtime-core/__tests__/components/Suspense.spec.ts b/packages/runtime-core/__tests__/components/Suspense.spec.ts\nindex 4e8da32..0567587 100644\n--- a/packages/runtime-core/__tests__/components/Suspense.spec.ts\n+++ b/packages/runtime-core/__tests__/components/Suspense.spec.ts\n@@ -2360,6 +2360,101 @@ describe('Suspense', () => {\n       )\n     })\n \n+    // #14173\n+    test('nested async components with v-for + only Suspense and async component wrappers', async () => {\n+      const CompAsyncSetup = defineAsyncComponent({\n+        props: ['item', 'id'],\n+        render(ctx: any) {\n+          return h('div', ctx.id + '-' + ctx.item.name)\n+        },\n+      })\n+      const items = ref([\n+        { id: 1, name: 'a' },\n+        { id: 2, name: 'b' },\n+        { id: 3, name: 'c' },\n+      ])\n+      const Comp = {\n+        props: ['id'],\n+        setup(props: any) {\n+          return () =>\n+            h(Suspense, null, {\n+              default: () =>\n+                h(\n+                  Fragment,\n+                  null,\n+                  items.value.map(item =>\n+                    h(CompAsyncSetup, {\n+                      item,\n+                      key: item.id,\n+                      id: props.id,\n+                    }),\n+                  ),\n+                ),\n+            })\n+        },\n+      }\n+\n+      const CompAsyncWrapper = defineAsyncComponent({\n+        props: ['id'],\n+        render(ctx: any) {\n+          return h(Comp, { id: ctx.id })\n+        },\n+      })\n+      const CompWrapper = defineComponent({\n+        props: ['id'],\n+        render(ctx: any) {\n+          return h(CompAsyncWrapper, { id: ctx.id })\n+        },\n+      })\n+      const list = ref([{ id: 1 }, { id: 2 }, { id: 3 }])\n+\n+      const App = {\n+        setup() {\n+          return () =>\n+            h(Suspense, null, {\n+              default: () =>\n+                h(\n+                  Fragment,\n+                  null,\n+                  list.value.map(item =>\n+                    h(CompWrapper, { id: item.id, key: item.id }),\n+                  ),\n+                ),\n+            })\n+        },\n+      }\n+\n+      const root = nodeOps.createElement('div')\n+      render(h(App), root)\n+      await nextTick()\n+      await Promise.all(deps)\n+      await Promise.all(deps)\n+\n+      expect(serializeInner(root)).toBe(\n+        `<div>1-a</div><div>1-b</div><div>1-c</div><div>2-a</div><div>2-b</div><div>2-c</div><div>3-a</div><div>3-b</div><div>3-c</div>`,\n+      )\n+\n+      list.value = [{ id: 4 }, { id: 5 }, { id: 6 }]\n+      await nextTick()\n+      await Promise.all(deps)\n+      await Promise.all(deps)\n+      expect(serializeInner(root)).toBe(\n+        `<div>4-a</div><div>4-b</div><div>4-c</div><div>5-a</div><div>5-b</div><div>5-c</div><div>6-a</div><div>6-b</div><div>6-c</div>`,\n+      )\n+\n+      items.value = [\n+        { id: 4, name: 'd' },\n+        { id: 5, name: 'f' },\n+        { id: 6, name: 'g' },\n+      ]\n+      await nextTick()\n+      await Promise.all(deps)\n+      await Promise.all(deps)\n+      expect(serializeInner(root)).toBe(\n+        `<div>4-d</div><div>4-f</div><div>4-g</div><div>5-d</div><div>5-f</div><div>5-g</div><div>6-d</div><div>6-f</div><div>6-g</div>`,\n+      )\n+    })\n+\n     test('should call unmounted directive once when fallback is replaced by resolved async component', async () => {\n       const Comp = {\n         render() {\ndiff --git a/packages/runtime-core/src/renderer.ts b/packages/runtime-core/src/renderer.ts\nindex 192bb44..5aa1289 100644\n--- a/packages/runtime-core/src/renderer.ts\n+++ b/packages/runtime-core/src/renderer.ts\n@@ -1995,8 +1995,8 @@ function baseCreateRenderer(\n         const anchorVNode = c2[nextIndex + 1] as VNode\n         const anchor =\n           nextIndex + 1 < l2\n-            ? // #13559, fallback to el placeholder for unresolved async component\n-              anchorVNode.el || anchorVNode.placeholder\n+            ? // #13559, #14173 fallback to el placeholder for unresolved async component\n+              anchorVNode.el || resolveAsyncComponentPlaceholder(anchorVNode)\n             : parentAnchor\n         if (newIndexToOldIndexMap[i] === 0) {\n           // mount new\n@@ -2577,3 +2577,17 @@ export function invalidateMount(hooks: LifecycleHook): void {\n       hooks[i].flags! |= SchedulerJobFlags.DISPOSED\n   }\n }\n+\n+function resolveAsyncComponentPlaceholder(anchorVnode: VNode) {\n+  if (anchorVnode.placeholder) {\n+    return anchorVnode.placeholder\n+  }\n+\n+  // anchor vnode maybe is a wrapper component has single unresolved async component\n+  const instance = anchorVnode.component\n+  if (instance) {\n+    return resolveAsyncComponentPlaceholder(instance.subTree)\n+  }\n+\n+  return null\n+}"}, {"role": "assistant", "content": "fix(runtime-core): resolve nested async component placeholders in v-for"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n CHANGELOG.md                          | 21 +++++++++++++++++++++\n package.json                          |  2 +-\n packages/compiler-core/package.json   |  2 +-\n packages/compiler-dom/package.json    |  2 +-\n packages/compiler-sfc/package.json    |  2 +-\n packages/compiler-ssr/package.json    |  2 +-\n packages/reactivity/package.json      |  2 +-\n packages/runtime-core/package.json    |  2 +-\n packages/runtime-dom/package.json     |  2 +-\n packages/server-renderer/package.json |  2 +-\n packages/shared/package.json          |  2 +-\n packages/vue-compat/package.json      |  2 +-\n packages/vue/package.json             |  2 +-\n 13 files changed, 33 insertions(+), 12 deletions(-)\n\ndiff --git a/CHANGELOG.md b/CHANGELOG.md\nindex 813a2ae..edb9534 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -1,3 +1,24 @@\n+## [3.5.23](https://github.com/vuejs/core/compare/v3.5.22...v3.5.23) (2025-11-06)\n+\n+\n+### Bug Fixes\n+\n+* **compiler-core:** correctly handle ts type assertions in expressions ([#13397](https://github.com/vuejs/core/issues/13397)) ([e6544ac](https://github.com/vuejs/core/commit/e6544ac292b5b473274f87cdb83ebeac3e7e61a4)), closes [#13395](https://github.com/vuejs/core/issues/13395)\n+* **compiler-core:** fix v-bind shorthand handling for in-DOM templates ([#13933](https://github.com/vuejs/core/issues/13933)) ([b3cca26](https://github.com/vuejs/core/commit/b3cca2611c656b85f0c4e737b9ec248d2627dded)), closes [#13930](https://github.com/vuejs/core/issues/13930)\n+* **compiler-sfc:** resolve numeric literals and template literals without expressions as static property key ([#13998](https://github.com/vuejs/core/issues/13998)) ([75d44c7](https://github.com/vuejs/core/commit/75d44c718981f91843e197265cc68e82fe2532dd))\n+* **compiler-ssr:** textarea with v-text directive SSR ([#13975](https://github.com/vuejs/core/issues/13975)) ([006a0c1](https://github.com/vuejs/core/commit/006a0c1011a224bcbf21195c6df76812c3a7e757))\n+* **compiler:** using guard instead of non-nullish assertion ([#13982](https://github.com/vuejs/core/issues/13982)) ([dcc6f36](https://github.com/vuejs/core/commit/dcc6f362577ed86ccad31c2623c6cf75137dd27a))\n+* **custom-element:** batch custom element prop patching ([#13478](https://github.com/vuejs/core/issues/13478)) ([c13e674](https://github.com/vuejs/core/commit/c13e674fb9f92ab9339d28a862d18de460faf56e)), closes [#12619](https://github.com/vuejs/core/issues/12619)\n+* **custom-element:** optimize slot retrieval to avoid duplicates ([#13961](https://github.com/vuejs/core/issues/13961)) ([84ca349](https://github.com/vuejs/core/commit/84ca349fef73f6f55fc98299fcfa5c1eeef721db)), closes [#13955](https://github.com/vuejs/core/issues/13955)\n+* **hydration:** avoid mismatch during hydrate text with newlines in interpolation ([#9232](https://github.com/vuejs/core/issues/9232)) ([6cbdf78](https://github.com/vuejs/core/commit/6cbdf7823b0c961190bee5b7c117b7f2bbeb832f)), closes [#9229](https://github.com/vuejs/core/issues/9229)\n+* **runtime-core:** pass props and children to loadingComponent ([#13997](https://github.com/vuejs/core/issues/13997)) ([40c4b2a](https://github.com/vuejs/core/commit/40c4b2a876ce606973521dfc3024e26bfc10953a))\n+* **runtime-dom:** ensure iframe sandbox is handled as an attribute to prevent unintended behavior ([#13950](https://github.com/vuejs/core/issues/13950)) ([5689884](https://github.com/vuejs/core/commit/5689884c8e32cda6a802ac36b4d23218f67b38ed)), closes [#13946](https://github.com/vuejs/core/issues/13946)\n+* **suspense:** clear placeholder and fallback el after resolve to enable GC ([#13928](https://github.com/vuejs/core/issues/13928)) ([f411c66](https://github.com/vuejs/core/commit/f411c6604c12c531883aa0d30b81a7f69092f8a6))\n+* **transition-group:** use offsetLeft and offsetTop instead of getBoundingClientRect  to avoid transform scale affect animation ([#6108](https://github.com/vuejs/core/issues/6108)) ([dc4dd59](https://github.com/vuejs/core/commit/dc4dd594fbecce6ed7f44ffa69dc8b5d022287b6)), closes [#6105](https://github.com/vuejs/core/issues/6105)\n+* **v-model:** handle number modifier on change ([#13959](https://github.com/vuejs/core/issues/13959)) ([8fbe48f](https://github.com/vuejs/core/commit/8fbe48fe396d830999afd07f9413d899157d5f5e)), closes [#13958](https://github.com/vuejs/core/issues/13958)\n+\n+\n+\n ## [3.5.22](https://github.com/vuejs/core/compare/v3.5.21...v3.5.22) (2025-09-25)\n \n \ndiff --git a/package.json b/package.json\nindex a5d4e70..2263e58 100644\n--- a/package.json\n+++ b/package.json\n@@ -1,6 +1,6 @@\n {\n   \"private\": true,\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"packageManager\": \"pnpm@10.20.0\",\n   \"type\": \"module\",\n   \"scripts\": {\ndiff --git a/packages/compiler-core/package.json b/packages/compiler-core/package.json\nindex 50af152..67da3bc 100644\n--- a/packages/compiler-core/package.json\n+++ b/packages/compiler-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-core\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"@vue/compiler-core\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/compiler-core.esm-bundler.js\",\ndiff --git a/packages/compiler-dom/package.json b/packages/compiler-dom/package.json\nindex f22e8a4..e96077c 100644\n--- a/packages/compiler-dom/package.json\n+++ b/packages/compiler-dom/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-dom\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"@vue/compiler-dom\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/compiler-dom.esm-bundler.js\",\ndiff --git a/packages/compiler-sfc/package.json b/packages/compiler-sfc/package.json\nindex ee91652..4c20dda 100644\n--- a/packages/compiler-sfc/package.json\n+++ b/packages/compiler-sfc/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-sfc\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"@vue/compiler-sfc\",\n   \"main\": \"dist/compiler-sfc.cjs.js\",\n   \"module\": \"dist/compiler-sfc.esm-browser.js\",\ndiff --git a/packages/compiler-ssr/package.json b/packages/compiler-ssr/package.json\nindex c7815ea..0c41506 100644\n--- a/packages/compiler-ssr/package.json\n+++ b/packages/compiler-ssr/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-ssr\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"@vue/compiler-ssr\",\n   \"main\": \"dist/compiler-ssr.cjs.js\",\n   \"types\": \"dist/compiler-ssr.d.ts\",\ndiff --git a/packages/reactivity/package.json b/packages/reactivity/package.json\nindex 8449e3c..2307d36 100644\n--- a/packages/reactivity/package.json\n+++ b/packages/reactivity/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/reactivity\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"@vue/reactivity\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/reactivity.esm-bundler.js\",\ndiff --git a/packages/runtime-core/package.json b/packages/runtime-core/package.json\nindex 2a30ea1..5f5b101 100644\n--- a/packages/runtime-core/package.json\n+++ b/packages/runtime-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/runtime-core\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"@vue/runtime-core\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/runtime-core.esm-bundler.js\",\ndiff --git a/packages/runtime-dom/package.json b/packages/runtime-dom/package.json\nindex b8421dd..27f1bc6 100644\n--- a/packages/runtime-dom/package.json\n+++ b/packages/runtime-dom/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/runtime-dom\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"@vue/runtime-dom\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/runtime-dom.esm-bundler.js\",\ndiff --git a/packages/server-renderer/package.json b/packages/server-renderer/package.json\nindex f83f5ad..5f12901 100644\n--- a/packages/server-renderer/package.json\n+++ b/packages/server-renderer/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/server-renderer\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"@vue/server-renderer\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/server-renderer.esm-bundler.js\",\ndiff --git a/packages/shared/package.json b/packages/shared/package.json\nindex 8d2beb5..37de8f7 100644\n--- a/packages/shared/package.json\n+++ b/packages/shared/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/shared\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"internal utils shared across @vue packages\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/shared.esm-bundler.js\",\ndiff --git a/packages/vue-compat/package.json b/packages/vue-compat/package.json\nindex 6f12237..182a91c 100644\n--- a/packages/vue-compat/package.json\n+++ b/packages/vue-compat/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compat\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"Vue 3 compatibility build for Vue 2\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/vue.runtime.esm-bundler.js\",\ndiff --git a/packages/vue/package.json b/packages/vue/package.json\nindex 2c72c39..9a448f9 100644\n--- a/packages/vue/package.json\n+++ b/packages/vue/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"vue\",\n-  \"version\": \"3.5.22\",\n+  \"version\": \"3.5.23\",\n   \"description\": \"The progressive JavaScript framework for building modern web UI.\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/vue.runtime.esm-bundler.js\","}, {"role": "assistant", "content": "chore: release v3.5.23"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/go/internal/modindex/scan.go                 |  6 +++---\n src/cmd/go/testdata/script/list_empty_importpath.txt | 11 +----------\n 2 files changed, 4 insertions(+), 13 deletions(-)\n\ndiff --git a/src/cmd/go/internal/modindex/scan.go b/src/cmd/go/internal/modindex/scan.go\nindex af2c0abe..beded695 100644\n--- a/src/cmd/go/internal/modindex/scan.go\n+++ b/src/cmd/go/internal/modindex/scan.go\n@@ -112,10 +112,10 @@ func parseErrorToString(err error) string {\n \t\treturn \"\"\n \t}\n \tvar p parseError\n-\tif e, ok := err.(scanner.ErrorList); ok {\n-\t\tp.ErrorList = &e\n+\tif errlist, ok := err.(scanner.ErrorList); ok {\n+\t\tp.ErrorList = &errlist\n \t} else {\n-\t\tp.ErrorString = e.Error()\n+\t\tp.ErrorString = err.Error()\n \t}\n \ts, err := json.Marshal(p)\n \tif err != nil {\ndiff --git a/src/cmd/go/testdata/script/list_empty_importpath.txt b/src/cmd/go/testdata/script/list_empty_importpath.txt\nindex fe421032..0960a779 100644\n--- a/src/cmd/go/testdata/script/list_empty_importpath.txt\n+++ b/src/cmd/go/testdata/script/list_empty_importpath.txt\n@@ -1,15 +1,6 @@\n ! go list all\n ! stderr 'panic'\n-[!GOOS:windows] [!GOOS:solaris] [!GOOS:freebsd] [!GOOS:openbsd] [!GOOS:netbsd] stderr 'invalid import path'\n-# #73976: Allow 'no errors' on Windows, Solaris, and BSD until issue\n-# is resolved to prevent flakes. 'no errors' is printed by\n-# empty scanner.ErrorList errors so that's probably where the\n-# message is coming from, though we don't know how.\n-[GOOS:windows] stderr 'invalid import path|no errors'\n-[GOOS:solaris] stderr 'invalid import path|no errors'\n-[GOOS:freebsd] stderr 'invalid import path|no errors'\n-[GOOS:openbsd] stderr 'invalid import path|no errors'\n-[GOOS:netbsd] stderr 'invalid import path|no errors'\n+stderr 'invalid import path'\n \n # go list produces a package for 'p' but not for ''\n go list -e all"}, {"role": "assistant", "content": "fix(modindex): fix variable shadowing in parseErrorToString"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/react-debug-tools/src/ReactDebugHooks.js  |   6 +-\n .../__tests__/profilerChangeDescriptions-test.js   |   8 +-\n .../src/__tests__/profilingCache-test.js           | 249 ++++++++++++++++++++-\n .../src/backend/fiber/renderer.js                  |  95 +++-----\n 4 files changed, 290 insertions(+), 68 deletions(-)\n\ndiff --git a/packages/react-debug-tools/src/ReactDebugHooks.js b/packages/react-debug-tools/src/ReactDebugHooks.js\nindex db9495a..b4eb6c2 100644\n--- a/packages/react-debug-tools/src/ReactDebugHooks.js\n+++ b/packages/react-debug-tools/src/ReactDebugHooks.js\n@@ -467,9 +467,11 @@ function useSyncExternalStore<T>(\n   // useSyncExternalStore() composes multiple hooks internally.\n   // Advance the current hook index the same number of times\n   // so that subsequent hooks have the right memoized state.\n-  nextHook(); // SyncExternalStore\n+  const hook = nextHook(); // SyncExternalStore\n   nextHook(); // Effect\n-  const value = getSnapshot();\n+  // Read from hook.memoizedState to get the value that was used during render,\n+  // not the current value from getSnapshot() which may have changed.\n+  const value = hook !== null ? hook.memoizedState : getSnapshot();\n   hookLog.push({\n     displayName: null,\n     primitive: 'SyncExternalStore',\ndiff --git a/packages/react-devtools-shared/src/__tests__/profilerChangeDescriptions-test.js b/packages/react-devtools-shared/src/__tests__/profilerChangeDescriptions-test.js\nindex 87d8132..4710f5c 100644\n--- a/packages/react-devtools-shared/src/__tests__/profilerChangeDescriptions-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/profilerChangeDescriptions-test.js\n@@ -90,7 +90,7 @@ describe('Profiler change descriptions', () => {\n       {\n         \"context\": true,\n         \"didHooksChange\": false,\n-        \"hooks\": null,\n+        \"hooks\": [],\n         \"isFirstMount\": false,\n         \"props\": [],\n         \"state\": null,\n@@ -110,7 +110,7 @@ describe('Profiler change descriptions', () => {\n       {\n         \"context\": true,\n         \"didHooksChange\": false,\n-        \"hooks\": null,\n+        \"hooks\": [],\n         \"isFirstMount\": false,\n         \"props\": [],\n         \"state\": null,\n@@ -125,7 +125,7 @@ describe('Profiler change descriptions', () => {\n       {\n         \"context\": false,\n         \"didHooksChange\": false,\n-        \"hooks\": null,\n+        \"hooks\": [],\n         \"isFirstMount\": false,\n         \"props\": [],\n         \"state\": null,\n@@ -140,7 +140,7 @@ describe('Profiler change descriptions', () => {\n       {\n         \"context\": true,\n         \"didHooksChange\": false,\n-        \"hooks\": null,\n+        \"hooks\": [],\n         \"isFirstMount\": false,\n         \"props\": [],\n         \"state\": null,\ndiff --git a/packages/react-devtools-shared/src/__tests__/profilingCache-test.js b/packages/react-devtools-shared/src/__tests__/profilingCache-test.js\nindex 428b22d..c17a59c 100644\n--- a/packages/react-devtools-shared/src/__tests__/profilingCache-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/profilingCache-test.js\n@@ -378,6 +378,12 @@ describe('ProfilingCache', () => {\n       ),\n     );\n \n+    // Save references to the real dispatch/setState functions.\n+    // inspectHooks() re-runs the component with a mock dispatcher,\n+    // which would overwrite these variables with mock functions that do nothing.\n+    const realDispatch = dispatch;\n+    const realSetState = setState;\n+\n     // Second render has no changed hooks, only changed props.\n     utils.act(() =>\n       render(\n@@ -388,10 +394,10 @@ describe('ProfilingCache', () => {\n     );\n \n     // Third render has a changed reducer hook.\n-    utils.act(() => dispatch({type: 'invert'}));\n+    utils.act(() => realDispatch({type: 'invert'}));\n \n     // Fourth render has a changed state hook.\n-    utils.act(() => setState('def'));\n+    utils.act(() => realSetState('def'));\n \n     // Fifth render has a changed context value, but no changed hook.\n     utils.act(() =>\n@@ -521,6 +527,238 @@ describe('ProfilingCache', () => {\n     }\n   });\n \n+  // @reactVersion >= 19.0\n+  it('should detect what hooks changed in a render with custom and composite hooks', () => {\n+    let snapshot = 0;\n+    let syncExternalStoreCallback;\n+\n+    function subscribe(callback) {\n+      syncExternalStoreCallback = callback;\n+      return () => {};\n+    }\n+\n+    function getSnapshot() {\n+      return snapshot;\n+    }\n+\n+    // Custom hook wrapping multiple primitive hooks\n+    function useCustomHook() {\n+      const [value, setValue] = React.useState('custom');\n+      React.useEffect(() => {}, [value]);\n+      return [value, setValue];\n+    }\n+\n+    let setState = null;\n+    let startTransition = null;\n+    let actionStateDispatch = null;\n+    let setCustomValue = null;\n+    let setFinalState = null;\n+\n+    const Component = () => {\n+      // Hook 0: useState\n+      const [state, _setState] = React.useState('initial');\n+      setState = _setState;\n+\n+      // Hook 1: useSyncExternalStore (composite hook - internally uses multiple hooks)\n+      const storeValue = React.useSyncExternalStore(\n+        subscribe,\n+        getSnapshot,\n+        getSnapshot,\n+      );\n+\n+      // Hook 2: useTransition (composite hook - internally uses multiple hooks)\n+      const [isPending, _startTransition] = React.useTransition();\n+      startTransition = _startTransition;\n+\n+      // Hook 3: useActionState (composite hook - internally uses multiple hooks)\n+      const [actionState, _actionStateDispatch] = React.useActionState(\n+        (_prev, action) => action,\n+        'action-initial',\n+      );\n+      actionStateDispatch = _actionStateDispatch;\n+\n+      // Hook 4: useState inside custom hook (flattened)\n+      // Hook 5: useEffect inside custom hook (not stateful, won't show in changes)\n+      const [customValue, _setCustomValue] = useCustomHook();\n+      setCustomValue = _setCustomValue;\n+\n+      // Hook 6: direct useState at the end\n+      const [finalState, _setFinalState] = React.useState('final');\n+      setFinalState = _setFinalState;\n+\n+      return `${state}-${storeValue}-${isPending}-${actionState}-${customValue}-${finalState}`;\n+    };\n+\n+    utils.act(() => store.profilerStore.startProfiling());\n+    utils.act(() => render(<Component />));\n+\n+    // Save references before inspectHooks() overwrites them\n+    const realSetState = setState;\n+    const realStartTransition = startTransition;\n+    const realActionStateDispatch = actionStateDispatch;\n+    const realSetCustomValue = setCustomValue;\n+    const realSetFinalState = setFinalState;\n+\n+    // 2nd render: change useState (hook 0)\n+    utils.act(() => realSetState('changed'));\n+\n+    // 3rd render: change useSyncExternalStore (hook 1)\n+    utils.act(() => {\n+      snapshot = 1;\n+      syncExternalStoreCallback();\n+    });\n+\n+    // 4th render: trigger useTransition (hook 2)\n+    // Note: useTransition triggers two renders - one when isPending becomes true,\n+    // and another when isPending becomes false after the transition completes\n+    utils.act(() => {\n+      realStartTransition(() => {});\n+    });\n+\n+    // 6th render: change useActionState (hook 3)\n+    utils.act(() => realActionStateDispatch('action-changed'));\n+\n+    // 7th render: change custom hook's useState (hook 4)\n+    utils.act(() => realSetCustomValue('custom-changed'));\n+\n+    // 8th render: change final useState (hook 6)\n+    utils.act(() => realSetFinalState('final-changed'));\n+\n+    utils.act(() => store.profilerStore.stopProfiling());\n+\n+    const rootID = store.roots[0];\n+\n+    const changeDescriptions = store.profilerStore\n+      .getDataForRoot(rootID)\n+      .commitData.map(commitData => commitData.changeDescriptions);\n+    expect(changeDescriptions).toHaveLength(8);\n+\n+    // 1st render: Initial mount\n+    expect(changeDescriptions[0]).toMatchInlineSnapshot(`\n+      Map {\n+        2 => {\n+          \"context\": null,\n+          \"didHooksChange\": false,\n+          \"isFirstMount\": true,\n+          \"props\": null,\n+          \"state\": null,\n+        },\n+      }\n+    `);\n+\n+    // 2nd render: Changed hook 0 (useState)\n+    expect(changeDescriptions[1]).toMatchInlineSnapshot(`\n+      Map {\n+        2 => {\n+          \"context\": false,\n+          \"didHooksChange\": true,\n+          \"hooks\": [\n+            0,\n+          ],\n+          \"isFirstMount\": false,\n+          \"props\": [],\n+          \"state\": null,\n+        },\n+      }\n+    `);\n+\n+    // 3rd render: Changed hook 1 (useSyncExternalStore)\n+    expect(changeDescriptions[2]).toMatchInlineSnapshot(`\n+      Map {\n+        2 => {\n+          \"context\": false,\n+          \"didHooksChange\": true,\n+          \"hooks\": [\n+            1,\n+          ],\n+          \"isFirstMount\": false,\n+          \"props\": [],\n+          \"state\": null,\n+        },\n+      }\n+    `);\n+\n+    // 4th render: Changed hook 2 (useTransition - isPending becomes true)\n+    expect(changeDescriptions[3]).toMatchInlineSnapshot(`\n+      Map {\n+        2 => {\n+          \"context\": false,\n+          \"didHooksChange\": true,\n+          \"hooks\": [\n+            2,\n+          ],\n+          \"isFirstMount\": false,\n+          \"props\": [],\n+          \"state\": null,\n+        },\n+      }\n+    `);\n+\n+    // 5th render: Changed hook 2 (useTransition - isPending becomes false)\n+    expect(changeDescriptions[4]).toMatchInlineSnapshot(`\n+      Map {\n+        2 => {\n+          \"context\": false,\n+          \"didHooksChange\": true,\n+          \"hooks\": [\n+            2,\n+          ],\n+          \"isFirstMount\": false,\n+          \"props\": [],\n+          \"state\": null,\n+        },\n+      }\n+    `);\n+\n+    // 6th render: Changed hook 3 (useActionState)\n+    expect(changeDescriptions[5]).toMatchInlineSnapshot(`\n+      Map {\n+        2 => {\n+          \"context\": false,\n+          \"didHooksChange\": true,\n+          \"hooks\": [\n+            3,\n+          ],\n+          \"isFirstMount\": false,\n+          \"props\": [],\n+          \"state\": null,\n+        },\n+      }\n+    `);\n+\n+    // 7th render: Changed hook 4 (useState inside useCustomHook)\n+    expect(changeDescriptions[6]).toMatchInlineSnapshot(`\n+      Map {\n+        2 => {\n+          \"context\": false,\n+          \"didHooksChange\": true,\n+          \"hooks\": [\n+            4,\n+          ],\n+          \"isFirstMount\": false,\n+          \"props\": [],\n+          \"state\": null,\n+        },\n+      }\n+    `);\n+\n+    // 8th render: Changed hook 6 (final useState)\n+    expect(changeDescriptions[7]).toMatchInlineSnapshot(`\n+      Map {\n+        2 => {\n+          \"context\": false,\n+          \"didHooksChange\": true,\n+          \"hooks\": [\n+            6,\n+          ],\n+          \"isFirstMount\": false,\n+          \"props\": [],\n+          \"state\": null,\n+        },\n+      }\n+    `);\n+  });\n+\n   // @reactVersion >= 19.0\n   it('should detect context changes or lack of changes with conditional use()', () => {\n     const ContextA = React.createContext(0);\n@@ -553,6 +791,11 @@ describe('ProfilingCache', () => {\n       ),\n     );\n \n+    // Save reference to the real setState function before profiling starts.\n+    // inspectHooks() re-runs the component with a mock dispatcher,\n+    // which would overwrite setState with a mock function that does nothing.\n+    const realSetState = setState;\n+\n     utils.act(() => store.profilerStore.startProfiling());\n \n     // First render changes Context.\n@@ -567,7 +810,7 @@ describe('ProfilingCache', () => {\n     );\n \n     // Second render has no changed Context, only changed state.\n-    utils.act(() => setState('def'));\n+    utils.act(() => realSetState('def'));\n \n     utils.act(() => store.profilerStore.stopProfiling());\n \ndiff --git a/packages/react-devtools-shared/src/backend/fiber/renderer.js b/packages/react-devtools-shared/src/backend/fiber/renderer.js\nindex 6848e32..892a3c6 100644\n--- a/packages/react-devtools-shared/src/backend/fiber/renderer.js\n+++ b/packages/react-devtools-shared/src/backend/fiber/renderer.js\n@@ -18,7 +18,7 @@ import type {\n   Wakeable,\n } from 'shared/ReactTypes';\n \n-import type {HooksTree} from 'react-debug-tools/src/ReactDebugHooks';\n+import type {HooksNode, HooksTree} from 'react-debug-tools/src/ReactDebugHooks';\n \n import {\n   ComponentFilterDisplayName,\n@@ -127,7 +127,6 @@ import {enableStyleXFeatures} from 'react-devtools-feature-flags';\n import {componentInfoToComponentLogsMap} from '../shared/DevToolsServerComponentLogs';\n \n import is from 'shared/objectIs';\n-import hasOwnProperty from 'shared/hasOwnProperty';\n \n import {getIODescription} from 'shared/ReactIODescription';\n \n@@ -1976,10 +1975,9 @@ export function attach(\n             state: null,\n           };\n         } else {\n-          const indices = getChangedHooksIndices(\n-            prevFiber.memoizedState,\n-            nextFiber.memoizedState,\n-          );\n+          const prevHooks = inspectHooks(prevFiber);\n+          const nextHooks = inspectHooks(nextFiber);\n+          const indices = getChangedHooksIndices(prevHooks, nextHooks);\n           const data: ChangeDescription = {\n             context: getContextChanged(prevFiber, nextFiber),\n             didHooksChange: indices !== null && indices.length > 0,\n@@ -2028,74 +2026,53 @@ export function attach(\n     return false;\n   }\n \n-  function isUseSyncExternalStoreHook(hookObject: any): boolean {\n-    const queue = hookObject.queue;\n-    if (!queue) {\n-      return false;\n-    }\n-\n-    const boundHasOwnProperty = hasOwnProperty.bind(queue);\n-    return (\n-      boundHasOwnProperty('value') &&\n-      boundHasOwnProperty('getSnapshot') &&\n-      typeof queue.getSnapshot === 'function'\n-    );\n-  }\n-\n-  function isHookThatCanScheduleUpdate(hookObject: any) {\n-    const queue = hookObject.queue;\n-    if (!queue) {\n-      return false;\n-    }\n-\n-    const boundHasOwnProperty = hasOwnProperty.bind(queue);\n-\n-    // Detect the shape of useState() / useReducer() / useTransition()\n-    // using the attributes that are unique to these hooks\n-    // but also stable (e.g. not tied to current Lanes implementation)\n-    // We don't check for dispatch property, because useTransition doesn't have it\n-    if (boundHasOwnProperty('pending')) {\n-      return true;\n-    }\n-\n-    return isUseSyncExternalStoreHook(hookObject);\n-  }\n-\n-  function didStatefulHookChange(prev: any, next: any): boolean {\n-    const prevMemoizedState = prev.memoizedState;\n-    const nextMemoizedState = next.memoizedState;\n+  function didStatefulHookChange(prev: HooksNode, next: HooksNode): boolean {\n+    // Detect the shape of useState() / useReducer() / useTransition() / useSyncExternalStore() / useActionState()\n+    const isStatefulHook =\n+      prev.isStateEditable === true ||\n+      prev.name === 'SyncExternalStore' ||\n+      prev.name === 'Transition' ||\n+      prev.name === 'ActionState' ||\n+      prev.name === 'FormState';\n \n-    if (isHookThatCanScheduleUpdate(prev)) {\n-      return prevMemoizedState !== nextMemoizedState;\n+    // Compare the values to see if they changed\n+    if (isStatefulHook) {\n+      return prev.value !== next.value;\n     }\n \n     return false;\n   }\n \n-  function getChangedHooksIndices(prev: any, next: any): null | Array<number> {\n-    if (prev == null || next == null) {\n+  function getChangedHooksIndices(\n+    prevHooks: HooksTree | null,\n+    nextHooks: HooksTree | null,\n+  ): null | Array<number> {\n+    if (prevHooks == null || nextHooks == null) {\n       return null;\n     }\n \n-    const indices = [];\n+    const indices: Array<number> = [];\n     let index = 0;\n \n-    while (next !== null) {\n-      if (didStatefulHookChange(prev, next)) {\n-        indices.push(index);\n-      }\n+    function traverse(prevTree: HooksTree, nextTree: HooksTree): void {\n+      for (let i = 0; i < prevTree.length; i++) {\n+        const prevHook = prevTree[i];\n+        const nextHook = nextTree[i];\n \n-      // useSyncExternalStore creates 2 internal hooks, but we only count it as 1 user-facing hook\n-      if (isUseSyncExternalStoreHook(next)) {\n-        next = next.next;\n-        prev = prev.next;\n-      }\n+        if (prevHook.subHooks.length > 0 && nextHook.subHooks.length > 0) {\n+          traverse(prevHook.subHooks, nextHook.subHooks);\n+          continue;\n+        }\n \n-      next = next.next;\n-      prev = prev.next;\n-      index++;\n+        if (didStatefulHookChange(prevHook, nextHook)) {\n+          indices.push(index);\n+        }\n+\n+        index++;\n+      }\n     }\n \n+    traverse(prevHooks, nextHooks);\n     return indices;\n   }\n "}, {"role": "assistant", "content": "fix(devtools): improve hook change detection for composite hooks"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/crypto/tls/common.go                 |   7 ++-\n src/crypto/tls/handshake_server.go       |   9 ++-\n src/crypto/tls/handshake_server_test.go  | 101 +++++++++++++++++++++++++++++++\n src/crypto/tls/handshake_server_tls13.go |  10 ++-\n src/crypto/tls/tls_test.go               |  11 +++-\n 5 files changed, 132 insertions(+), 6 deletions(-)\n\ndiff --git a/src/crypto/tls/common.go b/src/crypto/tls/common.go\nindex 099a11ca..093869ac 100644\n--- a/src/crypto/tls/common.go\n+++ b/src/crypto/tls/common.go\n@@ -980,6 +980,10 @@ const maxSessionTicketLifetime = 7 * 24 * time.Hour\n \n // Clone returns a shallow clone of c or nil if c is nil. It is safe to clone a [Config] that is\n // being used concurrently by a TLS client or server.\n+//\n+// If Config.SessionTicketKey is unpopulated, and Config.SetSessionTicketKeys has not been\n+// called, the clone will not share the same auto-rotated session ticket keys as the original\n+// Config in order to prevent sessions from being resumed across Configs.\n func (c *Config) Clone() *Config {\n \tif c == nil {\n \t\treturn nil\n@@ -1020,7 +1024,8 @@ func (c *Config) Clone() *Config {\n \t\tEncryptedClientHelloRejectionVerify: c.EncryptedClientHelloRejectionVerify,\n \t\tEncryptedClientHelloKeys:            c.EncryptedClientHelloKeys,\n \t\tsessionTicketKeys:                   c.sessionTicketKeys,\n-\t\tautoSessionTicketKeys:               c.autoSessionTicketKeys,\n+\t\t// We explicitly do not copy autoSessionTicketKeys, so that Configs do\n+\t\t// not share the same auto-rotated keys.\n \t}\n }\n \ndiff --git a/src/crypto/tls/handshake_server.go b/src/crypto/tls/handshake_server.go\nindex efdaeae6..06675a8c 100644\n--- a/src/crypto/tls/handshake_server.go\n+++ b/src/crypto/tls/handshake_server.go\n@@ -520,8 +520,13 @@ func (hs *serverHandshakeState) checkForResumption() error {\n \tif sessionHasClientCerts && c.config.ClientAuth == NoClientCert {\n \t\treturn nil\n \t}\n-\tif sessionHasClientCerts && c.config.time().After(sessionState.peerCertificates[0].NotAfter) {\n-\t\treturn nil\n+\tif sessionHasClientCerts {\n+\t\tnow := c.config.time()\n+\t\tfor _, c := range sessionState.peerCertificates {\n+\t\t\tif now.After(c.NotAfter) {\n+\t\t\t\treturn nil\n+\t\t\t}\n+\t\t}\n \t}\n \tif sessionHasClientCerts && c.config.ClientAuth >= VerifyClientCertIfGiven &&\n \t\tlen(sessionState.verifiedChains) == 0 {\ndiff --git a/src/crypto/tls/handshake_server_test.go b/src/crypto/tls/handshake_server_test.go\nindex 7e35c252..41ae8705 100644\n--- a/src/crypto/tls/handshake_server_test.go\n+++ b/src/crypto/tls/handshake_server_test.go\n@@ -13,6 +13,7 @@ import (\n \t\"crypto/rand\"\n \t\"crypto/tls/internal/fips140tls\"\n \t\"crypto/x509\"\n+\t\"crypto/x509/pkix\"\n \t\"encoding/pem\"\n \t\"errors\"\n \t\"fmt\"\n@@ -2153,3 +2154,103 @@ func TestHandshakeContextHierarchy(t *testing.T) {\n \t\tt.Errorf(\"Unexpected client error: %v\", err)\n \t}\n }\n+\n+func TestHandshakeChainExpiryResumptionTLS12(t *testing.T) {\n+\tt.Run(\"TLS1.2\", func(t *testing.T) {\n+\t\ttestHandshakeChainExpiryResumption(t, VersionTLS12)\n+\t})\n+\tt.Run(\"TLS1.3\", func(t *testing.T) {\n+\t\ttestHandshakeChainExpiryResumption(t, VersionTLS13)\n+\t})\n+}\n+\n+func testHandshakeChainExpiryResumption(t *testing.T, version uint16) {\n+\tnow := time.Now()\n+\tcreateChain := func(leafNotAfter, rootNotAfter time.Time) (certDER []byte, root *x509.Certificate) {\n+\t\ttmpl := &x509.Certificate{\n+\t\t\tSubject:               pkix.Name{CommonName: \"root\"},\n+\t\t\tNotBefore:             rootNotAfter.Add(-time.Hour * 24),\n+\t\t\tNotAfter:              rootNotAfter,\n+\t\t\tIsCA:                  true,\n+\t\t\tBasicConstraintsValid: true,\n+\t\t}\n+\t\trootDER, err := x509.CreateCertificate(rand.Reader, tmpl, tmpl, &testECDSAPrivateKey.PublicKey, testECDSAPrivateKey)\n+\t\tif err != nil {\n+\t\t\tt.Fatalf(\"CreateCertificate: %v\", err)\n+\t\t}\n+\t\troot, err = x509.ParseCertificate(rootDER)\n+\t\tif err != nil {\n+\t\t\tt.Fatalf(\"ParseCertificate: %v\", err)\n+\t\t}\n+\n+\t\ttmpl = &x509.Certificate{\n+\t\t\tSubject:   pkix.Name{},\n+\t\t\tDNSNames:  []string{\"expired-resume.example.com\"},\n+\t\t\tNotBefore: leafNotAfter.Add(-time.Hour * 24),\n+\t\t\tNotAfter:  leafNotAfter,\n+\t\t\tKeyUsage:  x509.KeyUsageDigitalSignature,\n+\t\t}\n+\t\tcertDER, err = x509.CreateCertificate(rand.Reader, tmpl, root, &testECDSAPrivateKey.PublicKey, testECDSAPrivateKey)\n+\t\tif err != nil {\n+\t\t\tt.Fatalf(\"CreateCertificate: %v\", err)\n+\t\t}\n+\n+\t\treturn certDER, root\n+\t}\n+\n+\tinitialLeafDER, initialRoot := createChain(now.Add(time.Hour), now.Add(2*time.Hour))\n+\n+\tserverConfig := testConfig.Clone()\n+\tserverConfig.MaxVersion = version\n+\tserverConfig.Certificates = []Certificate{{\n+\t\tCertificate: [][]byte{initialLeafDER},\n+\t\tPrivateKey:  testECDSAPrivateKey,\n+\t}}\n+\tserverConfig.ClientCAs = x509.NewCertPool()\n+\tserverConfig.ClientCAs.AddCert(initialRoot)\n+\tserverConfig.ClientAuth = RequireAndVerifyClientCert\n+\tserverConfig.Time = func() time.Time {\n+\t\treturn now\n+\t}\n+\n+\tclientConfig := testConfig.Clone()\n+\tclientConfig.MaxVersion = version\n+\tclientConfig.Certificates = []Certificate{{\n+\t\tCertificate: [][]byte{initialLeafDER},\n+\t\tPrivateKey:  testECDSAPrivateKey,\n+\t}}\n+\tclientConfig.RootCAs = x509.NewCertPool()\n+\tclientConfig.RootCAs.AddCert(initialRoot)\n+\tclientConfig.ServerName = \"expired-resume.example.com\"\n+\tclientConfig.ClientSessionCache = NewLRUClientSessionCache(32)\n+\n+\ttestResume := func(t *testing.T, sc, cc *Config, expectResume bool) {\n+\t\tt.Helper()\n+\t\tss, cs, err := testHandshake(t, cc, sc)\n+\t\tif err != nil {\n+\t\t\tt.Fatalf(\"handshake: %v\", err)\n+\t\t}\n+\t\tif cs.DidResume != expectResume {\n+\t\t\tt.Fatalf(\"DidResume = %v; want %v\", cs.DidResume, expectResume)\n+\t\t}\n+\t\tif ss.DidResume != expectResume {\n+\t\t\tt.Fatalf(\"DidResume = %v; want %v\", cs.DidResume, expectResume)\n+\t\t}\n+\t}\n+\n+\ttestResume(t, serverConfig, clientConfig, false)\n+\ttestResume(t, serverConfig, clientConfig, true)\n+\n+\tfreshLeafDER, freshRoot := createChain(now.Add(2*time.Hour), now.Add(3*time.Hour))\n+\tclientConfig.Certificates = []Certificate{{\n+\t\tCertificate: [][]byte{freshLeafDER},\n+\t\tPrivateKey:  testECDSAPrivateKey,\n+\t}}\n+\tserverConfig.Time = func() time.Time {\n+\t\treturn now.Add(1*time.Hour + 30*time.Minute)\n+\t}\n+\tserverConfig.ClientCAs = x509.NewCertPool()\n+\tserverConfig.ClientCAs.AddCert(freshRoot)\n+\n+\ttestResume(t, serverConfig, clientConfig, false)\n+}\ndiff --git a/src/crypto/tls/handshake_server_tls13.go b/src/crypto/tls/handshake_server_tls13.go\nindex b066924e..0033164f 100644\n--- a/src/crypto/tls/handshake_server_tls13.go\n+++ b/src/crypto/tls/handshake_server_tls13.go\n@@ -314,6 +314,7 @@ func (hs *serverHandshakeStateTLS13) checkForResumption() error {\n \t\treturn nil\n \t}\n \n+pskIdentityLoop:\n \tfor i, identity := range hs.clientHello.pskIdentities {\n \t\tif i >= maxClientPSKIdentities {\n \t\t\tbreak\n@@ -366,8 +367,13 @@ func (hs *serverHandshakeStateTLS13) checkForResumption() error {\n \t\tif sessionHasClientCerts && c.config.ClientAuth == NoClientCert {\n \t\t\tcontinue\n \t\t}\n-\t\tif sessionHasClientCerts && c.config.time().After(sessionState.peerCertificates[0].NotAfter) {\n-\t\t\tcontinue\n+\t\tif sessionHasClientCerts {\n+\t\t\tnow := c.config.time()\n+\t\t\tfor _, c := range sessionState.peerCertificates {\n+\t\t\t\tif now.After(c.NotAfter) {\n+\t\t\t\t\tcontinue pskIdentityLoop\n+\t\t\t\t}\n+\t\t\t}\n \t\t}\n \t\tif sessionHasClientCerts && c.config.ClientAuth >= VerifyClientCertIfGiven &&\n \t\t\tlen(sessionState.verifiedChains) == 0 {\ndiff --git a/src/crypto/tls/tls_test.go b/src/crypto/tls/tls_test.go\nindex 39ebb9d2..48428e4c 100644\n--- a/src/crypto/tls/tls_test.go\n+++ b/src/crypto/tls/tls_test.go\n@@ -935,8 +935,8 @@ func TestCloneNonFuncFields(t *testing.T) {\n \t\t}\n \t}\n \t// Set the unexported fields related to session ticket keys, which are copied with Clone().\n-\tc1.autoSessionTicketKeys = []ticketKey{c1.ticketKeyFromBytes(c1.SessionTicketKey)}\n \tc1.sessionTicketKeys = []ticketKey{c1.ticketKeyFromBytes(c1.SessionTicketKey)}\n+\t// We explicitly don't copy autoSessionTicketKeys in Clone, so don't set it.\n \n \tc2 := c1.Clone()\n \tif !reflect.DeepEqual(&c1, c2) {\n@@ -2461,3 +2461,12 @@ func (s messageOnlySigner) SignMessage(rand io.Reader, msg []byte, opts crypto.S\n \tdigest := h.Sum(nil)\n \treturn s.Signer.Sign(rand, digest, opts)\n }\n+\n+func TestConfigCloneAutoSessionTicketKeys(t *testing.T) {\n+\torig := &Config{}\n+\torig.ticketKeys(nil)\n+\tclone := orig.Clone()\n+\tif slices.Equal(orig.autoSessionTicketKeys, clone.autoSessionTicketKeys) {\n+\t\tt.Fatal(\"autoSessionTicketKeys slice copied in Clone\")\n+\t}\n+}"}, {"role": "assistant", "content": "fix(tls): check all chain certs for expiry on session resumption"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/fastapi-people.md   |  22 +------\n docs/en/docs/management-tasks.md | 126 ++-------------------------------------\n 2 files changed, 7 insertions(+), 141 deletions(-)\n\ndiff --git a/docs/en/docs/fastapi-people.md b/docs/en/docs/fastapi-people.md\nindex f2ca260..2c07af7 100644\n--- a/docs/en/docs/fastapi-people.md\n+++ b/docs/en/docs/fastapi-people.md\n@@ -196,31 +196,11 @@ They have contributed source code, documentation, etc. \ud83d\udce6\n \n There are hundreds of other contributors, you can see them all in the <a href=\"https://github.com/fastapi/fastapi/graphs/contributors\" class=\"external-link\" target=\"_blank\">FastAPI GitHub Contributors page</a>. \ud83d\udc77\n \n-## Top Translators\n-\n-These are the **Top Translators**. \ud83c\udf10\n-\n-These users have created the most Pull Requests with [translations to other languages](contributing.md#translations){.internal-link target=_blank} that have been *merged*.\n-\n-<div class=\"user-list user-list-center\">\n-\n-{% for user in (translators.values() | list)[:50] %}\n-\n-{% if user.login not in skip_users %}\n-\n-<div class=\"user\"><a href=\"{{ user.url }}\" target=\"_blank\"><div class=\"avatar-wrapper\"><img src=\"{{ user.avatarUrl }}\"/></div><div class=\"title\">@{{ user.login }}</div></a> <div class=\"count\">Translations: {{ user.count }}</div></div>\n-\n-{% endif %}\n-\n-{% endfor %}\n-\n-</div>\n-\n ## Top Translation Reviewers\n \n These users are the **Top Translation Reviewers**. \ud83d\udd75\ufe0f\n \n-I only speak a few languages (and not very well \ud83d\ude05). So, the reviewers are the ones that have the [**power to approve translations**](contributing.md#translations){.internal-link target=_blank} of the documentation. Without them, there wouldn't be documentation in several other languages.\n+Translation reviewers have the [**power to approve translations**](contributing.md#translations){.internal-link target=_blank} of the documentation. Without them, there wouldn't be documentation in several other languages.\n \n <div class=\"user-list user-list-center\">\n {% for user in (translation_reviewers.values() | list)[:50] %}\ndiff --git a/docs/en/docs/management-tasks.md b/docs/en/docs/management-tasks.md\nindex aac4d6f..68d10a4 100644\n--- a/docs/en/docs/management-tasks.md\n+++ b/docs/en/docs/management-tasks.md\n@@ -106,129 +106,15 @@ This way, we can notice when there are new translations ready, because they have\n \n ## Merge Translation PRs\n \n-For Spanish, as I'm a native speaker and it's a language close to me, I will give it a final review myself and in most cases tweak the PR a bit before merging it.\n+Translations are generated automatically with LLMs and scripts.\n \n-For the other languages, confirm that:\n+There's one GitHub Action that can be manually run to add or update translations for a language: <a href=\"https://github.com/fastapi/fastapi/actions/workflows/translate.yml\" class=\"external-link\" target=\"_blank\">`translate.yml`</a>.\n \n-* The title is correct following the instructions above.\n-* It has the labels `lang-all` and `lang-{lang code}`.\n-* The PR changes only one Markdown file adding a translation.\n-    * Or in some cases, at most two files, if they are small, for the same language, and people reviewed them.\n-    * If it's the first translation for that language, it will have additional `mkdocs.yml` files, for those cases follow the instructions below.\n-* The PR doesn't add any additional or extraneous files.\n-* The translation seems to have a similar structure as the original English file.\n-* The translation doesn't seem to change the original content, for example with obvious additional documentation sections.\n-* The translation doesn't use different Markdown structures, for example adding HTML tags when the original didn't have them.\n-* The \"admonition\" sections, like `tip`, `info`, etc. are not changed or translated. For example:\n-\n-```\n-/// tip\n-\n-This is a tip.\n-\n-///\n-\n-```\n-\n-looks like this:\n-\n-/// tip\n-\n-This is a tip.\n-\n-///\n-\n-...it could be translated as:\n-\n-```\n-/// tip\n-\n-Esto es un consejo.\n-\n-///\n-\n-```\n-\n-...but needs to keep the exact `tip` keyword. If it was translated to `consejo`, like:\n-\n-```\n-/// consejo\n+For these language translation PRs, confirm that:\n \n-Esto es un consejo.\n-\n-///\n-\n-```\n-\n-it would change the style to the default one, it would look like:\n-\n-/// consejo\n-\n-Esto es un consejo.\n-\n-///\n-\n-Those don't have to be translated, but if they are, they need to be written as:\n-\n-```\n-/// tip | consejo\n-\n-Esto es un consejo.\n-\n-///\n-\n-```\n-\n-Which looks like:\n-\n-/// tip | consejo\n-\n-Esto es un consejo.\n-\n-///\n-\n-## First Translation PR\n-\n-When there's a first translation for a language, it will have a `docs/{lang code}/docs/index.md` translated file and a `docs/{lang code}/mkdocs.yml`.\n-\n-For example, for Bosnian, it would be:\n-\n-* `docs/bs/docs/index.md`\n-* `docs/bs/mkdocs.yml`\n-\n-The `mkdocs.yml` file will have only the following content:\n-\n-```YAML\n-INHERIT: ../en/mkdocs.yml\n-```\n-\n-The language code would normally be in the <a href=\"https://en.wikipedia.org/wiki/List_of_ISO_639_language_codes\" class=\"external-link\" target=\"_blank\">ISO 639-1 list of language codes</a>.\n-\n-In any case, the language code should be in the file <a href=\"https://github.com/fastapi/fastapi/blob/master/docs/language_names.yml\" class=\"external-link\" target=\"_blank\">docs/language_names.yml</a>.\n-\n-There won't be yet a label for the language code, for example, if it was Bosnian, there wouldn't be a `lang-bs`. Before creating the label and adding it to the PR, create the GitHub Discussion:\n-\n-* Go to the <a href=\"https://github.com/fastapi/fastapi/discussions/categories/translations\" class=\"external-link\" target=\"_blank\">Translations GitHub Discussions</a>\n-* Create a new discussion with the title `Bosnian Translations` (or the language name in English)\n-* A description of:\n-\n-```Markdown\n-## Bosnian translations\n-\n-This is the issue to track translations of the docs to Bosnian. \ud83d\ude80\n-\n-Here are the [PRs to review with the label `lang-bs`](https://github.com/fastapi/fastapi/pulls?q=is%3Apr+is%3Aopen+sort%3Aupdated-desc+label%3Alang-bs+label%3A%22awaiting-review%22). \ud83e\udd13\n-```\n-\n-Update \"Bosnian\" with the new language.\n-\n-And update the search link to point to the new language label that will be created, like `lang-bs`.\n-\n-Create and add the label to that new Discussion just created, like `lang-bs`.\n-\n-Then go back to the PR, and add the label, like `lang-bs`, and `lang-all` and `awaiting-review`.\n-\n-Now the GitHub action will automatically detect the label `lang-bs` and will post in that Discussion that this PR is waiting to be reviewed.\n+* The PR was automated (authored by @tiangolo), not made by another user.\n+* It has the labels `lang-all` and `lang-{lang code}`.\n+* If the PR is approved by at least one native speaker, you can merge it.\n \n ## Review PRs\n "}, {"role": "assistant", "content": "docs: simplify translation workflow documentation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/reactivity/src/effect.ts | 5 -----\n 1 file changed, 5 deletions(-)\n\ndiff --git a/packages/reactivity/src/effect.ts b/packages/reactivity/src/effect.ts\nindex 77c6f9d..978d3b0 100644\n--- a/packages/reactivity/src/effect.ts\n+++ b/packages/reactivity/src/effect.ts\n@@ -470,11 +470,6 @@ function removeDep(link: Link) {\n   }\n }\n \n-export interface ReactiveEffectRunner<T = any> {\n-  (): T\n-  effect: ReactiveEffect\n-}\n-\n export function effect<T = any>(\n   fn: () => T,\n   options?: ReactiveEffectOptions,"}, {"role": "assistant", "content": "refactor(reactivity): remove unused ReactiveEffectRunner interface"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n rollup.dts.config.js | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/rollup.dts.config.js b/rollup.dts.config.js\nindex d9af98f..516fe6e 100644\n--- a/rollup.dts.config.js\n+++ b/rollup.dts.config.js\n@@ -7,7 +7,7 @@ import dts from 'rollup-plugin-dts'\n \n if (!existsSync('temp/packages')) {\n   console.warn(\n-    'no temp dts files found. run `tsc -p tsconfig.build-browser.json && tsc -p tsconfig.build-node.json` first.',\n+    'no temp dts files found. run `tsc -p tsconfig.build.json --noCheck` first.',\n   )\n   process.exit(1)\n }"}, {"role": "assistant", "content": "docs: update build instructions in rollup config"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .mailmap | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/.mailmap b/.mailmap\nindex 4c254b396b5..948f1ab14fd 100644\n--- a/.mailmap\n+++ b/.mailmap\n@@ -96,6 +96,7 @@ boolean_coercion <booleancoercion@gmail.com>\n Boris Egorov <jightuse@gmail.com> <egorov@linux.com>\n bors <bors@rust-lang.org> bors[bot] <26634292+bors[bot]@users.noreply.github.com>\n bors <bors@rust-lang.org> bors[bot] <bors[bot]@users.noreply.github.com>\n+bors <bors@rust-lang.org> <122020455+rust-bors[bot]@users.noreply.github.com>\n BoxyUwU <rust@boxyuwu.dev>\n BoxyUwU <rust@boxyuwu.dev> <supbscripter@gmail.com>\n Braden Nelson <moonheart08@users.noreply.github.com>"}, {"role": "assistant", "content": "chore: add rust-bors bot to mailmap"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/shared-docs/services/search.service.ts | 16 +++++++++++-----\n 1 file changed, 11 insertions(+), 5 deletions(-)\n\ndiff --git a/adev/shared-docs/services/search.service.ts b/adev/shared-docs/services/search.service.ts\nindex 96df876a..a557ebd2 100644\n--- a/adev/shared-docs/services/search.service.ts\n+++ b/adev/shared-docs/services/search.service.ts\n@@ -105,17 +105,23 @@ export class Search {\n       const content = hitItem._snippetResult.content;\n       const hierarchy = hitItem._snippetResult.hierarchy;\n       const category = hitItem.hierarchy?.lvl0 ?? null;\n-      const hasSubLabel = hierarchy?.lvl2 || hierarchy?.lvl3 || hierarchy?.lvl4;\n+\n+      const lvl1Value = hierarchy?.lvl1?.value || hitItem.hierarchy?.lvl1;\n+\n+      const sublabelSnippet = this.getBestSnippetForMatch(hitItem);\n+\n+      // If no lvl1, promote sublabel to label to avoid empty titles\n+      const label = lvl1Value || sublabelSnippet || '';\n+\n+      const hasSubLabel = lvl1Value && (hierarchy?.lvl2 || hierarchy?.lvl3 || hierarchy?.lvl4);\n \n       return {\n         id: hitItem.objectID,\n         type: hitItem.hierarchy.lvl0 === 'Tutorials' ? 'code' : 'doc',\n         url: hitItem.url,\n \n-        labelHtml: this.parseLabelToHtml(hitItem._snippetResult.hierarchy?.lvl1?.value ?? ''),\n-        subLabelHtml: this.parseLabelToHtml(\n-          hasSubLabel ? this.getBestSnippetForMatch(hitItem) : null,\n-        ),\n+        labelHtml: this.parseLabelToHtml(label),\n+        subLabelHtml: this.parseLabelToHtml(hasSubLabel ? sublabelSnippet : null),\n         contentHtml: content ? this.parseLabelToHtml(content.value) : null,\n         package: category === 'Reference' ? extractPackageNameFromUrl(hitItem.url) : null,\n "}, {"role": "assistant", "content": "docs(docs-infra): improve label fallback logic in search results"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_codegen_gcc/src/lib.rs              |   3 +-\n compiler/rustc_codegen_llvm/src/lib.rs             |   2 +-\n .../rustc_codegen_ssa/src/back/symbol_export.rs    |  18 +-\n compiler/rustc_codegen_ssa/src/lib.rs              |   6 +-\n .../rustc_const_eval/src/check_consts/check.rs     |  13 +-\n compiler/rustc_const_eval/src/lib.rs               |  16 +-\n compiler/rustc_interface/src/passes.rs             |  46 ++---\n .../rustc_lint/src/early/diagnostics/check_cfg.rs  |   2 +-\n compiler/rustc_lint/src/transmute.rs               |   4 +-\n compiler/rustc_metadata/src/rmeta/mod.rs           |   2 +-\n compiler/rustc_middle/src/mir/pretty.rs            |   7 +-\n compiler/rustc_middle/src/util/mod.rs              |  17 --\n compiler/rustc_mir_build/src/lib.rs                |  12 +-\n compiler/rustc_mir_transform/src/lib.rs            |   6 +-\n compiler/rustc_monomorphize/src/collector.rs       |   2 +-\n compiler/rustc_monomorphize/src/lib.rs             |   2 +-\n compiler/rustc_monomorphize/src/partitioning.rs    |   8 +-\n compiler/rustc_parse/src/parser/diagnostics.rs     |   4 +-\n compiler/rustc_parse/src/parser/mod.rs             |   7 +-\n compiler/rustc_passes/src/lib.rs                   |   2 +-\n compiler/rustc_resolve/src/build_reduced_graph.rs  |  33 ++--\n compiler/rustc_resolve/src/diagnostics.rs          |  27 +--\n compiler/rustc_resolve/src/errors.rs               |  13 ++\n compiler/rustc_resolve/src/imports.rs              |   9 +-\n compiler/rustc_resolve/src/late/diagnostics.rs     |  35 +++-\n compiler/rustc_resolve/src/lib.rs                  |  31 ++--\n .../error_reporting/traits/fulfillment_errors.rs   |   2 +-\n .../src/error_reporting/traits/suggestions.rs      |  12 +-\n library/alloc/src/collections/binary_heap/mod.rs   |   8 +-\n library/core/src/char/methods.rs                   |   9 +-\n library/core/src/iter/range.rs                     |   7 +\n library/std/src/io/error.rs                        |  12 +-\n library/std/src/io/error/tests.rs                  |   3 +-\n library/std/src/sys/env/uefi.rs                    |   4 +-\n library/std/src/sys/exit_guard.rs                  |   2 +-\n library/std/src/sys/fs/unix.rs                     |   4 +-\n library/std/src/sys/io/error/generic.rs            |  15 ++\n library/std/src/sys/io/error/hermit.rs             |  35 ++++\n library/std/src/sys/io/error/mod.rs                |  55 ++++++\n library/std/src/sys/io/error/motor.rs              |  67 ++++++++\n library/std/src/sys/io/error/sgx.rs                |  65 +++++++\n library/std/src/sys/io/error/solid.rs              |  19 +++\n library/std/src/sys/io/error/teeos.rs              |  64 +++++++\n library/std/src/sys/io/error/uefi.rs               | 104 ++++++++++++\n library/std/src/sys/io/error/unix.rs               | 186 +++++++++++++++++++++\n library/std/src/sys/io/error/wasi.rs               |  80 +++++++++\n library/std/src/sys/io/error/windows.rs            | 140 ++++++++++++++++\n library/std/src/sys/io/error/xous.rs               |  17 ++\n library/std/src/sys/io/mod.rs                      |  20 ++-\n library/std/src/sys/net/connection/socket/unix.rs  |   2 +-\n library/std/src/sys/net/hostname/unix.rs           |   2 +-\n library/std/src/sys/pal/hermit/mod.rs              |  33 +---\n library/std/src/sys/pal/hermit/os.rs               |   8 -\n library/std/src/sys/pal/motor/mod.rs               |  39 -----\n library/std/src/sys/pal/motor/os.rs                |  29 ----\n library/std/src/sys/pal/sgx/mod.rs                 |  50 ------\n library/std/src/sys/pal/sgx/os.rs                  |  18 +-\n library/std/src/sys/pal/solid/mod.rs               |   9 -\n library/std/src/sys/pal/solid/os.rs                |  10 +-\n library/std/src/sys/pal/teeos/mod.rs               |  55 ------\n library/std/src/sys/pal/teeos/os.rs                |   8 -\n library/std/src/sys/pal/uefi/mod.rs                |  50 ------\n library/std/src/sys/pal/uefi/os.rs                 |  53 ------\n library/std/src/sys/pal/unix/futex.rs              |   6 +-\n library/std/src/sys/pal/unix/linux/pidfd.rs        |   2 +-\n library/std/src/sys/pal/unix/linux/pidfd/tests.rs  |   5 +-\n library/std/src/sys/pal/unix/mod.rs                |  61 +------\n library/std/src/sys/pal/unix/os.rs                 | 127 --------------\n .../src/sys/pal/unix/stack_overflow/thread_info.rs |   2 +-\n library/std/src/sys/pal/unsupported/common.rs      |   8 -\n library/std/src/sys/pal/unsupported/os.rs          |   8 -\n library/std/src/sys/pal/vexos/mod.rs               |   4 +-\n library/std/src/sys/pal/vexos/os.rs                |   4 +-\n library/std/src/sys/pal/wasi/helpers.rs            |  56 +------\n library/std/src/sys/pal/wasi/mod.rs                |   2 +-\n library/std/src/sys/pal/wasi/os.rs                 |  30 +---\n library/std/src/sys/pal/windows/mod.rs             |  78 ---------\n library/std/src/sys/pal/windows/os.rs              |  60 -------\n library/std/src/sys/pal/xous/os.rs                 |   9 -\n library/std/src/sys/pal/zkvm/mod.rs                |   8 -\n library/std/src/sys/pal/zkvm/os.rs                 |   8 -\n library/std/src/sys/process/uefi.rs                |   2 +-\n library/std/src/sys/process/unix/common.rs         |   2 +-\n library/std/src/sys/process/unix/unix.rs           |   2 +-\n library/std/src/sys/random/linux.rs                |   2 +-\n library/std/src/sys/sync/condvar/windows7.rs       |   4 +-\n library/std/src/sys/thread/unix.rs                 |   9 +-\n src/librustdoc/core.rs                             |   9 +-\n src/tools/miri/src/bin/miri.rs                     |   2 +-\n .../option-niche-unfixed/option-nonzero-eq.rs      |   7 +-\n .../missing-bound.stderr                           |   5 +-\n tests/ui-fulldeps/obtain-borrowck.rs               |   6 +-\n .../ui-fulldeps/rustc-dev-remap.only-remap.stderr  |   2 +-\n .../rustc-dev-remap.remap-unremap.stderr           |   2 +-\n .../diagnostic-derive-doc-comment-field.stderr     |   4 +-\n .../session-diagnostic/diagnostic-derive.stderr    |   2 +-\n tests/ui/abi/issues/issue-22565-rust-call.stderr   |   4 +-\n tests/ui/async-await/coroutine-not-future.stderr   |   6 +-\n tests/ui/async-await/issue-61076.rs                |   4 +-\n tests/ui/async-await/issue-61076.stderr            |   4 +-\n tests/ui/async-await/issue-84841.stderr            |   2 +-\n tests/ui/async-await/try-in-sync.stderr            |   2 +-\n .../two-phase-reservation-sharing-interference.rs  |   2 +-\n .../adt_const_params/const_param_ty_bad.stderr     |  12 +-\n .../const_param_ty_bad_empty_array.stderr          |   2 +-\n ...onst_param_ty_generic_bounds_do_not_hold.stderr |   6 +-\n .../const_param_ty_impl_no_structural_eq.stderr    |   4 +-\n .../generic_const_exprs/issue-69654.stderr         |   5 +\n tests/ui/coroutine/gen_block_is_coro.stderr        |   6 +-\n tests/ui/error-codes/E0059.stderr                  |   4 +-\n tests/ui/extern/extern-types-unsized.stderr        |   4 +-\n tests/ui/extern/unsized-extern-derefmove.stderr    |   6 +-\n .../feature-gate-sized-hierarchy.stderr            |   2 +-\n .../rust-call-abi-not-a-tuple-ice-81974.stderr     |  16 +-\n tests/ui/mir/validate/validate-unsize-cast.stderr  |   2 +-\n .../ui/overloaded/overloaded-calls-nontuple.stderr |  12 +-\n .../pattern/deref-patterns/recursion-limit.stderr  |   2 +-\n .../deref-patterns/unsatisfied-bounds.stderr       |   2 +-\n tests/ui/proc-macro/quote/not-quotable.stderr      |   2 +-\n tests/ui/range/range-1.rs                          |   2 +-\n tests/ui/range/range-1.stderr                      |   6 +-\n .../disallowed-positions.e2021.stderr              |   6 +-\n .../disallowed-positions.e2024.stderr              |   6 +-\n tests/ui/sized-hierarchy/default-bound.stderr      |   2 +-\n tests/ui/sized-hierarchy/impls.stderr              |  10 +-\n .../ui/sized-hierarchy/pretty-print-opaque.stderr  |   6 +-\n tests/ui/specialization/issue-44861.stderr         |   2 +-\n .../stability-in-private-module.rs                 |   2 +-\n .../stability-in-private-module.stderr             |   2 +-\n tests/ui/suggestions/fn-trait-notation.stderr      |   4 +-\n tests/ui/suggestions/issue-72766.stderr            |   2 +-\n tests/ui/suggestions/issue-97704.stderr            |   2 +-\n .../trait-bounds/unstable-trait-suggestion.stderr  |   7 +-\n tests/ui/traits/issue-71036.rs                     |   2 +-\n tests/ui/traits/issue-71036.stderr                 |   2 +-\n tests/ui/traits/next-solver/coroutine.fail.stderr  |   2 +-\n .../higher-ranked-upcasting-ub.next.stderr         |   2 +-\n .../unsize-goal-escaping-bounds.current.stderr     |   2 +-\n tests/ui/transmutability/assoc-bound.stderr        |   2 +-\n .../dont-assume-err-is-yes-issue-126377.stderr     |   2 +-\n .../transmutability/references/unsafecell.stderr   |   8 +-\n .../try-block-bad-type-heterogeneous.stderr        |   4 +-\n tests/ui/try-block/try-block-bad-type.stderr       |   4 +-\n tests/ui/try-block/try-block-in-while.stderr       |   2 +-\n tests/ui/try-trait/try-operator-on-main.stderr     |   6 +-\n tests/ui/tuple/builtin-fail.stderr                 |   8 +-\n tests/ui/type-inference/box_has_sigdrop.rs         |   2 +-\n tests/ui/type/pattern_types/nested.stderr          |  14 +-\n tests/ui/typeck/issue-57404.stderr                 |   2 +-\n .../non-tupled-arg-mismatch.stderr                 |   2 +-\n 150 files changed, 1254 insertions(+), 1143 deletions(-)"}, {"role": "assistant", "content": "refactor: reorganize io error handling into platform modules"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-core/__tests__/apiInject.spec.ts | 43 +++++++++++++++++++++++\n packages/runtime-core/src/apiInject.ts            |  7 ++--\n 2 files changed, 47 insertions(+), 3 deletions(-)\n\ndiff --git a/packages/runtime-core/__tests__/apiInject.spec.ts b/packages/runtime-core/__tests__/apiInject.spec.ts\nindex e5c9267..27dc967 100644\n--- a/packages/runtime-core/__tests__/apiInject.spec.ts\n+++ b/packages/runtime-core/__tests__/apiInject.spec.ts\n@@ -6,6 +6,7 @@ import {\n   hasInjectionContext,\n   inject,\n   nextTick,\n+  onMounted,\n   provide,\n   reactive,\n   readonly,\n@@ -372,4 +373,46 @@ describe('api: provide/inject', () => {\n       })\n     })\n   })\n+\n+  describe('warnings for incorrect usage', () => {\n+    it('should warn when inject() is called outside setup', () => {\n+      inject('foo', 'bar')\n+      expect(`inject() can only be used`).toHaveBeenWarned()\n+    })\n+\n+    it('should warn when provide() is called outside setup', () => {\n+      provide('foo', 'bar')\n+      expect(`provide() can only be used`).toHaveBeenWarned()\n+    })\n+\n+    it('should warn when provide() is called from a render function', () => {\n+      const Provider = {\n+        setup() {\n+          return () => {\n+            provide('foo', 'bar')\n+          }\n+        },\n+      }\n+\n+      const root = nodeOps.createElement('div')\n+      render(h(Provider), root)\n+      expect(`provide() can only be used`).toHaveBeenWarned()\n+    })\n+\n+    it('should warn when provide() is called from onMounted', () => {\n+      const Provider = {\n+        setup() {\n+          onMounted(() => {\n+            provide('foo', 'bar')\n+          })\n+\n+          return () => null\n+        },\n+      }\n+\n+      const root = nodeOps.createElement('div')\n+      render(h(Provider), root)\n+      expect(`provide() can only be used`).toHaveBeenWarned()\n+    })\n+  })\n })\ndiff --git a/packages/runtime-core/src/apiInject.ts b/packages/runtime-core/src/apiInject.ts\nindex d5c97a5..af59984 100644\n--- a/packages/runtime-core/src/apiInject.ts\n+++ b/packages/runtime-core/src/apiInject.ts\n@@ -11,11 +11,12 @@ export function provide<T, K = InjectionKey<T> | string | number>(\n   key: K,\n   value: K extends InjectionKey<infer V> ? V : T,\n ): void {\n-  if (!currentInstance) {\n-    if (__DEV__) {\n+  if (__DEV__) {\n+    if (!currentInstance || currentInstance.isMounted) {\n       warn(`provide() can only be used inside setup().`)\n     }\n-  } else {\n+  }\n+  if (currentInstance) {\n     let provides = currentInstance.provides\n     // by default an instance inherits its parent's provides object\n     // but when it needs to provide values of its own, it creates its"}, {"role": "assistant", "content": "fix(runtime-core): warn when provide() is called after setup"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/ci.yml | 16 ++++------------\n 1 file changed, 4 insertions(+), 12 deletions(-)"}, {"role": "assistant", "content": "ci: simplify workflow configuration"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/reflect/value.go | 2 ++\n 1 file changed, 2 insertions(+)\n\ndiff --git a/src/reflect/value.go b/src/reflect/value.go\nindex 7f0ec2a3..8c8acbaa 100644\n--- a/src/reflect/value.go\n+++ b/src/reflect/value.go\n@@ -362,6 +362,7 @@ func (v Value) CanSet() bool {\n // type of the function's corresponding input parameter.\n // If v is a variadic function, Call creates the variadic slice parameter\n // itself, copying in the corresponding values.\n+// It panics if the Value was obtained by accessing unexported struct fields.\n func (v Value) Call(in []Value) []Value {\n \tv.mustBe(Func)\n \tv.mustBeExported()\n@@ -375,6 +376,7 @@ func (v Value) Call(in []Value) []Value {\n // It returns the output results as Values.\n // As in Go, each input argument must be assignable to the\n // type of the function's corresponding input parameter.\n+// It panics if the Value was obtained by accessing unexported struct fields.\n func (v Value) CallSlice(in []Value) []Value {\n \tv.mustBe(Func)\n \tv.mustBeExported()"}, {"role": "assistant", "content": "docs(reflect): add panic note for unexported struct fields"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_resolve/src/imports.rs              |  9 +++-\n tests/ui/imports/overwrite-different-ambig-2.rs    | 24 +++++++++++\n .../ui/imports/overwrite-different-ambig-2.stderr  | 49 ++++++++++++++++++++++\n 3 files changed, 81 insertions(+), 1 deletion(-)\n\ndiff --git a/compiler/rustc_resolve/src/imports.rs b/compiler/rustc_resolve/src/imports.rs\nindex c3ea408deb8..451779ae32c 100644\n--- a/compiler/rustc_resolve/src/imports.rs\n+++ b/compiler/rustc_resolve/src/imports.rs\n@@ -301,9 +301,12 @@ fn remove_same_import<'ra>(d1: Decl<'ra>, d2: Decl<'ra>) -> (Decl<'ra>, Decl<'ra\n         && let DeclKind::Import { import: import2, source_decl: d2_next } = d2.kind\n         && import1 == import2\n     {\n-        assert_eq!(d1.ambiguity.get(), d2.ambiguity.get());\n         assert_eq!(d1.expansion, d2.expansion);\n         assert_eq!(d1.span, d2.span);\n+        if d1.ambiguity.get() != d2.ambiguity.get() {\n+            assert!(d1.ambiguity.get().is_some());\n+            assert!(d2.ambiguity.get().is_none());\n+        }\n         // Visibility of the new import declaration may be different,\n         // because it already incorporates the visibility of the source binding.\n         // `warn_ambiguity` of a re-fetched glob can also change in both directions.\n@@ -377,6 +380,10 @@ fn select_glob_decl(\n             // assert_ne!(old_deep_decl, deep_decl);\n             // assert!(old_deep_decl.is_glob_import());\n             assert!(!deep_decl.is_glob_import());\n+            if old_glob_decl.ambiguity.get().is_some() && glob_decl.ambiguity.get().is_none() {\n+                // Do not lose glob ambiguities when re-fetching the glob.\n+                glob_decl.ambiguity.set_unchecked(old_glob_decl.ambiguity.get());\n+            }\n             if glob_decl.is_ambiguity_recursive() {\n                 glob_decl.warn_ambiguity.set_unchecked(true);\n             }\ndiff --git a/tests/ui/imports/overwrite-different-ambig-2.rs b/tests/ui/imports/overwrite-different-ambig-2.rs\nnew file mode 100644\nindex 00000000000..1b6d20e24d3\n--- /dev/null\n+++ b/tests/ui/imports/overwrite-different-ambig-2.rs\n@@ -0,0 +1,24 @@\n+mod m1 {\n+    mod inner {\n+        pub struct S {}\n+    }\n+    pub use self::inner::*;\n+\n+    #[derive(Debug)]\n+    pub struct S {}\n+}\n+\n+mod m2 {\n+    pub struct S {}\n+}\n+\n+// First we have a glob ambiguity in this glob (with `m2::*`).\n+// Then we re-fetch `m1::*` because non-glob `m1::S` materializes from derive,\n+// and we need to make sure that the glob ambiguity is not lost during re-fetching.\n+use m1::*;\n+use m2::*;\n+\n+fn main() {\n+    let _: m1::S = S {}; //~ ERROR `S` is ambiguous\n+                         //~| WARN this was previously accepted\n+}\ndiff --git a/tests/ui/imports/overwrite-different-ambig-2.stderr b/tests/ui/imports/overwrite-different-ambig-2.stderr\nnew file mode 100644\nindex 00000000000..e75f552d119\n--- /dev/null\n+++ b/tests/ui/imports/overwrite-different-ambig-2.stderr\n@@ -0,0 +1,49 @@\n+error: `S` is ambiguous\n+  --> $DIR/overwrite-different-ambig-2.rs:22:20\n+   |\n+LL |     let _: m1::S = S {};\n+   |                    ^ ambiguous name\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #114095 <https://github.com/rust-lang/rust/issues/114095>\n+   = note: ambiguous because of multiple glob imports of a name in the same module\n+note: `S` could refer to the struct imported here\n+  --> $DIR/overwrite-different-ambig-2.rs:18:5\n+   |\n+LL | use m1::*;\n+   |     ^^^^^\n+   = help: consider adding an explicit import of `S` to disambiguate\n+note: `S` could also refer to the struct imported here\n+  --> $DIR/overwrite-different-ambig-2.rs:19:5\n+   |\n+LL | use m2::*;\n+   |     ^^^^^\n+   = help: consider adding an explicit import of `S` to disambiguate\n+   = note: `#[deny(ambiguous_glob_imports)]` (part of `#[deny(future_incompatible)]`) on by default\n+\n+error: aborting due to 1 previous error\n+\n+Future incompatibility report: Future breakage diagnostic:\n+error: `S` is ambiguous\n+  --> $DIR/overwrite-different-ambig-2.rs:22:20\n+   |\n+LL |     let _: m1::S = S {};\n+   |                    ^ ambiguous name\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #114095 <https://github.com/rust-lang/rust/issues/114095>\n+   = note: ambiguous because of multiple glob imports of a name in the same module\n+note: `S` could refer to the struct imported here\n+  --> $DIR/overwrite-different-ambig-2.rs:18:5\n+   |\n+LL | use m1::*;\n+   |     ^^^^^\n+   = help: consider adding an explicit import of `S` to disambiguate\n+note: `S` could also refer to the struct imported here\n+  --> $DIR/overwrite-different-ambig-2.rs:19:5\n+   |\n+LL | use m2::*;\n+   |     ^^^^^\n+   = help: consider adding an explicit import of `S` to disambiguate\n+   = note: `#[deny(ambiguous_glob_imports)]` (part of `#[deny(future_incompatible)]`) on by default\n+"}, {"role": "assistant", "content": "fix(resolve): preserve glob ambiguity during re-fetch"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/runtime/trace/recorder.go | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/runtime/trace/recorder.go b/src/runtime/trace/recorder.go\nindex 4f2d3aa9..a18d7641 100644\n--- a/src/runtime/trace/recorder.go\n+++ b/src/runtime/trace/recorder.go\n@@ -39,7 +39,7 @@ func (w *recorder) Write(b []byte) (n int, err error) {\n \t\tw.headerReceived = true\n \t}\n \tif len(b) == n {\n-\t\treturn 0, nil\n+\t\treturn n, nil\n \t}\n \tba, nb, err := readBatch(b[n:]) // Every write from the runtime is guaranteed to be a complete batch.\n \tif err != nil {"}, {"role": "assistant", "content": "fix(trace): return correct byte count in recorder Write"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/.claude/settings.local.json    |   9 +\n compiler/scripts/enable-feature-flag.js | 347 ++++++++++++++++++++++++++++++++\n 2 files changed, 356 insertions(+)\n\ndiff --git a/compiler/.claude/settings.local.json b/compiler/.claude/settings.local.json\nnew file mode 100644\nindex 0000000..9bbd188\n--- /dev/null\n+++ b/compiler/.claude/settings.local.json\n@@ -0,0 +1,9 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(node scripts/enable-feature-flag.js:*)\"\n+    ],\n+    \"deny\": [],\n+    \"ask\": []\n+  }\n+}\ndiff --git a/compiler/scripts/enable-feature-flag.js b/compiler/scripts/enable-feature-flag.js\nnew file mode 100755\nindex 0000000..f51c5b4\n--- /dev/null\n+++ b/compiler/scripts/enable-feature-flag.js\n@@ -0,0 +1,347 @@\n+#!/usr/bin/env node\n+/**\n+ * Copyright (c) Meta Platforms, Inc. and affiliates.\n+ *\n+ * This source code is licensed under the MIT license found in the\n+ * LICENSE file in the root directory of this source tree.\n+ */\n+\n+'use strict';\n+\n+const fs = require('fs');\n+const path = require('path');\n+const {execSync} = require('child_process');\n+const yargs = require('yargs/yargs');\n+const {hideBin} = require('yargs/helpers');\n+\n+// Constants\n+const COMPILER_ROOT = path.resolve(__dirname, '..');\n+const ENVIRONMENT_TS_PATH = path.join(\n+  COMPILER_ROOT,\n+  'packages/babel-plugin-react-compiler/src/HIR/Environment.ts'\n+);\n+const FIXTURES_PATH = path.join(\n+  COMPILER_ROOT,\n+  'packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler'\n+);\n+const FIXTURE_EXTENSIONS = ['.js', '.jsx', '.ts', '.tsx'];\n+\n+/**\n+ * Parse command line arguments\n+ */\n+function parseArgs() {\n+  const argv = yargs(hideBin(process.argv))\n+    .usage('Usage: $0 <flag-name>')\n+    .command('$0 <flag-name>', 'Enable a feature flag by default', yargs => {\n+      yargs.positional('flag-name', {\n+        describe: 'Name of the feature flag to enable',\n+        type: 'string',\n+      });\n+    })\n+    .example(\n+      '$0 validateExhaustiveMemoizationDependencies',\n+      'Enable the validateExhaustiveMemoizationDependencies flag'\n+    )\n+    .help('h')\n+    .alias('h', 'help')\n+    .strict()\n+    .parseSync();\n+\n+  return argv['flag-name'];\n+}\n+\n+/**\n+ * Enable a feature flag in Environment.ts by changing default(false) to default(true)\n+ */\n+function enableFlagInEnvironment(flagName) {\n+  console.log(`\\nEnabling flag \"${flagName}\" in Environment.ts...`);\n+\n+  const content = fs.readFileSync(ENVIRONMENT_TS_PATH, 'utf8');\n+\n+  // Check if the flag exists with default(false)\n+  const flagPatternFalse = new RegExp(\n+    `(${escapeRegex(flagName)}:\\\\s*z\\\\.boolean\\\\(\\\\)\\\\.default\\\\()false(\\\\))`,\n+    'g'\n+  );\n+\n+  if (!flagPatternFalse.test(content)) {\n+    // Check if flag exists at all\n+    const flagExistsPattern = new RegExp(\n+      `${escapeRegex(flagName)}:\\\\s*z\\\\.boolean\\\\(\\\\)`,\n+      'g'\n+    );\n+    if (flagExistsPattern.test(content)) {\n+      // Check if it's already true\n+      const flagPatternTrue = new RegExp(\n+        `${escapeRegex(flagName)}:\\\\s*z\\\\.boolean\\\\(\\\\)\\\\.default\\\\(true\\\\)`,\n+        'g'\n+      );\n+      if (flagPatternTrue.test(content)) {\n+        console.error(`Error: Flag \"${flagName}\" already has default(true)`);\n+        process.exit(1);\n+      }\n+      console.error(\n+        `Error: Flag \"${flagName}\" exists but doesn't have default(false)`\n+      );\n+      process.exit(1);\n+    }\n+    console.error(`Error: Flag \"${flagName}\" not found in Environment.ts`);\n+    process.exit(1);\n+  }\n+\n+  // Perform the replacement\n+  const newContent = content.replace(flagPatternFalse, '$1true$2');\n+\n+  // Verify the replacement worked\n+  if (content === newContent) {\n+    console.error(`Error: Failed to replace flag \"${flagName}\"`);\n+    process.exit(1);\n+  }\n+\n+  fs.writeFileSync(ENVIRONMENT_TS_PATH, newContent, 'utf8');\n+  console.log(`Successfully enabled \"${flagName}\" in Environment.ts`);\n+}\n+\n+/**\n+ * Helper to escape regex special characters\n+ */\n+function escapeRegex(string) {\n+  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n+}\n+\n+/**\n+ * Run yarn snap and capture output\n+ */\n+function runTests() {\n+  console.log('\\nRunning test suite (yarn snap)...');\n+\n+  try {\n+    const output = execSync('yarn snap', {\n+      cwd: COMPILER_ROOT,\n+      encoding: 'utf8',\n+      stdio: 'pipe',\n+      maxBuffer: 10 * 1024 * 1024, // 10MB buffer\n+    });\n+    return {success: true, output};\n+  } catch (error) {\n+    // yarn snap exits with code 1 when tests fail, which throws an error\n+    return {success: false, output: error.stdout || error.message};\n+  }\n+}\n+\n+/**\n+ * Parse failing test names from test output\n+ */\n+function parseFailingTests(output) {\n+  const failingTests = [];\n+\n+  // Look for lines that contain \"FAIL:\" followed by the test name\n+  // Format: \"FAIL: test-name\" or with ANSI codes\n+  const lines = output.split('\\n');\n+  for (const line of lines) {\n+    // Remove ANSI codes for easier parsing\n+    const cleanLine = line.replace(/\\x1b\\[[0-9;]*m/g, '');\n+\n+    // Match \"FAIL: test-name\"\n+    const match = cleanLine.match(/^FAIL:\\s*(.+)$/);\n+    if (match) {\n+      failingTests.push(match[1].trim());\n+    }\n+  }\n+\n+  return failingTests;\n+}\n+\n+/**\n+ * Find the fixture file for a given test name\n+ */\n+function findFixtureFile(testName) {\n+  const basePath = path.join(FIXTURES_PATH, testName);\n+\n+  for (const ext of FIXTURE_EXTENSIONS) {\n+    const filePath = basePath + ext;\n+    if (fs.existsSync(filePath)) {\n+      return filePath;\n+    }\n+  }\n+\n+  return null;\n+}\n+\n+/**\n+ * Add pragma to disable the feature flag in a fixture file\n+ */\n+function addPragmaToFixture(filePath, flagName) {\n+  const content = fs.readFileSync(filePath, 'utf8');\n+  const lines = content.split('\\n');\n+\n+  if (lines.length === 0) {\n+    console.warn(`Warning: Empty file ${filePath}`);\n+    return false;\n+  }\n+\n+  const firstLine = lines[0];\n+  const pragma = `@${flagName}:false`;\n+\n+  // Check if pragma already exists\n+  if (firstLine.includes(pragma)) {\n+    return false; // Already has the pragma\n+  }\n+\n+  // Check if first line is a single-line comment\n+  if (firstLine.trim().startsWith('//')) {\n+    // Append pragma to existing comment\n+    lines[0] = firstLine + ' ' + pragma;\n+  } else if (firstLine.trim().startsWith('/*')) {\n+    // Multi-line comment - insert new line before it\n+    lines.unshift('// ' + pragma);\n+  } else {\n+    // No comment - insert new comment as first line\n+    lines.unshift('// ' + pragma);\n+  }\n+\n+  fs.writeFileSync(filePath, lines.join('\\n'), 'utf8');\n+  return true;\n+}\n+\n+/**\n+ * Update snapshot files\n+ */\n+function updateSnapshots() {\n+  console.log('\\nUpdating snapshots (yarn snap -u)...');\n+\n+  try {\n+    execSync('yarn snap -u', {\n+      cwd: COMPILER_ROOT,\n+      encoding: 'utf8',\n+      stdio: 'pipe',\n+      maxBuffer: 10 * 1024 * 1024,\n+    });\n+    console.log('Snapshots updated successfully');\n+    return true;\n+  } catch (error) {\n+    console.error('Error updating snapshots:', error.message);\n+    return false;\n+  }\n+}\n+\n+/**\n+ * Verify all tests pass\n+ */\n+function verifyAllTestsPass() {\n+  console.log('\\nRunning final verification (yarn snap)...');\n+\n+  const {success, output} = runTests();\n+\n+  // Parse summary line: \"N Tests, N Passed, N Failed\"\n+  const summaryMatch = output.match(\n+    /(\\d+)\\s+Tests,\\s+(\\d+)\\s+Passed,\\s+(\\d+)\\s+Failed/\n+  );\n+\n+  if (summaryMatch) {\n+    const [, total, passed, failed] = summaryMatch;\n+    console.log(\n+      `\\nTest Results: ${total} Tests, ${passed} Passed, ${failed} Failed`\n+    );\n+\n+    if (failed === '0') {\n+      console.log('All tests passed!');\n+      return true;\n+    } else {\n+      console.error(`${failed} tests still failing`);\n+      const failingTests = parseFailingTests(output);\n+      if (failingTests.length > 0) {\n+        console.error('\\nFailing tests:');\n+        failingTests.forEach(test => console.error(`  - ${test}`));\n+      }\n+      return false;\n+    }\n+  }\n+\n+  return success;\n+}\n+\n+/**\n+ * Main function\n+ */\n+async function main() {\n+  const flagName = parseArgs();\n+\n+  console.log(`\\nEnabling flag: '${flagName}'`);\n+\n+  try {\n+    // Step 1: Enable flag in Environment.ts\n+    enableFlagInEnvironment(flagName);\n+\n+    // Step 2: Run tests to find failures\n+    const {output} = runTests();\n+    const failingTests = parseFailingTests(output);\n+\n+    console.log(`\\nFound ${failingTests.length} failing tests`);\n+\n+    if (failingTests.length === 0) {\n+      console.log('No failing tests! Feature flag enabled successfully.');\n+      process.exit(0);\n+    }\n+\n+    // Step 3: Add pragma to each failing fixture\n+    console.log(`\\nAdding '@${flagName}:false' pragma to failing fixtures...`);\n+\n+    const notFound = [];\n+    let notFoundCount = 0;\n+\n+    for (const testName of failingTests) {\n+      const fixturePath = findFixtureFile(testName);\n+\n+      if (!fixturePath) {\n+        console.warn(`Could not find fixture file for: ${testName}`);\n+        notFound.push(fixturePath);\n+        continue;\n+      }\n+\n+      const updated = addPragmaToFixture(fixturePath, flagName);\n+      if (updated) {\n+        updatedCount++;\n+        console.log(`  Updated: ${testName}`);\n+      }\n+    }\n+\n+    console.log(\n+      `\\nSummary: Updated ${updatedCount} fixtures, ${notFoundCount} not found`\n+    );\n+\n+    if (notFoundCount.length !== 0) {\n+      console.error(\n+        '\\nFailed to update snapshots, could not find:\\n' + notFound.join('\\n')\n+      );\n+      process.exit(1);\n+    }\n+\n+    // Step 4: Update snapshots\n+    if (!updateSnapshots()) {\n+      console.error('\\nFailed to update snapshots');\n+      process.exit(1);\n+    }\n+\n+    // Step 5: Verify all tests pass\n+    if (!verifyAllTestsPass()) {\n+      console.error('\\nVerification failed: Some tests are still failing');\n+      process.exit(1);\n+    }\n+\n+    console.log('\\nSuccess! Feature flag enabled and all tests passing.');\n+    console.log(`\\nSummary:`);\n+    console.log(`  - Enabled \"${flagName}\" in Environment.ts`);\n+    console.log(`  - Updated ${updatedCount} fixture files with pragma`);\n+    console.log(`  - All tests passing`);\n+\n+    process.exit(0);\n+  } catch (error) {\n+    console.error('\\nFatal error:', error.message);\n+    console.error(error.stack);\n+    process.exit(1);\n+  }\n+}\n+\n+// Run the script\n+main();"}, {"role": "assistant", "content": "feat(compiler): add feature flag enablement script"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n tests/rustdoc-gui/utils.goml | 30 ++++++++++++++++++++++++------\n 1 file changed, 24 insertions(+), 6 deletions(-)\n\ndiff --git a/tests/rustdoc-gui/utils.goml b/tests/rustdoc-gui/utils.goml\nindex c0625ead2f1..c5c8ab3b1af 100644\n--- a/tests/rustdoc-gui/utils.goml\n+++ b/tests/rustdoc-gui/utils.goml\n@@ -29,9 +29,18 @@ define-function: (\n     \"open-settings-menu\",\n     [],\n     block {\n-        call-function: (\"click-settings-button\", {})\n-        // Wait for the popover to appear...\n-        wait-for-css: (\"#settings\", {\"display\": \"block\"})\n+        store-count: (\"#settings\", nb_settings_menu)\n+        if: (|nb_settings_menu| != 0, block {\n+            store-css: (\"#settings\", {\"display\": settings_display})\n+        })\n+        else: block {\n+            store-value: (settings_display, \"none\")\n+        }\n+        if: (|settings_display| != \"block\", block {\n+            call-function: (\"click-settings-button\", {})\n+            // Wait for the popover to appear...\n+            wait-for-css: (\"#settings\", {\"display\": \"block\"})\n+        })\n     }\n )\n \n@@ -39,9 +48,18 @@ define-function: (\n     \"close-settings-menu\",\n     [],\n     block {\n-        call-function: (\"click-settings-button\", {})\n-        // Wait for the popover to disappear...\n-        wait-for-css-false: (\"#settings\", {\"display\": \"block\"})\n+        store-count: (\"#settings\", nb_settings_menu)\n+        if: (|nb_settings_menu| != 0, block {\n+            store-css: (\"#settings\", {\"display\": settings_display})\n+        })\n+        else: block {\n+            store-value: (settings_display, \"block\")\n+        }\n+        if: (|settings_display| == \"block\", block {\n+            call-function: (\"click-settings-button\", {})\n+            // Wait for the popover to disappear...\n+            wait-for-css-false: (\"#settings\", {\"display\": \"block\"})\n+        })\n     }\n )\n "}, {"role": "assistant", "content": "test(rustdoc-gui): add state checks before toggling settings menu"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/data/github_sponsors.yml | 431 +++++++++++++++++++--------------------\n 1 file changed, 211 insertions(+), 220 deletions(-)\n\ndiff --git a/docs/en/data/github_sponsors.yml b/docs/en/data/github_sponsors.yml\nindex 2478060..971687d 100644\n--- a/docs/en/data/github_sponsors.yml\n+++ b/docs/en/data/github_sponsors.yml\n@@ -2,57 +2,51 @@ sponsors:\n - - login: renderinc\n     avatarUrl: https://avatars.githubusercontent.com/u/36424661?v=4\n     url: https://github.com/renderinc\n-  - login: andrew-propelauth\n-    avatarUrl: https://avatars.githubusercontent.com/u/89474256?u=c98993dec8553c09d424ede67bbe86e5c35f48c9&v=4\n-    url: https://github.com/andrew-propelauth\n-  - login: blockbee-io\n-    avatarUrl: https://avatars.githubusercontent.com/u/115143449?u=1b8620c2d6567c4df2111a371b85a51f448f9b85&v=4\n-    url: https://github.com/blockbee-io\n-  - login: zuplo\n-    avatarUrl: https://avatars.githubusercontent.com/u/85497839?v=4\n-    url: https://github.com/zuplo\n-  - login: coderabbitai\n-    avatarUrl: https://avatars.githubusercontent.com/u/132028505?v=4\n-    url: https://github.com/coderabbitai\n-  - login: greptileai\n-    avatarUrl: https://avatars.githubusercontent.com/u/140149887?v=4\n-    url: https://github.com/greptileai\n   - login: subtotal\n     avatarUrl: https://avatars.githubusercontent.com/u/176449348?v=4\n     url: https://github.com/subtotal\n+  - login: greptileai\n+    avatarUrl: https://avatars.githubusercontent.com/u/140149887?v=4\n+    url: https://github.com/greptileai\n+  - login: coderabbitai\n+    avatarUrl: https://avatars.githubusercontent.com/u/132028505?v=4\n+    url: https://github.com/coderabbitai\n+  - login: zuplo\n+    avatarUrl: https://avatars.githubusercontent.com/u/85497839?v=4\n+    url: https://github.com/zuplo\n+  - login: blockbee-io\n+    avatarUrl: https://avatars.githubusercontent.com/u/115143449?u=1b8620c2d6567c4df2111a371b85a51f448f9b85&v=4\n+    url: https://github.com/blockbee-io\n+  - login: andrew-propelauth\n+    avatarUrl: https://avatars.githubusercontent.com/u/89474256?u=c98993dec8553c09d424ede67bbe86e5c35f48c9&v=4\n+    url: https://github.com/andrew-propelauth\n   - login: railwayapp\n     avatarUrl: https://avatars.githubusercontent.com/u/66716858?v=4\n     url: https://github.com/railwayapp\n-- - login: dribia\n-    avatarUrl: https://avatars.githubusercontent.com/u/41189616?v=4\n-    url: https://github.com/dribia\n-  - login: svix\n-    avatarUrl: https://avatars.githubusercontent.com/u/80175132?v=4\n-    url: https://github.com/svix\n+- - login: speakeasy-api\n+    avatarUrl: https://avatars.githubusercontent.com/u/91446104?v=4\n+    url: https://github.com/speakeasy-api\n   - login: stainless-api\n     avatarUrl: https://avatars.githubusercontent.com/u/88061651?v=4\n     url: https://github.com/stainless-api\n-  - login: speakeasy-api\n-    avatarUrl: https://avatars.githubusercontent.com/u/91446104?v=4\n-    url: https://github.com/speakeasy-api\n-  - login: databento\n-    avatarUrl: https://avatars.githubusercontent.com/u/64141749?v=4\n-    url: https://github.com/databento\n+  - login: svix\n+    avatarUrl: https://avatars.githubusercontent.com/u/80175132?v=4\n+    url: https://github.com/svix\n   - login: permitio\n     avatarUrl: https://avatars.githubusercontent.com/u/71775833?v=4\n     url: https://github.com/permitio\n-- - login: Ponte-Energy-Partners\n-    avatarUrl: https://avatars.githubusercontent.com/u/114745848?v=4\n-    url: https://github.com/Ponte-Energy-Partners\n-  - login: LambdaTest-Inc\n+  - login: databento\n+    avatarUrl: https://avatars.githubusercontent.com/u/64141749?v=4\n+    url: https://github.com/databento\n+- - login: LambdaTest-Inc\n     avatarUrl: https://avatars.githubusercontent.com/u/171592363?u=96606606a45fa170427206199014f2a5a2a4920b&v=4\n     url: https://github.com/LambdaTest-Inc\n+  - login: Ponte-Energy-Partners\n+    avatarUrl: https://avatars.githubusercontent.com/u/114745848?v=4\n+    url: https://github.com/Ponte-Energy-Partners\n   - login: BoostryJP\n     avatarUrl: https://avatars.githubusercontent.com/u/57932412?v=4\n     url: https://github.com/BoostryJP\n-  - login: requestly\n-    avatarUrl: https://avatars.githubusercontent.com/u/12287519?v=4\n-    url: https://github.com/requestly\n   - login: acsone\n     avatarUrl: https://avatars.githubusercontent.com/u/7601056?v=4\n     url: https://github.com/acsone\n@@ -68,9 +62,6 @@ sponsors:\n   - login: Doist\n     avatarUrl: https://avatars.githubusercontent.com/u/2565372?v=4\n     url: https://github.com/Doist\n-  - login: bholagabbar\n-    avatarUrl: https://avatars.githubusercontent.com/u/11693595?v=4\n-    url: https://github.com/bholagabbar\n - - login: mainframeindustries\n     avatarUrl: https://avatars.githubusercontent.com/u/55092103?v=4\n     url: https://github.com/mainframeindustries\n@@ -86,6 +77,9 @@ sponsors:\n   - login: ChargeStorm\n     avatarUrl: https://avatars.githubusercontent.com/u/26000165?v=4\n     url: https://github.com/ChargeStorm\n+  - login: ibrahimpelumi6142\n+    avatarUrl: https://avatars.githubusercontent.com/u/113442282?v=4\n+    url: https://github.com/ibrahimpelumi6142\n   - login: nilslindemann\n     avatarUrl: https://avatars.githubusercontent.com/u/6892179?u=1dca6a22195d6cd1ab20737c0e19a4c55d639472&v=4\n     url: https://github.com/nilslindemann\n@@ -116,124 +110,127 @@ sponsors:\n   - login: Leay15\n     avatarUrl: https://avatars.githubusercontent.com/u/32212558?u=c4aa9c1737e515959382a5515381757b1fd86c53&v=4\n     url: https://github.com/Leay15\n-  - login: Karine-Bauch\n-    avatarUrl: https://avatars.githubusercontent.com/u/90465103?u=7feb1018abb1a5631cfd9a91fea723d1ceb5f49b&v=4\n-    url: https://github.com/Karine-Bauch\n   - login: jugeeem\n     avatarUrl: https://avatars.githubusercontent.com/u/116043716?u=ae590d79c38ac79c91b9c5caa6887d061e865a3d&v=4\n     url: https://github.com/jugeeem\n-  - login: patsatsia\n-    avatarUrl: https://avatars.githubusercontent.com/u/61111267?u=3271b85f7a37b479c8d0ae0a235182e83c166edf&v=4\n-    url: https://github.com/patsatsia\n-  - login: anthonycepeda\n-    avatarUrl: https://avatars.githubusercontent.com/u/72019805?u=60bdf46240cff8fca482ff0fc07d963fd5e1a27c&v=4\n-    url: https://github.com/anthonycepeda\n-  - login: patricioperezv\n-    avatarUrl: https://avatars.githubusercontent.com/u/73832292?u=5f471f156e19ee7920e62ae0f4a47b95580e61cf&v=4\n-    url: https://github.com/patricioperezv\n-  - login: chickenandstats\n-    avatarUrl: https://avatars.githubusercontent.com/u/79477966?u=ae2b894aa954070db1d7830dab99b49eba4e4567&v=4\n-    url: https://github.com/chickenandstats\n+  - login: Karine-Bauch\n+    avatarUrl: https://avatars.githubusercontent.com/u/90465103?u=7feb1018abb1a5631cfd9a91fea723d1ceb5f49b&v=4\n+    url: https://github.com/Karine-Bauch\n   - login: kaoru0310\n     avatarUrl: https://avatars.githubusercontent.com/u/80977929?u=1b61d10142b490e56af932ddf08a390fae8ee94f&v=4\n     url: https://github.com/kaoru0310\n-  - login: jstanden\n-    avatarUrl: https://avatars.githubusercontent.com/u/63288?u=c3658d57d2862c607a0e19c2101c3c51876e36ad&v=4\n-    url: https://github.com/jstanden\n-  - login: knallgelb\n-    avatarUrl: https://avatars.githubusercontent.com/u/2358812?u=c48cb6362b309d74cbf144bd6ad3aed3eb443e82&v=4\n-    url: https://github.com/knallgelb\n-  - login: dblackrun\n-    avatarUrl: https://avatars.githubusercontent.com/u/3528486?v=4\n-    url: https://github.com/dblackrun\n-  - login: zsinx6\n-    avatarUrl: https://avatars.githubusercontent.com/u/3532625?u=ba75a5dc744d1116ccfeaaf30d41cb2fe81fe8dd&v=4\n-    url: https://github.com/zsinx6\n-  - login: kennywakeland\n-    avatarUrl: https://avatars.githubusercontent.com/u/3631417?u=7c8f743f1ae325dfadea7c62bbf1abd6a824fc55&v=4\n-    url: https://github.com/kennywakeland\n-  - login: aacayaco\n-    avatarUrl: https://avatars.githubusercontent.com/u/3634801?u=eaadda178c964178fcb64886f6c732172c8f8219&v=4\n-    url: https://github.com/aacayaco\n-  - login: anomaly\n-    avatarUrl: https://avatars.githubusercontent.com/u/3654837?v=4\n-    url: https://github.com/anomaly\n-  - login: mj0331\n-    avatarUrl: https://avatars.githubusercontent.com/u/3890353?u=1c627ac1a024515b4871de5c3ebbfaa1a57f65d4&v=4\n-    url: https://github.com/mj0331\n-  - login: gorhack\n-    avatarUrl: https://avatars.githubusercontent.com/u/4141690?u=ec119ebc4bdf00a7bc84657a71aa17834f4f27f3&v=4\n-    url: https://github.com/gorhack\n-  - login: Ryandaydev\n-    avatarUrl: https://avatars.githubusercontent.com/u/4292423?u=679ff84cb7b988c5795a5fa583857f574a055763&v=4\n-    url: https://github.com/Ryandaydev\n-  - login: jaredtrog\n-    avatarUrl: https://avatars.githubusercontent.com/u/4381365?v=4\n-    url: https://github.com/jaredtrog\n+  - login: chickenandstats\n+    avatarUrl: https://avatars.githubusercontent.com/u/79477966?u=ae2b894aa954070db1d7830dab99b49eba4e4567&v=4\n+    url: https://github.com/chickenandstats\n+  - login: patricioperezv\n+    avatarUrl: https://avatars.githubusercontent.com/u/73832292?u=5f471f156e19ee7920e62ae0f4a47b95580e61cf&v=4\n+    url: https://github.com/patricioperezv\n+  - login: anthonycepeda\n+    avatarUrl: https://avatars.githubusercontent.com/u/72019805?u=60bdf46240cff8fca482ff0fc07d963fd5e1a27c&v=4\n+    url: https://github.com/anthonycepeda\n+  - login: AalbatrossGuy\n+    avatarUrl: https://avatars.githubusercontent.com/u/68378354?u=0bdeea9356d24f638244131f6d8d1e2d2f3601ca&v=4\n+    url: https://github.com/AalbatrossGuy\n+  - login: patsatsia\n+    avatarUrl: https://avatars.githubusercontent.com/u/61111267?u=3271b85f7a37b479c8d0ae0a235182e83c166edf&v=4\n+    url: https://github.com/patsatsia\n   - login: oliverxchen\n     avatarUrl: https://avatars.githubusercontent.com/u/4471774?u=534191f25e32eeaadda22dfab4b0a428733d5489&v=4\n     url: https://github.com/oliverxchen\n-  - login: paulcwatts\n-    avatarUrl: https://avatars.githubusercontent.com/u/150269?u=1819e145d573b44f0ad74b87206d21cd60331d4e&v=4\n-    url: https://github.com/paulcwatts\n-  - login: robintw\n-    avatarUrl: https://avatars.githubusercontent.com/u/296686?v=4\n-    url: https://github.com/robintw\n-  - login: pamelafox\n-    avatarUrl: https://avatars.githubusercontent.com/u/297042?v=4\n-    url: https://github.com/pamelafox\n-  - login: wshayes\n-    avatarUrl: https://avatars.githubusercontent.com/u/365303?u=07ca03c5ee811eb0920e633cc3c3db73dbec1aa5&v=4\n-    url: https://github.com/wshayes\n-  - login: koxudaxi\n-    avatarUrl: https://avatars.githubusercontent.com/u/630670?u=507d8577b4b3670546b449c4c2ccbc5af40d72f7&v=4\n-    url: https://github.com/koxudaxi\n-  - login: falkben\n-    avatarUrl: https://avatars.githubusercontent.com/u/653031?u=ad9838e089058c9e5a0bab94c0eec7cc181e0cd0&v=4\n-    url: https://github.com/falkben\n-  - login: mintuhouse\n-    avatarUrl: https://avatars.githubusercontent.com/u/769950?u=ecfbd79a97d33177e0d093ddb088283cf7fe8444&v=4\n-    url: https://github.com/mintuhouse\n+  - login: jaredtrog\n+    avatarUrl: https://avatars.githubusercontent.com/u/4381365?v=4\n+    url: https://github.com/jaredtrog\n+  - login: Ryandaydev\n+    avatarUrl: https://avatars.githubusercontent.com/u/4292423?u=679ff84cb7b988c5795a5fa583857f574a055763&v=4\n+    url: https://github.com/Ryandaydev\n+  - login: gorhack\n+    avatarUrl: https://avatars.githubusercontent.com/u/4141690?u=ec119ebc4bdf00a7bc84657a71aa17834f4f27f3&v=4\n+    url: https://github.com/gorhack\n+  - login: mj0331\n+    avatarUrl: https://avatars.githubusercontent.com/u/3890353?u=1c627ac1a024515b4871de5c3ebbfaa1a57f65d4&v=4\n+    url: https://github.com/mj0331\n+  - login: anomaly\n+    avatarUrl: https://avatars.githubusercontent.com/u/3654837?v=4\n+    url: https://github.com/anomaly\n+  - login: aacayaco\n+    avatarUrl: https://avatars.githubusercontent.com/u/3634801?u=eaadda178c964178fcb64886f6c732172c8f8219&v=4\n+    url: https://github.com/aacayaco\n+  - login: kennywakeland\n+    avatarUrl: https://avatars.githubusercontent.com/u/3631417?u=7c8f743f1ae325dfadea7c62bbf1abd6a824fc55&v=4\n+    url: https://github.com/kennywakeland\n+  - login: zsinx6\n+    avatarUrl: https://avatars.githubusercontent.com/u/3532625?u=ba75a5dc744d1116ccfeaaf30d41cb2fe81fe8dd&v=4\n+    url: https://github.com/zsinx6\n+  - login: dblackrun\n+    avatarUrl: https://avatars.githubusercontent.com/u/3528486?v=4\n+    url: https://github.com/dblackrun\n+  - login: knallgelb\n+    avatarUrl: https://avatars.githubusercontent.com/u/2358812?u=c48cb6362b309d74cbf144bd6ad3aed3eb443e82&v=4\n+    url: https://github.com/knallgelb\n   - login: dodo5522\n     avatarUrl: https://avatars.githubusercontent.com/u/1362607?u=9bf1e0e520cccc547c046610c468ce6115bbcf9f&v=4\n     url: https://github.com/dodo5522\n-  - login: wdwinslow\n-    avatarUrl: https://avatars.githubusercontent.com/u/11562137?u=371272f2c69e680e0559a7b0a57385e83a5dc728&v=4\n-    url: https://github.com/wdwinslow\n-  - login: jsoques\n-    avatarUrl: https://avatars.githubusercontent.com/u/12414216?u=620921d94196546cc8b9eae2cc4cbc3f95bab42f&v=4\n-    url: https://github.com/jsoques\n-  - login: dannywade\n-    avatarUrl: https://avatars.githubusercontent.com/u/13680237?u=418ee985bd41577b20fde81417fb2d901e875e8a&v=4\n-    url: https://github.com/dannywade\n-  - login: khadrawy\n-    avatarUrl: https://avatars.githubusercontent.com/u/13686061?u=59f25ef42ecf04c22657aac4238ce0e2d3d30304&v=4\n-    url: https://github.com/khadrawy\n-  - login: mjohnsey\n-    avatarUrl: https://avatars.githubusercontent.com/u/16784016?u=38fad2e6b411244560b3af99c5f5a4751bc81865&v=4\n-    url: https://github.com/mjohnsey\n-  - login: ashi-agrawal\n-    avatarUrl: https://avatars.githubusercontent.com/u/17105294?u=99c7a854035e5398d8e7b674f2d42baae6c957f8&v=4\n-    url: https://github.com/ashi-agrawal\n+  - login: mintuhouse\n+    avatarUrl: https://avatars.githubusercontent.com/u/769950?u=ecfbd79a97d33177e0d093ddb088283cf7fe8444&v=4\n+    url: https://github.com/mintuhouse\n+  - login: falkben\n+    avatarUrl: https://avatars.githubusercontent.com/u/653031?u=ad9838e089058c9e5a0bab94c0eec7cc181e0cd0&v=4\n+    url: https://github.com/falkben\n+  - login: koxudaxi\n+    avatarUrl: https://avatars.githubusercontent.com/u/630670?u=507d8577b4b3670546b449c4c2ccbc5af40d72f7&v=4\n+    url: https://github.com/koxudaxi\n+  - login: wshayes\n+    avatarUrl: https://avatars.githubusercontent.com/u/365303?u=07ca03c5ee811eb0920e633cc3c3db73dbec1aa5&v=4\n+    url: https://github.com/wshayes\n+  - login: pamelafox\n+    avatarUrl: https://avatars.githubusercontent.com/u/297042?v=4\n+    url: https://github.com/pamelafox\n+  - login: robintw\n+    avatarUrl: https://avatars.githubusercontent.com/u/296686?v=4\n+    url: https://github.com/robintw\n+  - login: jstanden\n+    avatarUrl: https://avatars.githubusercontent.com/u/63288?u=c3658d57d2862c607a0e19c2101c3c51876e36ad&v=4\n+    url: https://github.com/jstanden\n   - login: RaamEEIL\n     avatarUrl: https://avatars.githubusercontent.com/u/20320552?v=4\n     url: https://github.com/RaamEEIL\n-  - login: ternaus\n-    avatarUrl: https://avatars.githubusercontent.com/u/5481618?u=513a26b02a39e7a28d587cd37c6cc877ea368e6e&v=4\n-    url: https://github.com/ternaus\n-  - login: eseglem\n-    avatarUrl: https://avatars.githubusercontent.com/u/5920492?u=208d419cf667b8ac594c82a8db01932c7e50d057&v=4\n-    url: https://github.com/eseglem\n-  - login: FernandoCelmer\n-    avatarUrl: https://avatars.githubusercontent.com/u/6262214?u=58ba6d5888fa7f355934e52db19f950e20b38162&v=4\n-    url: https://github.com/FernandoCelmer\n-  - login: Rehket\n-    avatarUrl: https://avatars.githubusercontent.com/u/7015688?u=3afb0ba200feebbc7f958950e92db34df2a3c172&v=4\n-    url: https://github.com/Rehket\n+  - login: ashi-agrawal\n+    avatarUrl: https://avatars.githubusercontent.com/u/17105294?u=99c7a854035e5398d8e7b674f2d42baae6c957f8&v=4\n+    url: https://github.com/ashi-agrawal\n+  - login: mjohnsey\n+    avatarUrl: https://avatars.githubusercontent.com/u/16784016?u=38fad2e6b411244560b3af99c5f5a4751bc81865&v=4\n+    url: https://github.com/mjohnsey\n+  - login: khadrawy\n+    avatarUrl: https://avatars.githubusercontent.com/u/13686061?u=59f25ef42ecf04c22657aac4238ce0e2d3d30304&v=4\n+    url: https://github.com/khadrawy\n+  - login: dannywade\n+    avatarUrl: https://avatars.githubusercontent.com/u/13680237?u=418ee985bd41577b20fde81417fb2d901e875e8a&v=4\n+    url: https://github.com/dannywade\n+  - login: jsoques\n+    avatarUrl: https://avatars.githubusercontent.com/u/12414216?u=620921d94196546cc8b9eae2cc4cbc3f95bab42f&v=4\n+    url: https://github.com/jsoques\n+  - login: wdwinslow\n+    avatarUrl: https://avatars.githubusercontent.com/u/11562137?u=371272f2c69e680e0559a7b0a57385e83a5dc728&v=4\n+    url: https://github.com/wdwinslow\n   - login: hiancdtrsnm\n     avatarUrl: https://avatars.githubusercontent.com/u/7343177?v=4\n     url: https://github.com/hiancdtrsnm\n-- - login: manoelpqueiroz\n+  - login: Rehket\n+    avatarUrl: https://avatars.githubusercontent.com/u/7015688?u=3afb0ba200feebbc7f958950e92db34df2a3c172&v=4\n+    url: https://github.com/Rehket\n+  - login: FernandoCelmer\n+    avatarUrl: https://avatars.githubusercontent.com/u/6262214?u=58ba6d5888fa7f355934e52db19f950e20b38162&v=4\n+    url: https://github.com/FernandoCelmer\n+  - login: eseglem\n+    avatarUrl: https://avatars.githubusercontent.com/u/5920492?u=208d419cf667b8ac594c82a8db01932c7e50d057&v=4\n+    url: https://github.com/eseglem\n+  - login: ternaus\n+    avatarUrl: https://avatars.githubusercontent.com/u/5481618?u=513a26b02a39e7a28d587cd37c6cc877ea368e6e&v=4\n+    url: https://github.com/ternaus\n+- - login: Artur-Galstyan\n+    avatarUrl: https://avatars.githubusercontent.com/u/63471891?u=e8691f386037e51a737cc0ba866cd8c89e5cf109&v=4\n+    url: https://github.com/Artur-Galstyan\n+  - login: manoelpqueiroz\n     avatarUrl: https://avatars.githubusercontent.com/u/23669137?u=b12e84b28a84369ab5b30bd5a79e5788df5a0756&v=4\n     url: https://github.com/manoelpqueiroz\n - - login: pawamoy\n@@ -254,9 +251,12 @@ sponsors:\n   - login: hgalytoby\n     avatarUrl: https://avatars.githubusercontent.com/u/50397689?u=6cc9028f3db63f8f60ad21c17b1ce4b88c4e2e60&v=4\n     url: https://github.com/hgalytoby\n-  - login: nisutec\n-    avatarUrl: https://avatars.githubusercontent.com/u/25281462?u=e562484c451fdfc59053163f64405f8eb262b8b0&v=4\n-    url: https://github.com/nisutec\n+  - login: johnl28\n+    avatarUrl: https://avatars.githubusercontent.com/u/54412955?u=47dd06082d1c39caa90c752eb55566e4f3813957&v=4\n+    url: https://github.com/johnl28\n+  - login: danielunderwood\n+    avatarUrl: https://avatars.githubusercontent.com/u/4472301?v=4\n+    url: https://github.com/danielunderwood\n   - login: hoenie-ams\n     avatarUrl: https://avatars.githubusercontent.com/u/25708487?u=cda07434f0509ac728d9edf5e681117c0f6b818b&v=4\n     url: https://github.com/hoenie-ams\n@@ -267,93 +267,87 @@ sponsors:\n     avatarUrl: https://avatars.githubusercontent.com/u/33275230?u=eb223cad27017bb1e936ee9b429b450d092d0236&v=4\n     url: https://github.com/engineerjoe440\n   - login: bnkc\n-    avatarUrl: https://avatars.githubusercontent.com/u/34930566?u=db5e6f4f87836cad26c2aa90ce390ce49041c5a9&v=4\n+    avatarUrl: https://avatars.githubusercontent.com/u/34930566?u=4771ac4e64066f0847d40e5b29910adabd9b2372&v=4\n     url: https://github.com/bnkc\n   - login: petercool\n     avatarUrl: https://avatars.githubusercontent.com/u/37613029?u=75aa8c6729e6e8f85a300561c4dbeef9d65c8797&v=4\n     url: https://github.com/petercool\n-  - login: johnl28\n-    avatarUrl: https://avatars.githubusercontent.com/u/54412955?u=47dd06082d1c39caa90c752eb55566e4f3813957&v=4\n-    url: https://github.com/johnl28\n-  - login: PunRabbit\n-    avatarUrl: https://avatars.githubusercontent.com/u/70463212?u=1a835cfbc99295a60c8282f6aa6199d1b42241a5&v=4\n-    url: https://github.com/PunRabbit\n   - login: PelicanQ\n     avatarUrl: https://avatars.githubusercontent.com/u/77930606?v=4\n     url: https://github.com/PelicanQ\n-  - login: WillHogan\n-    avatarUrl: https://avatars.githubusercontent.com/u/1661551?u=8a80356e3e7d5a417157aba7ea565dabc8678327&v=4\n-    url: https://github.com/WillHogan\n+  - login: PunRabbit\n+    avatarUrl: https://avatars.githubusercontent.com/u/70463212?u=1a835cfbc99295a60c8282f6aa6199d1b42241a5&v=4\n+    url: https://github.com/PunRabbit\n   - login: my3\n     avatarUrl: https://avatars.githubusercontent.com/u/1825270?v=4\n     url: https://github.com/my3\n-  - login: danielunderwood\n-    avatarUrl: https://avatars.githubusercontent.com/u/4472301?v=4\n-    url: https://github.com/danielunderwood\n-  - login: ddanier\n-    avatarUrl: https://avatars.githubusercontent.com/u/113563?u=ed1dc79de72f93bd78581f88ebc6952b62f472da&v=4\n-    url: https://github.com/ddanier\n-  - login: bryanculbertson\n-    avatarUrl: https://avatars.githubusercontent.com/u/144028?u=defda4f90e93429221cc667500944abde60ebe4a&v=4\n-    url: https://github.com/bryanculbertson\n-  - login: slafs\n-    avatarUrl: https://avatars.githubusercontent.com/u/210173?v=4\n-    url: https://github.com/slafs\n-  - login: ceb10n\n-    avatarUrl: https://avatars.githubusercontent.com/u/235213?u=edcce471814a1eba9f0cdaa4cd0de18921a940a6&v=4\n-    url: https://github.com/ceb10n\n-  - login: tochikuji\n-    avatarUrl: https://avatars.githubusercontent.com/u/851759?v=4\n-    url: https://github.com/tochikuji\n+  - login: WillHogan\n+    avatarUrl: https://avatars.githubusercontent.com/u/1661551?u=8a80356e3e7d5a417157aba7ea565dabc8678327&v=4\n+    url: https://github.com/WillHogan\n   - login: miguelgr\n     avatarUrl: https://avatars.githubusercontent.com/u/1484589?u=54556072b8136efa12ae3b6902032ea2a39ace4b&v=4\n     url: https://github.com/miguelgr\n-  - login: xncbf\n-    avatarUrl: https://avatars.githubusercontent.com/u/9462045?u=a80a7bb349555b277645632ed66639ff43400614&v=4\n-    url: https://github.com/xncbf\n-  - login: DMantis\n-    avatarUrl: https://avatars.githubusercontent.com/u/9536869?u=652dd0d49717803c0cbcbf44f7740e53cf2d4892&v=4\n-    url: https://github.com/DMantis\n-  - login: hard-coders\n-    avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=95db33927bbff1ed1c07efddeb97ac2ff33068ed&v=4\n-    url: https://github.com/hard-coders\n-  - login: mntolia\n-    avatarUrl: https://avatars.githubusercontent.com/u/10390224?v=4\n-    url: https://github.com/mntolia\n-  - login: Zuzah\n-    avatarUrl: https://avatars.githubusercontent.com/u/10934846?u=1ef43e075ddc87bd1178372bf4d95ee6175cae27&v=4\n-    url: https://github.com/Zuzah\n-  - login: TheR1D\n-    avatarUrl: https://avatars.githubusercontent.com/u/16740832?u=b0dfdbdb27b79729430c71c6128962f77b7b53f7&v=4\n-    url: https://github.com/TheR1D\n+  - login: tochikuji\n+    avatarUrl: https://avatars.githubusercontent.com/u/851759?v=4\n+    url: https://github.com/tochikuji\n+  - login: ceb10n\n+    avatarUrl: https://avatars.githubusercontent.com/u/235213?u=edcce471814a1eba9f0cdaa4cd0de18921a940a6&v=4\n+    url: https://github.com/ceb10n\n+  - login: slafs\n+    avatarUrl: https://avatars.githubusercontent.com/u/210173?v=4\n+    url: https://github.com/slafs\n+  - login: bryanculbertson\n+    avatarUrl: https://avatars.githubusercontent.com/u/144028?u=defda4f90e93429221cc667500944abde60ebe4a&v=4\n+    url: https://github.com/bryanculbertson\n+  - login: ddanier\n+    avatarUrl: https://avatars.githubusercontent.com/u/113563?u=ed1dc79de72f93bd78581f88ebc6952b62f472da&v=4\n+    url: https://github.com/ddanier\n+  - login: nisutec\n+    avatarUrl: https://avatars.githubusercontent.com/u/25281462?u=e562484c451fdfc59053163f64405f8eb262b8b0&v=4\n+    url: https://github.com/nisutec\n   - login: joshuatz\n     avatarUrl: https://avatars.githubusercontent.com/u/17817563?u=f1bf05b690d1fc164218f0b420cdd3acb7913e21&v=4\n     url: https://github.com/joshuatz\n-  - login: rangulvers\n-    avatarUrl: https://avatars.githubusercontent.com/u/5235430?u=e254d4af4ace5a05fa58372ae677c7d26f0d5a53&v=4\n-    url: https://github.com/rangulvers\n-  - login: sdevkota\n-    avatarUrl: https://avatars.githubusercontent.com/u/5250987?u=4ed9a120c89805a8aefda1cbdc0cf6512e64d1b4&v=4\n-    url: https://github.com/sdevkota\n-  - login: Baghdady92\n-    avatarUrl: https://avatars.githubusercontent.com/u/5708590?v=4\n-    url: https://github.com/Baghdady92\n-  - login: KentShikama\n-    avatarUrl: https://avatars.githubusercontent.com/u/6329898?u=8b236810db9b96333230430837e1f021f9246da1&v=4\n-    url: https://github.com/KentShikama\n-  - login: katnoria\n-    avatarUrl: https://avatars.githubusercontent.com/u/7674948?u=09767eb13e07e09496c5fee4e5ce21d9eac34a56&v=4\n-    url: https://github.com/katnoria\n-  - login: harsh183\n-    avatarUrl: https://avatars.githubusercontent.com/u/7780198?v=4\n-    url: https://github.com/harsh183\n+  - login: TheR1D\n+    avatarUrl: https://avatars.githubusercontent.com/u/16740832?u=b0dfdbdb27b79729430c71c6128962f77b7b53f7&v=4\n+    url: https://github.com/TheR1D\n+  - login: Zuzah\n+    avatarUrl: https://avatars.githubusercontent.com/u/10934846?u=1ef43e075ddc87bd1178372bf4d95ee6175cae27&v=4\n+    url: https://github.com/Zuzah\n+  - login: mntolia\n+    avatarUrl: https://avatars.githubusercontent.com/u/10390224?v=4\n+    url: https://github.com/mntolia\n+  - login: hard-coders\n+    avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=78d12d1acdf853c817700145e73de7fd9e5d068b&v=4\n+    url: https://github.com/hard-coders\n+  - login: DMantis\n+    avatarUrl: https://avatars.githubusercontent.com/u/9536869?u=652dd0d49717803c0cbcbf44f7740e53cf2d4892&v=4\n+    url: https://github.com/DMantis\n+  - login: xncbf\n+    avatarUrl: https://avatars.githubusercontent.com/u/9462045?u=a80a7bb349555b277645632ed66639ff43400614&v=4\n+    url: https://github.com/xncbf\n   - login: moonape1226\n     avatarUrl: https://avatars.githubusercontent.com/u/8532038?u=d9f8b855a429fff9397c3833c2ff83849ebf989d&v=4\n     url: https://github.com/moonape1226\n-- - login: andrecorumba\n-    avatarUrl: https://avatars.githubusercontent.com/u/37807517?u=9b9be3b41da9bda60957da9ef37b50dbf65baa61&v=4\n-    url: https://github.com/andrecorumba\n-  - login: KOZ39\n+  - login: harsh183\n+    avatarUrl: https://avatars.githubusercontent.com/u/7780198?v=4\n+    url: https://github.com/harsh183\n+  - login: katnoria\n+    avatarUrl: https://avatars.githubusercontent.com/u/7674948?u=09767eb13e07e09496c5fee4e5ce21d9eac34a56&v=4\n+    url: https://github.com/katnoria\n+  - login: KentShikama\n+    avatarUrl: https://avatars.githubusercontent.com/u/6329898?u=8b236810db9b96333230430837e1f021f9246da1&v=4\n+    url: https://github.com/KentShikama\n+  - login: Baghdady92\n+    avatarUrl: https://avatars.githubusercontent.com/u/5708590?v=4\n+    url: https://github.com/Baghdady92\n+  - login: sdevkota\n+    avatarUrl: https://avatars.githubusercontent.com/u/5250987?u=4ed9a120c89805a8aefda1cbdc0cf6512e64d1b4&v=4\n+    url: https://github.com/sdevkota\n+  - login: rangulvers\n+    avatarUrl: https://avatars.githubusercontent.com/u/5235430?u=e254d4af4ace5a05fa58372ae677c7d26f0d5a53&v=4\n+    url: https://github.com/rangulvers\n+- - login: KOZ39\n     avatarUrl: https://avatars.githubusercontent.com/u/38822500?u=9dfc0a697df1c9628f08e20dc3fb17b1afc4e5a7&v=4\n     url: https://github.com/KOZ39\n   - login: rwxd\n@@ -365,27 +359,24 @@ sponsors:\n   - login: Olegt0rr\n     avatarUrl: https://avatars.githubusercontent.com/u/25399456?u=3e87b5239a2f4600975ba13be73054f8567c6060&v=4\n     url: https://github.com/Olegt0rr\n-  - login: dinoz0rg\n-    avatarUrl: https://avatars.githubusercontent.com/u/32940067?u=739cda1eb123a2dd5e1db45c361396f239e23f8b&v=4\n-    url: https://github.com/dinoz0rg\n   - login: larsyngvelundin\n     avatarUrl: https://avatars.githubusercontent.com/u/34173819?u=74958599695bf83ac9f1addd935a51548a10c6b0&v=4\n     url: https://github.com/larsyngvelundin\n-  - login: hippoley\n-    avatarUrl: https://avatars.githubusercontent.com/u/135493401?u=1164ef48a645a7c12664fabc1638fbb7e1c459b0&v=4\n-    url: https://github.com/hippoley\n-  - login: 4anklee\n-    avatarUrl: https://avatars.githubusercontent.com/u/144109238?u=a79c0d581b2a3d8f3897e7ef4c012640a6c1eb3a&v=4\n-    url: https://github.com/4anklee\n+  - login: andrecorumba\n+    avatarUrl: https://avatars.githubusercontent.com/u/37807517?u=9b9be3b41da9bda60957da9ef37b50dbf65baa61&v=4\n+    url: https://github.com/andrecorumba\n   - login: CoderDeltaLAN\n     avatarUrl: https://avatars.githubusercontent.com/u/152043745?u=4ff541efffb7d134e60c5fcf2dd1e343f90bb782&v=4\n     url: https://github.com/CoderDeltaLAN\n-  - login: onestn\n-    avatarUrl: https://avatars.githubusercontent.com/u/62360849?u=746dd21c34e7e06eefb11b03e8bb01aaae3c2a4f&v=4\n-    url: https://github.com/onestn\n+  - login: hippoley\n+    avatarUrl: https://avatars.githubusercontent.com/u/135493401?u=1164ef48a645a7c12664fabc1638fbb7e1c459b0&v=4\n+    url: https://github.com/hippoley\n   - login: nayasinghania\n     avatarUrl: https://avatars.githubusercontent.com/u/74111380?u=752e99a5e139389fdc0a0677122adc08438eb076&v=4\n     url: https://github.com/nayasinghania\n+  - login: onestn\n+    avatarUrl: https://avatars.githubusercontent.com/u/62360849?u=746dd21c34e7e06eefb11b03e8bb01aaae3c2a4f&v=4\n+    url: https://github.com/onestn\n   - login: Toothwitch\n     avatarUrl: https://avatars.githubusercontent.com/u/1710406?u=5eebb23b46cd26e48643b9e5179536cad491c17a&v=4\n     url: https://github.com/Toothwitch"}, {"role": "assistant", "content": "docs: update github sponsors list"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/crypto/rsa/rsa_test.go | 6 ++++++\n 1 file changed, 6 insertions(+)\n\ndiff --git a/src/crypto/rsa/rsa_test.go b/src/crypto/rsa/rsa_test.go\nindex 5ae4c1dd..124fba1e 100644\n--- a/src/crypto/rsa/rsa_test.go\n+++ b/src/crypto/rsa/rsa_test.go\n@@ -145,6 +145,12 @@ d8Y7\n }\n \n func testKeyBasics(t *testing.T, priv *PrivateKey) {\n+\tdefer func() {\n+\t\tif t.Failed() {\n+\t\t\tt.Logf(\"failed key: %#v\", priv)\n+\t\t}\n+\t}()\n+\n \tif err := priv.Validate(); err != nil {\n \t\tt.Errorf(\"Validate() failed: %s\", err)\n \t}"}, {"role": "assistant", "content": "test(rsa): add debug logging for failed key tests"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 4 ++++\n 1 file changed, 4 insertions(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 9bd794f..f9b694e 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -7,6 +7,10 @@ hide:\n \n ## Latest Changes\n \n+### Docs\n+\n+* \ud83d\udcdd Specify language code for code block. PR [#14656](https://github.com/fastapi/fastapi/pull/14656) by [@YuriiMotov](https://github.com/YuriiMotov).\n+\n ### Translations\n \n * \ud83d\udd27 Add LLM prompt file for Turkish, generated from the existing translations. PR [#14547](https://github.com/fastapi/fastapi/pull/14547) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: add release notes for PR #14656"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 2a2b0d6..1df9e63 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -9,6 +9,7 @@ hide:\n \n ### Docs\n \n+* \ud83d\udcdd Update docs about managing translations. PR [#14704](https://github.com/fastapi/fastapi/pull/14704) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udcdd Update docs for contributing with translations. PR [#14701](https://github.com/fastapi/fastapi/pull/14701) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udcdd Specify language code for code block. PR [#14656](https://github.com/fastapi/fastapi/pull/14656) by [@YuriiMotov](https://github.com/YuriiMotov).\n "}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex f7d8cb5..818a553 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -19,6 +19,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udd27 Add pre-commit local script to fix language translations. PR [#14683](https://github.com/fastapi/fastapi/pull/14683) by [@tiangolo](https://github.com/tiangolo).\n * \u2b06\ufe0f  Migrate to uv. PR [#14676](https://github.com/fastapi/fastapi/pull/14676) by [@DoctorJohn](https://github.com/DoctorJohn).\n * \ud83d\udd28 Add LLM translations tool fixer. PR [#14652](https://github.com/fastapi/fastapi/pull/14652) by [@YuriiMotov](https://github.com/YuriiMotov).\n * \ud83d\udc65 Update FastAPI People - Sponsors. PR [#14626](https://github.com/fastapi/fastapi/pull/14626) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: add pre-commit script to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex f9b694e..c1d2456 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -19,6 +19,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udd28 Add LLM translations tool fixer. PR [#14652](https://github.com/fastapi/fastapi/pull/14652) by [@YuriiMotov](https://github.com/YuriiMotov).\n * \ud83d\udc65 Update FastAPI People - Sponsors. PR [#14626](https://github.com/fastapi/fastapi/pull/14626) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc65 Update FastAPI GitHub topic repositories. PR [#14630](https://github.com/fastapi/fastapi/pull/14630) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc65 Update FastAPI People - Contributors and Translators. PR [#14625](https://github.com/fastapi/fastapi/pull/14625) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: add LLM translations tool fixer to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../internal/simd_test/simulation_helpers_test.go  | 87 ++++++++++++++++++++++\n src/simd/archsimd/internal/simd_test/unary_test.go | 42 +++++++++++\n 2 files changed, 129 insertions(+)\n\ndiff --git a/src/simd/archsimd/internal/simd_test/simulation_helpers_test.go b/src/simd/archsimd/internal/simd_test/simulation_helpers_test.go\nindex a51912a4..da107d80 100644\n--- a/src/simd/archsimd/internal/simd_test/simulation_helpers_test.go\n+++ b/src/simd/archsimd/internal/simd_test/simulation_helpers_test.go\n@@ -330,3 +330,90 @@ func imaSlice[T integer](x, y, z []T) []T {\n func fmaSlice[T float](x, y, z []T) []T {\n \treturn map3[T](fma)(x, y, z)\n }\n+\n+func satToInt8[T integer](x T) int8 {\n+\tvar m int8 = -128\n+\tvar M int8 = 127\n+\tif T(M) < T(m) { // expecting T being a larger type\n+\t\tpanic(\"bad input type\")\n+\t}\n+\tif x < T(m) {\n+\t\treturn m\n+\t}\n+\tif x > T(M) {\n+\t\treturn M\n+\t}\n+\treturn int8(x)\n+}\n+\n+func satToUint8[T integer](x T) uint8 {\n+\tvar M uint8 = 255\n+\tif T(M) < 0 { // expecting T being a larger type\n+\t\tpanic(\"bad input type\")\n+\t}\n+\tif x < 0 {\n+\t\treturn 0\n+\t}\n+\tif x > T(M) {\n+\t\treturn M\n+\t}\n+\treturn uint8(x)\n+}\n+\n+func satToInt16[T integer](x T) int16 {\n+\tvar m int16 = -32768\n+\tvar M int16 = 32767\n+\tif T(M) < T(m) { // expecting T being a larger type\n+\t\tpanic(\"bad input type\")\n+\t}\n+\tif x < T(m) {\n+\t\treturn m\n+\t}\n+\tif x > T(M) {\n+\t\treturn M\n+\t}\n+\treturn int16(x)\n+}\n+\n+func satToUint16[T integer](x T) uint16 {\n+\tvar M uint16 = 65535\n+\tif T(M) < 0 { // expecting T being a larger type\n+\t\tpanic(\"bad input type\")\n+\t}\n+\tif x < 0 {\n+\t\treturn 0\n+\t}\n+\tif x > T(M) {\n+\t\treturn M\n+\t}\n+\treturn uint16(x)\n+}\n+\n+func satToInt32[T integer](x T) int32 {\n+\tvar m int32 = -1 << 31\n+\tvar M int32 = 1<<31 - 1\n+\tif T(M) < T(m) { // expecting T being a larger type\n+\t\tpanic(\"bad input type\")\n+\t}\n+\tif x < T(m) {\n+\t\treturn m\n+\t}\n+\tif x > T(M) {\n+\t\treturn M\n+\t}\n+\treturn int32(x)\n+}\n+\n+func satToUint32[T integer](x T) uint32 {\n+\tvar M uint32 = 1<<32 - 1\n+\tif T(M) < 0 { // expecting T being a larger type\n+\t\tpanic(\"bad input type\")\n+\t}\n+\tif x < 0 {\n+\t\treturn 0\n+\t}\n+\tif x > T(M) {\n+\t\treturn M\n+\t}\n+\treturn uint32(x)\n+}\ndiff --git a/src/simd/archsimd/internal/simd_test/unary_test.go b/src/simd/archsimd/internal/simd_test/unary_test.go\nindex 5d00eba0..097feb60 100644\n--- a/src/simd/archsimd/internal/simd_test/unary_test.go\n+++ b/src/simd/archsimd/internal/simd_test/unary_test.go\n@@ -270,3 +270,45 @@ func TestTruncate(t *testing.T) {\n \t\ttestUint64x8ConvertToUint32(t, archsimd.Uint64x8.TruncateToUint32, map1[uint64](toUint32))\n \t}\n }\n+\n+func TestSaturate(t *testing.T) {\n+\tif archsimd.X86.AVX512() {\n+\t\ttestInt16x8ConvertToInt8(t, archsimd.Int16x8.SaturateToInt8, map1n[int16](satToInt8, 16))\n+\t\ttestInt16x16ConvertToInt8(t, archsimd.Int16x16.SaturateToInt8, map1[int16](satToInt8))\n+\t\ttestInt16x32ConvertToInt8(t, archsimd.Int16x32.SaturateToInt8, map1[int16](satToInt8))\n+\t\ttestInt32x4ConvertToInt8(t, archsimd.Int32x4.SaturateToInt8, map1n[int32](satToInt8, 16))\n+\t\ttestInt32x8ConvertToInt8(t, archsimd.Int32x8.SaturateToInt8, map1n[int32](satToInt8, 16))\n+\t\ttestInt32x16ConvertToInt8(t, archsimd.Int32x16.SaturateToInt8, map1[int32](satToInt8))\n+\t\ttestInt64x2ConvertToInt8(t, archsimd.Int64x2.SaturateToInt8, map1n[int64](satToInt8, 16))\n+\t\ttestInt64x4ConvertToInt8(t, archsimd.Int64x4.SaturateToInt8, map1n[int64](satToInt8, 16))\n+\t\ttestInt64x8ConvertToInt8(t, archsimd.Int64x8.SaturateToInt8, map1n[int64](satToInt8, 16))\n+\t\ttestInt32x4ConvertToInt16(t, archsimd.Int32x4.SaturateToInt16, map1n[int32](satToInt16, 8))\n+\t\ttestInt32x8ConvertToInt16(t, archsimd.Int32x8.SaturateToInt16, map1[int32](satToInt16))\n+\t\ttestInt32x16ConvertToInt16(t, archsimd.Int32x16.SaturateToInt16, map1[int32](satToInt16))\n+\t\ttestInt64x2ConvertToInt16(t, archsimd.Int64x2.SaturateToInt16, map1n[int64](satToInt16, 8))\n+\t\ttestInt64x4ConvertToInt16(t, archsimd.Int64x4.SaturateToInt16, map1n[int64](satToInt16, 8))\n+\t\ttestInt64x8ConvertToInt16(t, archsimd.Int64x8.SaturateToInt16, map1[int64](satToInt16))\n+\t\ttestInt64x2ConvertToInt32(t, archsimd.Int64x2.SaturateToInt32, map1n[int64](satToInt32, 4))\n+\t\ttestInt64x4ConvertToInt32(t, archsimd.Int64x4.SaturateToInt32, map1[int64](satToInt32))\n+\t\ttestInt64x8ConvertToInt32(t, archsimd.Int64x8.SaturateToInt32, map1[int64](satToInt32))\n+\n+\t\ttestUint16x8ConvertToUint8(t, archsimd.Uint16x8.SaturateToUint8, map1n[uint16](satToUint8, 16))\n+\t\ttestUint16x16ConvertToUint8(t, archsimd.Uint16x16.SaturateToUint8, map1[uint16](satToUint8))\n+\t\ttestUint16x32ConvertToUint8(t, archsimd.Uint16x32.SaturateToUint8, map1[uint16](satToUint8))\n+\t\ttestUint32x4ConvertToUint8(t, archsimd.Uint32x4.SaturateToUint8, map1n[uint32](satToUint8, 16))\n+\t\ttestUint32x8ConvertToUint8(t, archsimd.Uint32x8.SaturateToUint8, map1n[uint32](satToUint8, 16))\n+\t\ttestUint32x16ConvertToUint8(t, archsimd.Uint32x16.SaturateToUint8, map1[uint32](satToUint8))\n+\t\ttestUint64x2ConvertToUint8(t, archsimd.Uint64x2.SaturateToUint8, map1n[uint64](satToUint8, 16))\n+\t\ttestUint64x4ConvertToUint8(t, archsimd.Uint64x4.SaturateToUint8, map1n[uint64](satToUint8, 16))\n+\t\ttestUint64x8ConvertToUint8(t, archsimd.Uint64x8.SaturateToUint8, map1n[uint64](satToUint8, 16))\n+\t\ttestUint32x4ConvertToUint16(t, archsimd.Uint32x4.SaturateToUint16, map1n[uint32](satToUint16, 8))\n+\t\ttestUint32x8ConvertToUint16(t, archsimd.Uint32x8.SaturateToUint16, map1[uint32](satToUint16))\n+\t\ttestUint32x16ConvertToUint16(t, archsimd.Uint32x16.SaturateToUint16, map1[uint32](satToUint16))\n+\t\ttestUint64x2ConvertToUint16(t, archsimd.Uint64x2.SaturateToUint16, map1n[uint64](satToUint16, 8))\n+\t\ttestUint64x4ConvertToUint16(t, archsimd.Uint64x4.SaturateToUint16, map1n[uint64](satToUint16, 8))\n+\t\ttestUint64x8ConvertToUint16(t, archsimd.Uint64x8.SaturateToUint16, map1[uint64](satToUint16))\n+\t\ttestUint64x2ConvertToUint32(t, archsimd.Uint64x2.SaturateToUint32, map1n[uint64](satToUint32, 4))\n+\t\ttestUint64x4ConvertToUint32(t, archsimd.Uint64x4.SaturateToUint32, map1[uint64](satToUint32))\n+\t\ttestUint64x8ConvertToUint32(t, archsimd.Uint64x8.SaturateToUint32, map1[uint64](satToUint32))\n+\t}\n+}"}, {"role": "assistant", "content": "test(simd): add saturate conversion tests"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/runtime_build_and_test.yml | 4 ++++\n 1 file changed, 4 insertions(+)\n\ndiff --git a/.github/workflows/runtime_build_and_test.yml b/.github/workflows/runtime_build_and_test.yml\nindex 6e5332e..c1cc8df 100644\n--- a/.github/workflows/runtime_build_and_test.yml\n+++ b/.github/workflows/runtime_build_and_test.yml\n@@ -3,6 +3,10 @@ name: (Runtime) Build and Test\n on:\n   push:\n     branches: [main]\n+    tags:\n+      # To get CI for backport releases.\n+      # This will duplicate CI for releases from main which is acceptable\n+      - \"v*\"\n   pull_request:\n     paths-ignore:\n       - compiler/**"}, {"role": "assistant", "content": "ci: add tag trigger for backport releases"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/ci.yml | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/.github/workflows/ci.yml b/.github/workflows/ci.yml\nindex 027695f..ee9fd61 100644\n--- a/.github/workflows/ci.yml\n+++ b/.github/workflows/ci.yml\n@@ -39,4 +39,4 @@ jobs:\n         run: pnpm build --withTypes\n \n       - name: Release\n-        run: pnpx pkg-pr-new publish --compact --pnpm './packages/*'\n+        run: pnpx pkg-pr-new publish --compact --pnpm './packages/*' --packageManager=pnpm,npm,yarn"}, {"role": "assistant", "content": "ci: add package manager options to release"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/contributing.md | 235 +++----------------------------------------\n scripts/docs.py              |  11 +-\n 2 files changed, 17 insertions(+), 229 deletions(-)\n\ndiff --git a/docs/en/docs/contributing.md b/docs/en/docs/contributing.md\nindex 18b7f60..be4706f 100644\n--- a/docs/en/docs/contributing.md\n+++ b/docs/en/docs/contributing.md\n@@ -177,252 +177,45 @@ as Uvicorn by default will use the port `8000`, the documentation on port `8008`\n \n ### Translations\n \n-/// warning | Attention\n-\n-**Update on Translations**\n-\n-We're updating the way we handle documentation translations.\n-\n-Until now, we invited community members to translate pages via pull requests, which were then reviewed by at least two native speakers. While this has helped bring FastAPI to many more users, we\u2019ve also run into several challenges - some languages have only a few translated pages, others are outdated and hard to maintain over time.\n-To improve this, we\u2019re working on automation tools \ud83e\udd16 to manage translations more efficiently. Once ready, documentation will be machine-translated and still reviewed by at least two native speakers \u2705 before publishing. This will allow us to keep translations up-to-date while reducing the review burden on maintainers.\n-\n-What\u2019s changing now:\n-\n-* \ud83d\udeab We\u2019re no longer accepting new community-submitted translation PRs.\n-\n-* \u23f3 Existing open PRs will be reviewed and can still be merged if completed within the next 3 weeks (since July 11 2025).\n-\n-* \ud83c\udf10 In the future, we will only support languages where at least three active native speakers are available to review and maintain translations.\n-\n-This transition will help us keep translations more consistent and timely while better supporting our contributors \ud83d\ude4c. Thank you to everyone who has contributed so far \u2014 your help has been invaluable! \ud83d\udc96\n-\n-///\n-\n-\n Help with translations is VERY MUCH appreciated! And it can't be done without the help from the community. \ud83c\udf0e \ud83d\ude80\n \n Here are the steps to help with translations.\n \n-#### Tips and guidelines\n-\n-* Check the currently <a href=\"https://github.com/fastapi/fastapi/pulls\" class=\"external-link\" target=\"_blank\">existing pull requests</a> for your language. You can filter the pull requests by the ones with the label for your language. For example, for Spanish, the label is <a href=\"https://github.com/fastapi/fastapi/pulls?q=is%3Aopen+sort%3Aupdated-desc+label%3Alang-es+label%3Aawaiting-review\" class=\"external-link\" target=\"_blank\">`lang-es`</a>.\n-\n-* Review those pull requests, requesting changes or approving them. For the languages I don't speak, I'll wait for several others to review the translation before merging.\n-\n-/// tip\n-\n-You can <a href=\"https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/commenting-on-a-pull-request\" class=\"external-link\" target=\"_blank\">add comments with change suggestions</a> to existing pull requests.\n-\n-Check the docs about <a href=\"https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-request-reviews\" class=\"external-link\" target=\"_blank\">adding a pull request review</a> to approve it or request changes.\n-\n-///\n+#### Review Translation PRs\n \n-* Check if there's a <a href=\"https://github.com/fastapi/fastapi/discussions/categories/translations\" class=\"external-link\" target=\"_blank\">GitHub Discussion</a> to coordinate translations for your language. You can subscribe to it, and when there's a new pull request to review, an automatic comment will be added to the discussion.\n-\n-* If you translate pages, add a single pull request per page translated. That will make it much easier for others to review it.\n-\n-* To check the 2-letter code for the language you want to translate, you can use the table <a href=\"https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes\" class=\"external-link\" target=\"_blank\">List of ISO 639-1 codes</a>.\n-\n-#### Existing language\n-\n-Let's say you want to translate a page for a language that already has translations for some pages, like Spanish.\n-\n-In the case of Spanish, the 2-letter code is `es`. So, the directory for Spanish translations is located at `docs/es/`.\n-\n-/// tip\n-\n-The main (\"official\") language is English, located at `docs/en/`.\n-\n-///\n+Translation pull requests are made by LLMs guided with prompts designed by the FastAPI team together with the community of native speakers for each supported language.\n \n-Now run the live server for the docs in Spanish:\n+These translations are normally still reviewed by native speakers, and here's where you can help!\n \n-<div class=\"termy\">\n-\n-```console\n-// Use the command \"live\" and pass the language code as a CLI argument\n-$ python ./scripts/docs.py live es\n-\n-<span style=\"color: green;\">[INFO]</span> Serving on http://127.0.0.1:8008\n-<span style=\"color: green;\">[INFO]</span> Start watching changes\n-<span style=\"color: green;\">[INFO]</span> Start detecting changes\n-```\n-\n-</div>\n-\n-/// tip\n-\n-Alternatively, you can perform the same steps that scripts does manually.\n-\n-Go into the language directory, for the Spanish translations it's at `docs/es/`:\n-\n-```console\n-$ cd docs/es/\n-```\n-\n-Then run `mkdocs` in that directory:\n-\n-```console\n-$ mkdocs serve --dev-addr 127.0.0.1:8008\n-```\n-\n-///\n-\n-Now you can go to <a href=\"http://127.0.0.1:8008\" class=\"external-link\" target=\"_blank\">http://127.0.0.1:8008</a> and see your changes live.\n-\n-You will see that every language has all the pages. But some pages are not translated and have an info box at the top, about the missing translation.\n-\n-Now let's say that you want to add a translation for the section [Features](features.md){.internal-link target=_blank}.\n-\n-* Copy the file at:\n-\n-```\n-docs/en/docs/features.md\n-```\n+* Check the currently <a href=\"https://github.com/fastapi/fastapi/pulls\" class=\"external-link\" target=\"_blank\">existing pull requests</a> for your language. You can filter the pull requests by the ones with the label for your language. For example, for Spanish, the label is <a href=\"https://github.com/fastapi/fastapi/pulls?q=is%3Aopen+sort%3Aupdated-desc+label%3Alang-es+label%3Aawaiting-review\" class=\"external-link\" target=\"_blank\">`lang-es`</a>.\n \n-* Paste it in exactly the same location but for the language you want to translate, e.g.:\n+* When reviewing a pull request, it's better not to suggest changes in the same pull request, because it is LLM generated, and it won't be possible to make sure that small individual changes are replicated in other similar sections, or that they are preserved when translating the same content again.\n \n-```\n-docs/es/docs/features.md\n-```\n+* Instead of adding suggestions to the translation PR, make the suggestions to the LLM prompt file for that language, in a new PR. For example, for Spanish, the LLM prompt file is at: <a href=\"https://github.com/fastapi/fastapi/blob/master/docs/es/llm-prompt.md\" class=\"external-link\" target=\"_blank\">`docs/es/llm-prompt.md`</a>.\n \n /// tip\n \n-Notice that the only change in the path and file name is the language code, from `en` to `es`.\n+Check the docs about <a href=\"https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-request-reviews\" class=\"external-link\" target=\"_blank\">adding a pull request review</a> to approve it or request changes.\n \n ///\n \n-If you go to your browser you will see that now the docs show your new section (the info box at the top is gone). \ud83c\udf89\n-\n-Now you can translate it all and see how it looks as you save the file.\n+#### Subscribe to Notifications for Your Language\n \n-#### Don't Translate these Pages\n-\n-\ud83d\udea8 Don't translate:\n-\n-* Files under `reference/`\n-* `release-notes.md`\n-* `fastapi-people.md`\n-* `external-links.md`\n-* `newsletter.md`\n-* `management-tasks.md`\n-* `management.md`\n-* `contributing.md`\n+* Check if there's a <a href=\"https://github.com/fastapi/fastapi/discussions/categories/translations\" class=\"external-link\" target=\"_blank\">GitHub Discussion</a> to coordinate translations for your language. You can subscribe to it, and when there's a new pull request to review, an automatic comment will be added to the discussion.\n \n-Some of these files are updated very frequently and a translation would always be behind, or they include the main content from English source files, etc.\n+* To check the 2-letter code for the language you want to translate, you can use the table <a href=\"https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes\" class=\"external-link\" target=\"_blank\">List of ISO 639-1 codes</a>.\n \n #### Request a New Language\n \n Let's say that you want to request translations for a language that is not yet translated, not even some pages. For example, Latin.\n \n-If there is no discussion for that language, you can start by requesting the new language. For that, you can follow these steps:\n-\n+* The first step would be for you to find other 2 people that would be willing to be reviewing translation PRs for that language with you.\n+* Once there are at least 3 people that would be willing to commit to help maintain that language, you can continue the next steps.\n * Create a new discussion following the template.\n-* Get a few native speakers to comment on the discussion and commit to help review translations for that language.\n+* Tag the other 2 people that will help with the language, and ask them to confirm there they will help.\n \n Once there are several people in the discussion, the FastAPI team can evaluate it and can make it an official translation.\n \n-Then the docs will be automatically translated using AI, and the team of native speakers can review the translation, and help tweak the AI prompts.\n+Then the docs will be automatically translated using LLMs, and the team of native speakers can review the translation, and help tweak the LLM prompts.\n \n Once there's a new translation, for example if docs are updated or there's a new section, there will be a comment in the same discussion with the link to the new translation to review.\n-\n-#### New Language\n-\n-/// note\n-\n-These steps will be performed by the FastAPI team.\n-\n-///\n-\n-Checking the link from above (List of ISO 639-1 codes), you can see that the 2-letter code for Latin is `la`.\n-\n-Now you can create a new directory for the new language, running the following script:\n-\n-<div class=\"termy\">\n-\n-```console\n-// Use the command new-lang, pass the language code as a CLI argument\n-$ python ./scripts/docs.py new-lang la\n-\n-Successfully initialized: docs/la\n-```\n-\n-</div>\n-\n-Now you can check in your code editor the newly created directory `docs/la/`.\n-\n-That command created a file `docs/la/mkdocs.yml` with a simple config that inherits everything from the `en` version:\n-\n-```yaml\n-INHERIT: ../en/mkdocs.yml\n-```\n-\n-/// tip\n-\n-You could also simply create that file with those contents manually.\n-\n-///\n-\n-That command also created a dummy file `docs/la/index.md` for the main page, you can start by translating that one.\n-\n-You can continue with the previous instructions for an \"Existing Language\" for that process.\n-\n-You can make the first pull request with those two files, `docs/la/mkdocs.yml` and `docs/la/index.md`. \ud83c\udf89\n-\n-#### Preview the result\n-\n-As already mentioned above, you can use the `./scripts/docs.py` with the `live` command to preview the results (or `mkdocs serve`).\n-\n-Once you are done, you can also test it all as it would look online, including all the other languages.\n-\n-To do that, first build all the docs:\n-\n-<div class=\"termy\">\n-\n-```console\n-// Use the command \"build-all\", this will take a bit\n-$ python ./scripts/docs.py build-all\n-\n-Building docs for: en\n-Building docs for: es\n-Successfully built docs for: es\n-```\n-\n-</div>\n-\n-This builds all those independent MkDocs sites for each language, combines them, and generates the final output at `./site/`.\n-\n-Then you can serve that with the command `serve`:\n-\n-<div class=\"termy\">\n-\n-```console\n-// Use the command \"serve\" after running \"build-all\"\n-$ python ./scripts/docs.py serve\n-\n-Warning: this is a very simple server. For development, use mkdocs serve instead.\n-This is here only to preview a site with translations already built.\n-Make sure you run the build-all command first.\n-Serving at: http://127.0.0.1:8008\n-```\n-\n-</div>\n-\n-#### Translation specific tips and guidelines\n-\n-* Translate only the Markdown documents (`.md`). Do not translate the code examples at `./docs_src`.\n-\n-* In code blocks within the Markdown document, translate comments (`# a comment`), but leave the rest unchanged.\n-\n-* Do not change anything enclosed in \"``\" (inline code).\n-\n-* In lines starting with `///` translate only the text part after `|`. Leave the rest unchanged.\n-\n-* You can translate info boxes like `/// warning` with for example `/// warning | Achtung`. But do not change the word immediately after the `///`, it determines the color of the info box.\n-\n-* Do not change the paths in links to images, code files, Markdown documents.\n-\n-* However, when a Markdown document is translated, the `#hash-parts` in links to its headings may change. Update these links if possible.\n-    * Search for such links in the translated document using the regex `#[^# ]`.\n-    * Search in all documents already translated into your language for `your-translated-document.md`. For example VS Code has an option \"Edit\" -> \"Find in Files\".\n-    * When translating a document, do not \"pre-translate\" `#hash-parts` that link to headings in untranslated documents.\ndiff --git a/scripts/docs.py b/scripts/docs.py\nindex c350ee8..20bf1c1 100644\n--- a/scripts/docs.py\n+++ b/scripts/docs.py\n@@ -130,14 +130,9 @@ def new_lang(lang: str = typer.Argument(..., callback=lang_callback)):\n     new_path.mkdir()\n     new_config_path: Path = Path(new_path) / mkdocs_name\n     new_config_path.write_text(\"INHERIT: ../en/mkdocs.yml\\n\", encoding=\"utf-8\")\n-    new_config_docs_path: Path = new_path / \"docs\"\n-    new_config_docs_path.mkdir()\n-    en_index_path: Path = en_docs_path / \"docs\" / \"index.md\"\n-    new_index_path: Path = new_config_docs_path / \"index.md\"\n-    en_index_content = en_index_path.read_text(encoding=\"utf-8\")\n-    new_index_content = f\"{missing_translation_snippet}\\n\\n{en_index_content}\"\n-    new_index_path.write_text(new_index_content, encoding=\"utf-8\")\n-    typer.secho(f\"Successfully initialized: {new_path}\", color=typer.colors.GREEN)\n+    new_llm_prompt_path: Path = new_path / \"llm-prompt.md\"\n+    new_llm_prompt_path.write_text(\"\", encoding=\"utf-8\")\n+    print(f\"Successfully initialized: {new_path}\")\n     update_languages()\n \n "}, {"role": "assistant", "content": "docs: simplify translation contribution guidelines"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/net/file_posix.go | 6 +++++-\n 1 file changed, 5 insertions(+), 1 deletion(-)\n\ndiff --git a/src/net/file_posix.go b/src/net/file_posix.go\nindex 132d03e9..b28ff584 100644\n--- a/src/net/file_posix.go\n+++ b/src/net/file_posix.go\n@@ -23,7 +23,11 @@ func newFileFD(f *os.File) (*netFD, error) {\n \t\tpoll.CloseFunc(s)\n \t\treturn nil, os.NewSyscallError(\"getsockopt\", err)\n \t}\n-\tlsa, _ := syscall.Getsockname(s)\n+\tlsa, err := syscall.Getsockname(s)\n+\tif err != nil {\n+\t\tpoll.CloseFunc(s)\n+\t\treturn nil, os.NewSyscallError(\"getsockname\", err)\n+\t}\n \trsa, _ := syscall.Getpeername(s)\n \tswitch lsa.(type) {\n \tcase *syscall.SockaddrInet4:"}, {"role": "assistant", "content": "fix(net): handle getsockname error in file descriptor creation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n vscode-ng-language-service/tools/release.mts | 39 ++++++++++++++++++++++++++--\n 1 file changed, 37 insertions(+), 2 deletions(-)\n\ndiff --git a/vscode-ng-language-service/tools/release.mts b/vscode-ng-language-service/tools/release.mts\nindex ebc675ce..63541d8a 100644\n--- a/vscode-ng-language-service/tools/release.mts\n+++ b/vscode-ng-language-service/tools/release.mts\n@@ -80,7 +80,7 @@ async function main(): Promise<void> {\n   }\n \n   console.log(chalk.blue(`Releasing from ${branchToReleaseFrom}.`));\n-  await exec(`git fetch ${angularRepoRemote} ${branchToReleaseFrom}`);\n+  await exec(`git fetch ${angularRepoRemote} ${branchToReleaseFrom} --tags`);\n \n   const currentVersion = await getCurrentVersion();\n   const newVersion = await getNewVersion(currentVersion);\n@@ -240,8 +240,9 @@ async function prepareReleasePullRequest(\n  * @param toVersion The version to generate the changelog for.\n  */\n async function generateChangelog(fromVersion: string, toVersion: string): Promise<string> {\n+  const previousTag = await getPreviousTag(fromVersion);\n   let {stdout: commits} = await exec(\n-    `git log --left-only FETCH_HEAD...${getTagName(fromVersion)} -E ` +\n+    `git log --left-only FETCH_HEAD...${previousTag} -E ` +\n       '--grep=\"^(feat|fix|perf)\\\\((vscode-extension|language-server|language-service)\\\\):\" ' +\n       '--format=\"format:- %s ([%h](https://github.com/angular/angular/commit/%H))\"',\n   );\n@@ -519,6 +520,40 @@ function getRepoDetails(remoteUrl: string): {owner: string; repo: string} {\n   };\n }\n \n+/**\n+ * Gets the previous tag to version from.\n+ *\n+ * It checks if the tag for the `currentVersion` exists. If it does, returning it.\n+ * If not, it finds the latest tag that adheres to the semver versioning of the extension.\n+ */\n+async function getPreviousTag(currentVersion: string): Promise<string> {\n+  const currentTag = getTagName(currentVersion);\n+  try {\n+    await exec(`git rev-parse \"${currentTag}\"`);\n+    return currentTag;\n+  } catch {\n+    // Tag does not exist.\n+  }\n+\n+  const {stdout: tags} = await exec(`git tag --list \"${tagPrefix}*\"`);\n+  const versions = tags\n+    .trim()\n+    .split('\\n')\n+    .map((t) => t.trim())\n+    .filter((t) => t.startsWith(tagPrefix))\n+    .map((t) => t.slice(tagPrefix.length))\n+    .filter((v) => semver.valid(v));\n+\n+  if (versions.length === 0) {\n+    throw new Error('No previous release tags found.');\n+  }\n+\n+  // Sort versions in descending order\n+  versions.sort((a, b) => semver.rcompare(a, b));\n+\n+  return getTagName(versions[0]);\n+}\n+\n /**\n  * Gets the tag name for the given version.\n  *"}, {"role": "assistant", "content": "build: fix changelog generation for last rev"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 46488d3..491caae 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -22,6 +22,7 @@ hide:\n \n ### Internal\n \n+* \u2b06 Bump actions/upload-artifact from 5 to 6. PR [#14525](https://github.com/fastapi/fastapi/pull/14525) by [@dependabot[bot]](https://github.com/apps/dependabot).\n * \u2b06 Bump actions/download-artifact from 6 to 7. PR [#14526](https://github.com/fastapi/fastapi/pull/14526) by [@dependabot[bot]](https://github.com/apps/dependabot).\n * \ud83d\udc77 Tweak CI input names. PR [#14688](https://github.com/fastapi/fastapi/pull/14688) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd28 Refactor translation script to allow committing in place. PR [#14687](https://github.com/fastapi/fastapi/pull/14687) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/simd/archsimd/internal/simd_test/unary_test.go | 9 +++++++--\n 1 file changed, 7 insertions(+), 2 deletions(-)\n\ndiff --git a/src/simd/archsimd/internal/simd_test/unary_test.go b/src/simd/archsimd/internal/simd_test/unary_test.go\nindex 32b4626f..b6d814a4 100644\n--- a/src/simd/archsimd/internal/simd_test/unary_test.go\n+++ b/src/simd/archsimd/internal/simd_test/unary_test.go\n@@ -117,16 +117,18 @@ func TestCeilScaledResidue(t *testing.T) {\n }\n \n func TestConvert(t *testing.T) {\n-\ttestFloat32x4ConvertToFloat64(t, archsimd.Float32x4.ConvertToFloat64, map1[float32](toFloat64))\n+\ttestFloat64x2ConvertToFloat32(t, archsimd.Float64x2.ConvertToFloat32, map1n[float64](toFloat32, 4))\n \ttestFloat64x4ConvertToFloat32(t, archsimd.Float64x4.ConvertToFloat32, map1[float64](toFloat32))\n+\ttestFloat32x4ConvertToFloat64(t, archsimd.Float32x4.ConvertToFloat64, map1[float32](toFloat64))\n \n \ttestFloat32x4ConvertToInt32(t, archsimd.Float32x4.ConvertToInt32, map1[float32](floatToInt32_x86))\n \ttestFloat32x8ConvertToInt32(t, archsimd.Float32x8.ConvertToInt32, map1[float32](floatToInt32_x86))\n+\ttestFloat64x2ConvertToInt32(t, archsimd.Float64x2.ConvertToInt32, map1n[float64](floatToInt32_x86, 4))\n \ttestFloat64x4ConvertToInt32(t, archsimd.Float64x4.ConvertToInt32, map1[float64](floatToInt32_x86))\n \n \ttestInt32x4ConvertToFloat32(t, archsimd.Int32x4.ConvertToFloat32, map1[int32](toFloat32))\n-\ttestInt32x4ConvertToFloat64(t, archsimd.Int32x4.ConvertToFloat64, map1[int32](toFloat64))\n \ttestInt32x8ConvertToFloat32(t, archsimd.Int32x8.ConvertToFloat32, map1[int32](toFloat32))\n+\ttestInt32x4ConvertToFloat64(t, archsimd.Int32x4.ConvertToFloat64, map1[int32](toFloat64))\n \n \tif archsimd.X86.AVX512() {\n \t\ttestFloat32x8ConvertToFloat64(t, archsimd.Float32x8.ConvertToFloat64, map1[float32](toFloat64))\n@@ -143,6 +145,7 @@ func TestConvert(t *testing.T) {\n \t\ttestFloat32x4ConvertToUint32(t, archsimd.Float32x4.ConvertToUint32, map1[float32](floatToUint32_x86))\n \t\ttestFloat32x8ConvertToUint32(t, archsimd.Float32x8.ConvertToUint32, map1[float32](floatToUint32_x86))\n \t\ttestFloat32x16ConvertToUint32(t, archsimd.Float32x16.ConvertToUint32, map1[float32](floatToUint32_x86))\n+\t\ttestFloat64x2ConvertToUint32(t, archsimd.Float64x2.ConvertToUint32, map1n[float64](floatToUint32_x86, 4))\n \t\ttestFloat64x4ConvertToUint32(t, archsimd.Float64x4.ConvertToUint32, map1[float64](floatToUint32_x86))\n \t\ttestFloat64x8ConvertToUint32(t, archsimd.Float64x8.ConvertToUint32, map1[float64](floatToUint32_x86))\n \t\ttestFloat32x4ConvertToUint64(t, archsimd.Float32x4.ConvertToUint64, map1[float32](floatToUint64_x86))\n@@ -152,6 +155,7 @@ func TestConvert(t *testing.T) {\n \t\ttestFloat64x8ConvertToUint64(t, archsimd.Float64x8.ConvertToUint64, map1[float64](floatToUint64_x86))\n \n \t\ttestInt32x16ConvertToFloat32(t, archsimd.Int32x16.ConvertToFloat32, map1[int32](toFloat32))\n+\t\ttestInt64x2ConvertToFloat32(t, archsimd.Int64x2.ConvertToFloat32, map1n[int64](toFloat32, 4))\n \t\ttestInt64x4ConvertToFloat32(t, archsimd.Int64x4.ConvertToFloat32, map1[int64](toFloat32))\n \t\ttestInt64x8ConvertToFloat32(t, archsimd.Int64x8.ConvertToFloat32, map1[int64](toFloat32))\n \t\ttestInt64x2ConvertToFloat64(t, archsimd.Int64x2.ConvertToFloat64, map1[int64](toFloat64))\n@@ -161,6 +165,7 @@ func TestConvert(t *testing.T) {\n \t\ttestUint32x4ConvertToFloat32(t, archsimd.Uint32x4.ConvertToFloat32, map1[uint32](toFloat32))\n \t\ttestUint32x8ConvertToFloat32(t, archsimd.Uint32x8.ConvertToFloat32, map1[uint32](toFloat32))\n \t\ttestUint32x16ConvertToFloat32(t, archsimd.Uint32x16.ConvertToFloat32, map1[uint32](toFloat32))\n+\t\ttestUint64x2ConvertToFloat32(t, archsimd.Uint64x2.ConvertToFloat32, map1n[uint64](toFloat32, 4))\n \t\ttestUint64x4ConvertToFloat32(t, archsimd.Uint64x4.ConvertToFloat32, map1[uint64](toFloat32))\n \t\ttestUint64x8ConvertToFloat32(t, archsimd.Uint64x8.ConvertToFloat32, map1[uint64](toFloat32))\n \t\ttestUint32x4ConvertToFloat64(t, archsimd.Uint32x4.ConvertToFloat64, map1[uint32](toFloat64))"}, {"role": "assistant", "content": "test(simd): add float64x2 and 64-bit conversion tests"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_middle/src/thir.rs                  | 14 ++--\n compiler/rustc_middle/src/thir/visit.rs            |  8 +--\n compiler/rustc_mir_build/src/builder/block.rs      | 13 ++--\n .../src/builder/expr/as_constant.rs                |  2 +-\n .../rustc_mir_build/src/builder/expr/as_operand.rs |  9 +--\n .../rustc_mir_build/src/builder/expr/as_place.rs   |  5 +-\n .../rustc_mir_build/src/builder/expr/as_rvalue.rs  |  9 ++-\n .../rustc_mir_build/src/builder/expr/as_temp.rs    | 12 ++--\n compiler/rustc_mir_build/src/builder/expr/into.rs  |  5 +-\n compiler/rustc_mir_build/src/builder/expr/stmt.rs  | 10 +--\n .../rustc_mir_build/src/builder/matches/mod.rs     |  8 +--\n compiler/rustc_mir_build/src/builder/mod.rs        |  4 +-\n compiler/rustc_mir_build/src/builder/scope.rs      | 10 ++-\n compiler/rustc_mir_build/src/check_unsafety.rs     |  2 +-\n compiler/rustc_mir_build/src/thir/cx/block.rs      |  2 +-\n compiler/rustc_mir_build/src/thir/cx/expr.rs       |  4 +-\n .../src/thir/pattern/check_match.rs                | 66 ++++++++-----------\n compiler/rustc_mir_build/src/thir/print.rs         | 12 ++--\n tests/ui/thir-print/c-variadic.stdout              |  2 +-\n tests/ui/thir-print/offset_of.stdout               | 76 +++++++++++-----------\n tests/ui/thir-print/thir-flat-const-variant.stdout | 36 +++-------\n tests/ui/thir-print/thir-flat.stdout               |  4 +-\n tests/ui/thir-print/thir-tree-loop-match.stdout    | 24 +++----\n tests/ui/thir-print/thir-tree-match.stdout         | 20 +++---\n tests/ui/thir-print/thir-tree.stdout               |  2 +-\n tests/ui/unpretty/box.stdout                       |  8 +--\n 26 files changed, 174 insertions(+), 193 deletions(-)"}, {"role": "assistant", "content": "refactor(thir): simplify expression representation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/go/internal/work/gc.go | 17 ++++++++++-------\n 1 file changed, 10 insertions(+), 7 deletions(-)\n\ndiff --git a/src/cmd/go/internal/work/gc.go b/src/cmd/go/internal/work/gc.go\nindex fc74715f..6300a913 100644\n--- a/src/cmd/go/internal/work/gc.go\n+++ b/src/cmd/go/internal/work/gc.go\n@@ -217,11 +217,11 @@ func compilerConcurrency() (int, func()) {\n \tconcurrentProcesses++\n \t// Set aside tokens so that we don't run out if we were running cfg.BuildP concurrent compiles.\n \t// We'll set aside one token for each of the action goroutines that aren't currently running a compile.\n-\tsetAside := cfg.BuildP - concurrentProcesses\n+\tsetAside := (cfg.BuildP - concurrentProcesses) * minTokens\n \tavailableTokens := tokens - setAside\n-\t// Grab half the remaining tokens: but with a floor of at least 1 token, and\n+\t// Grab half the remaining tokens: but with a floor of at least minTokens token, and\n \t// a ceiling of the max backend concurrency.\n-\tc := max(min(availableTokens/2, maxCompilerConcurrency), 1)\n+\tc := max(min(availableTokens/2, maxCompilerConcurrency), minTokens)\n \ttokens -= c\n \t// Successfully grabbed the tokens.\n \treturn c, func() {\n@@ -239,15 +239,18 @@ var (\n \ttotalTokens         int // total number of tokens: this is used for checking that we get them all back in the end\n \ttokens              int // number of available tokens\n \tconcurrentProcesses int // number of currently running compiles\n+\tminTokens           int // minimum number of tokens to give out\n )\n \n // initCompilerConcurrencyPool sets the number of tokens in the pool. It needs\n // to be run after init, so that it can use the value of cfg.BuildP.\n func initCompilerConcurrencyPool() {\n-\t// Size the pool so that the worst case total number of compiles is not more\n-\t// than what it was when we capped the concurrency to 4.\n-\toldConcurrencyCap := min(4, maxCompilerConcurrency)\n-\ttokens = oldConcurrencyCap * cfg.BuildP\n+\t// Size the pool to allow 2*maxCompilerConcurrency extra tokens to\n+\t// be distributed amongst the compile actions in addition to the minimum\n+\t// of min(4,GOMAXPROCS) tokens for each of the potentially cfg.BuildP\n+\t// concurrently running compile actions.\n+\tminTokens = min(4, maxCompilerConcurrency)\n+\ttokens = 2*maxCompilerConcurrency + minTokens*cfg.BuildP\n \ttotalTokens = tokens\n }\n "}, {"role": "assistant", "content": "refactor(gc): improve compiler concurrency token distribution"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n package.json   |   6 +-\n pnpm-lock.yaml | 307 ++++++++++++++-------------------------------------------\n 2 files changed, 75 insertions(+), 238 deletions(-)\n\ndiff --git a/package.json b/package.json\nindex 83c8a8a..a6daaa0 100644\n--- a/package.json\n+++ b/package.json\n@@ -75,7 +75,7 @@\n     \"@types/semver\": \"^7.7.1\",\n     \"@types/serve-handler\": \"^6.1.4\",\n     \"@vitest/coverage-v8\": \"^3.2.4\",\n-    \"@vitest/eslint-plugin\": \"^1.4.0\",\n+    \"@vitest/eslint-plugin\": \"^1.5.2\",\n     \"@vue/consolidate\": \"1.0.0\",\n     \"conventional-changelog-cli\": \"^5.0.0\",\n     \"enquirer\": \"^2.4.1\",\n@@ -84,7 +84,7 @@\n     \"eslint\": \"^9.39.2\",\n     \"eslint-plugin-import-x\": \"^4.16.1\",\n     \"estree-walker\": \"catalog:\",\n-    \"jsdom\": \"^27.1.0\",\n+    \"jsdom\": \"^27.3.0\",\n     \"lint-staged\": \"^16.2.7\",\n     \"lodash\": \"^4.17.21\",\n     \"magic-string\": \"^0.30.21\",\n@@ -95,7 +95,7 @@\n     \"prettier\": \"^3.7.4\",\n     \"pretty-bytes\": \"^7.1.0\",\n     \"pug\": \"^3.0.3\",\n-    \"puppeteer\": \"~24.28.0\",\n+    \"puppeteer\": \"~24.33.0\",\n     \"rimraf\": \"^6.1.2\",\n     \"rollup\": \"^4.53.3\",\n     \"rollup-plugin-dts\": \"^6.3.0\",\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 58e7e7e..73f20d1 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -70,10 +70,10 @@ importers:\n         version: 6.1.4\n       '@vitest/coverage-v8':\n         specifier: ^3.2.4\n-        version: 3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0))\n+        version: 3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0))\n       '@vitest/eslint-plugin':\n-        specifier: ^1.4.0\n-        version: 1.4.0(eslint@9.39.2)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0))\n+        specifier: ^1.5.2\n+        version: 1.5.2(eslint@9.39.2)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0))\n       '@vue/consolidate':\n         specifier: 1.0.0\n         version: 1.0.0\n@@ -99,8 +99,8 @@ importers:\n         specifier: 'catalog:'\n         version: 2.0.2\n       jsdom:\n-        specifier: ^27.1.0\n-        version: 27.1.0(postcss@8.5.6)\n+        specifier: ^27.3.0\n+        version: 27.3.0(postcss@8.5.6)\n       lint-staged:\n         specifier: ^16.2.7\n         version: 16.2.7\n@@ -132,8 +132,8 @@ importers:\n         specifier: ^3.0.3\n         version: 3.0.3\n       puppeteer:\n-        specifier: ~24.28.0\n-        version: 24.28.0(typescript@5.6.3)\n+        specifier: ~24.33.0\n+        version: 24.33.0(typescript@5.6.3)\n       rimraf:\n         specifier: ^6.1.2\n         version: 6.1.2\n@@ -178,7 +178,7 @@ importers:\n         version: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n       vitest:\n         specifier: ^3.2.4\n-        version: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0)\n+        version: 3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0)\n \n   packages-private/dts-built-test:\n     dependencies:\n@@ -440,18 +440,18 @@ importers:\n \n packages:\n \n-  '@acemir/cssom@0.9.19':\n-    resolution: {integrity: sha512-Pp2gAQXPZ2o7lt4j0IMwNRXqQ3pagxtDj5wctL5U2Lz4oV0ocDNlkgx4DpxfyKav4S/bePuI+SMqcBSUHLy9kg==}\n+  '@acemir/cssom@0.9.29':\n+    resolution: {integrity: sha512-G90x0VW+9nW4dFajtjCoT+NM0scAfH9Mb08IcjgFHYbfiL/lU04dTF9JuVOi3/OH+DJCQdcIseSXkdCB9Ky6JA==}\n \n   '@ampproject/remapping@2.3.0':\n     resolution: {integrity: sha512-30iZtAPgz+LTIYoeivqYo853f02jBYSd5uGnGpkFV0M3xOt9aN73erkgYAmZU43x4VfqcnLxW9Kpg3R5LC4YYw==}\n     engines: {node: '>=6.0.0'}\n \n-  '@asamuzakjp/css-color@4.0.5':\n-    resolution: {integrity: sha512-lMrXidNhPGsDjytDy11Vwlb6OIGrT3CmLg3VWNFyWkLWtijKl7xjvForlh8vuj0SHGjgl4qZEQzUmYTeQA2JFQ==}\n+  '@asamuzakjp/css-color@4.1.0':\n+    resolution: {integrity: sha512-9xiBAtLn4aNsa4mDnpovJvBn72tNEIACyvlqaNJ+ADemR+yeMJWnBudOi2qGDviJa7SwcDOU/TRh5dnET7qk0w==}\n \n-  '@asamuzakjp/dom-selector@6.7.4':\n-    resolution: {integrity: sha512-buQDjkm+wDPXd6c13534URWZqbz0RP5PAhXZ+LIoa5LgwInT9HVJvGIJivg75vi8I13CxDGdTnz+aY5YUJlIAA==}\n+  '@asamuzakjp/dom-selector@6.7.6':\n+    resolution: {integrity: sha512-hBaJER6A9MpdG3WgdlOolHmbOYvSk46y7IQN/1+iqiCuUu6iWdQrs9DGKF8ocqsEqWujWf/V7b7vaDgiUmIvUg==}\n \n   '@asamuzakjp/nwsapi@2.3.9':\n     resolution: {integrity: sha512-n8GuYSrI9bF7FFZ/SjhwevlHc8xaVlb/7HmHelnc/PZXBD2ZR49NnN9sMMuDdEGPeeRQ5d0hqlSlEpgCX3Wl0Q==}\n@@ -830,12 +830,6 @@ packages:\n     cpu: [x64]\n     os: [win32]\n \n-  '@eslint-community/eslint-utils@4.7.0':\n-    resolution: {integrity: sha512-dyybb3AcajC7uha6CvhdVRJqaKyn7w2YKqKyAN37NKYgZT36w+iRb0Dymmc5qEJ549c/S31cMMSFd75bteCpCw==}\n-    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}\n-    peerDependencies:\n-      eslint: ^6.0.0 || ^7.0.0 || >=8.0.0\n-\n   '@eslint-community/eslint-utils@4.9.0':\n     resolution: {integrity: sha512-ayVFHdtZ+hsq1t2Dy24wCmGXGe4q9Gu3smhLYALJrr473ZH27MsnSL+LKUlimp4BWJqMDMLmPpx/Q9R3OAlL4g==}\n     engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}\n@@ -941,18 +935,6 @@ packages:\n   '@napi-rs/wasm-runtime@0.2.12':\n     resolution: {integrity: sha512-ZVWUcfwY4E/yPitQJl481FjFo3K22D6qF0DuFH6Y/nbnE11GY5uguDxZMGXPQ8WQ0128MXQD7TnfHyK4oWoIJQ==}\n \n-  '@nodelib/fs.scandir@2.1.5':\n-    resolution: {integrity: sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==}\n-    engines: {node: '>= 8'}\n-\n-  '@nodelib/fs.stat@2.0.5':\n-    resolution: {integrity: sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==}\n-    engines: {node: '>= 8'}\n-\n-  '@nodelib/fs.walk@1.2.8':\n-    resolution: {integrity: sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==}\n-    engines: {node: '>= 8'}\n-\n   '@parcel/watcher-android-arm64@2.4.1':\n     resolution: {integrity: sha512-LOi/WTbbh3aTn2RYddrO8pnapixAziFl6SMxHM69r3tvdSm94JtCenaKgk1GRg5FJ5wpMCpHeW+7yqPlvZv7kg==}\n     engines: {node: '>= 10.0.0'}\n@@ -1033,8 +1015,8 @@ packages:\n     resolution: {integrity: sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==}\n     engines: {node: '>=14'}\n \n-  '@puppeteer/browsers@2.10.13':\n-    resolution: {integrity: sha512-a9Ruw3j3qlnB5a/zHRTkruppynxqaeE4H9WNj5eYGRWqw0ZauZ23f4W2ARf3hghF5doozyD+CRtt7XSYuYRI/Q==}\n+  '@puppeteer/browsers@2.11.0':\n+    resolution: {integrity: sha512-n6oQX6mYkG8TRPuPXmbPidkUbsSRalhmaaVAQxvH1IkQy63cwsH+kOjB3e4cpCDHg0aSvsiX9bQ4s2VB6mGWUQ==}\n     engines: {node: '>=18'}\n     hasBin: true\n \n@@ -1346,32 +1328,16 @@ packages:\n       eslint: ^8.57.0 || ^9.0.0\n       typescript: '>=4.8.4 <6.0.0'\n \n-  '@typescript-eslint/project-service@8.46.3':\n-    resolution: {integrity: sha512-Fz8yFXsp2wDFeUElO88S9n4w1I4CWDTXDqDr9gYvZgUpwXQqmZBr9+NTTql5R3J7+hrJZPdpiWaB9VNhAKYLuQ==}\n-    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n-    peerDependencies:\n-      typescript: '>=4.8.4 <6.0.0'\n-\n   '@typescript-eslint/project-service@8.49.0':\n     resolution: {integrity: sha512-/wJN0/DKkmRUMXjZUXYZpD1NEQzQAAn9QWfGwo+Ai8gnzqH7tvqS7oNVdTjKqOcPyVIdZdyCMoqN66Ia789e7g==}\n     engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n     peerDependencies:\n       typescript: '>=4.8.4 <6.0.0'\n \n-  '@typescript-eslint/scope-manager@8.46.3':\n-    resolution: {integrity: sha512-FCi7Y1zgrmxp3DfWfr+3m9ansUUFoy8dkEdeQSgA9gbm8DaHYvZCdkFRQrtKiedFf3Ha6VmoqoAaP68+i+22kg==}\n-    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n-\n   '@typescript-eslint/scope-manager@8.49.0':\n     resolution: {integrity: sha512-npgS3zi+/30KSOkXNs0LQXtsg9ekZ8OISAOLGWA/ZOEn0ZH74Ginfl7foziV8DT+D98WfQ5Kopwqb/PZOaIJGg==}\n     engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n \n-  '@typescript-eslint/tsconfig-utils@8.46.3':\n-    resolution: {integrity: sha512-GLupljMniHNIROP0zE7nCcybptolcH8QZfXOpCfhQDAdwJ/ZTlcaBOYebSOZotpti/3HrHSw7D3PZm75gYFsOA==}\n-    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n-    peerDependencies:\n-      typescript: '>=4.8.4 <6.0.0'\n-\n   '@typescript-eslint/tsconfig-utils@8.49.0':\n     resolution: {integrity: sha512-8prixNi1/6nawsRYxet4YOhnbW+W9FK/bQPxsGB1D3ZrDzbJ5FXw5XmzxZv82X3B+ZccuSxo/X8q9nQ+mFecWA==}\n     engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n@@ -1393,25 +1359,12 @@ packages:\n     resolution: {integrity: sha512-e9k/fneezorUo6WShlQpMxXh8/8wfyc+biu6tnAqA81oWrEic0k21RHzP9uqqpyBBeBKu4T+Bsjy9/b8u7obXQ==}\n     engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n \n-  '@typescript-eslint/typescript-estree@8.46.3':\n-    resolution: {integrity: sha512-f/NvtRjOm80BtNM5OQtlaBdM5BRFUv7gf381j9wygDNL+qOYSNOgtQ/DCndiYi80iIOv76QqaTmp4fa9hwI0OA==}\n-    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n-    peerDependencies:\n-      typescript: '>=4.8.4 <6.0.0'\n-\n   '@typescript-eslint/typescript-estree@8.49.0':\n     resolution: {integrity: sha512-jrLdRuAbPfPIdYNppHJ/D0wN+wwNfJ32YTAm10eJVsFmrVpXQnDWBn8niCSMlWjvml8jsce5E/O+86IQtTbJWA==}\n     engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n     peerDependencies:\n       typescript: '>=4.8.4 <6.0.0'\n \n-  '@typescript-eslint/utils@8.46.3':\n-    resolution: {integrity: sha512-VXw7qmdkucEx9WkmR3ld/u6VhRyKeiF1uxWwCy/iuNfokjJ7VhsgLSOTjsol8BunSw190zABzpwdNsze2Kpo4g==}\n-    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n-    peerDependencies:\n-      eslint: ^8.57.0 || ^9.0.0\n-      typescript: '>=4.8.4 <6.0.0'\n-\n   '@typescript-eslint/utils@8.49.0':\n     resolution: {integrity: sha512-N3W7rJw7Rw+z1tRsHZbK395TWSYvufBXumYtEGzypgMUthlg0/hmCImeA8hgO2d2G4pd7ftpxxul2J8OdtdaFA==}\n     engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n@@ -1419,10 +1372,6 @@ packages:\n       eslint: ^8.57.0 || ^9.0.0\n       typescript: '>=4.8.4 <6.0.0'\n \n-  '@typescript-eslint/visitor-keys@8.46.3':\n-    resolution: {integrity: sha512-uk574k8IU0rOF/AjniX8qbLSGURJVUCeM5e4MIMKBFFi8weeiLrG1fyQejyLXQpRZbU/1BuQasleV/RfHC3hHg==}\n-    engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n-\n   '@typescript-eslint/visitor-keys@8.49.0':\n     resolution: {integrity: sha512-LlKaciDe3GmZFphXIc79THF/YYBugZ7FS1pO581E/edlVVNbZKDy93evqmrfQ9/Y4uN0vVhX4iuchq26mK/iiA==}\n     engines: {node: ^18.18.0 || ^20.9.0 || >=21.1.0}\n@@ -1538,8 +1487,8 @@ packages:\n       '@vitest/browser':\n         optional: true\n \n-  '@vitest/eslint-plugin@1.4.0':\n-    resolution: {integrity: sha512-TMzJ0Vqdsc71stblzI0ZdqSnt6Bp4mJ+amD3Hv3qhKK82hBUnznYfnLwA80gdGfe5V24ysndMOoSGrol6fyvbA==}\n+  '@vitest/eslint-plugin@1.5.2':\n+    resolution: {integrity: sha512-2t1F2iecXB/b1Ox4U137lhD3chihEE3dRVtu3qMD35tc6UqUjg1VGRJoS1AkFKwpT8zv8OQInzPQO06hrRkeqw==}\n     engines: {node: '>=18'}\n     peerDependencies:\n       eslint: '>=8.57.0'\n@@ -1780,8 +1729,8 @@ packages:\n     resolution: {integrity: sha512-n8enUVCED/KVRQlab1hr3MVpcVMvxtZjmEa956u+4YijlmQED223XMSYj2tLuKvr4jcCTzNNMpQDUer72MMmzA==}\n     engines: {node: '>= 14.16.0'}\n \n-  chromium-bidi@10.5.1:\n-    resolution: {integrity: sha512-rlj6OyhKhVTnk4aENcUme3Jl9h+cq4oXu4AzBcvr8RMmT6BR4a3zSNT9dbIfXr9/BS6ibzRyDhowuw4n2GgzsQ==}\n+  chromium-bidi@11.0.0:\n+    resolution: {integrity: sha512-cM3DI+OOb89T3wO8cpPSro80Q9eKYJ7hGVXoGS3GkDPxnYSqiv+6xwpIf6XERyJ9Tdsl09hmNmY94BkgZdVekw==}\n     peerDependencies:\n       devtools-protocol: '*'\n \n@@ -1939,8 +1888,8 @@ packages:\n     engines: {node: '>=4'}\n     hasBin: true\n \n-  cssstyle@5.3.2:\n-    resolution: {integrity: sha512-zDMqXh8Vs1CdRYZQ2M633m/SFgcjlu8RB8b/1h82i+6vpArF507NSYIWJHGlJaTWoS+imcnctmEz43txhbVkOw==}\n+  cssstyle@5.3.4:\n+    resolution: {integrity: sha512-KyOS/kJMEq5O9GdPnaf82noigg5X5DYn0kZPJTaAsCUaBizp6Xa1y9D4Qoqf/JazEXWuruErHgVXwjN5391ZJw==}\n     engines: {node: '>=20'}\n \n   csstype@3.2.3:\n@@ -2028,8 +1977,8 @@ packages:\n     engines: {node: '>=0.10'}\n     hasBin: true\n \n-  devtools-protocol@0.0.1521046:\n-    resolution: {integrity: sha512-vhE6eymDQSKWUXwwA37NtTTVEzjtGVfDr3pRbsWEQ5onH/Snp2c+2xZHWJJawG/0hCCJLRGt4xVtEVUVILol4w==}\n+  devtools-protocol@0.0.1534754:\n+    resolution: {integrity: sha512-26T91cV5dbOYnXdJi5qQHoTtUoNEqwkHcAyu/IKtjIAxiEqPMrDiRkDOPWVsGfNZGmlQVHQbZRSjD8sxagWVsQ==}\n \n   doctypes@1.1.0:\n     resolution: {integrity: sha512-LLBi6pEqS6Do3EKQ3J0NqHWV5hhb78Pi8vvESYwyOy2c31ZEZVdtitdzsQsKb7878PEERhzUk0ftqGhG6Mz+pQ==}\n@@ -2221,19 +2170,12 @@ packages:\n   fast-fifo@1.3.2:\n     resolution: {integrity: sha512-/d9sfos4yxzpwkDkuN7k2SqFKtYNmCTzgfEpz82x34IM9/zc8KGxQoXg1liNC/izpRM/MBdt44Nmx41ZWqk+FQ==}\n \n-  fast-glob@3.3.3:\n-    resolution: {integrity: sha512-7MptL8U0cqcFdzIzwOTHoilX9x5BrNqye7Z/LuC7kCMRio1EMSyqRK3BEAUD7sXRq4iT4AzTVuZdhgQ2TCvYLg==}\n-    engines: {node: '>=8.6.0'}\n-\n   fast-json-stable-stringify@2.1.0:\n     resolution: {integrity: sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==}\n \n   fast-levenshtein@2.0.6:\n     resolution: {integrity: sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==}\n \n-  fastq@1.19.1:\n-    resolution: {integrity: sha512-GwLTyxkCXjXbxqIhTsMI2Nui8huMPtnxg7krajPJAjnEG/iiOS7i+zCtWGZR9G0NBKbXKh6X9m9UIsYX/N6vvQ==}\n-\n   fd-slicer@1.1.0:\n     resolution: {integrity: sha512-cE1qsB/VwyQozZ+q1dGxR8LBYNZeofhEdUNGSMbQD3Gw2lAzX9Zb3uIU6Ebc/Fmyjo9AWWfnn0AUCHqtevs/8g==}\n \n@@ -2343,10 +2285,6 @@ packages:\n     engines: {node: '>=18'}\n     hasBin: true\n \n-  glob-parent@5.1.2:\n-    resolution: {integrity: sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==}\n-    engines: {node: '>= 6'}\n-\n   glob-parent@6.0.2:\n     resolution: {integrity: sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==}\n     engines: {node: '>=10.13.0'}\n@@ -2584,8 +2522,8 @@ packages:\n   jsbn@1.1.0:\n     resolution: {integrity: sha512-4bYVV3aAMtDTTu4+xsDYa6sy9GyJ69/amsu9sYF2zqjiEoZA5xJi3BrfX3uY+/IekIu7MwdObdbDWpoZdBv3/A==}\n \n-  jsdom@27.1.0:\n-    resolution: {integrity: sha512-Pcfm3eZ+eO4JdZCXthW9tCDT3nF4K+9dmeZ+5X39n+Kqz0DDIABRP5CAEOHRFZk8RGuC2efksTJxrjp8EXCunQ==}\n+  jsdom@27.3.0:\n+    resolution: {integrity: sha512-GtldT42B8+jefDUC4yUKAvsaOrH7PDHmZxZXNgF2xMmymjUbRYJvpAybZAKEmXDGTM0mCsz8duOa4vTm5AY2Kg==}\n     engines: {node: ^20.19.0 || ^22.12.0 || >=24.0.0}\n     peerDependencies:\n       canvas: ^3.0.0\n@@ -2681,6 +2619,10 @@ packages:\n     resolution: {integrity: sha512-F9ODfyqML2coTIsQpSkRHnLSZMtkU8Q+mSfcaIyKwy58u+8k5nvAYeiNhsyMARvzNcXJ9QfWVrcPsC9e9rAxtg==}\n     engines: {node: 20 || >=22}\n \n+  lru-cache@11.2.4:\n+    resolution: {integrity: sha512-B5Y16Jr9LB9dHVkh6ZevG+vAbOsNOYCX+sXvFWFu7B3Iz5mijW3zdbMyhsh8ANd2mSWBYdJgnqi+mL7/LrOPYg==}\n+    engines: {node: 20 || >=22}\n+\n   lru-cache@7.18.3:\n     resolution: {integrity: sha512-jumlc0BIUrS3qJGgIkWZsyfAM7NCWiBcCDhnd+3NNM5KbBmLTgHVfWBcg6W+rLUsIpzpERPsvwUP7CckAQSOoA==}\n     engines: {node: '>=12'}\n@@ -2725,10 +2667,6 @@ packages:\n   merge-stream@2.0.0:\n     resolution: {integrity: sha512-abv/qOcuPfk3URPfDzmZU1LKmuw8kT+0nIHvKrKgFrwifol/doWcdA4ZqsWQ8ENrFKkd67Mfpo/LovbIUsbt3w==}\n \n-  merge2@1.4.1:\n-    resolution: {integrity: sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==}\n-    engines: {node: '>= 8'}\n-\n   micromatch@4.0.8:\n     resolution: {integrity: sha512-PXwfBhYu0hBCPw8Dn0E+WDYb7af3dSLVWKi3HGv84IdF4TyFoC0ysxFd0Goxw7nSv4T/PzEJQxsYsEiFCKo2BA==}\n     engines: {node: '>=8.6'}\n@@ -3063,18 +3001,15 @@ packages:\n     resolution: {integrity: sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==}\n     engines: {node: '>=6'}\n \n-  puppeteer-core@24.28.0:\n-    resolution: {integrity: sha512-QpAqaYgeZHF5/xAZ4jAOzsU+l0Ed4EJoWkRdfw8rNqmSN7itcdYeCJaSPQ0s5Pyn/eGNC4xNevxbgY+5bzNllw==}\n+  puppeteer-core@24.33.0:\n+    resolution: {integrity: sha512-tPTxVg+Qdj/8av4cy6szv3GlhxeOoNhiiMZ955fjxQyvPQE/6DjCa6ZyF/x0WJrlgBZtaLSP8TQgJb7FdLDXXA==}\n     engines: {node: '>=18'}\n \n-  puppeteer@24.28.0:\n-    resolution: {integrity: sha512-KLRGFNCGmXJpocEBbEIoHJB0vNRZLQNBjl5ExXEv0z7MIU+qqVEQcfWTyat+qxPDk/wZvSf+b30cQqAfWxX0zg==}\n+  puppeteer@24.33.0:\n+    resolution: {integrity: sha512-nl3wsAztq5F8zybn4Tk41OCnYIzFIzGC6AN0WcF2KCUnWenajvRRPgBmS6LvNUV2HEeIzT2zRZHH0TgVxLDKew==}\n     engines: {node: '>=18'}\n     hasBin: true\n \n-  queue-microtask@1.2.3:\n-    resolution: {integrity: sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==}\n-\n   queue-tick@1.0.1:\n     resolution: {integrity: sha512-kJt5qhMxoszgU/62PLP1CJytzd2NKetjSRnyuj31fDd3Rlcz3fzlFdFLD1SItunPwyqEOkca6GbV612BWfaBag==}\n \n@@ -3135,10 +3070,6 @@ packages:\n     resolution: {integrity: sha512-oMA2dcrw6u0YfxJQXm342bFKX/E4sG9rbTzO9ptUcR/e8A33cHuvStiYOwH7fszkZlZ1z/ta9AAoPk2F4qIOHA==}\n     engines: {node: '>=18'}\n \n-  reusify@1.1.0:\n-    resolution: {integrity: sha512-g6QUff04oZpHs0eG5p83rFLhHeV00ug/Yf9nZM6fLeUrPguBTkTQOdpAWWspMh55TZfVQDPaN3NQJfbVRAxdIw==}\n-    engines: {iojs: '>=1.0.0', node: '>=0.10.0'}\n-\n   rfdc@1.4.1:\n     resolution: {integrity: sha512-q1b3N5QkRUWUl7iyylaaj3kOpIT0N2i9MqIEQXP73GVsN9cw3fdx8X63cEmWhJGi2PPCF23Ijp7ktmd39rawIA==}\n \n@@ -3171,9 +3102,6 @@ packages:\n     engines: {node: '>=18.0.0', npm: '>=8.0.0'}\n     hasBin: true\n \n-  run-parallel@1.2.0:\n-    resolution: {integrity: sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==}\n-\n   safe-buffer@5.1.2:\n     resolution: {integrity: sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==}\n \n@@ -3600,8 +3528,8 @@ packages:\n     resolution: {integrity: sha512-o8qghlI8NZHU1lLPrpi2+Uq7abh4GGPpYANlalzWxyWteJOCsr/P+oPBA49TOLu5FTZO4d3F9MnWJfiMo4BkmA==}\n     engines: {node: '>=18'}\n \n-  webdriver-bidi-protocol@0.3.8:\n-    resolution: {integrity: sha512-21Yi2GhGntMc671vNBCjiAeEVknXjVRoyu+k+9xOMShu+ZQfpGQwnBqbNz/Sv4GXZ6JmutlPAi2nIJcrymAWuQ==}\n+  webdriver-bidi-protocol@0.3.9:\n+    resolution: {integrity: sha512-uIYvlRQ0PwtZR1EzHlTMol1G0lAlmOe6wPykF9a77AK3bkpvZHzIVxRE2ThOx5vjy2zISe0zhwf5rzuUfbo1PQ==}\n \n   webidl-conversions@8.0.0:\n     resolution: {integrity: sha512-n4W4YFyz5JzOfQeA8oN7dUYpR+MBP3PIUsn2jLjWXwK5ASUzt0Jc/A5sAUZoCYFJRGF0FBKJ+1JjN43rNdsQzA==}\n@@ -3712,14 +3640,14 @@ packages:\n \n snapshots:\n \n-  '@acemir/cssom@0.9.19': {}\n+  '@acemir/cssom@0.9.29': {}\n \n   '@ampproject/remapping@2.3.0':\n     dependencies:\n       '@jridgewell/gen-mapping': 0.3.5\n       '@jridgewell/trace-mapping': 0.3.25\n \n-  '@asamuzakjp/css-color@4.0.5':\n+  '@asamuzakjp/css-color@4.1.0':\n     dependencies:\n       '@csstools/css-calc': 2.1.4(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)\n       '@csstools/css-color-parser': 3.1.0(@csstools/css-parser-algorithms@3.0.5(@csstools/css-tokenizer@3.0.4))(@csstools/css-tokenizer@3.0.4)\n@@ -3727,13 +3655,13 @@ snapshots:\n       '@csstools/css-tokenizer': 3.0.4\n       lru-cache: 11.2.2\n \n-  '@asamuzakjp/dom-selector@6.7.4':\n+  '@asamuzakjp/dom-selector@6.7.6':\n     dependencies:\n       '@asamuzakjp/nwsapi': 2.3.9\n       bidi-js: 1.0.3\n       css-tree: 3.1.0\n       is-potential-custom-element-name: 1.0.1\n-      lru-cache: 11.2.2\n+      lru-cache: 11.2.4\n \n   '@asamuzakjp/nwsapi@2.3.9': {}\n \n@@ -3953,11 +3881,6 @@ snapshots:\n   '@esbuild/win32-x64@0.27.1':\n     optional: true\n \n-  '@eslint-community/eslint-utils@4.7.0(eslint@9.39.2)':\n-    dependencies:\n-      eslint: 9.39.2\n-      eslint-visitor-keys: 3.4.3\n-\n   '@eslint-community/eslint-utils@4.9.0(eslint@9.39.2)':\n     dependencies:\n       eslint: 9.39.2\n@@ -4067,18 +3990,6 @@ snapshots:\n       '@tybys/wasm-util': 0.10.1\n     optional: true\n \n-  '@nodelib/fs.scandir@2.1.5':\n-    dependencies:\n-      '@nodelib/fs.stat': 2.0.5\n-      run-parallel: 1.2.0\n-\n-  '@nodelib/fs.stat@2.0.5': {}\n-\n-  '@nodelib/fs.walk@1.2.8':\n-    dependencies:\n-      '@nodelib/fs.scandir': 2.1.5\n-      fastq: 1.19.1\n-\n   '@parcel/watcher-android-arm64@2.4.1':\n     optional: true\n \n@@ -4139,7 +4050,7 @@ snapshots:\n   '@pkgjs/parseargs@0.11.0':\n     optional: true\n \n-  '@puppeteer/browsers@2.10.13':\n+  '@puppeteer/browsers@2.11.0':\n     dependencies:\n       debug: 4.4.3\n       extract-zip: 2.0.1\n@@ -4394,15 +4305,6 @@ snapshots:\n     transitivePeerDependencies:\n       - supports-color\n \n-  '@typescript-eslint/project-service@8.46.3(typescript@5.6.3)':\n-    dependencies:\n-      '@typescript-eslint/tsconfig-utils': 8.46.3(typescript@5.6.3)\n-      '@typescript-eslint/types': 8.46.3\n-      debug: 4.4.3\n-      typescript: 5.6.3\n-    transitivePeerDependencies:\n-      - supports-color\n-\n   '@typescript-eslint/project-service@8.49.0(typescript@5.6.3)':\n     dependencies:\n       '@typescript-eslint/tsconfig-utils': 8.49.0(typescript@5.6.3)\n@@ -4412,20 +4314,11 @@ snapshots:\n     transitivePeerDependencies:\n       - supports-color\n \n-  '@typescript-eslint/scope-manager@8.46.3':\n-    dependencies:\n-      '@typescript-eslint/types': 8.46.3\n-      '@typescript-eslint/visitor-keys': 8.46.3\n-\n   '@typescript-eslint/scope-manager@8.49.0':\n     dependencies:\n       '@typescript-eslint/types': 8.49.0\n       '@typescript-eslint/visitor-keys': 8.49.0\n \n-  '@typescript-eslint/tsconfig-utils@8.46.3(typescript@5.6.3)':\n-    dependencies:\n-      typescript: 5.6.3\n-\n   '@typescript-eslint/tsconfig-utils@8.49.0(typescript@5.6.3)':\n     dependencies:\n       typescript: 5.6.3\n@@ -4446,22 +4339,6 @@ snapshots:\n \n   '@typescript-eslint/types@8.49.0': {}\n \n-  '@typescript-eslint/typescript-estree@8.46.3(typescript@5.6.3)':\n-    dependencies:\n-      '@typescript-eslint/project-service': 8.46.3(typescript@5.6.3)\n-      '@typescript-eslint/tsconfig-utils': 8.46.3(typescript@5.6.3)\n-      '@typescript-eslint/types': 8.46.3\n-      '@typescript-eslint/visitor-keys': 8.46.3\n-      debug: 4.4.3\n-      fast-glob: 3.3.3\n-      is-glob: 4.0.3\n-      minimatch: 9.0.5\n-      semver: 7.7.3\n-      ts-api-utils: 2.1.0(typescript@5.6.3)\n-      typescript: 5.6.3\n-    transitivePeerDependencies:\n-      - supports-color\n-\n   '@typescript-eslint/typescript-estree@8.49.0(typescript@5.6.3)':\n     dependencies:\n       '@typescript-eslint/project-service': 8.49.0(typescript@5.6.3)\n@@ -4477,20 +4354,9 @@ snapshots:\n     transitivePeerDependencies:\n       - supports-color\n \n-  '@typescript-eslint/utils@8.46.3(eslint@9.39.2)(typescript@5.6.3)':\n-    dependencies:\n-      '@eslint-community/eslint-utils': 4.7.0(eslint@9.39.2)\n-      '@typescript-eslint/scope-manager': 8.46.3\n-      '@typescript-eslint/types': 8.46.3\n-      '@typescript-eslint/typescript-estree': 8.46.3(typescript@5.6.3)\n-      eslint: 9.39.2\n-      typescript: 5.6.3\n-    transitivePeerDependencies:\n-      - supports-color\n-\n   '@typescript-eslint/utils@8.49.0(eslint@9.39.2)(typescript@5.6.3)':\n     dependencies:\n-      '@eslint-community/eslint-utils': 4.7.0(eslint@9.39.2)\n+      '@eslint-community/eslint-utils': 4.9.0(eslint@9.39.2)\n       '@typescript-eslint/scope-manager': 8.49.0\n       '@typescript-eslint/types': 8.49.0\n       '@typescript-eslint/typescript-estree': 8.49.0(typescript@5.6.3)\n@@ -4499,11 +4365,6 @@ snapshots:\n     transitivePeerDependencies:\n       - supports-color\n \n-  '@typescript-eslint/visitor-keys@8.46.3':\n-    dependencies:\n-      '@typescript-eslint/types': 8.46.3\n-      eslint-visitor-keys: 4.2.1\n-\n   '@typescript-eslint/visitor-keys@8.49.0':\n     dependencies:\n       '@typescript-eslint/types': 8.49.0\n@@ -4574,7 +4435,7 @@ snapshots:\n       vite: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n       vue: link:packages/vue\n \n-  '@vitest/coverage-v8@3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0))':\n+  '@vitest/coverage-v8@3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0))':\n     dependencies:\n       '@ampproject/remapping': 2.3.0\n       '@bcoe/v8-coverage': 1.0.2\n@@ -4589,18 +4450,18 @@ snapshots:\n       std-env: 3.9.0\n       test-exclude: 7.0.1\n       tinyrainbow: 2.0.0\n-      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0)\n+      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0)\n     transitivePeerDependencies:\n       - supports-color\n \n-  '@vitest/eslint-plugin@1.4.0(eslint@9.39.2)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0))':\n+  '@vitest/eslint-plugin@1.5.2(eslint@9.39.2)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0))':\n     dependencies:\n-      '@typescript-eslint/scope-manager': 8.46.3\n-      '@typescript-eslint/utils': 8.46.3(eslint@9.39.2)(typescript@5.6.3)\n+      '@typescript-eslint/scope-manager': 8.49.0\n+      '@typescript-eslint/utils': 8.49.0(eslint@9.39.2)(typescript@5.6.3)\n       eslint: 9.39.2\n     optionalDependencies:\n       typescript: 5.6.3\n-      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0)\n+      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0)\n     transitivePeerDependencies:\n       - supports-color\n \n@@ -4834,9 +4695,9 @@ snapshots:\n     dependencies:\n       readdirp: 4.0.1\n \n-  chromium-bidi@10.5.1(devtools-protocol@0.0.1521046):\n+  chromium-bidi@11.0.0(devtools-protocol@0.0.1534754):\n     dependencies:\n-      devtools-protocol: 0.0.1521046\n+      devtools-protocol: 0.0.1534754\n       mitt: 3.0.1\n       zod: 3.24.1\n \n@@ -5011,9 +4872,9 @@ snapshots:\n \n   cssesc@3.0.0: {}\n \n-  cssstyle@5.3.2(postcss@8.5.6):\n+  cssstyle@5.3.4(postcss@8.5.6):\n     dependencies:\n-      '@asamuzakjp/css-color': 4.0.5\n+      '@asamuzakjp/css-color': 4.1.0\n       '@csstools/css-syntax-patches-for-csstree': 1.0.14(postcss@8.5.6)\n       css-tree: 3.1.0\n     transitivePeerDependencies:\n@@ -5074,7 +4935,7 @@ snapshots:\n   detect-libc@1.0.3:\n     optional: true\n \n-  devtools-protocol@0.0.1521046: {}\n+  devtools-protocol@0.0.1534754: {}\n \n   doctypes@1.1.0: {}\n \n@@ -5336,22 +5197,10 @@ snapshots:\n \n   fast-fifo@1.3.2: {}\n \n-  fast-glob@3.3.3:\n-    dependencies:\n-      '@nodelib/fs.stat': 2.0.5\n-      '@nodelib/fs.walk': 1.2.8\n-      glob-parent: 5.1.2\n-      merge2: 1.4.1\n-      micromatch: 4.0.8\n-\n   fast-json-stable-stringify@2.1.0: {}\n \n   fast-levenshtein@2.0.6: {}\n \n-  fastq@1.19.1:\n-    dependencies:\n-      reusify: 1.1.0\n-\n   fd-slicer@1.1.0:\n     dependencies:\n       pend: 1.2.0\n@@ -5461,10 +5310,6 @@ snapshots:\n       - conventional-commits-filter\n       - conventional-commits-parser\n \n-  glob-parent@5.1.2:\n-    dependencies:\n-      is-glob: 4.0.3\n-\n   glob-parent@6.0.2:\n     dependencies:\n       is-glob: 4.0.3\n@@ -5680,11 +5525,11 @@ snapshots:\n \n   jsbn@1.1.0: {}\n \n-  jsdom@27.1.0(postcss@8.5.6):\n+  jsdom@27.3.0(postcss@8.5.6):\n     dependencies:\n-      '@acemir/cssom': 0.9.19\n-      '@asamuzakjp/dom-selector': 6.7.4\n-      cssstyle: 5.3.2(postcss@8.5.6)\n+      '@acemir/cssom': 0.9.29\n+      '@asamuzakjp/dom-selector': 6.7.6\n+      cssstyle: 5.3.4(postcss@8.5.6)\n       data-urls: 6.0.0\n       decimal.js: 10.6.0\n       html-encoding-sniffer: 4.0.0\n@@ -5802,6 +5647,8 @@ snapshots:\n \n   lru-cache@11.2.2: {}\n \n+  lru-cache@11.2.4: {}\n+\n   lru-cache@7.18.3: {}\n \n   magic-string@0.30.21:\n@@ -5836,8 +5683,6 @@ snapshots:\n \n   merge-stream@2.0.0: {}\n \n-  merge2@1.4.1: {}\n-\n   micromatch@4.0.8:\n     dependencies:\n       braces: 3.0.3\n@@ -6188,27 +6033,27 @@ snapshots:\n \n   punycode@2.3.1: {}\n \n-  puppeteer-core@24.28.0:\n+  puppeteer-core@24.33.0:\n     dependencies:\n-      '@puppeteer/browsers': 2.10.13\n-      chromium-bidi: 10.5.1(devtools-protocol@0.0.1521046)\n+      '@puppeteer/browsers': 2.11.0\n+      chromium-bidi: 11.0.0(devtools-protocol@0.0.1534754)\n       debug: 4.4.3\n-      devtools-protocol: 0.0.1521046\n+      devtools-protocol: 0.0.1534754\n       typed-query-selector: 2.12.0\n-      webdriver-bidi-protocol: 0.3.8\n+      webdriver-bidi-protocol: 0.3.9\n       ws: 8.18.3\n     transitivePeerDependencies:\n       - bufferutil\n       - supports-color\n       - utf-8-validate\n \n-  puppeteer@24.28.0(typescript@5.6.3):\n+  puppeteer@24.33.0(typescript@5.6.3):\n     dependencies:\n-      '@puppeteer/browsers': 2.10.13\n-      chromium-bidi: 10.5.1(devtools-protocol@0.0.1521046)\n+      '@puppeteer/browsers': 2.11.0\n+      chromium-bidi: 11.0.0(devtools-protocol@0.0.1534754)\n       cosmiconfig: 9.0.0(typescript@5.6.3)\n-      devtools-protocol: 0.0.1521046\n-      puppeteer-core: 24.28.0\n+      devtools-protocol: 0.0.1534754\n+      puppeteer-core: 24.33.0\n       typed-query-selector: 2.12.0\n     transitivePeerDependencies:\n       - bufferutil\n@@ -6216,8 +6061,6 @@ snapshots:\n       - typescript\n       - utf-8-validate\n \n-  queue-microtask@1.2.3: {}\n-\n   queue-tick@1.0.1: {}\n \n   range-parser@1.2.0: {}\n@@ -6288,8 +6131,6 @@ snapshots:\n       onetime: 7.0.0\n       signal-exit: 4.1.0\n \n-  reusify@1.1.0: {}\n-\n   rfdc@1.4.1: {}\n \n   rimraf@6.1.2:\n@@ -6349,10 +6190,6 @@ snapshots:\n       '@rollup/rollup-win32-x64-msvc': 4.53.3\n       fsevents: 2.3.3\n \n-  run-parallel@1.2.0:\n-    dependencies:\n-      queue-microtask: 1.2.3\n-\n   safe-buffer@5.1.2: {}\n \n   safe-buffer@5.2.1: {}\n@@ -6732,7 +6569,7 @@ snapshots:\n       fsevents: 2.3.3\n       sass: 1.96.0\n \n-  vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0):\n+  vitest@3.2.4(@types/node@24.10.4)(jsdom@27.3.0(postcss@8.5.6))(sass@1.96.0):\n     dependencies:\n       '@types/chai': 5.2.2\n       '@vitest/expect': 3.2.4\n@@ -6759,7 +6596,7 @@ snapshots:\n       why-is-node-running: 2.3.0\n     optionalDependencies:\n       '@types/node': 24.10.4\n-      jsdom: 27.1.0(postcss@8.5.6)\n+      jsdom: 27.3.0(postcss@8.5.6)\n     transitivePeerDependencies:\n       - less\n       - lightningcss\n@@ -6777,7 +6614,7 @@ snapshots:\n     dependencies:\n       xml-name-validator: 5.0.0\n \n-  webdriver-bidi-protocol@0.3.8: {}\n+  webdriver-bidi-protocol@0.3.9: {}\n \n   webidl-conversions@8.0.0: {}\n "}, {"role": "assistant", "content": "build(deps): update vitest, jsdom, and puppeteer"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/go/testdata/vcstest/git/legacytest.txt | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/cmd/go/testdata/vcstest/git/legacytest.txt b/src/cmd/go/testdata/vcstest/git/legacytest.txt\nindex 5846983c..6465242d 100644\n--- a/src/cmd/go/testdata/vcstest/git/legacytest.txt\n+++ b/src/cmd/go/testdata/vcstest/git/legacytest.txt\n@@ -6,7 +6,7 @@ env GIT_COMMITTER_NAME=$GIT_AUTHOR_NAME\n env GIT_COMMITTER_EMAIL=$GIT_AUTHOR_EMAIL\n \n git init\n-git branch -M master\n+git checkout -b master\n \n at 2018-07-17T12:41:39-04:00\n cp x_cf92c7b.go x.go"}, {"role": "assistant", "content": "test: use checkout -b instead of branch -M for git init"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts | 13 ++++++-------\n packages/compiler/src/expression_parser/ast.ts              |  4 +++-\n 2 files changed, 9 insertions(+), 8 deletions(-)\n\ndiff --git a/packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts b/packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts\nindex 1275ea57..36197ee3 100644\n--- a/packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts\n+++ b/packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts\n@@ -129,13 +129,6 @@ class AstTranslator implements AstVisitor {\n       ast = ast.ast;\n     }\n \n-    // The `EmptyExpr` doesn't have a dedicated method on `AstVisitor`, so it's special cased here.\n-    if (ast instanceof EmptyExpr) {\n-      const res = ts.factory.createIdentifier('undefined');\n-      addParseSpanInfo(res, ast.sourceSpan);\n-      return res;\n-    }\n-\n     // First attempt to let any custom resolution logic provide a translation for the given node.\n     const resolved = this.maybeResolve(ast);\n     if (resolved !== null) {\n@@ -494,6 +487,12 @@ class AstTranslator implements AstVisitor {\n     return node;\n   }\n \n+  visitEmptyExpr(ast: EmptyExpr, context: any) {\n+    const node = ts.factory.createIdentifier('undefined');\n+    addParseSpanInfo(node, ast.sourceSpan);\n+    return node;\n+  }\n+\n   private convertToSafeCall(\n     ast: Call | SafeCall,\n     expr: ts.Expression,\ndiff --git a/packages/compiler/src/expression_parser/ast.ts b/packages/compiler/src/expression_parser/ast.ts\nindex 3d851bac..2f6fcc18 100644\n--- a/packages/compiler/src/expression_parser/ast.ts\n+++ b/packages/compiler/src/expression_parser/ast.ts\n@@ -47,7 +47,7 @@ export abstract class ASTWithName extends AST {\n \n export class EmptyExpr extends AST {\n   override visit(visitor: AstVisitor, context: any = null) {\n-    // do nothing\n+    return visitor.visitEmptyExpr?.(this, context);\n   }\n }\n \n@@ -651,6 +651,7 @@ export interface AstVisitor {\n   visitRegularExpressionLiteral(ast: RegularExpressionLiteral, context: any): any;\n   visitSpreadElement(ast: SpreadElement, context: any): any;\n   visitASTWithSource?(ast: ASTWithSource, context: any): any;\n+  visitEmptyExpr?(ast: EmptyExpr, context: any): any;\n   /**\n    * This function is optionally defined to allow classes that implement this\n    * interface to selectively decide if the specified `ast` should be visited.\n@@ -756,6 +757,7 @@ export class RecursiveAstVisitor implements AstVisitor {\n   visitSpreadElement(ast: SpreadElement, context: any) {\n     this.visit(ast.expression, context);\n   }\n+  visitEmptyExpr(ast: EmptyExpr, context: any): any {}\n   // This is not part of the AstVisitor interface, just a helper method\n   visitAll(asts: AST[], context: any): any {\n     for (const ast of asts) {"}, {"role": "assistant", "content": "feat(compiler): support `AstVisitor.visitEmptyExpr()`"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/compiler-core/src/transforms/transformVBindShorthand.ts | 5 +++--\n 1 file changed, 3 insertions(+), 2 deletions(-)\n\ndiff --git a/packages/compiler-core/src/transforms/transformVBindShorthand.ts b/packages/compiler-core/src/transforms/transformVBindShorthand.ts\nindex a6b989e..2101808 100644\n--- a/packages/compiler-core/src/transforms/transformVBindShorthand.ts\n+++ b/packages/compiler-core/src/transforms/transformVBindShorthand.ts\n@@ -19,9 +19,10 @@ export const transformVBindShorthand: NodeTransform = (node, context) => {\n           // #13930 :foo in in-DOM templates will be parsed into :foo=\"\" by browser\n           (__BROWSER__ &&\n             prop.exp.type === NodeTypes.SIMPLE_EXPRESSION &&\n-            !prop.exp.content.trim()))\n+            !prop.exp.content.trim())) &&\n+        prop.arg\n       ) {\n-        const arg = prop.arg!\n+        const arg = prop.arg\n         if (arg.type !== NodeTypes.SIMPLE_EXPRESSION || !arg.isStatic) {\n           // only simple expression is allowed for same-name shorthand\n           context.onError("}, {"role": "assistant", "content": "fix(compiler-core): add null check for v-bind shorthand arg"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n scripts/jest/config.base.js           |  1 +\n scripts/jest/sizeBalancedSequencer.js | 28 ++++++++++++++++++++++++++++\n 2 files changed, 29 insertions(+)\n\ndiff --git a/scripts/jest/config.base.js b/scripts/jest/config.base.js\nindex ba001e1..12b5fc4 100644\n--- a/scripts/jest/config.base.js\n+++ b/scripts/jest/config.base.js\n@@ -2,6 +2,7 @@\n \n module.exports = {\n   globalSetup: require.resolve('./setupGlobal.js'),\n+  testSequencer: require.resolve('./sizeBalancedSequencer.js'),\n   modulePathIgnorePatterns: [\n     '<rootDir>/scripts/rollup/shims/',\n     '<rootDir>/scripts/bench/',\ndiff --git a/scripts/jest/sizeBalancedSequencer.js b/scripts/jest/sizeBalancedSequencer.js\nnew file mode 100644\nindex 0000000..318cd13\n--- /dev/null\n+++ b/scripts/jest/sizeBalancedSequencer.js\n@@ -0,0 +1,28 @@\n+'use strict';\n+\n+const Sequencer = require('@jest/test-sequencer').default;\n+const fs = require('fs');\n+\n+class SizeBalancedSequencer extends Sequencer {\n+  shard(tests, {shardIndex, shardCount}) {\n+    const shards = Array.from({length: shardCount}, () => ({\n+      tests: [],\n+      size: 0,\n+    }));\n+    const sorted = [...tests].sort(\n+      (a, b) => fs.statSync(b.path).size - fs.statSync(a.path).size\n+    );\n+\n+    for (let i = 0; i < sorted.length; i++) {\n+      const test = sorted[i];\n+      const size = fs.statSync(test.path).size;\n+      const smallest = shards.reduce((min, s) => (s.size < min.size ? s : min));\n+      smallest.tests.push(test);\n+      smallest.size += size;\n+    }\n+\n+    return shards[shardIndex - 1].tests;\n+  }\n+}\n+\n+module.exports = SizeBalancedSequencer;"}, {"role": "assistant", "content": "test(jest): add size-balanced test sequencer for sharding"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/runtime_build_and_test.yml | 45 ++++++++++++++++++++++++++--\n 1 file changed, 42 insertions(+), 3 deletions(-)\n\ndiff --git a/.github/workflows/runtime_build_and_test.yml b/.github/workflows/runtime_build_and_test.yml\nindex c1cc8df..735ac6e 100644\n--- a/.github/workflows/runtime_build_and_test.yml\n+++ b/.github/workflows/runtime_build_and_test.yml\n@@ -382,9 +382,6 @@ jobs:\n           -r=experimental --env=development,\n           -r=experimental --env=production,\n \n-          # Dev Tools\n-          --project=devtools -r=experimental,\n-\n           # TODO: Update test config to support www build tests\n           # - \"-r=www-classic --env=development --variant=false\"\n           # - \"-r=www-classic --env=production --variant=false\"\n@@ -450,6 +447,48 @@ jobs:\n         run: ls -R build\n       - run: yarn test --build ${{ matrix.test_params }} --shard=${{ matrix.shard }} --ci\n \n+  test_build_devtools:\n+    name: yarn test-build (devtools)\n+    needs: [build_and_lint, runtime_node_modules_cache]\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        shard:\n+          - 1/3\n+          - 2/3\n+          - 3/3\n+    runs-on: ubuntu-latest\n+    steps:\n+      - uses: actions/checkout@v4\n+        with:\n+          ref: ${{ github.event.inputs.commit_sha != '' && github.event.inputs.commit_sha || github.event.pull_request.head.sha || github.sha }}\n+      - uses: actions/setup-node@v4\n+        with:\n+          node-version-file: '.nvmrc'\n+          cache: yarn\n+          cache-dependency-path: yarn.lock\n+      - name: Restore cached node_modules\n+        uses: actions/cache/restore@v4\n+        id: node_modules\n+        with:\n+          path: |\n+            **/node_modules\n+          key: runtime-node_modules-v7-${{ runner.arch }}-${{ runner.os }}-${{ hashFiles('yarn.lock') }}\n+          # Don't use restore-keys here. Otherwise the cache grows indefinitely.\n+      - name: Ensure clean build directory\n+        run: rm -rf build\n+      - run: yarn install --frozen-lockfile\n+        if: steps.node_modules.outputs.cache-hit != 'true'\n+      - name: Restore archived build\n+        uses: actions/download-artifact@v4\n+        with:\n+          pattern: _build_*\n+          path: build\n+          merge-multiple: true\n+      - name: Display structure of build\n+        run: ls -R build\n+      - run: yarn test --build --project=devtools -r=experimental --shard=${{ matrix.shard }} --ci\n+\n   process_artifacts_combined:\n     name: Process artifacts combined\n     needs: [build_and_lint, runtime_node_modules_cache]"}, {"role": "assistant", "content": "ci: split devtools build tests into dedicated job"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/__tests__/store-test.js                    | 53 ++++++++++++++++++++++\n .../src/backend/fiber/renderer.js                  | 26 ++++++++++-\n 2 files changed, 78 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/react-devtools-shared/src/__tests__/store-test.js b/packages/react-devtools-shared/src/__tests__/store-test.js\nindex 37272ea..c4fe7d3 100644\n--- a/packages/react-devtools-shared/src/__tests__/store-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/store-test.js\n@@ -3143,6 +3143,59 @@ describe('Store', () => {\n     expect(store).toMatchInlineSnapshot(``);\n   });\n \n+  // @reactVersion >= 17.0\n+  it('should track suspended by in filtered fallback', async () => {\n+    function IgnoreMe({promise}) {\n+      return readValue(promise);\n+    }\n+\n+    function Component({promise}) {\n+      return readValue(promise);\n+    }\n+\n+    await actAsync(\n+      async () =>\n+        (store.componentFilters = [createDisplayNameFilter('^IgnoreMe', true)]),\n+    );\n+\n+    let resolveFallback;\n+    const fallbackPromise = new Promise(resolve => {\n+      resolveFallback = resolve;\n+    });\n+    let resolveContent;\n+    const contentPromise = new Promise(resolve => {\n+      resolveContent = resolve;\n+    });\n+\n+    await actAsync(() =>\n+      render(\n+        <React.Suspense\n+          name=\"main\"\n+          fallback={<IgnoreMe promise={fallbackPromise} />}>\n+          <Component promise={contentPromise} />\n+        </React.Suspense>,\n+      ),\n+    );\n+    expect(store).toMatchInlineSnapshot(``);\n+\n+    await actAsync(() => resolveFallback('loading'));\n+    expect(store).toMatchInlineSnapshot(`\n+      [root]\n+          <Suspense name=\"main\">\n+      [suspense-root]  rects={null}\n+        <Suspense name=\"main\" rects={null}>\n+    `);\n+\n+    await actAsync(() => resolveContent('content'));\n+    expect(store).toMatchInlineSnapshot(`\n+      [root]\n+        \u25be <Suspense name=\"main\">\n+            <Component>\n+      [suspense-root]  rects={null}\n+        <Suspense name=\"main\" rects={null}>\n+    `);\n+  });\n+\n   // @reactVersion >= 19\n   it('should keep suspended boundaries in the Suspense tree but not hidden Activity', async () => {\n     const Activity = React.Activity || React.unstable_Activity;\ndiff --git a/packages/react-devtools-shared/src/backend/fiber/renderer.js b/packages/react-devtools-shared/src/backend/fiber/renderer.js\nindex 4f755fd..6848e32 100644\n--- a/packages/react-devtools-shared/src/backend/fiber/renderer.js\n+++ b/packages/react-devtools-shared/src/backend/fiber/renderer.js\n@@ -2992,6 +2992,30 @@ export function attach(\n     ) {\n       parentInstance = parentInstance.parent;\n     }\n+    if (parentInstance.kind === FIBER_INSTANCE) {\n+      const fiber = parentInstance.data;\n+\n+      if (\n+        fiber.tag === SuspenseComponent &&\n+        parentInstance !== parentSuspenseNode.instance\n+      ) {\n+        // We're about to attach async info to a Suspense boundary we're not\n+        // actually considering the parent Suspense boundary for this async info.\n+        // We must have not found a suitable Fiber inside the fallback (e.g. due to filtering).\n+        // Use the parent of this instance instead since we treat async info\n+        // attached to a Suspense boundary as that async info triggering the\n+        // fallback of that boundary.\n+        const parent = parentInstance.parent;\n+        if (parent === null) {\n+          // This shouldn't happen. Any <Suspense> would have at least have the\n+          // host root as the parent which can't have a fallback.\n+          throw new Error(\n+            'Did not find a suitable instance for this async info. This is a bug in React.',\n+          );\n+        }\n+        parentInstance = parent;\n+      }\n+    }\n \n     const suspenseNodeSuspendedBy = parentSuspenseNode.suspendedBy;\n     const ioInfo = asyncInfo.awaited;\n@@ -5255,9 +5279,9 @@ export function attach(\n       // It might even result in a bad user experience for e.g. node selection in the Elements panel.\n       // The easiest fix is to strip out the intermediate Fragment fibers,\n       // so the Elements panel and Profiler don't need to special case them.\n-      // Suspense components only have a non-null memoizedState if they're timed-out.\n       const isLegacySuspense =\n         nextFiber.tag === SuspenseComponent && OffscreenComponent === -1;\n+      // Suspense components only have a non-null memoizedState if they're timed-out.\n       const prevDidTimeout =\n         isLegacySuspense && prevFiber.memoizedState !== null;\n       const nextDidTimeOut ="}, {"role": "assistant", "content": "fix(devtools): track suspended components in filtered fallback"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-core/src/componentPublicInstance.ts | 14 ++++----------\n 1 file changed, 4 insertions(+), 10 deletions(-)\n\ndiff --git a/packages/runtime-core/src/componentPublicInstance.ts b/packages/runtime-core/src/componentPublicInstance.ts\nindex 57d784c..a334b48 100644\n--- a/packages/runtime-core/src/componentPublicInstance.ts\n+++ b/packages/runtime-core/src/componentPublicInstance.ts\n@@ -430,7 +430,6 @@ export const PublicInstanceProxyHandlers: ProxyHandler<any> = {\n     // is the multiple hasOwn() calls. It's much faster to do a simple property\n     // access on a plain object, so we use an accessCache object (with null\n     // prototype) to memoize what access type a key corresponds to.\n-    let normalizedProps\n     if (key[0] !== '$') {\n       const n = accessCache![key]\n       if (n !== undefined) {\n@@ -455,12 +454,7 @@ export const PublicInstanceProxyHandlers: ProxyHandler<any> = {\n       ) {\n         accessCache![key] = AccessTypes.DATA\n         return data[key]\n-      } else if (\n-        // only cache other properties when instance has declared (thus stable)\n-        // props\n-        (normalizedProps = instance.propsOptions[0]) &&\n-        hasOwn(normalizedProps, key)\n-      ) {\n+      } else if (hasOwn(props, key)) {\n         accessCache![key] = AccessTypes.PROPS\n         return props![key]\n       } else if (ctx !== EMPTY_OBJ && hasOwn(ctx, key)) {\n@@ -583,11 +577,11 @@ export const PublicInstanceProxyHandlers: ProxyHandler<any> = {\n \n   has(\n     {\n-      _: { data, setupState, accessCache, ctx, appContext, propsOptions, type },\n+      _: { data, setupState, accessCache, ctx, appContext, props, type },\n     }: ComponentRenderContext,\n     key: string,\n   ) {\n-    let normalizedProps, cssModules\n+    let cssModules\n     return !!(\n       accessCache![key] ||\n       (__FEATURE_OPTIONS_API__ &&\n@@ -595,7 +589,7 @@ export const PublicInstanceProxyHandlers: ProxyHandler<any> = {\n         key[0] !== '$' &&\n         hasOwn(data, key)) ||\n       hasSetupBinding(setupState, key) ||\n-      ((normalizedProps = propsOptions[0]) && hasOwn(normalizedProps, key)) ||\n+      hasOwn(props, key) ||\n       hasOwn(ctx, key) ||\n       hasOwn(publicPropertiesMap, key) ||\n       hasOwn(appContext.config.globalProperties, key) ||"}, {"role": "assistant", "content": "refactor: simplify props access check in component proxy"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_hir_analysis/src/collect.rs         |   8 +-\n .../src/hir_ty_lowering/bounds.rs                  |  35 +++---\n .../rustc_hir_analysis/src/hir_ty_lowering/mod.rs  | 136 ++++++++++-----------\n compiler/rustc_hir_analysis/src/lib.rs             |   6 +-\n compiler/rustc_hir_typeck/src/expr.rs              |   4 +-\n compiler/rustc_hir_typeck/src/fn_ctxt/_impl.rs     |  13 +-\n compiler/rustc_hir_typeck/src/method/confirm.rs    |   7 +-\n src/librustdoc/clean/mod.rs                        |  50 ++++++--\n .../associated-const-bindings/ambiguity.stderr     |   6 +\n .../mgca/tuple_expr_arg_bad-issue-151048.rs        |   8 ++\n .../mgca/tuple_expr_arg_bad-issue-151048.stderr    |   8 ++\n 11 files changed, 163 insertions(+), 118 deletions(-)\n\ndiff --cc compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\nindex a66a521975c,65d2d61e6fc..6e1e6c157a9\n--- a/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\n+++ b/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\n@@@ -2410,15 -2410,12 +2410,11 @@@ impl<'tcx> dyn HirTyLowerer<'tcx> + '_ \n      ) -> Const<'tcx> {\n          let tcx = self.tcx();\n  \n-         let FeedConstTy::WithTy(ty) = feed else {\n-             return Const::new_error_with_message(tcx, array_expr.span, \"unsupported const array\");\n-         };\n- \n          let ty::Array(elem_ty, _) = ty.kind() else {\n -            return Const::new_error_with_message(\n -                tcx,\n -                array_expr.span,\n -                \"const array must have an array type\",\n -            );\n +            let e = tcx\n +                .dcx()\n +                .span_err(array_expr.span, format!(\"expected `{}`, found const array\", ty));\n +            return Const::new_error(tcx, e);\n          };\n  \n          let elems = array_expr"}, {"role": "assistant", "content": "refactor(hirtylowering): simplify const array type handling"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_parse/src/parser/generics.rs        | 26 +++++++-\n tests/ui/const-generics/incorrect-const-param.rs   | 45 ++++++++++++++\n .../ui/const-generics/incorrect-const-param.stderr | 70 ++++++++++++++++++++++\n 3 files changed, 140 insertions(+), 1 deletion(-)"}, {"role": "assistant", "content": "fix(parser): improve const generic parameter diagnostics"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n CHANGELOG.md                          | 22 ++++++++++++++++++++++\n package.json                          |  2 +-\n packages/compiler-core/package.json   |  2 +-\n packages/compiler-dom/package.json    |  2 +-\n packages/compiler-sfc/package.json    |  2 +-\n packages/compiler-ssr/package.json    |  2 +-\n packages/reactivity/package.json      |  2 +-\n packages/runtime-core/package.json    |  2 +-\n packages/runtime-dom/package.json     |  2 +-\n packages/server-renderer/package.json |  2 +-\n packages/shared/package.json          |  2 +-\n packages/vue-compat/package.json      |  2 +-\n packages/vue/package.json             |  2 +-\n 13 files changed, 34 insertions(+), 12 deletions(-)\n\ndiff --git a/CHANGELOG.md b/CHANGELOG.md\nindex 1417d29..3c6ea89 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -1,3 +1,25 @@\n+## [3.5.26](https://github.com/vuejs/core/compare/v3.5.25...v3.5.26) (2025-12-18)\n+\n+\n+### Bug Fixes\n+\n+* **compat:** fix compat handler of draggable ([#12445](https://github.com/vuejs/core/issues/12445)) ([ed85953](https://github.com/vuejs/core/commit/ed85953e28741ae1913cfc92b7b66e1a8da47f8c)), closes [#12444](https://github.com/vuejs/core/issues/12444)\n+* **compat:** handle v-model deprecation warning with missing appContext ([#14203](https://github.com/vuejs/core/issues/14203)) ([945a543](https://github.com/vuejs/core/commit/945a543152e8d80903d4f7a18a84ebe8d36e56f8)), closes [#14202](https://github.com/vuejs/core/issues/14202)\n+* **compiler-sfc:** demote const reactive bindings used in v-model ([#14214](https://github.com/vuejs/core/issues/14214)) ([e24ff7d](https://github.com/vuejs/core/commit/e24ff7d302a887ea532571c231a385362fa17279)), closes [#11265](https://github.com/vuejs/core/issues/11265) [#11275](https://github.com/vuejs/core/issues/11275)\n+* **compiler-ssr:** handle ssr attr fallthrough when preserve whitespace ([#12304](https://github.com/vuejs/core/issues/12304)) ([4783118](https://github.com/vuejs/core/commit/47831189196b62b12dd17f6e909efc51d9d22fd2)), closes [#8072](https://github.com/vuejs/core/issues/8072)\n+* **hmr:** handle cached text node update ([#14134](https://github.com/vuejs/core/issues/14134)) ([69ce3c7](https://github.com/vuejs/core/commit/69ce3c7d755db868cfa66d67ab5b3f383a44e053)), closes [#14127](https://github.com/vuejs/core/issues/14127)\n+* **keep-alive:** use resolved component name for async components in cache pruning ([#14212](https://github.com/vuejs/core/issues/14212)) ([dfe667c](https://github.com/vuejs/core/commit/dfe667c8567d48167c250062483d2d2cfc7bdc03)), closes [#14210](https://github.com/vuejs/core/issues/14210)\n+* **runtime-core:** ensure correct anchor el for deeper unresolved async components ([#14182](https://github.com/vuejs/core/issues/14182)) ([f5b3bf2](https://github.com/vuejs/core/commit/f5b3bf264d2e12725381bed1c492069437069b03)), closes [#14173](https://github.com/vuejs/core/issues/14173)\n+* **runtime-core:** handle patch stable fragment edge case ([#12411](https://github.com/vuejs/core/issues/12411)) ([94aeb64](https://github.com/vuejs/core/commit/94aeb64ccdf20d541059b533c9780977c14db9cb)), closes [#12410](https://github.com/vuejs/core/issues/12410)\n+* **runtime-core:** pass component instance to flushPreFlushCbs on unmount ([#14221](https://github.com/vuejs/core/issues/14221)) ([e857e12](https://github.com/vuejs/core/commit/e857e12c0aff03c0148e3e52d92935918872dc33)), closes [#14215](https://github.com/vuejs/core/issues/14215)\n+\n+\n+### Performance Improvements\n+\n+* **compiler-core:** use binary-search to get line and column ([#14222](https://github.com/vuejs/core/issues/14222)) ([1904053](https://github.com/vuejs/core/commit/1904053f1f7986c2d6dbe858ee1b594b4b229c17))\n+\n+\n+\n ## [3.5.25](https://github.com/vuejs/core/compare/v3.5.24...v3.5.25) (2025-11-24)\n \n \ndiff --git a/package.json b/package.json\nindex a6daaa0..6f1aa9a 100644\n--- a/package.json\n+++ b/package.json\n@@ -1,6 +1,6 @@\n {\n   \"private\": true,\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"packageManager\": \"pnpm@10.25.0\",\n   \"type\": \"module\",\n   \"scripts\": {\ndiff --git a/packages/compiler-core/package.json b/packages/compiler-core/package.json\nindex bb65b2a..911e36e 100644\n--- a/packages/compiler-core/package.json\n+++ b/packages/compiler-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-core\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"@vue/compiler-core\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/compiler-core.esm-bundler.js\",\ndiff --git a/packages/compiler-dom/package.json b/packages/compiler-dom/package.json\nindex 45f169b..a4565d3 100644\n--- a/packages/compiler-dom/package.json\n+++ b/packages/compiler-dom/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-dom\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"@vue/compiler-dom\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/compiler-dom.esm-bundler.js\",\ndiff --git a/packages/compiler-sfc/package.json b/packages/compiler-sfc/package.json\nindex bdb605d..e95ec27 100644\n--- a/packages/compiler-sfc/package.json\n+++ b/packages/compiler-sfc/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-sfc\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"@vue/compiler-sfc\",\n   \"main\": \"dist/compiler-sfc.cjs.js\",\n   \"module\": \"dist/compiler-sfc.esm-browser.js\",\ndiff --git a/packages/compiler-ssr/package.json b/packages/compiler-ssr/package.json\nindex 89bf859..d2eb07e 100644\n--- a/packages/compiler-ssr/package.json\n+++ b/packages/compiler-ssr/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-ssr\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"@vue/compiler-ssr\",\n   \"main\": \"dist/compiler-ssr.cjs.js\",\n   \"types\": \"dist/compiler-ssr.d.ts\",\ndiff --git a/packages/reactivity/package.json b/packages/reactivity/package.json\nindex c4507ff..f4e2d69 100644\n--- a/packages/reactivity/package.json\n+++ b/packages/reactivity/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/reactivity\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"@vue/reactivity\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/reactivity.esm-bundler.js\",\ndiff --git a/packages/runtime-core/package.json b/packages/runtime-core/package.json\nindex 0e57c1d..4d24ff0 100644\n--- a/packages/runtime-core/package.json\n+++ b/packages/runtime-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/runtime-core\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"@vue/runtime-core\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/runtime-core.esm-bundler.js\",\ndiff --git a/packages/runtime-dom/package.json b/packages/runtime-dom/package.json\nindex d712948..a956cec 100644\n--- a/packages/runtime-dom/package.json\n+++ b/packages/runtime-dom/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/runtime-dom\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"@vue/runtime-dom\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/runtime-dom.esm-bundler.js\",\ndiff --git a/packages/server-renderer/package.json b/packages/server-renderer/package.json\nindex 45dbfc3..51546b2 100644\n--- a/packages/server-renderer/package.json\n+++ b/packages/server-renderer/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/server-renderer\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"@vue/server-renderer\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/server-renderer.esm-bundler.js\",\ndiff --git a/packages/shared/package.json b/packages/shared/package.json\nindex 68dbe15..bfbbb0e 100644\n--- a/packages/shared/package.json\n+++ b/packages/shared/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/shared\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"internal utils shared across @vue packages\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/shared.esm-bundler.js\",\ndiff --git a/packages/vue-compat/package.json b/packages/vue-compat/package.json\nindex d9f76bc..36e2a9f 100644\n--- a/packages/vue-compat/package.json\n+++ b/packages/vue-compat/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compat\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"Vue 3 compatibility build for Vue 2\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/vue.runtime.esm-bundler.js\",\ndiff --git a/packages/vue/package.json b/packages/vue/package.json\nindex c520af8..6d249ff 100644\n--- a/packages/vue/package.json\n+++ b/packages/vue/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"vue\",\n-  \"version\": \"3.5.25\",\n+  \"version\": \"3.5.26\",\n   \"description\": \"The progressive JavaScript framework for building modern web UI.\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/vue.runtime.esm-bundler.js\","}, {"role": "assistant", "content": "chore: release v3.5.26"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .github/workflows/scorecard.yml | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/.github/workflows/scorecard.yml b/.github/workflows/scorecard.yml\nindex 94274a52..cf03ef88 100644\n--- a/.github/workflows/scorecard.yml\n+++ b/.github/workflows/scorecard.yml\n@@ -47,6 +47,6 @@ jobs:\n \n       # Upload the results to GitHub's code scanning dashboard.\n       - name: 'Upload to code-scanning'\n-        uses: github/codeql-action/upload-sarif@5d4e8d1aca955e8d8589aabd499c5cae939e33c7 # v4.31.9\n+        uses: github/codeql-action/upload-sarif@cdefb33c0f6224e58673d9004f47f7cb3e328b89 # v4.31.10\n         with:\n           sarif_file: results.sarif"}, {"role": "assistant", "content": "build: update github/codeql-action action to v4.31.10"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n tests/ui/const-generics/associated-const-bindings/ambiguity.stderr | 6 ++++++\n 1 file changed, 6 insertions(+)\n\ndiff --git a/tests/ui/const-generics/associated-const-bindings/ambiguity.stderr b/tests/ui/const-generics/associated-const-bindings/ambiguity.stderr\nindex a14afe9d692..806708f18d6 100644\n--- a/tests/ui/const-generics/associated-const-bindings/ambiguity.stderr\n+++ b/tests/ui/const-generics/associated-const-bindings/ambiguity.stderr\n@@ -27,6 +27,12 @@ LL |     const C: &'static str;\n ...\n LL | fn take1(_: impl Trait1<C = \"?\">) {}\n    |                         ^^^^^^^ ambiguous associated constant `C`\n+   |\n+   = help: consider introducing a new type parameter `T` and adding `where` constraints:\n+               where\n+                   T: Trait1,\n+                   T: Parent2::C = \"?\",\n+                   T: Parent1::C = \"?\"\n \n error: aborting due to 2 previous errors\n "}, {"role": "assistant", "content": "test: update expected stderr for const generics ambiguity"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/reactivity/__tests__/ref.spec.ts | 216 +++++++++++++++++++++++++++++-\n packages/reactivity/src/baseHandlers.ts   |  10 +-\n packages/reactivity/src/ref.ts            |  42 +++++-\n 3 files changed, 252 insertions(+), 16 deletions(-)\n\ndiff --git a/packages/reactivity/__tests__/ref.spec.ts b/packages/reactivity/__tests__/ref.spec.ts\nindex 7976a53..25fe87a 100644\n--- a/packages/reactivity/__tests__/ref.spec.ts\n+++ b/packages/reactivity/__tests__/ref.spec.ts\n@@ -16,6 +16,7 @@ import {\n   isShallow,\n   readonly,\n   shallowReactive,\n+  shallowReadonly,\n } from '../src/reactive'\n \n describe('reactivity/ref', () => {\n@@ -308,18 +309,83 @@ describe('reactivity/ref', () => {\n     a.x = 4\n     expect(dummyX).toBe(4)\n \n-    // should keep ref\n-    const r = { x: ref(1) }\n-    expect(toRef(r, 'x')).toBe(r.x)\n+    // a ref in a non-reactive object should be unwrapped\n+    const r: any = { x: ref(1) }\n+    const t = toRef(r, 'x')\n+    expect(t.value).toBe(1)\n+\n+    r.x.value = 2\n+    expect(t.value).toBe(2)\n+\n+    t.value = 3\n+    expect(t.value).toBe(3)\n+    expect(r.x.value).toBe(3)\n+\n+    // with a default\n+    const u = toRef(r, 'x', 7)\n+    expect(u.value).toBe(3)\n+\n+    r.x.value = undefined\n+    expect(r.x.value).toBeUndefined()\n+    expect(t.value).toBeUndefined()\n+    expect(u.value).toBe(7)\n+\n+    u.value = 7\n+    expect(r.x.value).toBe(7)\n+    expect(t.value).toBe(7)\n+    expect(u.value).toBe(7)\n   })\n \n   test('toRef on array', () => {\n-    const a = reactive(['a', 'b'])\n+    const a: any = reactive(['a', 'b'])\n     const r = toRef(a, 1)\n     expect(r.value).toBe('b')\n     r.value = 'c'\n     expect(r.value).toBe('c')\n     expect(a[1]).toBe('c')\n+\n+    a[1] = ref('d')\n+    expect(isRef(a[1])).toBe(true)\n+    expect(r.value).toBe('d')\n+    r.value = 'e'\n+    expect(isRef(a[1])).toBe(true)\n+    expect(a[1].value).toBe('e')\n+\n+    const s = toRef(a, 2, 'def')\n+    const len = toRef(a, 'length')\n+\n+    expect(s.value).toBe('def')\n+    expect(len.value).toBe(2)\n+\n+    a.push('f')\n+    expect(s.value).toBe('f')\n+    expect(len.value).toBe(3)\n+\n+    len.value = 2\n+\n+    expect(s.value).toBe('def')\n+    expect(len.value).toBe(2)\n+\n+    const symbol = Symbol()\n+    const t = toRef(a, 'foo')\n+    const u = toRef(a, symbol)\n+    expect(t.value).toBeUndefined()\n+    expect(u.value).toBeUndefined()\n+\n+    const foo = ref(3)\n+    const bar = ref(5)\n+    a.foo = foo\n+    a[symbol] = bar\n+    expect(t.value).toBe(3)\n+    expect(u.value).toBe(5)\n+\n+    t.value = 4\n+    u.value = 6\n+\n+    expect(a.foo).toBe(4)\n+    expect(foo.value).toBe(4)\n+    expect(a[symbol]).toBe(6)\n+    expect(bar.value).toBe(6)\n   })\n \n   test('toRef default value', () => {\n@@ -345,6 +411,148 @@ describe('reactivity/ref', () => {\n     expect(isReadonly(x)).toBe(true)\n   })\n \n+  test('toRef lazy evaluation of properties inside a proxy', () => {\n+    const fn = vi.fn(() => 5)\n+    const num = computed(fn)\n+    const a = toRef({ num }, 'num')\n+    const b = toRef(reactive({ num }), 'num')\n+    const c = toRef(readonly({ num }), 'num')\n+    const d = toRef(shallowReactive({ num }), 'num')\n+    const e = toRef(shallowReadonly({ num }), 'num')\n+\n+    expect(fn).not.toHaveBeenCalled()\n+\n+    expect(a.value).toBe(5)\n+    expect(b.value).toBe(5)\n+    expect(c.value).toBe(5)\n+    expect(d.value).toBe(5)\n+    expect(e.value).toBe(5)\n+    expect(fn).toHaveBeenCalledTimes(1)\n+  })\n+\n+  test('toRef with shallowReactive/shallowReadonly', () => {\n+    const r = ref(0)\n+    const s1 = shallowReactive<{ foo: any }>({ foo: r })\n+    const t1 = toRef(s1, 'foo', 2)\n+    const s2 = shallowReadonly(s1)\n+    const t2 = toRef(s2, 'foo', 3)\n+\n+    expect(r.value).toBe(0)\n+    expect(s1.foo.value).toBe(0)\n+    expect(t1.value).toBe(0)\n+    expect(s2.foo.value).toBe(0)\n+    expect(t2.value).toBe(0)\n+\n+    s1.foo = ref(1)\n+\n+    expect(r.value).toBe(0)\n+    expect(s1.foo.value).toBe(1)\n+    expect(t1.value).toBe(1)\n+    expect(s2.foo.value).toBe(1)\n+    expect(t2.value).toBe(1)\n+\n+    s1.foo.value = undefined\n+\n+    expect(r.value).toBe(0)\n+    expect(s1.foo.value).toBeUndefined()\n+    expect(t1.value).toBe(2)\n+    expect(s2.foo.value).toBeUndefined()\n+    expect(t2.value).toBe(3)\n+\n+    t1.value = 2\n+\n+    expect(r.value).toBe(0)\n+    expect(s1.foo.value).toBe(2)\n+    expect(t1.value).toBe(2)\n+    expect(s2.foo.value).toBe(2)\n+    expect(t2.value).toBe(2)\n+\n+    t2.value = 4\n+\n+    expect(r.value).toBe(0)\n+    expect(s1.foo.value).toBe(4)\n+    expect(t1.value).toBe(4)\n+    expect(s2.foo.value).toBe(4)\n+    expect(t2.value).toBe(4)\n+\n+    s1.foo = undefined\n+\n+    expect(r.value).toBe(0)\n+    expect(s1.foo).toBeUndefined()\n+    expect(t1.value).toBe(2)\n+    expect(s2.foo).toBeUndefined()\n+    expect(t2.value).toBe(3)\n+  })\n+\n+  test('toRef for shallowReadonly around reactive', () => {\n+    const get = vi.fn(() => 3)\n+    const set = vi.fn()\n+    const num = computed({ get, set })\n+    const t = toRef(shallowReadonly(reactive({ num })), 'num')\n+\n+    expect(get).not.toHaveBeenCalled()\n+    expect(set).not.toHaveBeenCalled()\n+\n+    t.value = 1\n+\n+    expect(\n+      'Set operation on key \"num\" failed: target is readonly',\n+    ).toHaveBeenWarned()\n+\n+    expect(get).not.toHaveBeenCalled()\n+    expect(set).not.toHaveBeenCalled()\n+\n+    expect(t.value).toBe(3)\n+\n+    expect(get).toHaveBeenCalledTimes(1)\n+    expect(set).not.toHaveBeenCalled()\n+  })\n+\n+  test('toRef for readonly around shallowReactive', () => {\n+    const get = vi.fn(() => 3)\n+    const set = vi.fn()\n+    const num = computed({ get, set })\n+    const t: Ref<number> = toRef(readonly(shallowReactive({ num })), 'num')\n+\n+    expect(get).not.toHaveBeenCalled()\n+    expect(set).not.toHaveBeenCalled()\n+\n+    t.value = 1\n+\n+    expect(\n+      'Set operation on key \"num\" failed: target is readonly',\n+    ).toHaveBeenWarned()\n+\n+    expect(get).not.toHaveBeenCalled()\n+    expect(set).not.toHaveBeenCalled()\n+\n+    expect(t.value).toBe(3)\n+\n+    expect(get).toHaveBeenCalledTimes(1)\n+    expect(set).not.toHaveBeenCalled()\n+  })\n+\n+  test(`toRef doesn't bypass the proxy when getting/setting a nested ref`, () => {\n+    const r = ref(2)\n+    const obj = shallowReactive({ num: r })\n+    const t = toRef(obj, 'num')\n+\n+    expect(t.value).toBe(2)\n+\n+    effect(() => {\n+      t.value = 3\n+    })\n+\n+    expect(t.value).toBe(3)\n+    expect(r.value).toBe(3)\n+\n+    const s = ref(4)\n+    obj.num = s\n+\n+    expect(t.value).toBe(3)\n+    expect(s.value).toBe(3)\n+  })\n+\n   test('toRefs', () => {\n     const a = reactive({\n       x: 1,\ndiff --git a/packages/reactivity/src/baseHandlers.ts b/packages/reactivity/src/baseHandlers.ts\nindex 68ad10f..b69d795 100644\n--- a/packages/reactivity/src/baseHandlers.ts\n+++ b/packages/reactivity/src/baseHandlers.ts\n@@ -146,13 +146,14 @@ class MutableReactiveHandler extends BaseReactiveHandler {\n     receiver: object,\n   ): boolean {\n     let oldValue = target[key]\n+    const isArrayWithIntegerKey = isArray(target) && isIntegerKey(key)\n     if (!this._isShallow) {\n       const isOldValueReadonly = isReadonly(oldValue)\n       if (!isShallow(value) && !isReadonly(value)) {\n         oldValue = toRaw(oldValue)\n         value = toRaw(value)\n       }\n-      if (!isArray(target) && isRef(oldValue) && !isRef(value)) {\n+      if (!isArrayWithIntegerKey && isRef(oldValue) && !isRef(value)) {\n         if (isOldValueReadonly) {\n           if (__DEV__) {\n             warn(\n@@ -170,10 +171,9 @@ class MutableReactiveHandler extends BaseReactiveHandler {\n       // in shallow mode, objects are set as-is regardless of reactive or not\n     }\n \n-    const hadKey =\n-      isArray(target) && isIntegerKey(key)\n-        ? Number(key) < target.length\n-        : hasOwn(target, key)\n+    const hadKey = isArrayWithIntegerKey\n+      ? Number(key) < target.length\n+      : hasOwn(target, key)\n     const result = Reflect.set(\n       target,\n       key,\ndiff --git a/packages/reactivity/src/ref.ts b/packages/reactivity/src/ref.ts\nindex 0246297..1b8eaaf 100644\n--- a/packages/reactivity/src/ref.ts\n+++ b/packages/reactivity/src/ref.ts\n@@ -3,12 +3,14 @@ import {\n   hasChanged,\n   isArray,\n   isFunction,\n+  isIntegerKey,\n   isObject,\n } from '@vue/shared'\n import { Dep, getDepFromReactive } from './dep'\n import {\n   type Builtin,\n   type ShallowReactiveMarker,\n+  type Target,\n   isProxy,\n   isReactive,\n   isReadonly,\n@@ -351,23 +353,52 @@ class ObjectRefImpl<T extends object, K extends keyof T> {\n   public readonly [ReactiveFlags.IS_REF] = true\n   public _value: T[K] = undefined!\n \n+  private readonly _raw: T\n+  private readonly _shallow: boolean\n+\n   constructor(\n     private readonly _object: T,\n     private readonly _key: K,\n     private readonly _defaultValue?: T[K],\n-  ) {}\n+  ) {\n+    this._raw = toRaw(_object)\n+\n+    let shallow = true\n+    let obj = _object\n+\n+    // For an array with integer key, refs are not unwrapped\n+    if (!isArray(_object) || !isIntegerKey(String(_key))) {\n+      // Otherwise, check each proxy layer for unwrapping\n+      do {\n+        shallow = !isProxy(obj) || isShallow(obj)\n+      } while (shallow && (obj = (obj as Target)[ReactiveFlags.RAW]))\n+    }\n+\n+    this._shallow = shallow\n+  }\n \n   get value() {\n-    const val = this._object[this._key]\n+    let val = this._object[this._key]\n+    if (this._shallow) {\n+      val = unref(val)\n+    }\n     return (this._value = val === undefined ? this._defaultValue! : val)\n   }\n \n   set value(newVal) {\n+    if (this._shallow && isRef(this._raw[this._key])) {\n+      const nestedRef = this._object[this._key]\n+      if (isRef(nestedRef)) {\n+        nestedRef.value = newVal\n+        return\n+      }\n+    }\n+\n     this._object[this._key] = newVal\n   }\n \n   get dep(): Dep | undefined {\n-    return getDepFromReactive(toRaw(this._object), this._key)\n+    return getDepFromReactive(this._raw, this._key)\n   }\n }\n \n@@ -464,10 +495,7 @@ function propertyToRef(\n   key: string,\n   defaultValue?: unknown,\n ) {\n-  const val = source[key]\n-  return isRef(val)\n-    ? val\n-    : (new ObjectRefImpl(source, key, defaultValue) as any)\n+  return new ObjectRefImpl(source, key, defaultValue) as any\n }\n \n /**"}, {"role": "assistant", "content": "fix(reactivity): handle nested refs in toRef for shallow proxies"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/internal/types/testdata/check/cycles6.go | 71 ++++++++++++++++++++++++++++\n 1 file changed, 71 insertions(+)\n\ndiff --git a/src/internal/types/testdata/check/cycles6.go b/src/internal/types/testdata/check/cycles6.go\nnew file mode 100644\nindex 00000000..e5635ed4\n--- /dev/null\n+++ b/src/internal/types/testdata/check/cycles6.go\n@@ -0,0 +1,71 @@\n+// Copyright 2026 The Go Authors. All rights reserved.\n+// Use of this source code is governed by a BSD-style\n+// license that can be found in the LICENSE file.\n+\n+package p\n+\n+import \"unsafe\"\n+\n+// Below are the pieces of syntax corresponding to functions which can produce a\n+// type T without first having a value of type T. Notice that each causes a\n+// value of type T to be passed to unsafe.Sizeof while T is incomplete.\n+\n+// literal on type\n+type T0 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(T0{})]int\n+// literal on value                                                             (not applicable)\n+// literal on pointer                                                           (not applicable)\n+\n+// call on type\n+type T1 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(T1(42))]int\n+// call on value\n+func f2() T2\n+type T2 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(f2())]int\n+// call on pointer                                                              (not applicable)\n+\n+// assert on type\n+var i3 interface{}\n+type T3 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(i3.(T3))]int\n+// assert on value                                                              (not applicable)\n+// assert on pointer                                                            (not applicable)\n+\n+// receive on type                                                              (not applicable)\n+// receive on value\n+func f4() <-chan T4\n+type T4 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(<-f4())]int\n+// receive on pointer                                                           (not applicable)\n+\n+// star on type                                                                 (not applicable)\n+// star on value                                                                (not applicable)\n+// star on pointer\n+func f5() *T5\n+type T5 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(*f5())]int\n+\n+// Below is additional syntax which interacts with incomplete types. Notice that\n+// each of the below falls into 1 of 3 cases:\n+//   1. It cannot produce a value of (incomplete) type T.\n+//   2. It can, but only because it already has a value of type T.\n+//   3. It can, but only because it performs an implicit dereference.\n+\n+// select on type                                                               (case 1)\n+// select on value                                                              (case 2)\n+type T6 /* ERROR \"invalid recursive type\" */ struct {\n+\tf T7\n+}\n+type T7 [unsafe.Sizeof(T6{}.f)]int\n+// select on pointer                                                            (case 3)\n+type T8 /* ERROR \"invalid recursive type\" */ struct {\n+\tf T9\n+}\n+type T9 [unsafe.Sizeof(new(T8).f)]int\n+\n+// slice on type                                                                (not applicable)\n+// slice on value                                                               (case 2)\n+type T10 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(T10{}[:])]int\n+// slice on pointer                                                             (case 3)\n+type T11 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(new(T11)[:])]int\n+\n+// index on type                                                                (case 1)\n+// index on value                                                               (case 2)\n+type T12 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(T12{}[42])]int\n+// index on pointer                                                             (case 3)\n+type T13 /* ERROR \"invalid recursive type\" */ [unsafe.Sizeof(new(T13)[42])]int"}, {"role": "assistant", "content": "test: add cycle detection tests for recursive types"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n doc/go_spec.html | 87 +++++++++++++++++++++++++++++++++-----------------------\n 1 file changed, 51 insertions(+), 36 deletions(-)\n\ndiff --git a/doc/go_spec.html b/doc/go_spec.html\nindex f47f5a6e..478aefd4 100644\n--- a/doc/go_spec.html\n+++ b/doc/go_spec.html\n@@ -1,6 +1,6 @@\n <!--{\n \t\"Title\": \"The Go Programming Language Specification\",\n-\t\"Subtitle\": \"Language version go1.26 (Dec 2, 2025)\",\n+\t\"Subtitle\": \"Language version go1.26 (Jan 12, 2026)\",\n \t\"Path\": \"/ref/spec\"\n }-->\n \n@@ -3143,7 +3143,8 @@ math.Sin // denotes the Sin function in package math\n <p>\n Composite literals construct new values for structs, arrays, slices, and maps\n each time they are evaluated.\n-They consist of the type of the literal followed by a brace-bound list of elements.\n+They consist of the type of the literal followed by a (possibly empty)\n+brace-bound list of elements.\n Each element may optionally be preceded by a corresponding key.\n </p>\n \n@@ -3168,35 +3169,53 @@ as a TypeName).\n If the LiteralType is a type parameter, all types in its type set\n must have the same underlying type which must be\n a valid composite literal type.\n+</p>\n+\n+<p>\n The types of the elements and keys must be <a href=\"#Assignability\">assignable</a>\n-to the respective field, element, and key types of type <code>T</code>;\n+to the respective field, element, and key types of the LiteralType;\n there is no additional conversion.\n The key is interpreted as a field name for struct literals,\n an index for array and slice literals, and a key for map literals.\n-For map literals, all elements must have a key. It is an error\n-to specify multiple elements with the same field name or\n-constant key value. For non-constant map keys, see the section on\n-<a href=\"#Order_of_evaluation\">evaluation order</a>.\n+It is an error to specify multiple elements with the same field name\n+or constant key value.\n+A literal may omit the element list; such a literal evaluates\n+to the zero value for its type.\n </p>\n \n <p>\n-For struct literals the following rules apply:\n+A parsing ambiguity arises when a composite literal using the\n+TypeName form of the LiteralType appears as an operand between the\n+<a href=\"#Keywords\">keyword</a> and the opening brace of the block\n+of an \"if\", \"for\", or \"switch\" statement, and the composite literal\n+is not enclosed in parentheses, square brackets, or curly braces.\n+In this rare case, the opening brace of the literal is erroneously parsed\n+as the one introducing the block of statements. To resolve the ambiguity,\n+the composite literal must appear within parentheses.\n+</p>\n+\n+<pre>\n+if x == (T{a,b,c}[i]) { \u2026 }\n+if (x == T{a,b,c}[i]) { \u2026 }\n+</pre>\n+\n+<h4>Struct literals</h4>\n+\n+<p>\n+For struct literals without keys, the element list must contain an element\n+for each struct field in the order in which the fields are declared.\n+</p>\n+\n+<p>\n+For struct literals with keys the following rules apply:\n </p>\n <ul>\n-\t<li>A key must be a field name declared in the struct type.\n-\t</li>\n-\t<li>An element list that does not contain any keys must\n-\t    list an element for each struct field in the\n-\t    order in which the fields are declared.\n+\t<li>Every element must have a key.\n \t</li>\n-\t<li>If any element has a key, every element must have a key.\n+\t<li>Each key must be a field name declared in the struct type.\n \t</li>\n-\t<li>An element list that contains keys does not need to\n-\t    have an element for each struct field. Omitted fields\n-\t    get the zero value for that field.\n-\t</li>\n-\t<li>A literal may omit the element list; such a literal evaluates\n-\t    to the zero value for its type.\n+\t<li>The element list does not need to have an element for each struct field.\n+\t    Omitted fields get the zero value for that field.\n \t</li>\n \t<li>It is an error to specify an element for a non-exported\n \t    field of a struct belonging to a different package.\n@@ -3220,6 +3239,8 @@ origin := Point3D{}                            // zero value for Point3D\n line := Line{origin, Point3D{y: -4, z: 12.3}}  // zero value for line.q.x\n </pre>\n \n+<h4>Array and slice literals</h4>\n+\n <p>\n For array and slice literals the following rules apply:\n </p>\n@@ -3295,6 +3316,16 @@ tmp := [n]T{x1, x2, \u2026 xn}\n tmp[0 : n]\n </pre>\n \n+<h4>Map literals</h4>\n+\n+<p>\n+For map literals, each element must have a key.\n+For non-constant map keys, see the section on\n+<a href=\"#Order_of_evaluation\">evaluation order</a>.\n+</p>\n+\n+<h4>Elision of element types</h4>\n+\n <p>\n Within a composite literal of array, slice, or map type <code>T</code>,\n elements or map keys that are themselves composite literals may elide the respective\n@@ -3315,22 +3346,6 @@ type PPoint *Point\n [2]PPoint{{1.5, -3.5}, {}}          // same as [2]PPoint{PPoint(&amp;Point{1.5, -3.5}), PPoint(&amp;Point{})}\n </pre>\n \n-<p>\n-A parsing ambiguity arises when a composite literal using the\n-TypeName form of the LiteralType appears as an operand between the\n-<a href=\"#Keywords\">keyword</a> and the opening brace of the block\n-of an \"if\", \"for\", or \"switch\" statement, and the composite literal\n-is not enclosed in parentheses, square brackets, or curly braces.\n-In this rare case, the opening brace of the literal is erroneously parsed\n-as the one introducing the block of statements. To resolve the ambiguity,\n-the composite literal must appear within parentheses.\n-</p>\n-\n-<pre>\n-if x == (T{a,b,c}[i]) { \u2026 }\n-if (x == T{a,b,c}[i]) { \u2026 }\n-</pre>\n-\n <p>\n Examples of valid array, slice, and map literals:\n </p>"}, {"role": "assistant", "content": "docs: restructure composite literals section"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages-private/template-explorer/package.json |  2 +-\n pnpm-lock.yaml                                  | 20 +++++++++++---------\n 2 files changed, 12 insertions(+), 10 deletions(-)\n\ndiff --git a/packages-private/template-explorer/package.json b/packages-private/template-explorer/package.json\nindex eace79a..04b8794 100644\n--- a/packages-private/template-explorer/package.json\n+++ b/packages-private/template-explorer/package.json\n@@ -11,7 +11,7 @@\n     \"enableNonBrowserBranches\": true\n   },\n   \"dependencies\": {\n-    \"monaco-editor\": \"^0.54.0\",\n+    \"monaco-editor\": \"^0.55.1\",\n     \"source-map-js\": \"^1.2.1\"\n   }\n }\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex c550a30..5c6b55a 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -226,8 +226,8 @@ importers:\n   packages-private/template-explorer:\n     dependencies:\n       monaco-editor:\n-        specifier: ^0.54.0\n-        version: 0.54.0\n+        specifier: ^0.55.1\n+        version: 0.55.1\n       source-map-js:\n         specifier: ^1.2.1\n         version: 1.2.1\n@@ -2015,8 +2015,8 @@ packages:\n   doctypes@1.1.0:\n     resolution: {integrity: sha512-LLBi6pEqS6Do3EKQ3J0NqHWV5hhb78Pi8vvESYwyOy2c31ZEZVdtitdzsQsKb7878PEERhzUk0ftqGhG6Mz+pQ==}\n \n-  dompurify@3.1.7:\n-    resolution: {integrity: sha512-VaTstWtsneJY8xzy7DekmYWEOZcmzIe3Qb3zPd4STve1OBTa+e+WmS1ITQec1fZYXI3HCsOZZiSMpG6oxoWMWQ==}\n+  dompurify@3.2.7:\n+    resolution: {integrity: sha512-WhL/YuveyGXJaerVlMYGWhvQswa7myDG17P7Vu65EWC05o8vfeNbvNf4d/BOvH99+ZW+LlQsc1GDKMa1vNK6dw==}\n \n   dot-prop@5.3.0:\n     resolution: {integrity: sha512-QM8q3zDe58hqUqjraQOmzZ1LIH9SWQJTlEKCH4kJ2oQvLZk7RbQXvtDM2XEq3fwkV9CCvvH4LA0AV+ogFsBM2Q==}\n@@ -2754,8 +2754,8 @@ packages:\n   mitt@3.0.1:\n     resolution: {integrity: sha512-vKivATfr97l2/QBCYAkXYDbrIWPM2IIKEl7YPhjCvKlG3kE2gm+uBo6nEXK3M5/Ffh/FLpKExzOQ3JJoJGFKBw==}\n \n-  monaco-editor@0.54.0:\n-    resolution: {integrity: sha512-hx45SEUoLatgWxHKCmlLJH81xBo0uXP4sRkESUpmDQevfi+e7K1VuiSprK6UpQ8u4zOcKNiH0pMvHvlMWA/4cw==}\n+  monaco-editor@0.55.1:\n+    resolution: {integrity: sha512-jz4x+TJNFHwHtwuV9vA9rMujcZRb0CEilTEwG2rRSpe/A7Jdkuj8xPKttCgOh+v/lkHy7HsZ64oj+q3xoAFl9A==}\n \n   ms@2.0.0:\n     resolution: {integrity: sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==}\n@@ -5028,7 +5028,9 @@ snapshots:\n \n   doctypes@1.1.0: {}\n \n-  dompurify@3.1.7: {}\n+  dompurify@3.2.7:\n+    optionalDependencies:\n+      '@types/trusted-types': 2.0.7\n \n   dot-prop@5.3.0:\n     dependencies:\n@@ -5832,9 +5834,9 @@ snapshots:\n \n   mitt@3.0.1: {}\n \n-  monaco-editor@0.54.0:\n+  monaco-editor@0.55.1:\n     dependencies:\n-      dompurify: 3.1.7\n+      dompurify: 3.2.7\n       marked: 14.0.0\n \n   ms@2.0.0: {}"}, {"role": "assistant", "content": "build(deps): update monaco-editor to 0.55.1"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 818a553..5090a9e 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -19,6 +19,7 @@ hide:\n \n ### Internal\n \n+* \u2705 Enable tests in CI for scripts. PR [#14684](https://github.com/fastapi/fastapi/pull/14684) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd27 Add pre-commit local script to fix language translations. PR [#14683](https://github.com/fastapi/fastapi/pull/14683) by [@tiangolo](https://github.com/tiangolo).\n * \u2b06\ufe0f  Migrate to uv. PR [#14676](https://github.com/fastapi/fastapi/pull/14676) by [@DoctorJohn](https://github.com/DoctorJohn).\n * \ud83d\udd28 Add LLM translations tool fixer. PR [#14652](https://github.com/fastapi/fastapi/pull/14652) by [@YuriiMotov](https://github.com/YuriiMotov)."}, {"role": "assistant", "content": "docs: add CI test enablement to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/devtools/views/Components/Components.css                   | 2 ++\n .../src/devtools/views/Components/Components.js                    | 6 +++++-\n .../src/devtools/views/Components/InspectedElement.css             | 7 +++++--\n .../src/devtools/views/Components/InspectedElement.js              | 4 ++++\n .../src/devtools/views/InspectedElement/InspectedElementPane.js    | 1 +\n .../src/devtools/views/SuspenseTab/SuspenseTab.css                 | 2 ++\n .../src/devtools/views/SuspenseTab/SuspenseTab.js                  | 6 +++++-\n 7 files changed, 24 insertions(+), 4 deletions(-)\n\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Components/Components.css b/packages/react-devtools-shared/src/devtools/views/Components/Components.css\nindex 8df59f7..b977a36 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Components/Components.css\n+++ b/packages/react-devtools-shared/src/devtools/views/Components/Components.css\n@@ -22,6 +22,7 @@\n   flex: 1 1 35%;\n   overflow-x: hidden;\n   overflow-y: auto;\n+  border-left: 1px solid var(--color-border);\n }\n \n .ResizeBarWrapper {\n@@ -55,6 +56,7 @@\n \n   .InspectedElementWrapper {\n     flex: 1 1 50%;\n+    border-left: none;\n   }\n \n   .ResizeBar {\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Components/Components.js b/packages/react-devtools-shared/src/devtools/views/Components/Components.js\nindex 1f0927d..80b6d45 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Components/Components.js\n+++ b/packages/react-devtools-shared/src/devtools/views/Components/Components.js\n@@ -159,7 +159,11 @@ function Components(_: {}) {\n             <div className={styles.InspectedElementWrapper}>\n               <NativeStyleContextController>\n                 <InspectedElementErrorBoundary>\n-                  <InspectedElement />\n+                  <InspectedElement\n+                    fallbackEmpty={\n+                      'No React element selected. Select an element in the tree to inspect.'\n+                    }\n+                  />\n                 </InspectedElementErrorBoundary>\n               </NativeStyleContextController>\n             </div>\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.css b/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.css\nindex 7b00c0c..f9e60f0 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.css\n+++ b/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.css\n@@ -3,7 +3,6 @@\n   flex-direction: column;\n   height: 100%;\n   width: 100%;\n-  border-left: 1px solid var(--color-border);\n   border-top: 1px solid var(--color-border);\n }\n \n@@ -69,7 +68,11 @@\n   padding: 0.25rem;\n   color: var(--color-dimmer);\n   font-style: italic;\n-  border-left: 1px solid var(--color-border);\n+}\n+\n+.NoInspectionFallback {\n+  padding: 0.25rem;\n+  font-style: italic;\n }\n \n .StrictModeNonCompliant {\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.js b/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.js\nindex 7ba7067..af5c8d4 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.js\n+++ b/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.js\n@@ -36,6 +36,8 @@ import Tooltip from './reach-ui/tooltip';\n \n export type Props = {\n   actionButtons?: React.Node,\n+  /** fallback to show when no element is inspected */\n+  fallbackEmpty: React.Node,\n };\n \n // TODO Make edits and deletes also use transition API!\n@@ -44,6 +46,7 @@ const noSourcePromise = Promise.resolve(null);\n \n export default function InspectedElementWrapper({\n   actionButtons,\n+  fallbackEmpty,\n }: Props): React.Node {\n   const {inspectedElementID} = useContext(TreeStateContext);\n   const bridge = useContext(BridgeContext);\n@@ -193,6 +196,7 @@ export default function InspectedElementWrapper({\n     return (\n       <div className={styles.InspectedElement}>\n         <div className={styles.TitleRow} />\n+        <div className={styles.NoInspectionFallback}>{fallbackEmpty}</div>\n       </div>\n     );\n   }\ndiff --git a/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.js b/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.js\nindex 0d5b523..a47bffd 100644\n--- a/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.js\n+++ b/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.js\n@@ -25,6 +25,7 @@ function InspectedElementPane() {\n       <div className={styles.InspectedElementPane}>\n         <InspectedElement\n           actionButtons={!hideSettings && <SettingsModalContextToggle />}\n+          fallbackEmpty={\"Selected element wasn't rendered with React.\"}\n         />\n         <SettingsModal />\n       </div>\ndiff --git a/packages/react-devtools-shared/src/devtools/views/SuspenseTab/SuspenseTab.css b/packages/react-devtools-shared/src/devtools/views/SuspenseTab/SuspenseTab.css\nindex 0b1d85b..a7915d0 100644\n--- a/packages/react-devtools-shared/src/devtools/views/SuspenseTab/SuspenseTab.css\n+++ b/packages/react-devtools-shared/src/devtools/views/SuspenseTab/SuspenseTab.css\n@@ -35,6 +35,7 @@\n   flex: 0 0 calc(100% - var(--horizontal-resize-tree-percentage));\n   overflow-x: hidden;\n   overflow-y: auto;\n+  border-left: 1px solid var(--color-border);\n }\n \n .ResizeBarWrapper {\n@@ -70,6 +71,7 @@\n \n   .InspectedElementWrapper {\n     flex: 0 0 calc(100% - var(--vertical-resize-tree-percentage));\n+    border-left: none;\n   }\n \n   .TreeWrapper + .ResizeBarWrapper .ResizeBar {\ndiff --git a/packages/react-devtools-shared/src/devtools/views/SuspenseTab/SuspenseTab.js b/packages/react-devtools-shared/src/devtools/views/SuspenseTab/SuspenseTab.js\nindex 36351f8..bd5de7d 100644\n--- a/packages/react-devtools-shared/src/devtools/views/SuspenseTab/SuspenseTab.js\n+++ b/packages/react-devtools-shared/src/devtools/views/SuspenseTab/SuspenseTab.js\n@@ -543,7 +543,11 @@ function SuspenseTab(_: {}) {\n           className={styles.InspectedElementWrapper}\n           hidden={inspectedElementHidden}>\n           <InspectedElementErrorBoundary>\n-            <InspectedElement />\n+            <InspectedElement\n+              fallbackEmpty={\n+                'No React element selected. Select a Suspense boundary in the minimap to inspect.'\n+              }\n+            />\n           </InspectedElementErrorBoundary>\n         </div>\n         <SettingsModal />"}, {"role": "assistant", "content": "feat(devtools): add empty state fallback for inspected element"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../runtime-dom/src/components/TransitionGroup.ts  | 22 ++++++---\n packages/vue/__tests__/e2e/TransitionGroup.spec.ts | 56 ++++++++++++++++++++++\n 2 files changed, 71 insertions(+), 7 deletions(-)\n\ndiff --git a/packages/runtime-dom/src/components/TransitionGroup.ts b/packages/runtime-dom/src/components/TransitionGroup.ts\nindex 3ba59f0..eb86dd4 100644\n--- a/packages/runtime-dom/src/components/TransitionGroup.ts\n+++ b/packages/runtime-dom/src/components/TransitionGroup.ts\n@@ -29,8 +29,13 @@ import {\n } from '@vue/runtime-core'\n import { extend } from '@vue/shared'\n \n-const positionMap = new WeakMap<VNode, DOMRect>()\n-const newPositionMap = new WeakMap<VNode, DOMRect>()\n+interface Position {\n+  top: number\n+  left: number\n+}\n+\n+const positionMap = new WeakMap<VNode, Position>()\n+const newPositionMap = new WeakMap<VNode, Position>()\n const moveCbKey = Symbol('_moveCb')\n const enterCbKey = Symbol('_enterCb')\n \n@@ -145,10 +150,10 @@ const TransitionGroupImpl: ComponentOptions = /*@__PURE__*/ decorate({\n                 instance,\n               ),\n             )\n-            positionMap.set(\n-              child,\n-              (child.el as Element).getBoundingClientRect(),\n-            )\n+            positionMap.set(child, {\n+              left: (child.el as HTMLElement).offsetLeft,\n+              top: (child.el as HTMLElement).offsetTop,\n+            })\n           }\n         }\n       }\n@@ -189,7 +194,10 @@ function callPendingCbs(c: VNode) {\n }\n \n function recordPosition(c: VNode) {\n-  newPositionMap.set(c, (c.el as Element).getBoundingClientRect())\n+  newPositionMap.set(c, {\n+    left: (c.el as HTMLElement).offsetLeft,\n+    top: (c.el as HTMLElement).offsetTop,\n+  })\n }\n \n function applyTranslation(c: VNode): VNode | undefined {\ndiff --git a/packages/vue/__tests__/e2e/TransitionGroup.spec.ts b/packages/vue/__tests__/e2e/TransitionGroup.spec.ts\nindex 62d89db..09f137b 100644\n--- a/packages/vue/__tests__/e2e/TransitionGroup.spec.ts\n+++ b/packages/vue/__tests__/e2e/TransitionGroup.spec.ts\n@@ -646,6 +646,62 @@ describe('e2e: TransitionGroup', () => {\n     E2E_TIMEOUT,\n   )\n \n+  // #6105\n+  test(\n+    'with scale',\n+    async () => {\n+      await page().evaluate(() => {\n+        const { createApp, ref, onMounted } = (window as any).Vue\n+        createApp({\n+          template: `\n+            <div id=\"container\">\n+              <div class=\"scale\" style=\"transform: scale(2) translateX(50%) translateY(50%)\">\n+                <transition-group tag=\"ul\">\n+                  <li v-for=\"item in items\" :key=\"item\">{{item}}</li>\n+                </transition-group>\n+                <button id=\"toggleBtn\" @click=\"click\">button</button>\n+              </div>\n+            </div>\n+          `,\n+          setup: () => {\n+            const items = ref(['a', 'b', 'c'])\n+            const click = () => {\n+              items.value.reverse()\n+            }\n+\n+            onMounted(() => {\n+              const styleNode = document.createElement('style')\n+              styleNode.innerHTML = `.v-move {\n+                transition: transform 0.5s ease;\n+              }`\n+              document.body.appendChild(styleNode)\n+            })\n+\n+            return { items, click }\n+          },\n+        }).mount('#app')\n+      })\n+\n+      const original_top = await page().$eval('ul li:nth-child(1)', node => {\n+        return node.getBoundingClientRect().top\n+      })\n+      const new_top = await page().evaluate(() => {\n+        const el = document.querySelector('ul li:nth-child(1)')\n+        const p = new Promise(resolve => {\n+          el!.addEventListener('transitionstart', () => {\n+            const new_top = el!.getBoundingClientRect().top\n+            resolve(new_top)\n+          })\n+        })\n+        ;(document.querySelector('#toggleBtn') as any)!.click()\n+        return p\n+      })\n+\n+      expect(original_top).toBeLessThan(new_top as number)\n+    },\n+    E2E_TIMEOUT,\n+  )\n+\n   test(\n     'not leaking after children unmounted',\n     async () => {"}, {"role": "assistant", "content": "fix(transition-group): use offsetLeft/Top instead of"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-core/src/components/Suspense.ts | 12 ++++++++++++\n 1 file changed, 12 insertions(+)\n\ndiff --git a/packages/runtime-core/src/components/Suspense.ts b/packages/runtime-core/src/components/Suspense.ts\nindex 0109d77..d14e96b 100644\n--- a/packages/runtime-core/src/components/Suspense.ts\n+++ b/packages/runtime-core/src/components/Suspense.ts\n@@ -530,6 +530,7 @@ function createSuspenseBoundary(\n         effects,\n         parentComponent,\n         container,\n+        isInFallback,\n       } = suspense\n \n       // if there's a transition happening we need to wait it to finish.\n@@ -551,6 +552,10 @@ function createSuspenseBoundary(\n                 MoveType.ENTER,\n               )\n               queuePostFlushCb(effects)\n+              // clear el reference from fallback vnode to allow GC after transition\n+              if (isInFallback && vnode.ssFallback) {\n+                vnode.ssFallback.el = null\n+              }\n             }\n           }\n         }\n@@ -570,6 +575,11 @@ function createSuspenseBoundary(\n             anchor = next(activeBranch)\n           }\n           unmount(activeBranch, parentComponent, suspense, true)\n+          // clear el reference from fallback vnode to allow GC\n+          // only clear immediately if there's no delayed transition\n+          if (!delayEnter && isInFallback && vnode.ssFallback) {\n+            vnode.ssFallback.el = null\n+          }\n         }\n         if (!delayEnter) {\n           // move content from off-dom container to actual container\n@@ -728,6 +738,8 @@ function createSuspenseBoundary(\n             optimized,\n           )\n           if (placeholder) {\n+            // clean up placeholder reference\n+            vnode.placeholder = null\n             remove(placeholder)\n           }\n           updateHOCHostEl(instance, vnode.el)"}, {"role": "assistant", "content": "fix(suspense): clear vnode references to allow GC"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../ReactiveScopes/InferReactiveScopeVariables.ts  |  8 --\n ...repro-stale-closure-forward-reference.expect.md | 94 ++++++++++++++++++++++\n .../repro-stale-closure-forward-reference.js       | 32 ++++++++\n 3 files changed, 126 insertions(+), 8 deletions(-)\n\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/ReactiveScopes/InferReactiveScopeVariables.ts b/compiler/packages/babel-plugin-react-compiler/src/ReactiveScopes/InferReactiveScopeVariables.ts\nindex 300115c..b034ee8 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/ReactiveScopes/InferReactiveScopeVariables.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/ReactiveScopes/InferReactiveScopeVariables.ts\n@@ -389,14 +389,6 @@ export function findDisjointMutableValues(\n              */\n             operand.identifier.mutableRange.start > 0\n           ) {\n-            if (\n-              instr.value.kind === 'FunctionExpression' ||\n-              instr.value.kind === 'ObjectMethod'\n-            ) {\n-              if (operand.identifier.type.kind === 'Primitive') {\n-                continue;\n-              }\n-            }\n             operands.push(operand.identifier);\n           }\n         }\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/repro-stale-closure-forward-reference.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/repro-stale-closure-forward-reference.expect.md\nnew file mode 100644\nindex 0000000..01d1fe6\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/repro-stale-closure-forward-reference.expect.md\n@@ -0,0 +1,94 @@\n+\n+## Input\n+\n+```javascript\n+import {useState} from 'react';\n+\n+/**\n+ * Repro for https://github.com/facebook/react/issues/35122\n+ *\n+ * InferReactiveScopeVariables was excluding primitive operands\n+ * when considering operands for merging. We previously did not\n+ * infer types for context variables (StoreContext etc), but later\n+ * started inferring types in cases of `const` context variables,\n+ * since the type cannot change.\n+ *\n+ * In this example, this meant that we skipped the `isExpired`\n+ * operand of the onClick function expression when considering\n+ * scopes to merge.\n+ */\n+function Test1() {\n+  const [expire, setExpire] = useState(5);\n+\n+  const onClick = () => {\n+    // Reference to isExpired prior to declaration\n+    console.log('isExpired', isExpired);\n+  };\n+\n+  const isExpired = expire === 0;\n+\n+  return <div onClick={onClick}>{expire}</div>;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Test1,\n+  params: [{}],\n+};\n+\n+```\n+\n+## Code\n+\n+```javascript\n+import { c as _c } from \"react/compiler-runtime\";\n+import { useState } from \"react\";\n+\n+/**\n+ * Repro for https://github.com/facebook/react/issues/35122\n+ *\n+ * InferReactiveScopeVariables was excluding primitive operands\n+ * when considering operands for merging. We previously did not\n+ * infer types for context variables (StoreContext etc), but later\n+ * started inferring types in cases of `const` context variables,\n+ * since the type cannot change.\n+ *\n+ * In this example, this meant that we skipped the `isExpired`\n+ * operand of the onClick function expression when considering\n+ * scopes to merge.\n+ */\n+function Test1() {\n+  const $ = _c(5);\n+  const [expire] = useState(5);\n+  let onClick;\n+  if ($[0] !== expire) {\n+    onClick = () => {\n+      console.log(\"isExpired\", isExpired);\n+    };\n+\n+    const isExpired = expire === 0;\n+    $[0] = expire;\n+    $[1] = onClick;\n+  } else {\n+    onClick = $[1];\n+  }\n+  let t0;\n+  if ($[2] !== expire || $[3] !== onClick) {\n+    t0 = <div onClick={onClick}>{expire}</div>;\n+    $[2] = expire;\n+    $[3] = onClick;\n+    $[4] = t0;\n+  } else {\n+    t0 = $[4];\n+  }\n+  return t0;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Test1,\n+  params: [{}],\n+};\n+\n+```\n+      \n+### Eval output\n+(kind: ok) <div>5</div>\n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/repro-stale-closure-forward-reference.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/repro-stale-closure-forward-reference.js\nnew file mode 100644\nindex 0000000..035640f\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/repro-stale-closure-forward-reference.js\n@@ -0,0 +1,32 @@\n+import {useState} from 'react';\n+\n+/**\n+ * Repro for https://github.com/facebook/react/issues/35122\n+ *\n+ * InferReactiveScopeVariables was excluding primitive operands\n+ * when considering operands for merging. We previously did not\n+ * infer types for context variables (StoreContext etc), but later\n+ * started inferring types in cases of `const` context variables,\n+ * since the type cannot change.\n+ *\n+ * In this example, this meant that we skipped the `isExpired`\n+ * operand of the onClick function expression when considering\n+ * scopes to merge.\n+ */\n+function Test1() {\n+  const [expire, setExpire] = useState(5);\n+\n+  const onClick = () => {\n+    // Reference to isExpired prior to declaration\n+    console.log('isExpired', isExpired);\n+  };\n+\n+  const isExpired = expire === 0;\n+\n+  return <div onClick={onClick}>{expire}</div>;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Test1,\n+  params: [{}],\n+};"}, {"role": "assistant", "content": "fix(compiler): include primitive operands in reactive scope merging"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/react-dom/package.json | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/packages/react-dom/package.json b/packages/react-dom/package.json\nindex 77776a7..351ed06 100644\n--- a/packages/react-dom/package.json\n+++ b/packages/react-dom/package.json\n@@ -61,7 +61,7 @@\n       \"react-server\": \"./server.react-server.js\",\n       \"workerd\": \"./server.edge.js\",\n       \"bun\": \"./server.bun.js\",\n-      \"deno\": \"./server.browser.js\",\n+      \"deno\": \"./server.node.js\",\n       \"worker\": \"./server.browser.js\",\n       \"node\": \"./server.node.js\",\n       \"edge-light\": \"./server.edge.js\","}, {"role": "assistant", "content": "fix(react-dom): use node server export for deno"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 491caae..7727fa6 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -22,6 +22,7 @@ hide:\n \n ### Internal\n \n+* \u2b06 Bump actions/cache from 4 to 5. PR [#14511](https://github.com/fastapi/fastapi/pull/14511) by [@dependabot[bot]](https://github.com/apps/dependabot).\n * \u2b06 Bump actions/upload-artifact from 5 to 6. PR [#14525](https://github.com/fastapi/fastapi/pull/14525) by [@dependabot[bot]](https://github.com/apps/dependabot).\n * \u2b06 Bump actions/download-artifact from 6 to 7. PR [#14526](https://github.com/fastapi/fastapi/pull/14526) by [@dependabot[bot]](https://github.com/apps/dependabot).\n * \ud83d\udc77 Tweak CI input names. PR [#14688](https://github.com/fastapi/fastapi/pull/14688) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: add actions/cache bump to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 34ed433..520554e 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -15,6 +15,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udc65 Update FastAPI GitHub topic repositories. PR [#14630](https://github.com/fastapi/fastapi/pull/14630) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc65 Update FastAPI People - Contributors and Translators. PR [#14625](https://github.com/fastapi/fastapi/pull/14625) by [@tiangolo](https://github.com/tiangolo).\n * \ud83c\udf10 Update translation prompts. PR [#14619](https://github.com/fastapi/fastapi/pull/14619) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd28 Update LLM translation script to guide reviewers to change the prompt. PR [#14614](https://github.com/fastapi/fastapi/pull/14614) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/compiler-ssr/src/transforms/ssrVModel.ts | 8 ++++----\n 1 file changed, 4 insertions(+), 4 deletions(-)\n\ndiff --git a/packages/compiler-ssr/src/transforms/ssrVModel.ts b/packages/compiler-ssr/src/transforms/ssrVModel.ts\nindex cbe5b2b..bf62a9b 100644\n--- a/packages/compiler-ssr/src/transforms/ssrVModel.ts\n+++ b/packages/compiler-ssr/src/transforms/ssrVModel.ts\n@@ -83,11 +83,11 @@ export const ssrTransformModel: DirectiveTransform = (dir, node, context) => {\n \n   if (node.tagType === ElementTypes.ELEMENT) {\n     const res: DirectiveTransformResult = { props: [] }\n-    const defaultProps = [\n-      // default value binding for text type inputs\n-      createObjectProperty(`value`, model),\n-    ]\n     if (node.tag === 'input') {\n+      const defaultProps = [\n+        // default value binding for text type inputs\n+        createObjectProperty(`value`, model),\n+      ]\n       const type = findProp(node, 'type')\n       if (type) {\n         const value = findValueBinding(node)"}, {"role": "assistant", "content": "refactor(compiler-ssr): move defaultProps inside input condition"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs |  2 ++\n src/librustdoc/clean/mod.rs                            | 14 +++-----------\n 2 files changed, 5 insertions(+), 11 deletions(-)\n\ndiff --git a/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs b/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\nindex 3dcc0232b30..65d2d61e6fc 100644\n--- a/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\n+++ b/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\n@@ -1283,6 +1283,8 @@ fn probe_single_bound_for_assoc_item<I>(\n                                             )\n                                         });\n \n+                                        // FIXME(mgca): code duplication with other places we lower\n+                                        // the rhs' of associated const bindings\n                                         let ty = projection_term.map_bound(|alias| {\n                                             tcx.type_of(alias.def_id).instantiate(tcx, alias.args)\n                                         });\ndiff --git a/src/librustdoc/clean/mod.rs b/src/librustdoc/clean/mod.rs\nindex c7c23f75d69..0ad9d2fdbe8 100644\n--- a/src/librustdoc/clean/mod.rs\n+++ b/src/librustdoc/clean/mod.rs\n@@ -471,19 +471,13 @@ fn clean_middle_term<'tcx>(\n fn clean_hir_term<'tcx>(\n     assoc_item: Option<DefId>,\n     term: &hir::Term<'tcx>,\n-    span: rustc_span::Span,\n     cx: &mut DocContext<'tcx>,\n ) -> Term {\n     match term {\n         hir::Term::Ty(ty) => Term::Type(clean_ty(ty, cx)),\n         hir::Term::Const(c) => {\n-            let ty = if let Some(assoc_item) = assoc_item {\n-                // FIXME(generic_const_items): this should instantiate with the alias item's args\n-                cx.tcx.type_of(assoc_item).instantiate_identity()\n-            } else {\n-                Ty::new_error_with_message(cx.tcx, span, \"cannot find the associated constant\")\n-            };\n-\n+            // FIXME(generic_const_items): this should instantiate with the alias item's args\n+            let ty = cx.tcx.type_of(assoc_item.unwrap()).instantiate_identity();\n             let ct = lower_const_arg_for_rustdoc(cx.tcx, c, ty);\n             Term::Constant(clean_middle_const(ty::Binder::dummy(ct), cx))\n         }\n@@ -3170,9 +3164,7 @@ fn clean_assoc_item_constraint<'tcx>(\n                     .associated_items(trait_did)\n                     .find_by_ident_and_kind(cx.tcx, constraint.ident, assoc_tag, trait_did)\n                     .map(|item| item.def_id);\n-                AssocItemConstraintKind::Equality {\n-                    term: clean_hir_term(assoc_item, term, constraint.span, cx),\n-                }\n+                AssocItemConstraintKind::Equality { term: clean_hir_term(assoc_item, term, cx) }\n             }\n             hir::AssocItemConstraintKind::Bound { bounds } => AssocItemConstraintKind::Bound {\n                 bounds: bounds.iter().filter_map(|b| clean_generic_bound(b, cx)).collect(),"}, {"role": "assistant", "content": "refactor: simplify cleanhirterm by removing unused span param"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/path/filepath/match.go | 6 ++++--\n 1 file changed, 4 insertions(+), 2 deletions(-)\n\ndiff --git a/src/path/filepath/match.go b/src/path/filepath/match.go\nindex 7ccf71ee..3c1c22bb 100644\n--- a/src/path/filepath/match.go\n+++ b/src/path/filepath/match.go\n@@ -28,13 +28,15 @@ var ErrBadPattern = errors.New(\"syntax error in pattern\")\n //\t\t'[' [ '^' ] { character-range } ']'\n //\t\t            character class (must be non-empty)\n //\t\tc           matches character c (c != '*', '?', '\\\\', '[')\n-//\t\t'\\\\' c      matches character c\n+//\t\t'\\\\' c      matches character c (except on Windows)\n //\n //\tcharacter-range:\n //\t\tc           matches character c (c != '\\\\', '-', ']')\n-//\t\t'\\\\' c      matches character c\n+//\t\t'\\\\' c      matches character c (except on Windows)\n //\t\tlo '-' hi   matches character c for lo <= c <= hi\n //\n+// Path segments in the pattern must be separated by [Separator].\n+//\n // Match requires pattern to match all of name, not just a substring.\n // The only possible returned error is [ErrBadPattern], when pattern\n // is malformed."}, {"role": "assistant", "content": "docs: clarify filepath match behavior for windows and separators"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/backend/views/Highlighter/index.js         | 33 +++++++++++++++++-----\n 1 file changed, 26 insertions(+), 7 deletions(-)\n\ndiff --git a/packages/react-devtools-shared/src/backend/views/Highlighter/index.js b/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\nindex 0adf3ff..34a81f3 100644\n--- a/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\n+++ b/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\n@@ -9,6 +9,7 @@\n \n import Agent from 'react-devtools-shared/src/backend/agent';\n import {hideOverlay, showOverlay} from './Highlighter';\n+import {isReactNativeEnvironment} from 'react-devtools-shared/src/backend/utils';\n \n import type {HostInstance} from 'react-devtools-shared/src/backend/types';\n import type {BackendBridge} from 'react-devtools-shared/src/bridge';\n@@ -49,6 +50,11 @@ export default function setupHighlighter(\n     right: number,\n     bottom: number,\n   }) {\n+    if (isReactNativeEnvironment()) {\n+      // Not implemented.\n+      return;\n+    }\n+\n     if (\n       left === Math.round(window.scrollX) &&\n       top === Math.round(window.scrollY)\n@@ -65,6 +71,11 @@ export default function setupHighlighter(\n \n   let scrollTimer = null;\n   function sendScroll() {\n+    if (isReactNativeEnvironment()) {\n+      // Not implemented.\n+      return;\n+    }\n+\n     if (scrollTimer) {\n       clearTimeout(scrollTimer);\n       scrollTimer = null;\n@@ -85,14 +96,17 @@ export default function setupHighlighter(\n     applyingScroll = false;\n   }\n \n-  document.addEventListener('scroll', () => {\n-    if (!scrollTimer) {\n-      // Periodically synchronize the scroll while scrolling.\n-      scrollTimer = setTimeout(sendScroll, 400);\n-    }\n-  });\n+  // $FlowFixMe[method-unbinding]\n+  if (document && typeof document.addEventListener === 'function') {\n+    document.addEventListener('scroll', () => {\n+      if (!scrollTimer) {\n+        // Periodically synchronize the scroll while scrolling.\n+        scrollTimer = setTimeout(sendScroll, 400);\n+      }\n+    });\n \n-  document.addEventListener('scrollend', scrollEnd);\n+    document.addEventListener('scrollend', scrollEnd);\n+  }\n \n   function startInspectingHost(onlySuspenseNodes: boolean) {\n     inspectOnlySuspenseNodes = onlySuspenseNodes;\n@@ -319,6 +333,11 @@ export default function setupHighlighter(\n     // with the scrollIntoView option.\n     hideOverlay(agent);\n \n+    if (isReactNativeEnvironment()) {\n+      // Not implemented.\n+      return;\n+    }\n+\n     if (scrollDelayTimer) {\n       clearTimeout(scrollDelayTimer);\n       scrollDelayTimer = null;"}, {"role": "assistant", "content": "fix(devtools): guard highlighter scroll handling for react native"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n test/codegen/bits.go | 177 ++++++++++++++++++++++++++++++++++-----------------\n 1 file changed, 117 insertions(+), 60 deletions(-)\n\ndiff --git a/test/codegen/bits.go b/test/codegen/bits.go\nindex da0745d4..d9c567b0 100644\n--- a/test/codegen/bits.go\n+++ b/test/codegen/bits.go\n@@ -13,17 +13,20 @@ import \"math/bits\"\n //\n \n func bitsCheckConstLeftShiftU64(a uint64) (n int) {\n-\t// amd64:\"BTQ [$]63\"\n+\t// amd64:\"BTQ [$]63,\"\n+\t// arm64:\"TBNZ [$]63,\"\n \t// riscv64:\"MOV [$]\" \"AND\" \"BNEZ\"\n \tif a&(1<<63) != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTQ [$]60\"\n+\t// amd64:\"BTQ [$]60,\"\n+\t// arm64:\"TBNZ [$]60,\"\n \t// riscv64:\"MOV [$]\" \"AND\" \"BNEZ\"\n \tif a&(1<<60) != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]0\"\n+\t// amd64:\"BTL [$]0,\"\n+\t// arm64:\"TBZ [$]0,\"\n \t// riscv64:\"ANDI\" \"BEQZ\"\n \tif a&(1<<0) != 0 {\n \t\treturn 1\n@@ -32,37 +35,44 @@ func bitsCheckConstLeftShiftU64(a uint64) (n int) {\n }\n \n func bitsCheckConstRightShiftU64(a [8]uint64) (n int) {\n-\t// amd64:\"BTQ [$]63\"\n+\t// amd64:\"BTQ [$]63,\"\n+\t// arm64:\"LSR [$]63,\" \"TBNZ [$]0,\"\n \t// riscv64:\"SRLI\" \"ANDI\" \"BNEZ\"\n \tif (a[0]>>63)&1 != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTQ [$]63\"\n+\t// amd64:\"BTQ [$]63,\"\n+\t// arm64:\"LSR [$]63,\" \"CBNZ\"\n \t// riscv64:\"SRLI\" \"BNEZ\"\n \tif a[1]>>63 != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTQ [$]63\"\n+\t// amd64:\"BTQ [$]63,\"\n+\t// arm64:\"LSR [$]63,\" \"CBZ\"\n \t// riscv64:\"SRLI\" \"BEQZ\"\n \tif a[2]>>63 == 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTQ [$]60\"\n+\t// amd64:\"BTQ [$]60,\"\n+\t// arm64:\"LSR [$]60,\" \"TBZ [$]0,\"\n \t// riscv64:\"SRLI\", \"ANDI\" \"BEQZ\"\n \tif (a[3]>>60)&1 == 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]1\"\n+\t// amd64:\"BTL [$]1,\"\n+\t// arm64:\"LSR [$]1,\" \"TBZ [$]0,\"\n \t// riscv64:\"SRLI\" \"ANDI\" \"BEQZ\"\n \tif (a[4]>>1)&1 == 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]0\"\n+\t// amd64:\"BTL [$]0,\"\n+\t// arm64:\"TBZ [$]0,\" -\"LSR\"\n \t// riscv64:\"ANDI\" \"BEQZ\" -\"SRLI\"\n \tif (a[5]>>0)&1 == 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]7\"\n+\t// amd64:\"BTL [$]7,\"\n+\t// arm64:\"LSR [$]5,\" \"TBNZ [$]2,\"\n \t// riscv64:\"SRLI\" \"ANDI\" \"BNEZ\"\n \tif (a[6]>>5)&4 == 0 {\n \t\treturn 1\n@@ -72,12 +82,14 @@ func bitsCheckConstRightShiftU64(a [8]uint64) (n int) {\n \n func bitsCheckVarU64(a, b uint64) (n int) {\n \t// amd64:\"BTQ\"\n+\t// arm64:\"MOVD [$]1,\" \"LSL\" \"TST\"\n \t// riscv64:\"ANDI [$]63,\" \"SLL \" \"AND \"\n \tif a&(1<<(b&63)) != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTQ\" -\"BT. [$]0\"\n-\t// riscv64:\"ANDI [$]63,\" \"SRL \" \"ANDI [$]1,\"\n+\t// amd64:\"BTQ\" -\"BT. [$]0,\"\n+\t// arm64:\"LSR\" \"TBZ [$]0,\"\n+\t// riscv64:\"ANDI [$]63,\" \"SRL\" \"ANDI [$]1,\"\n \tif (b>>(a&63))&1 != 0 {\n \t\treturn 1\n \t}\n@@ -85,17 +97,20 @@ func bitsCheckVarU64(a, b uint64) (n int) {\n }\n \n func bitsCheckMaskU64(a uint64) (n int) {\n-\t// amd64:\"BTQ [$]63\"\n+\t// amd64:\"BTQ [$]63,\"\n+\t// arm64:\"TBNZ [$]63,\"\n \t// riscv64:\"MOV [$]\" \"AND\" \"BNEZ\"\n \tif a&0x8000000000000000 != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTQ [$]59\"\n+\t// amd64:\"BTQ [$]59,\"\n+\t// arm64:\"TBNZ [$]59,\"\n \t// riscv64:\"MOV [$]\" \"AND\" \"BNEZ\"\n \tif a&0x800000000000000 != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]0\"\n+\t// amd64:\"BTL [$]0,\"\n+\t// arm64:\"TBZ [$]0,\"\n \t// riscv64:\"ANDI\" \"BEQZ\"\n \tif a&0x1 != 0 {\n \t\treturn 1\n@@ -105,18 +120,22 @@ func bitsCheckMaskU64(a uint64) (n int) {\n \n func bitsSetU64(a, b uint64) (n uint64) {\n \t// amd64:\"BTSQ\"\n+\t// arm64:\"MOVD [$]1,\" \"LSL\" \"ORR\"\n \t// riscv64:\"ANDI\" \"SLL\" \"OR\"\n \tn += b | (1 << (a & 63))\n \n-\t// amd64:\"BTSQ [$]63\"\n+\t// amd64:\"BTSQ [$]63,\"\n+\t// arm64:\"ORR [$]-9223372036854775808,\"\n \t// riscv64:\"MOV [$]\" \"OR \"\n \tn += a | (1 << 63)\n \n-\t// amd64:\"BTSQ [$]60\"\n+\t// amd64:\"BTSQ [$]60,\"\n+\t// arm64:\"ORR [$]1152921504606846976,\"\n \t// riscv64:\"MOV [$]\" \"OR \"\n \tn += a | (1 << 60)\n \n-\t// amd64:\"ORQ [$]1\"\n+\t// amd64:\"ORQ [$]1,\"\n+\t// arm64:\"ORR [$]1,\"\n \t// riscv64:\"ORI\"\n \tn += a | (1 << 0)\n \n@@ -125,18 +144,22 @@ func bitsSetU64(a, b uint64) (n uint64) {\n \n func bitsClearU64(a, b uint64) (n uint64) {\n \t// amd64:\"BTRQ\"\n+\t// arm64:\"MOVD [$]1,\" \"LSL\" \"BIC\"\n \t// riscv64:\"ANDI\" \"SLL\" \"ANDN\"\n \tn += b &^ (1 << (a & 63))\n \n-\t// amd64:\"BTRQ [$]63\"\n+\t// amd64:\"BTRQ [$]63,\"\n+\t// arm64:\"AND [$]9223372036854775807,\"\n \t// riscv64:\"MOV [$]\" \"AND \"\n \tn += a &^ (1 << 63)\n \n-\t// amd64:\"BTRQ [$]60\"\n+\t// amd64:\"BTRQ [$]60,\"\n+\t// arm64:\"AND [$]-1152921504606846977,\"\n \t// riscv64:\"MOV [$]\" \"AND \"\n \tn += a &^ (1 << 60)\n \n \t// amd64:\"ANDQ [$]-2\"\n+\t// arm64:\"AND [$]-2\"\n \t// riscv64:\"ANDI [$]-2\"\n \tn += a &^ (1 << 0)\n \n@@ -144,12 +167,14 @@ func bitsClearU64(a, b uint64) (n uint64) {\n }\n \n func bitsClearLowest(x int64, y int32) (int64, int32) {\n-\t// amd64:\"ANDQ [$]-2\"\n-\t// riscv64:\"ANDI [$]-2\"\n+\t// amd64:\"ANDQ [$]-2,\"\n+\t// arm64:\"AND [$]-2,\"\n+\t// riscv64:\"ANDI [$]-2,\"\n \ta := (x >> 1) << 1\n \n-\t// amd64:\"ANDL [$]-2\"\n-\t// riscv64:\"ANDI [$]-2\"\n+\t// amd64:\"ANDL [$]-2,\"\n+\t// arm64:\"AND [$]-2,\"\n+\t// riscv64:\"ANDI [$]-2,\"\n \tb := (y >> 1) << 1\n \n \treturn a, b\n@@ -157,19 +182,23 @@ func bitsClearLowest(x int64, y int32) (int64, int32) {\n \n func bitsFlipU64(a, b uint64) (n uint64) {\n \t// amd64:\"BTCQ\"\n+\t// arm64:\"MOVD [$]1,\" \"LSL\" \"EOR\"\n \t// riscv64:\"ANDI\" \"SLL\" \"XOR \"\n \tn += b ^ (1 << (a & 63))\n \n-\t// amd64:\"BTCQ [$]63\"\n+\t// amd64:\"BTCQ [$]63,\"\n+\t// arm64:\"EOR [$]-9223372036854775808,\"\n \t// riscv64:\"MOV [$]\" \"XOR \"\n \tn += a ^ (1 << 63)\n \n-\t// amd64:\"BTCQ [$]60\"\n+\t// amd64:\"BTCQ [$]60,\"\n+\t// arm64:\"EOR [$]1152921504606846976,\"\n \t// riscv64:\"MOV [$]\" \"XOR \"\n \tn += a ^ (1 << 60)\n \n-\t// amd64:\"XORQ [$]1\"\n-\t// riscv64:\"XORI [$]1\"\n+\t// amd64:\"XORQ [$]1,\"\n+\t// arm64:\"EOR [$]1,\"\n+\t// riscv64:\"XORI [$]1,\"\n \tn += a ^ (1 << 0)\n \n \treturn n\n@@ -180,17 +209,20 @@ func bitsFlipU64(a, b uint64) (n uint64) {\n //\n \n func bitsCheckConstShiftLeftU32(a uint32) (n int) {\n-\t// amd64:\"BTL [$]31\"\n+\t// amd64:\"BTL [$]31,\"\n+\t// arm64:\"TBNZ [$]31,\"\n \t// riscv64:\"MOV [$]\" \"AND\" \"BNEZ\"\n \tif a&(1<<31) != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]28\"\n+\t// amd64:\"BTL [$]28,\"\n+\t// arm64:\"TBNZ [$]28,\"\n \t// riscv64:\"ANDI\" \"BNEZ\"\n \tif a&(1<<28) != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]0\"\n+\t// amd64:\"BTL [$]0,\"\n+\t// arm64:\"TBZ [$]0,\"\n \t// riscv64:\"ANDI\" \"BEQZ\"\n \tif a&(1<<0) != 0 {\n \t\treturn 1\n@@ -199,37 +231,44 @@ func bitsCheckConstShiftLeftU32(a uint32) (n int) {\n }\n \n func bitsCheckConstRightShiftU32(a [8]uint32) (n int) {\n-\t// amd64:\"BTL [$]31\"\n+\t// amd64:\"BTL [$]31,\"\n+\t// arm64:\"UBFX [$]31,\" \"CBNZW\"\n \t// riscv64:\"SRLI\" \"ANDI\" \"BNEZ\"\n \tif (a[0]>>31)&1 != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]31\"\n+\t// amd64:\"BTL [$]31,\"\n+\t// arm64:\"UBFX [$]31,\" \"CBNZW\"\n \t// riscv64:\"SRLI\" \"BNEZ\"\n \tif a[1]>>31 != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]31\"\n+\t// amd64:\"BTL [$]31,\"\n+\t// arm64:\"UBFX [$]31,\" \"CBZW\"\n \t// riscv64:\"SRLI\" \"BEQZ\"\n \tif a[2]>>31 == 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]28\"\n+\t// amd64:\"BTL [$]28,\"\n+\t// arm64:\"UBFX [$]28,\" \"TBZ\"\n \t// riscv64:\"SRLI\" \"ANDI\" \"BEQZ\"\n \tif (a[3]>>28)&1 == 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]1\"\n+\t// amd64:\"BTL [$]1,\"\n+\t// arm64:\"UBFX [$]1,\" \"TBZ\"\n \t// riscv64:\"SRLI\" \"ANDI\" \"BEQZ\"\n \tif (a[4]>>1)&1 == 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]0\"\n-\t// riscv64:\"ANDI\" \"BEQZ\" -\"SRLI\"\n+\t// amd64:\"BTL [$]0,\"\n+\t// arm64:\"TBZ\" -\"UBFX\" -\"SRL\"\n+\t// riscv64:\"ANDI\" \"BEQZ\" -\"SRLI \"\n \tif (a[5]>>0)&1 == 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]7\"\n+\t// amd64:\"BTL [$]7,\"\n+\t// arm64:\"UBFX [$]5,\" \"TBNZ\"\n \t// riscv64:\"SRLI\" \"ANDI\" \"BNEZ\"\n \tif (a[6]>>5)&4 == 0 {\n \t\treturn 1\n@@ -239,11 +278,13 @@ func bitsCheckConstRightShiftU32(a [8]uint32) (n int) {\n \n func bitsCheckVarU32(a, b uint32) (n int) {\n \t// amd64:\"BTL\"\n+\t// arm64:\"AND [$]31,\" \"MOVD [$]1,\" \"LSL\" \"TSTW\"\n \t// riscv64:\"ANDI [$]31,\" \"SLL \" \"AND \"\n \tif a&(1<<(b&31)) != 0 {\n \t\treturn 1\n \t}\n \t// amd64:\"BTL\" -\"BT. [$]0\"\n+\t// arm64:\"AND [$]31,\" \"LSR\" \"TBZ\"\n \t// riscv64:\"ANDI [$]31,\" \"SRLW \" \"ANDI [$]1,\"\n \tif (b>>(a&31))&1 != 0 {\n \t\treturn 1\n@@ -252,17 +293,20 @@ func bitsCheckVarU32(a, b uint32) (n int) {\n }\n \n func bitsCheckMaskU32(a uint32) (n int) {\n-\t// amd64:\"BTL [$]31\"\n+\t// amd64:\"BTL [$]31,\"\n+\t// arm64:\"TBNZ [$]31,\"\n \t// riscv64:\"MOV [$]\" \"AND\" \"BNEZ\"\n \tif a&0x80000000 != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]27\"\n+\t// amd64:\"BTL [$]27,\"\n+\t// arm64:\"TBNZ [$]27,\"\n \t// riscv64:\"ANDI\" \"BNEZ\"\n \tif a&0x8000000 != 0 {\n \t\treturn 1\n \t}\n-\t// amd64:\"BTL [$]0\"\n+\t// amd64:\"BTL [$]0,\"\n+\t// arm64:\"TBZ [$]0,\"\n \t// riscv64:\"ANDI\" \"BEQZ\"\n \tif a&0x1 != 0 {\n \t\treturn 1\n@@ -272,19 +316,23 @@ func bitsCheckMaskU32(a uint32) (n int) {\n \n func bitsSetU32(a, b uint32) (n uint32) {\n \t// amd64:\"BTSL\"\n+\t// arm64:\"AND [$]31,\" \"MOVD [$]1,\" \"LSL\" \"ORR\"\n \t// riscv64:\"ANDI\" \"SLL\" \"OR\"\n \tn += b | (1 << (a & 31))\n \n-\t// amd64:\"ORL [$]-2147483648\"\n-\t// riscv64:\"ORI [$]-2147483648\"\n+\t// amd64:\"ORL [$]-2147483648,\"\n+\t// arm64:\"ORR [$]-2147483648,\"\n+\t// riscv64:\"ORI [$]-2147483648,\"\n \tn += a | (1 << 31)\n \n-\t// amd64:\"ORL [$]268435456\"\n-\t// riscv64:\"ORI [$]268435456\"\n+\t// amd64:\"ORL [$]268435456,\"\n+\t// arm64:\"ORR [$]268435456,\"\n+\t// riscv64:\"ORI [$]268435456,\"\n \tn += a | (1 << 28)\n \n-\t// amd64:\"ORL [$]1\"\n-\t// riscv64:\"ORI [$]1\"\n+\t// amd64:\"ORL [$]1,\"\n+\t// arm64:\"ORR [$]1,\"\n+\t// riscv64:\"ORI [$]1,\"\n \tn += a | (1 << 0)\n \n \treturn n\n@@ -292,19 +340,23 @@ func bitsSetU32(a, b uint32) (n uint32) {\n \n func bitsClearU32(a, b uint32) (n uint32) {\n \t// amd64:\"BTRL\"\n+\t// arm64:\"AND [$]31,\" \"MOVD [$]1,\" \"LSL\" \"BIC\"\n \t// riscv64:\"ANDI\" \"SLL\" \"ANDN\"\n \tn += b &^ (1 << (a & 31))\n \n-\t// amd64:\"ANDL [$]2147483647\"\n-\t// riscv64:\"ANDI [$]2147483647\"\n+\t// amd64:\"ANDL [$]2147483647,\"\n+\t// arm64:\"AND [$]2147483647,\"\n+\t// riscv64:\"ANDI [$]2147483647,\"\n \tn += a &^ (1 << 31)\n \n-\t// amd64:\"ANDL [$]-268435457\"\n-\t// riscv64:\"ANDI [$]-268435457\"\n+\t// amd64:\"ANDL [$]-268435457,\"\n+\t// arm64:\"AND [$]-268435457,\"\n+\t// riscv64:\"ANDI [$]-268435457,\"\n \tn += a &^ (1 << 28)\n \n-\t// amd64:\"ANDL [$]-2\"\n-\t// riscv64:\"ANDI [$]-2\"\n+\t// amd64:\"ANDL [$]-2,\"\n+\t// arm64:\"AND [$]-2,\"\n+\t// riscv64:\"ANDI [$]-2,\"\n \tn += a &^ (1 << 0)\n \n \treturn n\n@@ -312,19 +364,23 @@ func bitsClearU32(a, b uint32) (n uint32) {\n \n func bitsFlipU32(a, b uint32) (n uint32) {\n \t// amd64:\"BTCL\"\n+\t// arm64:\"AND [$]31,\" \"MOVD [$]1,\" \"LSL\" \"EOR\"\n \t// riscv64:\"ANDI\" \"SLL\" \"XOR \"\n \tn += b ^ (1 << (a & 31))\n \n-\t// amd64:\"XORL [$]-2147483648\"\n-\t// riscv64:\"XORI [$]-2147483648\"\n+\t// amd64:\"XORL [$]-2147483648,\"\n+\t// arm64:\"EOR [$]-2147483648,\"\n+\t// riscv64:\"XORI [$]-2147483648,\"\n \tn += a ^ (1 << 31)\n \n-\t// amd64:\"XORL [$]268435456\"\n-\t// riscv64:\"XORI [$]268435456\"\n+\t// amd64:\"XORL [$]268435456,\"\n+\t// arm64:\"EOR [$]268435456,\"\n+\t// riscv64:\"XORI [$]268435456,\"\n \tn += a ^ (1 << 28)\n \n-\t// amd64:\"XORL [$]1\"\n-\t// riscv64:\"XORI [$]1\"\n+\t// amd64:\"XORL [$]1,\"\n+\t// arm64:\"EOR [$]1,\"\n+\t// riscv64:\"XORI [$]1,\"\n \tn += a ^ (1 << 0)\n \n \treturn n\n@@ -343,6 +399,7 @@ func bitsOpOnMem(a []uint32, b, c, d uint32) {\n \n func bitsCheckMostNegative(b uint8) bool {\n \t// amd64:\"TESTB\"\n+\t// arm64:\"TSTW\" \"CSET\"\n \t// riscv64:\"ANDI [$]128,\" \"SNEZ\" -\"ADDI\"\n \treturn b&0x80 == 0x80\n }"}, {"role": "assistant", "content": "test(codegen): add arm64 bit operation checks"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages-private/sfc-playground/package.json |  2 +-\n pnpm-lock.yaml                               | 38 ++++++++++++++++++++++++----\n 2 files changed, 34 insertions(+), 6 deletions(-)\n\ndiff --git a/packages-private/sfc-playground/package.json b/packages-private/sfc-playground/package.json\nindex abb888e..2643652 100644\n--- a/packages-private/sfc-playground/package.json\n+++ b/packages-private/sfc-playground/package.json\n@@ -13,7 +13,7 @@\n     \"vite\": \"catalog:\"\n   },\n   \"dependencies\": {\n-    \"@vue/repl\": \"^4.7.0\",\n+    \"@vue/repl\": \"^4.7.1\",\n     \"file-saver\": \"^2.0.5\",\n     \"jszip\": \"^3.10.1\",\n     \"vue\": \"workspace:*\"\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 086bb24..e4548fc 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -204,8 +204,8 @@ importers:\n   packages-private/sfc-playground:\n     dependencies:\n       '@vue/repl':\n-        specifier: ^4.7.0\n-        version: 4.7.0\n+        specifier: ^4.7.1\n+        version: 4.7.1\n       file-saver:\n         specifier: ^2.0.5\n         version: 2.0.5\n@@ -986,30 +986,35 @@ packages:\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm]\n     os: [linux]\n+    libc: [glibc]\n \n   '@parcel/watcher-linux-arm64-glibc@2.4.1':\n     resolution: {integrity: sha512-BJ7mH985OADVLpbrzCLgrJ3TOpiZggE9FMblfO65PlOCdG++xJpKUJ0Aol74ZUIYfb8WsRlUdgrZxKkz3zXWYA==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@parcel/watcher-linux-arm64-musl@2.4.1':\n     resolution: {integrity: sha512-p4Xb7JGq3MLgAfYhslU2SjoV9G0kI0Xry0kuxeG/41UfpjHGOhv7UoUDAz/jb1u2elbhazy4rRBL8PegPJFBhA==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [musl]\n \n   '@parcel/watcher-linux-x64-glibc@2.4.1':\n     resolution: {integrity: sha512-s9O3fByZ/2pyYDPoLM6zt92yu6P4E39a03zvO0qCHOTjxmt3GHRMLuRZEWhWLASTMSrrnVNWdVI/+pUElJBBBg==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [x64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@parcel/watcher-linux-x64-musl@2.4.1':\n     resolution: {integrity: sha512-L2nZTYR1myLNST0O632g0Dx9LyMNHrn6TOt76sYxWLdff3cB22/GZX2UPtJnaqQPdCRoszoY5rcOj4oMTtp5fQ==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [x64]\n     os: [linux]\n+    libc: [musl]\n \n   '@parcel/watcher-win32-arm64@2.4.1':\n     resolution: {integrity: sha512-Uq2BPp5GWhrq/lcuItCHoqxjULU1QYEcyjSO5jqqOK8RNFDBQnenMMx4gAl3v8GiWa59E9+uDM7yZ6LxwUIfRg==}\n@@ -1142,56 +1147,67 @@ packages:\n     resolution: {integrity: sha512-PsNAbcyv9CcecAUagQefwX8fQn9LQ4nZkpDboBOttmyffnInRy8R8dSg6hxxl2Re5QhHBf6FYIDhIj5v982ATQ==}\n     cpu: [arm]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-arm-musleabihf@4.52.5':\n     resolution: {integrity: sha512-Fw4tysRutyQc/wwkmcyoqFtJhh0u31K+Q6jYjeicsGJJ7bbEq8LwPWV/w0cnzOqR2m694/Af6hpFayLJZkG2VQ==}\n     cpu: [arm]\n     os: [linux]\n+    libc: [musl]\n \n   '@rollup/rollup-linux-arm64-gnu@4.52.5':\n     resolution: {integrity: sha512-a+3wVnAYdQClOTlyapKmyI6BLPAFYs0JM8HRpgYZQO02rMR09ZcV9LbQB+NL6sljzG38869YqThrRnfPMCDtZg==}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-arm64-musl@4.52.5':\n     resolution: {integrity: sha512-AvttBOMwO9Pcuuf7m9PkC1PUIKsfaAJ4AYhy944qeTJgQOqJYJ9oVl2nYgY7Rk0mkbsuOpCAYSs6wLYB2Xiw0Q==}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [musl]\n \n   '@rollup/rollup-linux-loong64-gnu@4.52.5':\n     resolution: {integrity: sha512-DkDk8pmXQV2wVrF6oq5tONK6UHLz/XcEVow4JTTerdeV1uqPeHxwcg7aFsfnSm9L+OO8WJsWotKM2JJPMWrQtA==}\n     cpu: [loong64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-ppc64-gnu@4.52.5':\n     resolution: {integrity: sha512-W/b9ZN/U9+hPQVvlGwjzi+Wy4xdoH2I8EjaCkMvzpI7wJUs8sWJ03Rq96jRnHkSrcHTpQe8h5Tg3ZzUPGauvAw==}\n     cpu: [ppc64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-riscv64-gnu@4.52.5':\n     resolution: {integrity: sha512-sjQLr9BW7R/ZiXnQiWPkErNfLMkkWIoCz7YMn27HldKsADEKa5WYdobaa1hmN6slu9oWQbB6/jFpJ+P2IkVrmw==}\n     cpu: [riscv64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-riscv64-musl@4.52.5':\n     resolution: {integrity: sha512-hq3jU/kGyjXWTvAh2awn8oHroCbrPm8JqM7RUpKjalIRWWXE01CQOf/tUNWNHjmbMHg/hmNCwc/Pz3k1T/j/Lg==}\n     cpu: [riscv64]\n     os: [linux]\n+    libc: [musl]\n \n   '@rollup/rollup-linux-s390x-gnu@4.52.5':\n     resolution: {integrity: sha512-gn8kHOrku8D4NGHMK1Y7NA7INQTRdVOntt1OCYypZPRt6skGbddska44K8iocdpxHTMMNui5oH4elPH4QOLrFQ==}\n     cpu: [s390x]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-x64-gnu@4.52.5':\n     resolution: {integrity: sha512-hXGLYpdhiNElzN770+H2nlx+jRog8TyynpTVzdlc6bndktjKWyZyiCsuDAlpd+j+W+WNqfcyAWz9HxxIGfZm1Q==}\n     cpu: [x64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@rollup/rollup-linux-x64-musl@4.52.5':\n     resolution: {integrity: sha512-arCGIcuNKjBoKAXD+y7XomR9gY6Mw7HnFBv5Rw7wQRvwYLR7gBAgV7Mb2QTyjXfTveBNFAtPt46/36vV9STLNg==}\n     cpu: [x64]\n     os: [linux]\n+    libc: [musl]\n \n   '@rollup/rollup-openharmony-arm64@4.52.5':\n     resolution: {integrity: sha512-QoFqB6+/9Rly/RiPjaomPLmR/13cgkIGfA40LHly9zcH1S0bN2HVFYk3a1eAyHQyjs3ZJYlXvIGtcCs5tko9Cw==}\n@@ -1241,24 +1257,28 @@ packages:\n     engines: {node: '>=10'}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@swc/core-linux-arm64-musl@1.14.0':\n     resolution: {integrity: sha512-uofpVoPCEUjYIv454ZEZ3sLgMD17nIwlz2z7bsn7rl301Kt/01umFA7MscUovFfAK2IRGck6XB+uulMu6aFhKQ==}\n     engines: {node: '>=10'}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [musl]\n \n   '@swc/core-linux-x64-gnu@1.14.0':\n     resolution: {integrity: sha512-quTTx1Olm05fBfv66DEBuOsOgqdypnZ/1Bh3yGXWY7ANLFeeRpCDZpljD9BSjdsNdPOlwJmEUZXMHtGm3v1TZQ==}\n     engines: {node: '>=10'}\n     cpu: [x64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@swc/core-linux-x64-musl@1.14.0':\n     resolution: {integrity: sha512-caaNAu+aIqT8seLtCf08i8C3/UC5ttQujUjejhMcuS1/LoCKtNiUs4VekJd2UGt+pyuuSrQ6dKl8CbCfWvWeXw==}\n     engines: {node: '>=10'}\n     cpu: [x64]\n     os: [linux]\n+    libc: [musl]\n \n   '@swc/core-win32-arm64-msvc@1.14.0':\n     resolution: {integrity: sha512-EeW3jFlT3YNckJ6V/JnTfGcX7UHGyh6/AiCPopZ1HNaGiXVCKHPpVQZicmtyr/UpqxCXLrTgjHOvyMke7YN26A==}\n@@ -1451,41 +1471,49 @@ packages:\n     resolution: {integrity: sha512-jon9M7DKRLGZ9VYSkFMflvNqu9hDtOCEnO2QAryFWgT6o6AXU8du56V7YqnaLKr6rAbZBWYsYpikF226v423QA==}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-arm64-musl@1.7.2':\n     resolution: {integrity: sha512-c8Cg4/h+kQ63pL43wBNaVMmOjXI/X62wQmru51qjfTvI7kmCy5uHTJvK/9LrF0G8Jdx8r34d019P1DVJmhXQpA==}\n     cpu: [arm64]\n     os: [linux]\n+    libc: [musl]\n \n   '@unrs/resolver-binding-linux-ppc64-gnu@1.7.2':\n     resolution: {integrity: sha512-A+lcwRFyrjeJmv3JJvhz5NbcCkLQL6Mk16kHTNm6/aGNc4FwPHPE4DR9DwuCvCnVHvF5IAd9U4VIs/VvVir5lg==}\n     cpu: [ppc64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-riscv64-gnu@1.7.2':\n     resolution: {integrity: sha512-hQQ4TJQrSQW8JlPm7tRpXN8OCNP9ez7PajJNjRD1ZTHQAy685OYqPrKjfaMw/8LiHCt8AZ74rfUVHP9vn0N69Q==}\n     cpu: [riscv64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-riscv64-musl@1.7.2':\n     resolution: {integrity: sha512-NoAGbiqrxtY8kVooZ24i70CjLDlUFI7nDj3I9y54U94p+3kPxwd2L692YsdLa+cqQ0VoqMWoehDFp21PKRUoIQ==}\n     cpu: [riscv64]\n     os: [linux]\n+    libc: [musl]\n \n   '@unrs/resolver-binding-linux-s390x-gnu@1.7.2':\n     resolution: {integrity: sha512-KaZByo8xuQZbUhhreBTW+yUnOIHUsv04P8lKjQ5otiGoSJ17ISGYArc+4vKdLEpGaLbemGzr4ZeUbYQQsLWFjA==}\n     cpu: [s390x]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-x64-gnu@1.7.2':\n     resolution: {integrity: sha512-dEidzJDubxxhUCBJ/SHSMJD/9q7JkyfBMT77Px1npl4xpg9t0POLvnWywSk66BgZS/b2Hy9Y1yFaoMTFJUe9yg==}\n     cpu: [x64]\n     os: [linux]\n+    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-x64-musl@1.7.2':\n     resolution: {integrity: sha512-RvP+Ux3wDjmnZDT4XWFfNBRVG0fMsc+yVzNFUqOflnDfZ9OYujv6nkh+GOr+watwrW4wdp6ASfG/e7bkDradsw==}\n     cpu: [x64]\n     os: [linux]\n+    libc: [musl]\n \n   '@unrs/resolver-binding-wasm32-wasi@1.7.2':\n     resolution: {integrity: sha512-y797JBmO9IsvXVRCKDXOxjyAE4+CcZpla2GSoBQ33TVb3ILXuFnMrbR/QQZoauBYeOFuu4w3ifWLw52sdHGz6g==}\n@@ -1569,8 +1597,8 @@ packages:\n     resolution: {integrity: sha512-oTyUE+QHIzLw2PpV14GD/c7EohDyP64xCniWTcqcEmTd699eFqTIwOmtDYjcO1j3QgdXoJEoWv1/cCdLrRoOfg==}\n     engines: {node: '>= 0.12.0'}\n \n-  '@vue/repl@4.7.0':\n-    resolution: {integrity: sha512-1veaAsfO6xYLblo8jr2hQDlegdPjaCZkchZuG7PRhC9zX0bN2aLenu2rT7AEPAXDXK0OXCsB2+WIUevOTyMvLg==}\n+  '@vue/repl@4.7.1':\n+    resolution: {integrity: sha512-8w5Z3cyqBJ5ufzXO2eut2stzb7aX/ZnSva2d3ee8eEINEB7FG2JYwc14eAHHHGGuoXOGN5v4cyb5ti/YZGcwlg==}\n \n   '@zeit/schemas@2.36.0':\n     resolution: {integrity: sha512-7kjMwcChYEzMKjeex9ZFXkt1AyNov9R5HZtjBKVsmVpw7pa7ZtlCGvCBC2vnnXctaYN+aRI61HjIqeetZW5ROg==}\n@@ -4617,7 +4645,7 @@ snapshots:\n \n   '@vue/consolidate@1.0.0': {}\n \n-  '@vue/repl@4.7.0': {}\n+  '@vue/repl@4.7.1': {}\n \n   '@zeit/schemas@2.36.0': {}\n "}, {"role": "assistant", "content": "build(deps): bump @vue/repl to 4.7.1"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-dom/src/modules/attrs.ts  | 10 +++++-----\n packages/vue-compat/__tests__/misc.spec.ts | 21 +++++++++++++++++++++\n 2 files changed, 26 insertions(+), 5 deletions(-)\n\ndiff --git a/packages/runtime-dom/src/modules/attrs.ts b/packages/runtime-dom/src/modules/attrs.ts\nindex d7188aa..1e75e53 100644\n--- a/packages/runtime-dom/src/modules/attrs.ts\n+++ b/packages/runtime-dom/src/modules/attrs.ts\n@@ -59,11 +59,11 @@ export function compatCoerceAttr(\n ): boolean {\n   if (isEnumeratedAttr(key)) {\n     const v2CoercedValue =\n-      value === null\n-        ? 'false'\n-        : typeof value !== 'boolean' && value !== undefined\n-          ? 'true'\n-          : null\n+      value === undefined\n+        ? null\n+        : value === null || value === false || value === 'false'\n+          ? 'false'\n+          : 'true'\n     if (\n       v2CoercedValue &&\n       compatUtils.softAssertCompatEnabled(\ndiff --git a/packages/vue-compat/__tests__/misc.spec.ts b/packages/vue-compat/__tests__/misc.spec.ts\nindex 17fddd9..3cb120d 100644\n--- a/packages/vue-compat/__tests__/misc.spec.ts\n+++ b/packages/vue-compat/__tests__/misc.spec.ts\n@@ -275,3 +275,24 @@ test('ATTR_ENUMERATED_COERCION', () => {\n     )('contenteditable', 'foo', 'true'),\n   ).toHaveBeenWarned()\n })\n+\n+test('ATTR_ENUMERATED_COERCION, coercing \"false\"', () => {\n+  const vm = new Vue({\n+    template: `<div><div draggable=\"false\" :spellcheck=\"false\">hello</div></div>`,\n+  }).$mount()\n+  expect(vm.$el.innerHTML).toBe(\n+    `<div draggable=\"false\" spellcheck=\"false\">hello</div>`,\n+  )\n+  expect(\n+    (\n+      deprecationData[DeprecationTypes.ATTR_ENUMERATED_COERCION]\n+        .message as Function\n+    )('draggable', 'false', 'false'),\n+  ).toHaveBeenWarned()\n+  expect(\n+    (\n+      deprecationData[DeprecationTypes.ATTR_ENUMERATED_COERCION]\n+        .message as Function\n+    )('spellcheck', 'false', 'false'),\n+  ).toHaveBeenWarned()\n+})"}, {"role": "assistant", "content": "fix(compat): handle false value coercion for enumerated attributes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_resolve/src/diagnostics.rs |  5 ++++-\n compiler/rustc_resolve/src/ident.rs       | 19 +++++++++++--------\n compiler/rustc_resolve/src/late.rs        |  8 +++-----\n compiler/rustc_resolve/src/lib.rs         |  2 +-\n 4 files changed, 19 insertions(+), 15 deletions(-)"}, {"role": "assistant", "content": "refactor(resolve): improve identifier resolution diagnostics"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_resolve/src/diagnostics.rs          |  4 +-\n compiler/rustc_resolve/src/imports.rs              | 23 ++++++----\n tests/ui/hygiene/cross-crate-redefine.rs           |  2 +-\n tests/ui/hygiene/cross-crate-redefine.stderr       |  7 ++--\n tests/ui/imports/overwrite-deep-glob.rs            | 22 ++++++++++\n tests/ui/imports/overwrite-deep-glob.stderr        | 12 ++++++\n tests/ui/imports/overwrite-different-ambig-2.rs    | 24 +++++++++++\n .../ui/imports/overwrite-different-ambig-2.stderr  | 49 ++++++++++++++++++++++\n tests/ui/imports/overwrite-different-ambig.rs      | 25 +++++++++++\n tests/ui/imports/overwrite-different-vis.rs        | 21 ++++++++++\n .../imports/overwrite-different-warn-ambiguity.rs  | 28 +++++++++++++\n 11 files changed, 202 insertions(+), 15 deletions(-)"}, {"role": "assistant", "content": "fix(imports): improve glob import conflict diagnostics"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n packages/compiler/src/expression_parser/ast.ts     | 29 ++++++++++++++++++++++\n .../compiler/src/expression_parser/serializer.ts   | 12 +++++++++\n .../test/expression_parser/utils/unparser.ts       | 11 ++++++++\n .../test/expression_parser/utils/validator.ts      |  5 ++++\n packages/compiler/test/render3/util/expression.ts  |  5 ++++\n 5 files changed, 62 insertions(+)\n\ndiff --git a/packages/compiler/src/expression_parser/ast.ts b/packages/compiler/src/expression_parser/ast.ts\nindex c2908e10..abefe44e 100644\n--- a/packages/compiler/src/expression_parser/ast.ts\n+++ b/packages/compiler/src/expression_parser/ast.ts\n@@ -542,6 +542,31 @@ export class ParenthesizedExpression extends AST {\n   }\n }\n \n+export class ArrowFunctionIdentifierParameter {\n+  constructor(\n+    public name: string,\n+    public span: ParseSpan,\n+    public sourceSpan: AbsoluteSourceSpan,\n+  ) {}\n+}\n+\n+export type ArrowFunctionParameter = ArrowFunctionIdentifierParameter; // TODO(crisbeto): also rest parameters?\n+\n+export class ArrowFunction extends AST {\n+  constructor(\n+    span: ParseSpan,\n+    sourceSpan: AbsoluteSourceSpan,\n+    public parameters: ArrowFunctionParameter[],\n+    public body: AST,\n+  ) {\n+    super(span, sourceSpan);\n+  }\n+\n+  override visit(visitor: AstVisitor, context?: any) {\n+    return visitor.visitArrowFunction(this, context);\n+  }\n+}\n+\n export class RegularExpressionLiteral extends AST {\n   constructor(\n     span: ParseSpan,\n@@ -686,6 +711,7 @@ export interface AstVisitor {\n   visitTemplateLiteralElement(ast: TemplateLiteralElement, context: any): any;\n   visitTaggedTemplateLiteral(ast: TaggedTemplateLiteral, context: any): any;\n   visitParenthesizedExpression(ast: ParenthesizedExpression, context: any): any;\n+  visitArrowFunction(ast: ArrowFunction, context: any): any;\n   visitRegularExpressionLiteral(ast: RegularExpressionLiteral, context: any): any;\n   visitSpreadElement(ast: SpreadElement, context: any): any;\n   visitASTWithSource?(ast: ASTWithSource, context: any): any;\n@@ -791,6 +817,9 @@ export class RecursiveAstVisitor implements AstVisitor {\n   visitParenthesizedExpression(ast: ParenthesizedExpression, context: any) {\n     this.visit(ast.expression, context);\n   }\n+  visitArrowFunction(ast: ArrowFunction, context: any): any {\n+    this.visit(ast.body, context);\n+  }\n   visitRegularExpressionLiteral(ast: RegularExpressionLiteral, context: any) {}\n   visitSpreadElement(ast: SpreadElement, context: any) {\n     this.visit(ast.expression, context);\ndiff --git a/packages/compiler/src/expression_parser/serializer.ts b/packages/compiler/src/expression_parser/serializer.ts\nindex 68b311f6..79703527 100644\n--- a/packages/compiler/src/expression_parser/serializer.ts\n+++ b/packages/compiler/src/expression_parser/serializer.ts\n@@ -141,6 +141,18 @@ class SerializeExpressionVisitor implements expr.AstVisitor {\n     return `/${ast.body}/${ast.flags || ''}`;\n   }\n \n+  visitArrowFunction(ast: expr.ArrowFunction, context: any) {\n+    let params: string;\n+\n+    if (ast.parameters.length === 1) {\n+      params = ast.parameters[0].name;\n+    } else {\n+      params = `(${ast.parameters.map((e) => e.name).join(', ')})`;\n+    }\n+\n+    return `${params} => ${ast.body.visit(this, context)}`;\n+  }\n+\n   visitASTWithSource(ast: expr.ASTWithSource, context: any): string {\n     return ast.ast.visit(this, context);\n   }\ndiff --git a/packages/compiler/test/expression_parser/utils/unparser.ts b/packages/compiler/test/expression_parser/utils/unparser.ts\nindex 9677d74f..6bea18a1 100644\n--- a/packages/compiler/test/expression_parser/utils/unparser.ts\n+++ b/packages/compiler/test/expression_parser/utils/unparser.ts\n@@ -7,6 +7,7 @@\n  */\n \n import {\n+  ArrowFunction,\n   AST,\n   AstVisitor,\n   ASTWithSource,\n@@ -254,6 +255,16 @@ class Unparser implements AstVisitor {\n     this._visit(ast.expression);\n   }\n \n+  visitArrowFunction(ast: ArrowFunction, context: any) {\n+    if (ast.parameters.length === 1) {\n+      this._expression += ast.parameters[0].name;\n+    } else {\n+      this._expression += `(${ast.parameters.map((e) => e.name).join(', ')})`;\n+    }\n+    this._expression += ' => ';\n+    this._visit(ast.body);\n+  }\n+\n   private _visit(ast: AST) {\n     ast.visit(this);\n   }\ndiff --git a/packages/compiler/test/expression_parser/utils/validator.ts b/packages/compiler/test/expression_parser/utils/validator.ts\nindex d65a5ca7..b1b949b3 100644\n--- a/packages/compiler/test/expression_parser/utils/validator.ts\n+++ b/packages/compiler/test/expression_parser/utils/validator.ts\n@@ -7,6 +7,7 @@\n  */\n \n import {\n+  ArrowFunction,\n   AST,\n   Binary,\n   BindingPipe,\n@@ -165,6 +166,10 @@ class ASTValidator extends RecursiveAstVisitor {\n   override visitSpreadElement(ast: SpreadElement, context: any): void {\n     this.validate(ast, () => super.visitSpreadElement(ast, context));\n   }\n+\n+  override visitArrowFunction(ast: ArrowFunction, context: any) {\n+    this.validate(ast, () => super.visitArrowFunction(ast, context));\n+  }\n }\n \n function inSpan(span: ParseSpan, parentSpan: ParseSpan | undefined): parentSpan is ParseSpan {\ndiff --git a/packages/compiler/test/render3/util/expression.ts b/packages/compiler/test/render3/util/expression.ts\nindex 0e1b6f1d..e9eb3375 100644\n--- a/packages/compiler/test/render3/util/expression.ts\n+++ b/packages/compiler/test/render3/util/expression.ts\n@@ -136,6 +136,11 @@ class ExpressionSourceHumanizer extends e.RecursiveAstVisitor implements t.Visit\n     super.visitSpreadElement(ast, null);\n   }\n \n+  override visitArrowFunction(ast: e.ArrowFunction) {\n+    this.recordAst(ast);\n+    super.visitArrowFunction(ast, null);\n+  }\n+\n   visitTemplate(ast: t.Template) {\n     t.visitAll(this, ast.directives);\n     t.visitAll(this, ast.children);"}, {"role": "assistant", "content": "refactor(compiler): add AST nodes for arrow functions"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n library/std/src/sys/thread/unix.rs | 9 +++++++++\n 1 file changed, 9 insertions(+)"}, {"role": "assistant", "content": "feat(unix): add thread implementation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../react-devtools-shared/src/backend/views/Highlighter/index.js   | 7 +++++--\n 1 file changed, 5 insertions(+), 2 deletions(-)\n\ndiff --git a/packages/react-devtools-shared/src/backend/views/Highlighter/index.js b/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\nindex f1711e0..0339701 100644\n--- a/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\n+++ b/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\n@@ -96,8 +96,11 @@ export default function setupHighlighter(\n     applyingScroll = false;\n   }\n \n-  // $FlowFixMe[method-unbinding]\n-  if (document && typeof document.addEventListener === 'function') {\n+  if (\n+    typeof document === 'object' &&\n+    // $FlowFixMe[method-unbinding]\n+    typeof document.addEventListener === 'function'\n+  ) {\n     document.addEventListener('scroll', () => {\n       if (!scrollTimer) {\n         // Periodically synchronize the scroll while scrolling."}, {"role": "assistant", "content": "fix(devtools): improve document check in highlighter"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/translate.yml | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/.github/workflows/translate.yml b/.github/workflows/translate.yml\nindex e681762..f1267d2 100644\n--- a/.github/workflows/translate.yml\n+++ b/.github/workflows/translate.yml\n@@ -1,8 +1,8 @@\n name: Translate\n \n on:\n-  schedule:\n-    - cron: \"0 5 15 * *\"  # Run at 05:00 on the 15 of every month\n+  # schedule:\n+  #   - cron: \"0 5 15 * *\"  # Run at 05:00 on the 15 of every month\n \n   workflow_dispatch:\n     inputs:"}, {"role": "assistant", "content": "ci: disable scheduled translation workflow"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 8d080d6..45a6d31 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -9,6 +9,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udd25 Remove test variants for Pydantic v1 in test_request_params. PR [#14612](https://github.com/fastapi/fastapi/pull/14612) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd25 Remove Pydantic v1  specific test variants. PR [#14611](https://github.com/fastapi/fastapi/pull/14611) by [@tiangolo](https://github.com/tiangolo).\n \n ## 0.128.0"}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/simd/archsimd/_gen/simdgen/gen_simdTypes.go |  4 ++++\n src/simd/archsimd/types_amd64.go                | 24 ++++++++++++------------\n 2 files changed, 16 insertions(+), 12 deletions(-)\n\ndiff --git a/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go b/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\nindex 453784ff..d8c44812 100644\n--- a/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\n+++ b/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\n@@ -142,7 +142,11 @@ type v{{.}} struct {\n {{end}}\n \n {{define \"typeTmpl\"}}\n+{{- if eq .Type \"mask\"}}\n+// {{.Name}} is a mask for a SIMD vector of {{.Lanes}} {{.ElemBits}}-bit elements.\n+{{- else}}\n // {{.Name}} is a {{.Size}}-bit SIMD vector of {{.Lanes}} {{.Base}}s.\n+{{- end}}\n type {{.Name}} struct {\n {{.Fields}}\n }\ndiff --git a/src/simd/archsimd/types_amd64.go b/src/simd/archsimd/types_amd64.go\nindex 2efa1363..f39549c7 100644\n--- a/src/simd/archsimd/types_amd64.go\n+++ b/src/simd/archsimd/types_amd64.go\n@@ -295,7 +295,7 @@ func LoadMaskedUint64x2(y *[2]uint64, mask Mask64x2) Uint64x2\n //go:noescape\n func (x Uint64x2) StoreMasked(y *[2]uint64, mask Mask64x2)\n \n-// Mask8x16 is a 128-bit SIMD vector of 16 int8s.\n+// Mask8x16 is a mask for a SIMD vector of 16 8-bit elements.\n type Mask8x16 struct {\n \tint8x16 v128\n \tvals    [16]int8\n@@ -311,7 +311,7 @@ func Mask8x16FromBits(y uint16) Mask8x16\n // Asm: KMOVB, CPU Features: AVX512\n func (x Mask8x16) ToBits() uint16\n \n-// Mask16x8 is a 128-bit SIMD vector of 8 int16s.\n+// Mask16x8 is a mask for a SIMD vector of 8 16-bit elements.\n type Mask16x8 struct {\n \tint16x8 v128\n \tvals    [8]int16\n@@ -327,7 +327,7 @@ func Mask16x8FromBits(y uint8) Mask16x8\n // Asm: KMOVW, CPU Features: AVX512\n func (x Mask16x8) ToBits() uint8\n \n-// Mask32x4 is a 128-bit SIMD vector of 4 int32s.\n+// Mask32x4 is a mask for a SIMD vector of 4 32-bit elements.\n type Mask32x4 struct {\n \tint32x4 v128\n \tvals    [4]int32\n@@ -345,7 +345,7 @@ func Mask32x4FromBits(y uint8) Mask32x4\n // Asm: KMOVD, CPU Features: AVX512\n func (x Mask32x4) ToBits() uint8\n \n-// Mask64x2 is a 128-bit SIMD vector of 2 int64s.\n+// Mask64x2 is a mask for a SIMD vector of 2 64-bit elements.\n type Mask64x2 struct {\n \tint64x2 v128\n \tvals    [2]int64\n@@ -654,7 +654,7 @@ func LoadMaskedUint64x4(y *[4]uint64, mask Mask64x4) Uint64x4\n //go:noescape\n func (x Uint64x4) StoreMasked(y *[4]uint64, mask Mask64x4)\n \n-// Mask8x32 is a 256-bit SIMD vector of 32 int8s.\n+// Mask8x32 is a mask for a SIMD vector of 32 8-bit elements.\n type Mask8x32 struct {\n \tint8x32 v256\n \tvals    [32]int8\n@@ -670,7 +670,7 @@ func Mask8x32FromBits(y uint32) Mask8x32\n // Asm: KMOVB, CPU Features: AVX512\n func (x Mask8x32) ToBits() uint32\n \n-// Mask16x16 is a 256-bit SIMD vector of 16 int16s.\n+// Mask16x16 is a mask for a SIMD vector of 16 16-bit elements.\n type Mask16x16 struct {\n \tint16x16 v256\n \tvals     [16]int16\n@@ -686,7 +686,7 @@ func Mask16x16FromBits(y uint16) Mask16x16\n // Asm: KMOVW, CPU Features: AVX512\n func (x Mask16x16) ToBits() uint16\n \n-// Mask32x8 is a 256-bit SIMD vector of 8 int32s.\n+// Mask32x8 is a mask for a SIMD vector of 8 32-bit elements.\n type Mask32x8 struct {\n \tint32x8 v256\n \tvals    [8]int32\n@@ -702,7 +702,7 @@ func Mask32x8FromBits(y uint8) Mask32x8\n // Asm: KMOVD, CPU Features: AVX512\n func (x Mask32x8) ToBits() uint8\n \n-// Mask64x4 is a 256-bit SIMD vector of 4 int64s.\n+// Mask64x4 is a mask for a SIMD vector of 4 64-bit elements.\n type Mask64x4 struct {\n \tint64x4 v256\n \tvals    [4]int64\n@@ -1075,7 +1075,7 @@ func LoadMaskedUint64x8(y *[8]uint64, mask Mask64x8) Uint64x8\n //go:noescape\n func (x Uint64x8) StoreMasked(y *[8]uint64, mask Mask64x8)\n \n-// Mask8x64 is a 512-bit SIMD vector of 64 int8s.\n+// Mask8x64 is a mask for a SIMD vector of 64 8-bit elements.\n type Mask8x64 struct {\n \tint8x64 v512\n \tvals    [64]int8\n@@ -1091,7 +1091,7 @@ func Mask8x64FromBits(y uint64) Mask8x64\n // Asm: KMOVB, CPU Features: AVX512\n func (x Mask8x64) ToBits() uint64\n \n-// Mask16x32 is a 512-bit SIMD vector of 32 int16s.\n+// Mask16x32 is a mask for a SIMD vector of 32 16-bit elements.\n type Mask16x32 struct {\n \tint16x32 v512\n \tvals     [32]int16\n@@ -1107,7 +1107,7 @@ func Mask16x32FromBits(y uint32) Mask16x32\n // Asm: KMOVW, CPU Features: AVX512\n func (x Mask16x32) ToBits() uint32\n \n-// Mask32x16 is a 512-bit SIMD vector of 16 int32s.\n+// Mask32x16 is a mask for a SIMD vector of 16 32-bit elements.\n type Mask32x16 struct {\n \tint32x16 v512\n \tvals     [16]int32\n@@ -1123,7 +1123,7 @@ func Mask32x16FromBits(y uint16) Mask32x16\n // Asm: KMOVD, CPU Features: AVX512\n func (x Mask32x16) ToBits() uint16\n \n-// Mask64x8 is a 512-bit SIMD vector of 8 int64s.\n+// Mask64x8 is a mask for a SIMD vector of 8 64-bit elements.\n type Mask64x8 struct {\n \tint64x8 v512\n \tvals    [8]int64"}, {"role": "assistant", "content": "docs(simd): fix mask type comments to describe masks not vectors"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 45a6d31..50a83da 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -9,6 +9,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udc77 Do not run translations on cron while finishing updating existing languages. PR [#14613](https://github.com/fastapi/fastapi/pull/14613) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd25 Remove test variants for Pydantic v1 in test_request_params. PR [#14612](https://github.com/fastapi/fastapi/pull/14612) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd25 Remove Pydantic v1  specific test variants. PR [#14611](https://github.com/fastapi/fastapi/pull/14611) by [@tiangolo](https://github.com/tiangolo).\n "}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/simd/archsimd/_gen/tmplgen/main.go             | 23 +++++-\n .../internal/simd_test/compare_helpers_test.go     | 84 ++++++++++++++++++++++\n .../archsimd/internal/simd_test/compare_test.go    | 12 ++++\n .../archsimd/internal/simd_test/helpers_test.go    |  6 +-\n .../internal/simd_test/simulation_helpers_test.go  | 13 ++++\n 5 files changed, 135 insertions(+), 3 deletions(-)\n\ndiff --git a/src/simd/archsimd/_gen/tmplgen/main.go b/src/simd/archsimd/_gen/tmplgen/main.go\nindex e0d607af..8db185e1 100644\n--- a/src/simd/archsimd/_gen/tmplgen/main.go\n+++ b/src/simd/archsimd/_gen/tmplgen/main.go\n@@ -104,6 +104,11 @@ var uintShapes = &shapes{\n \tuints: []int{8, 16, 32, 64},\n }\n \n+var floatShapes = &shapes{\n+\tvecs:   []int{128, 256, 512},\n+\tfloats: []int{32, 64},\n+}\n+\n var integerShapes = &shapes{\n \tvecs:  []int{128, 256, 512},\n \tints:  []int{8, 16, 32, 64},\n@@ -507,6 +512,22 @@ func test{{.VType}}Compare(t *testing.T, f func(_, _ archsimd.{{.VType}}) archsi\n }\n `)\n \n+var compareUnaryTemplate = shapedTemplateOf(floatShapes, \"compare_unary_helpers\", `\n+// test{{.VType}}UnaryCompare tests the simd unary comparison method f against the expected behavior generated by want\n+func test{{.VType}}UnaryCompare(t *testing.T, f func(x archsimd.{{.VType}}) archsimd.Mask{{.WxC}}, want func(x []{{.Etype}}) []int64) {\n+\tn := {{.Count}}\n+\tt.Helper()\n+\tforSlice(t, {{.Etype}}s, n, func(x []{{.Etype}}) bool {\n+\t \tt.Helper()\n+\t\ta := archsimd.Load{{.VType}}Slice(x)\n+\t\tg := make([]int{{.EWidth}}, n)\n+\t\tf(a).ToInt{{.WxC}}().StoreSlice(g)\n+\t\tw := want(x)\n+\t\treturn checkSlicesLogInput(t, s64(g), w, 0.0, func() {t.Helper(); t.Logf(\"x=%v\", x)})\n+\t})\n+}\n+`)\n+\n // TODO this has not been tested yet.\n var compareMaskedTemplate = templateOf(\"comparemasked_helpers\", `\n // test{{.VType}}CompareMasked tests the simd masked comparison method f against the expected behavior generated by want\n@@ -941,7 +962,7 @@ func main() {\n \t\tone(*th, curryTestPrologue(\"ternary simd methods\"), ternaryTemplate, ternaryFlakyTemplate)\n \t}\n \tif *ch != \"\" {\n-\t\tone(*ch, curryTestPrologue(\"simd methods that compare two operands\"), compareTemplate)\n+\t\tone(*ch, curryTestPrologue(\"simd methods that compare two operands\"), compareTemplate, compareUnaryTemplate)\n \t}\n \tif *cmh != \"\" {\n \t\tone(*cmh, curryTestPrologue(\"simd methods that compare two operands under a mask\"), compareMaskedTemplate)\ndiff --git a/src/simd/archsimd/internal/simd_test/compare_helpers_test.go b/src/simd/archsimd/internal/simd_test/compare_helpers_test.go\nindex c520aa7f..7a33f0ff 100644\n--- a/src/simd/archsimd/internal/simd_test/compare_helpers_test.go\n+++ b/src/simd/archsimd/internal/simd_test/compare_helpers_test.go\n@@ -462,3 +462,87 @@ func testFloat64x8Compare(t *testing.T, f func(_, _ archsimd.Float64x8) archsimd\n \t\treturn checkSlicesLogInput(t, s64(g), w, 0.0, func() { t.Helper(); t.Logf(\"x=%v\", x); t.Logf(\"y=%v\", y) })\n \t})\n }\n+\n+// testFloat32x4UnaryCompare tests the simd unary comparison method f against the expected behavior generated by want\n+func testFloat32x4UnaryCompare(t *testing.T, f func(x archsimd.Float32x4) archsimd.Mask32x4, want func(x []float32) []int64) {\n+\tn := 4\n+\tt.Helper()\n+\tforSlice(t, float32s, n, func(x []float32) bool {\n+\t\tt.Helper()\n+\t\ta := archsimd.LoadFloat32x4Slice(x)\n+\t\tg := make([]int32, n)\n+\t\tf(a).ToInt32x4().StoreSlice(g)\n+\t\tw := want(x)\n+\t\treturn checkSlicesLogInput(t, s64(g), w, 0.0, func() { t.Helper(); t.Logf(\"x=%v\", x) })\n+\t})\n+}\n+\n+// testFloat64x2UnaryCompare tests the simd unary comparison method f against the expected behavior generated by want\n+func testFloat64x2UnaryCompare(t *testing.T, f func(x archsimd.Float64x2) archsimd.Mask64x2, want func(x []float64) []int64) {\n+\tn := 2\n+\tt.Helper()\n+\tforSlice(t, float64s, n, func(x []float64) bool {\n+\t\tt.Helper()\n+\t\ta := archsimd.LoadFloat64x2Slice(x)\n+\t\tg := make([]int64, n)\n+\t\tf(a).ToInt64x2().StoreSlice(g)\n+\t\tw := want(x)\n+\t\treturn checkSlicesLogInput(t, s64(g), w, 0.0, func() { t.Helper(); t.Logf(\"x=%v\", x) })\n+\t})\n+}\n+\n+// testFloat32x8UnaryCompare tests the simd unary comparison method f against the expected behavior generated by want\n+func testFloat32x8UnaryCompare(t *testing.T, f func(x archsimd.Float32x8) archsimd.Mask32x8, want func(x []float32) []int64) {\n+\tn := 8\n+\tt.Helper()\n+\tforSlice(t, float32s, n, func(x []float32) bool {\n+\t\tt.Helper()\n+\t\ta := archsimd.LoadFloat32x8Slice(x)\n+\t\tg := make([]int32, n)\n+\t\tf(a).ToInt32x8().StoreSlice(g)\n+\t\tw := want(x)\n+\t\treturn checkSlicesLogInput(t, s64(g), w, 0.0, func() { t.Helper(); t.Logf(\"x=%v\", x) })\n+\t})\n+}\n+\n+// testFloat64x4UnaryCompare tests the simd unary comparison method f against the expected behavior generated by want\n+func testFloat64x4UnaryCompare(t *testing.T, f func(x archsimd.Float64x4) archsimd.Mask64x4, want func(x []float64) []int64) {\n+\tn := 4\n+\tt.Helper()\n+\tforSlice(t, float64s, n, func(x []float64) bool {\n+\t\tt.Helper()\n+\t\ta := archsimd.LoadFloat64x4Slice(x)\n+\t\tg := make([]int64, n)\n+\t\tf(a).ToInt64x4().StoreSlice(g)\n+\t\tw := want(x)\n+\t\treturn checkSlicesLogInput(t, s64(g), w, 0.0, func() { t.Helper(); t.Logf(\"x=%v\", x) })\n+\t})\n+}\n+\n+// testFloat32x16UnaryCompare tests the simd unary comparison method f against the expected behavior generated by want\n+func testFloat32x16UnaryCompare(t *testing.T, f func(x archsimd.Float32x16) archsimd.Mask32x16, want func(x []float32) []int64) {\n+\tn := 16\n+\tt.Helper()\n+\tforSlice(t, float32s, n, func(x []float32) bool {\n+\t\tt.Helper()\n+\t\ta := archsimd.LoadFloat32x16Slice(x)\n+\t\tg := make([]int32, n)\n+\t\tf(a).ToInt32x16().StoreSlice(g)\n+\t\tw := want(x)\n+\t\treturn checkSlicesLogInput(t, s64(g), w, 0.0, func() { t.Helper(); t.Logf(\"x=%v\", x) })\n+\t})\n+}\n+\n+// testFloat64x8UnaryCompare tests the simd unary comparison method f against the expected behavior generated by want\n+func testFloat64x8UnaryCompare(t *testing.T, f func(x archsimd.Float64x8) archsimd.Mask64x8, want func(x []float64) []int64) {\n+\tn := 8\n+\tt.Helper()\n+\tforSlice(t, float64s, n, func(x []float64) bool {\n+\t\tt.Helper()\n+\t\ta := archsimd.LoadFloat64x8Slice(x)\n+\t\tg := make([]int64, n)\n+\t\tf(a).ToInt64x8().StoreSlice(g)\n+\t\tw := want(x)\n+\t\treturn checkSlicesLogInput(t, s64(g), w, 0.0, func() { t.Helper(); t.Logf(\"x=%v\", x) })\n+\t})\n+}\ndiff --git a/src/simd/archsimd/internal/simd_test/compare_test.go b/src/simd/archsimd/internal/simd_test/compare_test.go\nindex efafbfdc..e678676b 100644\n--- a/src/simd/archsimd/internal/simd_test/compare_test.go\n+++ b/src/simd/archsimd/internal/simd_test/compare_test.go\n@@ -298,3 +298,15 @@ func TestNotEqual(t *testing.T) {\n \t\ttestUint64x8Compare(t, archsimd.Uint64x8.NotEqual, notEqualSlice[uint64])\n \t}\n }\n+\n+func TestIsNaN(t *testing.T) {\n+\ttestFloat32x4UnaryCompare(t, archsimd.Float32x4.IsNaN, isNaNSlice[float32])\n+\ttestFloat32x8UnaryCompare(t, archsimd.Float32x8.IsNaN, isNaNSlice[float32])\n+\ttestFloat64x2UnaryCompare(t, archsimd.Float64x2.IsNaN, isNaNSlice[float64])\n+\ttestFloat64x4UnaryCompare(t, archsimd.Float64x4.IsNaN, isNaNSlice[float64])\n+\n+\tif archsimd.X86.AVX512() {\n+\t\ttestFloat32x16UnaryCompare(t, archsimd.Float32x16.IsNaN, isNaNSlice[float32])\n+\t\ttestFloat64x8UnaryCompare(t, archsimd.Float64x8.IsNaN, isNaNSlice[float64])\n+\t}\n+}\ndiff --git a/src/simd/archsimd/internal/simd_test/helpers_test.go b/src/simd/archsimd/internal/simd_test/helpers_test.go\nindex 37cc9819..d6963586 100644\n--- a/src/simd/archsimd/internal/simd_test/helpers_test.go\n+++ b/src/simd/archsimd/internal/simd_test/helpers_test.go\n@@ -182,12 +182,14 @@ var nzero = -zero\n var inf = 1 / zero\n var ninf = -1 / zero\n var nan = math.NaN()\n+var snan32 = math.Float32frombits(0x7f800001)\n+var snan64 = math.Float64frombits(0x7ff0000000000001)\n \n // N controls how large the test vectors are\n const N = 144\n \n-var float32s = nOf(N, []float32{float32(inf), float32(ninf), 1, float32(nan), float32(zero), 2, float32(nan), float32(zero), 3, float32(-zero), float32(1.0 / zero), float32(-1.0 / zero), 1.0 / 2, 1.0 / 4, 1.0 / 8, 1.0 / 1000, 1.0 / 1000000, 1, -1, 0, 2, -2, 3, -3, math.MaxFloat32, 1 / math.MaxFloat32, 10, -10, 100, 20, -20, 300, -300, -4000, -80, -160, -3200, -64, -4, -8, -16, -32, -64})\n-var float64s = nOf(N, []float64{inf, ninf, nan, zero, -zero, 1 / zero, -1 / zero, 0.0001, 0.0000001, 1, -1, 0, 2, -2, 3, -3, math.MaxFloat64, 1.0 / math.MaxFloat64, 10, -10, 100, 20, -20, 300, -300, -4000, -80, -16, -32, -64})\n+var float32s = nOf(N, []float32{float32(inf), float32(ninf), 1, float32(nan), snan32, -float32(nan), -snan32, float32(zero), 2, float32(nan), float32(zero), 3, float32(-zero), float32(1.0 / zero), float32(-1.0 / zero), 1.0 / 2, 1.0 / 4, 1.0 / 8, 1.0 / 1000, 1.0 / 1000000, 1, -1, 0, 2, -2, 3, -3, math.MaxFloat32, 1 / math.MaxFloat32, 10, -10, 100, 20, -20, 300, -300, -4000, -80, -160, -3200, -64, -4, -8, -16, -32, -64})\n+var float64s = nOf(N, []float64{inf, ninf, nan, snan64, -nan, -snan64, zero, -zero, 1 / zero, -1 / zero, 0.0001, 0.0000001, 1, -1, 0, 2, -2, 3, -3, math.MaxFloat64, 1.0 / math.MaxFloat64, 10, -10, 100, 20, -20, 300, -300, -4000, -80, -16, -32, -64})\n \n var int32s = nOf(N, []int32{1, -1, 0, 2, 4, 8, 1024, 0xffffff, -0xffffff, 0x55555, 0x77777, 0xccccc, -0x55555, -0x77777, -0xccccc, -4, -8, -16, -32, -64})\n var uint32s = nOf(N, []uint32{1, 0, 2, 4, 8, 1024, 0xffffff, ^uint32(0xffffff), 0x55555, 0x77777, 0xccccc, ^uint32(0x55555), ^uint32(0x77777), ^uint32(0xccccc)})\ndiff --git a/src/simd/archsimd/internal/simd_test/simulation_helpers_test.go b/src/simd/archsimd/internal/simd_test/simulation_helpers_test.go\nindex da107d80..ac60b6d3 100644\n--- a/src/simd/archsimd/internal/simd_test/simulation_helpers_test.go\n+++ b/src/simd/archsimd/internal/simd_test/simulation_helpers_test.go\n@@ -29,6 +29,10 @@ func notEqual[T number](x, y T) bool {\n \treturn x != y\n }\n \n+func isNaN[T float](x T) bool {\n+\treturn x != x\n+}\n+\n func abs[T number](x T) T {\n \t// TODO this will need a non-standard FP-equality test.\n \tif x == 0 { // true if x is -0.\n@@ -299,6 +303,15 @@ func notEqualSlice[T number](x, y []T) []int64 {\n \treturn mapCompare[T](notEqual)(x, y)\n }\n \n+func isNaNSlice[T float](x []T) []int64 {\n+\treturn map1[T](func(x T) int64 {\n+\t\tif isNaN(x) {\n+\t\t\treturn -1\n+\t\t}\n+\t\treturn 0\n+\t})(x)\n+}\n+\n func ceilSlice[T float](x []T) []T {\n \treturn map1[T](ceil)(x)\n }"}, {"role": "assistant", "content": "test(simd): add unary comparison helpers and IsNaN tests"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts | 3 +++\n 1 file changed, 3 insertions(+)\n\ndiff --git a/packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts b/packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts\nindex f206249..1cf08cb 100644\n--- a/packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts\n+++ b/packages/eslint-plugin-react-hooks/src/shared/RunReactCompiler.ts\n@@ -39,6 +39,9 @@ const COMPILER_OPTIONS: PluginOptions = {\n     validateNoCapitalizedCalls: [],\n     validateHooksUsage: true,\n     validateNoDerivedComputationsInEffects: true,\n+    // Temporarily enabled for internal testing\n+    enableUseKeyedState: true,\n+    enableVerboseNoSetStateInEffect: true,\n   },\n };\n "}, {"role": "assistant", "content": "feat(eslint-plugin-react-hooks): enable useKeyedState and verbose effect"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/archive/tar/reader_test.go | 2 +-\n src/archive/tar/stat_unix.go   | 2 +-\n src/archive/tar/strconv.go     | 2 +-\n src/runtime/trace.go           | 4 ++--\n src/runtime/tracebuf.go        | 2 +-\n test/typeparam/typelist.go     | 2 +-\n 6 files changed, 7 insertions(+), 7 deletions(-)\n\ndiff --git a/src/archive/tar/reader_test.go b/src/archive/tar/reader_test.go\nindex de3d3653..c7611ca0 100644\n--- a/src/archive/tar/reader_test.go\n+++ b/src/archive/tar/reader_test.go\n@@ -787,7 +787,7 @@ type readBadSeeker struct{ io.ReadSeeker }\n \n func (rbs *readBadSeeker) Seek(int64, int) (int64, error) { return 0, fmt.Errorf(\"illegal seek\") }\n \n-// TestReadTruncation test the ending condition on various truncated files and\n+// TestReadTruncation tests the ending condition on various truncated files and\n // that truncated files are still detected even if the underlying io.Reader\n // satisfies io.Seeker.\n func TestReadTruncation(t *testing.T) {\ndiff --git a/src/archive/tar/stat_unix.go b/src/archive/tar/stat_unix.go\nindex f999f56d..891a1a3b 100644\n--- a/src/archive/tar/stat_unix.go\n+++ b/src/archive/tar/stat_unix.go\n@@ -19,7 +19,7 @@ func init() {\n \tsysStat = statUnix\n }\n \n-// userMap and groupMap caches UID and GID lookups for performance reasons.\n+// userMap and groupMap cache UID and GID lookups for performance reasons.\n // The downside is that renaming uname or gname by the OS never takes effect.\n var userMap, groupMap sync.Map // map[int]string\n \ndiff --git a/src/archive/tar/strconv.go b/src/archive/tar/strconv.go\nindex 217efe9e..d3c28a8c 100644\n--- a/src/archive/tar/strconv.go\n+++ b/src/archive/tar/strconv.go\n@@ -312,7 +312,7 @@ func formatPAXRecord(k, v string) (string, error) {\n //\t\"%d %s=%s\\n\" % (size, key, value)\n //\n // Keys and values should be UTF-8, but the number of bad writers out there\n-// forces us to be a more liberal.\n+// forces us to be more liberal.\n // Thus, we only reject all keys with NUL, and only reject NULs in values\n // for the PAX version of the USTAR string fields.\n // The key must not contain an '=' character.\ndiff --git a/src/runtime/trace.go b/src/runtime/trace.go\nindex a7e8937a..5f568d20 100644\n--- a/src/runtime/trace.go\n+++ b/src/runtime/trace.go\n@@ -12,7 +12,7 @@\n //\n // ## Design\n //\n-// The basic idea behind the the execution tracer is to have per-M buffers that\n+// The basic idea behind the execution tracer is to have per-M buffers that\n // trace data may be written into. Each M maintains a write flag indicating whether\n // its trace buffer is currently in use.\n //\n@@ -173,7 +173,7 @@\n // doesn't do this directly for performance reasons. The runtime implementation instead caches\n // a G on the M created for the C thread. On Linux this M is then cached in the thread's TLS,\n // and on other systems, the M is put on a global list on exit from Go. We need to do some\n-// extra work to make sure that this is modeled correctly in the the tracer. For example,\n+// extra work to make sure that this is modeled correctly in the tracer. For example,\n // a C thread exiting Go may leave a P hanging off of its M (whether that M is kept in TLS\n // or placed back on a list). In order to correctly model goroutine creation and destruction,\n // we must behave as if the P was at some point stolen by the runtime, if the C thread\ndiff --git a/src/runtime/tracebuf.go b/src/runtime/tracebuf.go\nindex 5adaede4..1caf69f8 100644\n--- a/src/runtime/tracebuf.go\n+++ b/src/runtime/tracebuf.go\n@@ -29,7 +29,7 @@ type traceWriter struct {\n \t*traceBuf\n }\n \n-// writer returns an a traceWriter that writes into the current M's stream.\n+// writer returns a traceWriter that writes into the current M's stream.\n //\n // Once this is called, the caller must guard against stack growth until\n // end is called on it. Therefore, it's highly recommended to use this\ndiff --git a/test/typeparam/typelist.go b/test/typeparam/typelist.go\nindex cd8ef7d6..b3226301 100644\n--- a/test/typeparam/typelist.go\n+++ b/test/typeparam/typelist.go\n@@ -32,7 +32,7 @@ func _[T interface{ ~int }](x T) {\n \tvar _ T = T(myint(42))\n }\n \n-// Indexing a generic type which has a an array as core type.\n+// Indexing a generic type which has an array as core type.\n func _[T interface{ ~[10]int }](x T) {\n \t_ = x[9] // ok\n }"}, {"role": "assistant", "content": "docs: fix typos in comments"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/os/exec/lookpath.go   | 30 ++++++++++++++++++++++++++++++\n src/os/exec/lp_plan9.go   | 11 +----------\n src/os/exec/lp_unix.go    | 10 +---------\n src/os/exec/lp_wasm.go    |  2 +-\n src/os/exec/lp_windows.go | 26 ++++++++------------------\n 5 files changed, 41 insertions(+), 38 deletions(-)\n\ndiff --git a/src/os/exec/lookpath.go b/src/os/exec/lookpath.go\nnew file mode 100644\nindex 00000000..71f86b99\n--- /dev/null\n+++ b/src/os/exec/lookpath.go\n@@ -0,0 +1,30 @@\n+// Copyright 2026 The Go Authors. All rights reserved.\n+// Use of this source code is governed by a BSD-style\n+// license that can be found in the LICENSE file.\n+\n+package exec\n+\n+// LookPath searches for an executable named file in the current path,\n+// following the conventions of the host operating system.\n+// If file contains a slash, it is tried directly and the default path is not consulted.\n+// Otherwise, on success the result is an absolute path.\n+//\n+// LookPath returns an error satisfying [errors.Is](err, [ErrDot])\n+// if the resolved path is relative to the current directory.\n+// See the package documentation for more details.\n+//\n+// LookPath looks for an executable named file in the\n+// directories named by the PATH environment variable,\n+// except as described below.\n+//\n+//   - On Windows, the file must have an extension named by\n+//     the PATHEXT environment variable.\n+//     When PATHEXT is unset, the file must have\n+//     a \".com\", \".exe\", \".bat\", or \".cmd\" extension.\n+//   - On Plan 9, LookPath consults the path environment variable.\n+//     If file begins with \"/\", \"#\", \"./\", or \"../\", it is tried\n+//     directly and the path is not consulted.\n+//   - On Wasm, LookPath always returns an error.\n+func LookPath(file string) (string, error) {\n+\treturn lookPath(file)\n+}\ndiff --git a/src/os/exec/lp_plan9.go b/src/os/exec/lp_plan9.go\nindex f713a690..711aad11 100644\n--- a/src/os/exec/lp_plan9.go\n+++ b/src/os/exec/lp_plan9.go\n@@ -26,16 +26,7 @@ func findExecutable(file string) error {\n \treturn fs.ErrPermission\n }\n \n-// LookPath searches for an executable named file in the\n-// directories named by the path environment variable.\n-// If file begins with \"/\", \"#\", \"./\", or \"../\", it is tried\n-// directly and the path is not consulted.\n-// On success, the result is an absolute path.\n-//\n-// In older versions of Go, LookPath could return a path relative to the current directory.\n-// As of Go 1.19, LookPath will instead return that path along with an error satisfying\n-// [errors.Is](err, [ErrDot]). See the package documentation for more details.\n-func LookPath(file string) (string, error) {\n+func lookPath(file string) (string, error) {\n \tif err := validateLookPath(filepath.Clean(file)); err != nil {\n \t\treturn \"\", &Error{file, err}\n \t}\ndiff --git a/src/os/exec/lp_unix.go b/src/os/exec/lp_unix.go\nindex e5fddbaf..d3b10cc4 100644\n--- a/src/os/exec/lp_unix.go\n+++ b/src/os/exec/lp_unix.go\n@@ -41,15 +41,7 @@ func findExecutable(file string) error {\n \treturn fs.ErrPermission\n }\n \n-// LookPath searches for an executable named file in the\n-// directories named by the PATH environment variable.\n-// If file contains a slash, it is tried directly and the PATH is not consulted.\n-// Otherwise, on success, the result is an absolute path.\n-//\n-// In older versions of Go, LookPath could return a path relative to the current directory.\n-// As of Go 1.19, LookPath will instead return that path along with an error satisfying\n-// [errors.Is](err, [ErrDot]). See the package documentation for more details.\n-func LookPath(file string) (string, error) {\n+func lookPath(file string) (string, error) {\n \t// NOTE(rsc): I wish we could use the Plan 9 behavior here\n \t// (only bypass the path if file begins with / or ./ or ../)\n \t// but that would not match all the Unix shells.\ndiff --git a/src/os/exec/lp_wasm.go b/src/os/exec/lp_wasm.go\nindex 3c819049..1de9076e 100644\n--- a/src/os/exec/lp_wasm.go\n+++ b/src/os/exec/lp_wasm.go\n@@ -17,7 +17,7 @@ var ErrNotFound = errors.New(\"executable file not found in $PATH\")\n // directories named by the PATH environment variable.\n // If file contains a slash, it is tried directly and the PATH is not consulted.\n // The result may be an absolute path or a path relative to the current directory.\n-func LookPath(file string) (string, error) {\n+func lookPath(file string) (string, error) {\n \t// Wasm can not execute processes, so act as if there are no executables at all.\n \treturn \"\", &Error{file, ErrNotFound}\n }\ndiff --git a/src/os/exec/lp_windows.go b/src/os/exec/lp_windows.go\nindex 74537dec..f58aabc1 100644\n--- a/src/os/exec/lp_windows.go\n+++ b/src/os/exec/lp_windows.go\n@@ -56,22 +56,12 @@ func findExecutable(file string, exts []string) (string, error) {\n \treturn \"\", ErrNotFound\n }\n \n-// LookPath searches for an executable named file in the\n-// directories named by the PATH environment variable.\n-// LookPath also uses PATHEXT environment variable to match\n-// a suitable candidate.\n-// If file contains a slash, it is tried directly and the PATH is not consulted.\n-// Otherwise, on success, the result is an absolute path.\n-//\n-// In older versions of Go, LookPath could return a path relative to the current directory.\n-// As of Go 1.19, LookPath will instead return that path along with an error satisfying\n-// [errors.Is](err, [ErrDot]). See the package documentation for more details.\n-func LookPath(file string) (string, error) {\n+func lookPath(file string) (string, error) {\n \tif err := validateLookPath(file); err != nil {\n \t\treturn \"\", &Error{file, err}\n \t}\n \n-\treturn lookPath(file, pathExt())\n+\treturn lookPathExts(file, pathExt())\n }\n \n // lookExtensions finds windows executable by its dir and path.\n@@ -101,17 +91,17 @@ func lookExtensions(path, dir string) (string, error) {\n \t\t}\n \t}\n \tif dir == \"\" {\n-\t\treturn lookPath(path, exts)\n+\t\treturn lookPathExts(path, exts)\n \t}\n \tif filepath.VolumeName(path) != \"\" {\n-\t\treturn lookPath(path, exts)\n+\t\treturn lookPathExts(path, exts)\n \t}\n \tif len(path) > 1 && os.IsPathSeparator(path[0]) {\n-\t\treturn lookPath(path, exts)\n+\t\treturn lookPathExts(path, exts)\n \t}\n \tdirandpath := filepath.Join(dir, path)\n \t// We assume that LookPath will only add file extension.\n-\tlp, err := lookPath(dirandpath, exts)\n+\tlp, err := lookPathExts(dirandpath, exts)\n \tif err != nil {\n \t\treturn \"\", err\n \t}\n@@ -138,8 +128,8 @@ func pathExt() []string {\n \treturn exts\n }\n \n-// lookPath implements LookPath for the given PATHEXT list.\n-func lookPath(file string, exts []string) (string, error) {\n+// lookPathExts implements LookPath for the given PATHEXT list.\n+func lookPathExts(file string, exts []string) (string, error) {\n \tif strings.ContainsAny(file, `:\\/`) {\n \t\tf, err := findExecutable(file, exts)\n \t\tif err == nil {"}, {"role": "assistant", "content": "refactor(exec): consolidate LookPath docs into shared file"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_resolve/src/diagnostics.rs |  5 ++++-\n compiler/rustc_resolve/src/ident.rs       | 19 +++++++++++--------\n compiler/rustc_resolve/src/late.rs        |  8 +++-----\n compiler/rustc_resolve/src/lib.rs         |  2 +-\n 4 files changed, 19 insertions(+), 15 deletions(-)\n\ndiff --git a/compiler/rustc_resolve/src/diagnostics.rs b/compiler/rustc_resolve/src/diagnostics.rs\nindex 7bc08f1de54..899f8152552 100644\n--- a/compiler/rustc_resolve/src/diagnostics.rs\n+++ b/compiler/rustc_resolve/src/diagnostics.rs\n@@ -32,7 +32,9 @@\n use rustc_span::edition::Edition;\n use rustc_span::hygiene::MacroKind;\n use rustc_span::source_map::{SourceMap, Spanned};\n-use rustc_span::{BytePos, Ident, Macros20NormalizedIdent, Span, Symbol, SyntaxContext, kw, sym};\n+use rustc_span::{\n+    BytePos, DUMMY_SP, Ident, Macros20NormalizedIdent, Span, Symbol, SyntaxContext, kw, sym,\n+};\n use thin_vec::{ThinVec, thin_vec};\n use tracing::{debug, instrument};\n \n@@ -1179,6 +1181,7 @@ pub(crate) fn add_scope_set_candidates(\n         ctxt: SyntaxContext,\n         filter_fn: &impl Fn(Res) -> bool,\n     ) {\n+        let ctxt = DUMMY_SP.with_ctxt(ctxt);\n         self.cm().visit_scopes(scope_set, ps, ctxt, None, |this, scope, use_prelude, _| {\n             match scope {\n                 Scope::DeriveHelpers(expn_id) => {\ndiff --git a/compiler/rustc_resolve/src/ident.rs b/compiler/rustc_resolve/src/ident.rs\nindex 7f04216c555..f7e628048cc 100644\n--- a/compiler/rustc_resolve/src/ident.rs\n+++ b/compiler/rustc_resolve/src/ident.rs\n@@ -53,13 +53,15 @@ pub(crate) fn visit_scopes<'r, T>(\n         mut self: CmResolver<'r, 'ra, 'tcx>,\n         scope_set: ScopeSet<'ra>,\n         parent_scope: &ParentScope<'ra>,\n-        orig_ctxt: SyntaxContext,\n+        // Location of the span is not significant, but pass a `Span` instead of `SyntaxContext`\n+        // to avoid extracting and re-packaging the syntax context unnecessarily.\n+        orig_ctxt: Span,\n         derive_fallback_lint_id: Option<NodeId>,\n         mut visitor: impl FnMut(\n             &mut CmResolver<'r, 'ra, 'tcx>,\n             Scope<'ra>,\n             UsePrelude,\n-            SyntaxContext,\n+            Span,\n         ) -> ControlFlow<T>,\n     ) -> Option<T> {\n         // General principles:\n@@ -238,11 +240,12 @@ pub(crate) fn visit_scopes<'r, T>(\n     fn hygienic_lexical_parent(\n         &self,\n         module: Module<'ra>,\n-        ctxt: &mut SyntaxContext,\n+        span: &mut Span,\n         derive_fallback_lint_id: Option<NodeId>,\n     ) -> Option<(Module<'ra>, Option<NodeId>)> {\n-        if !module.expansion.outer_expn_is_descendant_of(*ctxt) {\n-            return Some((self.expn_def_scope(ctxt.remove_mark()), None));\n+        let ctxt = span.ctxt();\n+        if !module.expansion.outer_expn_is_descendant_of(ctxt) {\n+            return Some((self.expn_def_scope(span.remove_mark()), None));\n         }\n \n         if let ModuleKind::Block = module.kind {\n@@ -272,7 +275,7 @@ fn hygienic_lexical_parent(\n             let ext = &self.get_macro_by_def_id(def_id).ext;\n             if ext.builtin_name.is_none()\n                 && ext.macro_kinds() == MacroKinds::DERIVE\n-                && parent.expansion.outer_expn_is_descendant_of(*ctxt)\n+                && parent.expansion.outer_expn_is_descendant_of(ctxt)\n             {\n                 return Some((parent, derive_fallback_lint_id));\n             }\n@@ -433,10 +436,10 @@ pub(crate) fn resolve_ident_in_scope_set<'r>(\n         let break_result = self.visit_scopes(\n             scope_set,\n             parent_scope,\n-            orig_ident.span.ctxt(),\n+            orig_ident.span,\n             derive_fallback_lint_id,\n             |this, scope, use_prelude, ctxt| {\n-                let ident = Ident::new(orig_ident.name, orig_ident.span.with_ctxt(ctxt));\n+                let ident = Ident::new(orig_ident.name, ctxt);\n                 // The passed `ctxt` is already normalized, so avoid expensive double normalization.\n                 let ident = Macros20NormalizedIdent(ident);\n                 let res = match this.reborrow().resolve_ident_in_scope(\ndiff --git a/compiler/rustc_resolve/src/late.rs b/compiler/rustc_resolve/src/late.rs\nindex 6d009763177..6557e1dea1a 100644\n--- a/compiler/rustc_resolve/src/late.rs\n+++ b/compiler/rustc_resolve/src/late.rs\n@@ -37,9 +37,7 @@\n use rustc_session::lint;\n use rustc_session::parse::feature_err;\n use rustc_span::source_map::{Spanned, respan};\n-use rustc_span::{\n-    BytePos, DUMMY_SP, Ident, Macros20NormalizedIdent, Span, Symbol, SyntaxContext, kw, sym,\n-};\n+use rustc_span::{BytePos, DUMMY_SP, Ident, Macros20NormalizedIdent, Span, Symbol, kw, sym};\n use smallvec::{SmallVec, smallvec};\n use thin_vec::ThinVec;\n use tracing::{debug, instrument, trace};\n@@ -5224,7 +5222,7 @@ fn traits_in_scope(&mut self, ident: Ident, ns: Namespace) -> Vec<TraitCandidate\n         self.r.traits_in_scope(\n             self.current_trait_ref.as_ref().map(|(module, _)| *module),\n             &self.parent_scope,\n-            ident.span.ctxt(),\n+            ident.span,\n             Some((ident.name, ns)),\n         )\n     }\n@@ -5323,7 +5321,7 @@ fn resolve_doc_links(&mut self, attrs: &[Attribute], maybe_exported: MaybeExport\n                 .entry(self.parent_scope.module.nearest_parent_mod().expect_local())\n                 .or_insert_with(|| {\n                     self.r\n-                        .traits_in_scope(None, &self.parent_scope, SyntaxContext::root(), None)\n+                        .traits_in_scope(None, &self.parent_scope, DUMMY_SP, None)\n                         .into_iter()\n                         .filter_map(|tr| {\n                             if self.is_invalid_proc_macro_item_for_doc(tr.def_id) {\ndiff --git a/compiler/rustc_resolve/src/lib.rs b/compiler/rustc_resolve/src/lib.rs\nindex c4c1e06f94a..0939f8cddbe 100644\n--- a/compiler/rustc_resolve/src/lib.rs\n+++ b/compiler/rustc_resolve/src/lib.rs\n@@ -1918,7 +1918,7 @@ fn traits_in_scope(\n         &mut self,\n         current_trait: Option<Module<'ra>>,\n         parent_scope: &ParentScope<'ra>,\n-        ctxt: SyntaxContext,\n+        ctxt: Span,\n         assoc_item: Option<(Symbol, Namespace)>,\n     ) -> Vec<TraitCandidate> {\n         let mut found_traits = Vec::new();"}, {"role": "assistant", "content": "refactor(resolve): pass Span instead of SyntaxContext to avoid"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/crypto/internal/fips140test/acvp_test.go  | 4 ++--\n src/crypto/internal/fips140test/check_test.go | 2 +-\n src/crypto/tls/bogo_shim_test.go              | 2 +-\n 3 files changed, 4 insertions(+), 4 deletions(-)\n\ndiff --git a/src/crypto/internal/fips140test/acvp_test.go b/src/crypto/internal/fips140test/acvp_test.go\nindex e94bab74..6a0b46af 100644\n--- a/src/crypto/internal/fips140test/acvp_test.go\n+++ b/src/crypto/internal/fips140test/acvp_test.go\n@@ -2146,7 +2146,7 @@ func TestACVP(t *testing.T) {\n \t}\n \tconfigPath := filepath.Join(cwd, testConfigFile)\n \tt.Logf(\"running check_expected.go\\ncwd: %q\\ndata_dir: %q\\nconfig: %q\\ntool: %q\\nmodule-wrapper: %q\\n\",\n-\t\tcwd, dataDir, configPath, toolPath, os.Args[0])\n+\t\tcwd, dataDir, configPath, toolPath, testenv.Executable(t))\n \n \t// Run the check_expected test driver using the acvptool we built, and this test binary as the\n \t// module wrapper. The file paths in the config file are specified relative to the dataDir root\n@@ -2157,7 +2157,7 @@ func TestACVP(t *testing.T) {\n \t\t\"-tool\",\n \t\ttoolPath,\n \t\t// Note: module prefix must match Wrapper value in testConfigFile.\n-\t\t\"-module-wrappers\", \"go:\" + os.Args[0],\n+\t\t\"-module-wrappers\", \"go:\" + testenv.Executable(t),\n \t\t\"-tests\", configPath,\n \t}\n \tcmd = testenv.Command(t, testenv.GoToolPath(t), args...)\ndiff --git a/src/crypto/internal/fips140test/check_test.go b/src/crypto/internal/fips140test/check_test.go\nindex 8aef1f9b..d70ffbb7 100644\n--- a/src/crypto/internal/fips140test/check_test.go\n+++ b/src/crypto/internal/fips140test/check_test.go\n@@ -46,7 +46,7 @@ func TestIntegrityCheckFailure(t *testing.T) {\n \tmoduleStatus(t)\n \tcryptotest.MustSupportFIPS140(t)\n \n-\tbin, err := os.ReadFile(os.Args[0])\n+\tbin, err := os.ReadFile(testenv.Executable(t))\n \tif err != nil {\n \t\tt.Fatal(err)\n \t}\ndiff --git a/src/crypto/tls/bogo_shim_test.go b/src/crypto/tls/bogo_shim_test.go\nindex 1b5fc49c..ccac47c2 100644\n--- a/src/crypto/tls/bogo_shim_test.go\n+++ b/src/crypto/tls/bogo_shim_test.go\n@@ -577,7 +577,7 @@ func TestBogoSuite(t *testing.T) {\n \t\t\"test\",\n \t\t\".\",\n \t\tfmt.Sprintf(\"-shim-config=%s\", filepath.Join(cwd, \"bogo_config.json\")),\n-\t\tfmt.Sprintf(\"-shim-path=%s\", os.Args[0]),\n+\t\tfmt.Sprintf(\"-shim-path=%s\", testenv.Executable(t)),\n \t\t\"-shim-extra-flags=-bogo-mode\",\n \t\t\"-allow-unimplemented\",\n \t\t\"-loose-errors\", // TODO(roland): this should be removed eventually"}, {"role": "assistant", "content": "refactor(crypto): use testenv.Executable instead of os.Args[0]"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n SECURITY.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/SECURITY.md b/SECURITY.md\nindex 192502e..4b1db5a 100644\n--- a/SECURITY.md\n+++ b/SECURITY.md\n@@ -13,3 +13,4 @@ We would like to thank the following security researchers for responsibly disclo\n - Jeet Pal - [@jeetpal2007](https://github.com/jeetpal2007) | [Email](mailto:jeetpal2007@gmail.com) | [LinkedIn](https://in.linkedin.com/in/jeet-pal-22601a290)\n - Mix - [@mnixry](https://github.com/mnixry)\n - Aviv Keller - [@RedYetiDev](https://github.com/redyetidev) | [LinkedIn](https://www.linkedin.com/in/redyetidev) <redyetidev@gmail.com>\n+- Ben Zimmermann - [@bzzimmy](https://github.com/bzzimmy) | [Email](mailto:kernelrocks@proton.me)"}, {"role": "assistant", "content": "docs: add security researcher to hall of fame"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/go/internal/work/exec.go     | 8 ++++++++\n src/cmd/go/internal/work/security.go | 1 +\n 2 files changed, 9 insertions(+)\n\ndiff --git a/src/cmd/go/internal/work/exec.go b/src/cmd/go/internal/work/exec.go\nindex 0afdce23..c4971356 100644\n--- a/src/cmd/go/internal/work/exec.go\n+++ b/src/cmd/go/internal/work/exec.go\n@@ -1788,6 +1788,14 @@ func (b *Builder) getPkgConfigFlags(a *Action, p *load.Package) (cflags, ldflags\n \t\t\t\treturn nil, nil, fmt.Errorf(\"invalid pkg-config package name: %s\", pkg)\n \t\t\t}\n \t\t}\n+\n+\t\t// Running 'pkg-config' can cause execution of\n+\t\t// arbitrary code using flags that are not in\n+\t\t// the safelist.\n+\t\tif err := checkCompilerFlags(\"CFLAGS\", \"pkg-config --cflags\", pcflags); err != nil {\n+\t\t\treturn nil, nil, err\n+\t\t}\n+\n \t\tvar out []byte\n \t\tout, err = sh.runOut(p.Dir, nil, b.PkgconfigCmd(), \"--cflags\", pcflags, \"--\", pkgs)\n \t\tif err != nil {\ndiff --git a/src/cmd/go/internal/work/security.go b/src/cmd/go/internal/work/security.go\nindex ffa83e05..80b3f879 100644\n--- a/src/cmd/go/internal/work/security.go\n+++ b/src/cmd/go/internal/work/security.go\n@@ -129,6 +129,7 @@ var validCompilerFlags = []*lazyregexp.Regexp{\n \tre(`-pedantic(-errors)?`),\n \tre(`-pipe`),\n \tre(`-pthread`),\n+\tre(`--static`),\n \tre(`-?-std=([^@\\-].*)`),\n \tre(`-?-stdlib=([^@\\-].*)`),\n \tre(`--sysroot=([^@\\-].*)`),"}, {"role": "assistant", "content": "fix(security): validate pkg-config cflags and allow --static flag"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/devtools/views/SuspenseTab/ActivityList.js | 85 ++++++++++++----------\n 1 file changed, 47 insertions(+), 38 deletions(-)\n\ndiff --git a/packages/react-devtools-shared/src/devtools/views/SuspenseTab/ActivityList.js b/packages/react-devtools-shared/src/devtools/views/SuspenseTab/ActivityList.js\nindex 3a6935b..acef66d 100644\n--- a/packages/react-devtools-shared/src/devtools/views/SuspenseTab/ActivityList.js\n+++ b/packages/react-devtools-shared/src/devtools/views/SuspenseTab/ActivityList.js\n@@ -30,8 +30,6 @@ import {\n } from '../Components/TreeContext';\n import {useHighlightHostInstance} from '../hooks';\n import {StoreContext} from '../context';\n-import ButtonIcon from '../ButtonIcon';\n-import Button from '../Button';\n \n export function useChangeActivitySliceAction(): (\n   id: Element['id'] | null,\n@@ -118,6 +116,8 @@ export default function ActivityList({\n     useTransition();\n   const changeActivitySliceAction = useChangeActivitySliceAction();\n \n+  const includeAllOption = activityID !== null;\n+\n   function handleKeyDown(event: SyntheticKeyboardEvent) {\n     switch (event.key) {\n       case 'Escape':\n@@ -128,15 +128,16 @@ export default function ActivityList({\n         break;\n       case 'Enter':\n       case ' ':\n-        if (inspectedElementID !== null) {\n-          startActivitySliceSelection(() => {\n-            changeActivitySliceAction(inspectedElementID);\n-          });\n-        }\n+        startActivitySliceSelection(() => {\n+          changeActivitySliceAction(inspectedElementID);\n+        });\n         event.preventDefault();\n         break;\n       case 'Home':\n-        treeDispatch({type: 'SELECT_ELEMENT_BY_ID', payload: activities[0].id});\n+        treeDispatch({\n+          type: 'SELECT_ELEMENT_BY_ID',\n+          payload: includeAllOption ? null : activities[0].id,\n+        });\n         event.preventDefault();\n         break;\n       case 'End':\n@@ -150,15 +151,21 @@ export default function ActivityList({\n         const currentIndex = activities.findIndex(\n           activity => activity.id === selectedActivityID,\n         );\n-        if (currentIndex !== undefined) {\n-          const nextIndex =\n-            (currentIndex + activities.length - 1) % activities.length;\n-\n-          treeDispatch({\n-            type: 'SELECT_ELEMENT_BY_ID',\n-            payload: activities[nextIndex].id,\n-          });\n+        let nextIndex: number;\n+        if (currentIndex === -1) {\n+          // Currently selecting \"All\", wrap around to last Activity.\n+          nextIndex = activities.length - 1;\n+        } else {\n+          nextIndex = currentIndex - 1;\n+          if (!includeAllOption) {\n+            nextIndex = (nextIndex + activities.length) % activities.length;\n+          }\n         }\n+\n+        treeDispatch({\n+          type: 'SELECT_ELEMENT_BY_ID',\n+          payload: nextIndex === -1 ? null : activities[nextIndex].id,\n+        });\n         event.preventDefault();\n         break;\n       }\n@@ -166,14 +173,17 @@ export default function ActivityList({\n         const currentIndex = activities.findIndex(\n           activity => activity.id === selectedActivityID,\n         );\n-        if (currentIndex !== undefined) {\n-          const nextIndex = (currentIndex + 1) % activities.length;\n-\n-          treeDispatch({\n-            type: 'SELECT_ELEMENT_BY_ID',\n-            payload: activities[nextIndex].id,\n-          });\n+        let nextIndex: number;\n+        if (includeAllOption && currentIndex === activities.length - 1) {\n+          // Currently selecting last Activity, wrap around to \"All\".\n+          nextIndex = -1;\n+        } else {\n+          nextIndex = (currentIndex + 1) % activities.length;\n         }\n+        treeDispatch({\n+          type: 'SELECT_ELEMENT_BY_ID',\n+          payload: nextIndex === -1 ? null : activities[nextIndex].id,\n+        });\n         event.preventDefault();\n         break;\n       }\n@@ -182,7 +192,7 @@ export default function ActivityList({\n     }\n   }\n \n-  function handleClick(id: Element['id'], event: SyntheticMouseEvent) {\n+  function handleClick(id: Element['id'] | null, event: SyntheticMouseEvent) {\n     event.preventDefault();\n     treeDispatch({type: 'SELECT_ELEMENT_BY_ID', payload: id});\n   }\n@@ -195,25 +205,24 @@ export default function ActivityList({\n \n   return (\n     <div className={styles.ActivityListContaier}>\n-      <div className={styles.ActivityListHeader}>\n-        {activityID !== null && (\n-          // TODO: Obsolete once filtered Activities are included in this list.\n-          <Button\n-            onClick={startActivitySliceSelection.bind(\n-              null,\n-              changeActivitySliceAction.bind(null, null),\n-            )}\n-            title=\"Back to full tree view\">\n-            <ButtonIcon type=\"previous\" />\n-          </Button>\n-        )}\n-      </div>\n+      <div className={styles.ActivityListHeader} />\n       <ol\n         role=\"listbox\"\n         className={styles.ActivityListList}\n         data-pending-activity-slice-selection={isPendingActivitySliceSelection}\n         tabIndex={0}\n         onKeyDown={handleKeyDown}>\n+        {includeAllOption && (\n+          // TODO: Obsolete once filtered Activities are included in this list.\n+          <li\n+            role=\"option\"\n+            aria-selected={null === selectedActivityID ? 'true' : 'false'}\n+            className={styles.ActivityListItem}\n+            onClick={handleClick.bind(null, null)}\n+            onDoubleClick={handleDoubleClick}>\n+            All\n+          </li>\n+        )}\n         {activities.map(({id, depth}) => {\n           const activity = store.getElementByID(id);\n           if (activity === null) {\n@@ -244,7 +253,7 @@ export default function ActivityList({\n                 false,\n               )}\n               onPointerLeave={clearHighlightHostInstance}>\n-              {'\\u00A0'.repeat(depth) + name}\n+              {'\\u00A0'.repeat(depth + (includeAllOption ? 1 : 0)) + name}\n             </li>\n           );\n         })}"}, {"role": "assistant", "content": "refactor(devtools): improve activity list navigation and add all option"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/net/unixsock_test.go | 20 ++++++++++++++------\n 1 file changed, 14 insertions(+), 6 deletions(-)\n\ndiff --git a/src/net/unixsock_test.go b/src/net/unixsock_test.go\nindex f6c5679f..3e4a14b2 100644\n--- a/src/net/unixsock_test.go\n+++ b/src/net/unixsock_test.go\n@@ -375,6 +375,17 @@ func TestUnixUnlink(t *testing.T) {\n \t\t}\n \t\treturn l.(*UnixListener)\n \t}\n+\tfileListener := func(t *testing.T, l *UnixListener) (*os.File, Listener) {\n+\t\tf, err := l.File()\n+\t\tif err != nil {\n+\t\t\tt.Fatal(err)\n+\t\t}\n+\t\tln, err := FileListener(f)\n+\t\tif err != nil {\n+\t\t\tt.Fatal(err)\n+\t\t}\n+\t\treturn f, ln\n+\t}\n \tcheckExists := func(t *testing.T, desc string) {\n \t\tif _, err := os.Stat(name); err != nil {\n \t\t\tt.Fatalf(\"unix socket does not exist %s: %v\", desc, err)\n@@ -397,8 +408,7 @@ func TestUnixUnlink(t *testing.T) {\n \t// FileListener should not.\n \tt.Run(\"FileListener\", func(t *testing.T) {\n \t\tl := listen(t)\n-\t\tf, _ := l.File()\n-\t\tl1, _ := FileListener(f)\n+\t\tf, l1 := fileListener(t, l)\n \t\tcheckExists(t, \"after FileListener\")\n \t\tf.Close()\n \t\tcheckExists(t, \"after File close\")\n@@ -444,8 +454,7 @@ func TestUnixUnlink(t *testing.T) {\n \n \tt.Run(\"FileListener/SetUnlinkOnClose(true)\", func(t *testing.T) {\n \t\tl := listen(t)\n-\t\tf, _ := l.File()\n-\t\tl1, _ := FileListener(f)\n+\t\tf, l1 := fileListener(t, l)\n \t\tcheckExists(t, \"after FileListener\")\n \t\tl1.(*UnixListener).SetUnlinkOnClose(true)\n \t\tf.Close()\n@@ -457,8 +466,7 @@ func TestUnixUnlink(t *testing.T) {\n \n \tt.Run(\"FileListener/SetUnlinkOnClose(false)\", func(t *testing.T) {\n \t\tl := listen(t)\n-\t\tf, _ := l.File()\n-\t\tl1, _ := FileListener(f)\n+\t\tf, l1 := fileListener(t, l)\n \t\tcheckExists(t, \"after FileListener\")\n \t\tl1.(*UnixListener).SetUnlinkOnClose(false)\n \t\tf.Close()"}, {"role": "assistant", "content": "test(net): add fileListener helper and error handling"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-dom/src/jsx.ts | 6 +++++-\n 1 file changed, 5 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/runtime-dom/src/jsx.ts b/packages/runtime-dom/src/jsx.ts\nindex 3d09278..eb43ccb 100644\n--- a/packages/runtime-dom/src/jsx.ts\n+++ b/packages/runtime-dom/src/jsx.ts\n@@ -547,7 +547,7 @@ export interface InputHTMLAttributes extends HTMLAttributes {\n   checked?: Booleanish | any[] | Set<any> | undefined // for IDE v-model multi-checkbox support\n   crossorigin?: string | undefined\n   disabled?: Booleanish | undefined\n-  enterKeyHint?:\n+  enterkeyhint?:\n     | 'enter'\n     | 'done'\n     | 'go'\n@@ -556,6 +556,10 @@ export interface InputHTMLAttributes extends HTMLAttributes {\n     | 'search'\n     | 'send'\n     | undefined\n+  /**\n+   * @deprecated Use `enterkeyhint` instead.\n+   */\n+  enterKeyHint?: InputHTMLAttributes['enterkeyhint']\n   form?: string | undefined\n   formaction?: string | undefined\n   formenctype?: string | undefined"}, {"role": "assistant", "content": "fix(jsx): correct enterkeyhint attribute casing"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-core/__tests__/hmr.spec.ts | 53 +++++++++++++++++++++++++++++\n packages/runtime-core/src/renderer.ts       | 37 ++++++++++++++++----\n 2 files changed, 84 insertions(+), 6 deletions(-)\n\ndiff --git a/packages/runtime-core/__tests__/hmr.spec.ts b/packages/runtime-core/__tests__/hmr.spec.ts\nindex 991cc0e..9e92ed2 100644\n--- a/packages/runtime-core/__tests__/hmr.spec.ts\n+++ b/packages/runtime-core/__tests__/hmr.spec.ts\n@@ -1040,4 +1040,57 @@ describe('hot module replacement', () => {\n \n     expect(serializeInner(root)).toBe('<div>bar</div>')\n   })\n+\n+  // #14127\n+  test('update cached text nodes', async () => {\n+    const root = nodeOps.createElement('div')\n+    const appId = 'test-cached-text-nodes'\n+    const App: ComponentOptions = {\n+      __hmrId: appId,\n+      data() {\n+        return {\n+          count: 0,\n+        }\n+      },\n+      render: compileToFunction(\n+        `{{count}}\n+        <button @click=\"count++\">++</button> \n+        static text`,\n+      ),\n+    }\n+    createRecord(appId, App)\n+    render(h(App), root)\n+    expect(serializeInner(root)).toBe(`0 <button>++</button> static text`)\n+\n+    // trigger count update\n+    triggerEvent((root as any).children[2], 'click')\n+    await nextTick()\n+    expect(serializeInner(root)).toBe(`1 <button>++</button> static text`)\n+\n+    // trigger HMR update\n+    rerender(\n+      appId,\n+      compileToFunction(\n+        `{{count}}\n+        <button @click=\"count++\">++</button> \n+        static text updated`,\n+      ),\n+    )\n+    expect(serializeInner(root)).toBe(\n+      `1 <button>++</button> static text updated`,\n+    )\n+\n+    // trigger HMR update again\n+    rerender(\n+      appId,\n+      compileToFunction(\n+        `{{count}}\n+        <button @click=\"count++\">++</button> \n+        static text updated2`,\n+      ),\n+    )\n+    expect(serializeInner(root)).toBe(\n+      `1 <button>++</button> static text updated2`,\n+    )\n+  })\n })\ndiff --git a/packages/runtime-core/src/renderer.ts b/packages/runtime-core/src/renderer.ts\nindex 5aa1289..0aa797c 100644\n--- a/packages/runtime-core/src/renderer.ts\n+++ b/packages/runtime-core/src/renderer.ts\n@@ -500,7 +500,27 @@ function baseCreateRenderer(\n     } else {\n       const el = (n2.el = n1.el!)\n       if (n2.children !== n1.children) {\n-        hostSetText(el, n2.children as string)\n+        // We don't inherit el for cached text nodes in `traverseStaticChildren`\n+        // to avoid retaining detached DOM nodes. However, the text node may be\n+        // changed during HMR. In this case we need to replace the old text node\n+        // with the new one.\n+        if (\n+          __DEV__ &&\n+          isHmrUpdating &&\n+          n2.patchFlag === PatchFlags.CACHED &&\n+          '__elIndex' in n1\n+        ) {\n+          const childNodes = __TEST__\n+            ? container.children\n+            : container.childNodes\n+          const newChild = hostCreateText(n2.children as string)\n+          const oldChild =\n+            childNodes[((n2 as any).__elIndex = (n1 as any).__elIndex)]\n+          hostInsert(newChild, container, oldChild)\n+          hostRemove(oldChild)\n+        } else {\n+          hostSetText(el, n2.children as string)\n+        }\n       }\n     }\n   }\n@@ -2496,12 +2516,17 @@ export function traverseStaticChildren(\n           traverseStaticChildren(c1, c2)\n       }\n       // #6852 also inherit for text nodes\n-      if (\n-        c2.type === Text &&\n+      if (c2.type === Text) {\n         // avoid cached text nodes retaining detached dom nodes\n-        c2.patchFlag !== PatchFlags.CACHED\n-      ) {\n-        c2.el = c1.el\n+        if (c2.patchFlag !== PatchFlags.CACHED) {\n+          c2.el = c1.el\n+        } else {\n+          // cache the child index for HMR updates\n+          ;(c2 as any).__elIndex =\n+            i +\n+            // take fragment start anchor into account\n+            (n1.type === Fragment ? 1 : 0)\n+        }\n       }\n       // #2324 also inherit for comment nodes, but not placeholders (e.g. v-if which\n       // would have received .el during block patch)"}, {"role": "assistant", "content": "fix(runtime-core): update cached text nodes during HMR"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/react-devtools-core/README.md             |  4 +-\n .../src/contentScripts/hookSettingsInjector.js     |  5 ++\n packages/react-devtools-inline/src/backend.js      |  5 ++\n .../src/__tests__/console-test.js                  | 81 ++++++++++++++++++++++\n .../src/__tests__/setupTests.js                    |  1 +\n .../react-devtools-shared/src/backend/types.js     |  1 +\n .../devtools/views/Settings/DebuggingSettings.js   | 47 ++++++++++++-\n .../src/devtools/views/Settings/SettingsShared.css |  5 ++\n packages/react-devtools-shared/src/hook.js         | 31 ++++++---\n 9 files changed, 165 insertions(+), 15 deletions(-)\n\ndiff --git a/packages/react-devtools-core/README.md b/packages/react-devtools-core/README.md\nindex f3487fe..21f4f69 100644\n--- a/packages/react-devtools-core/README.md\n+++ b/packages/react-devtools-core/README.md\n@@ -32,7 +32,7 @@ if (process.env.NODE_ENV !== 'production') {\n #### `Settings`\n | Spec                                                                                                                                                                           | Default value                                                                                                                                                        |\n |--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n-| <pre>{<br>  appendComponentStack: boolean,<br>  breakOnConsoleErrors: boolean,<br>  showInlineWarningsAndErrors: boolean,<br>  hideConsoleLogsInStrictMode: boolean<br>}</pre> | <pre>{<br>  appendComponentStack: true,<br>  breakOnConsoleErrors: false,<br>  showInlineWarningsAndErrors: true,<br>  hideConsoleLogsInStrictMode: false<br>}</pre> |\n+| <pre>{<br>  appendComponentStack: boolean,<br>  breakOnConsoleErrors: boolean,<br>  showInlineWarningsAndErrors: boolean,<br>  hideConsoleLogsInStrictMode: boolean,<br>  disableSecondConsoleLogDimmingInStrictMode: boolean<br>}</pre> | <pre>{<br>  appendComponentStack: true,<br>  breakOnConsoleErrors: false,<br>  showInlineWarningsAndErrors: true,<br>  hideConsoleLogsInStrictMode: false,<br>  disableSecondConsoleLogDimmingInStrictMode: false<br>}</pre> |\n \n ### `connectToDevTools` options\n | Prop                   | Default       | Description                                                                                                               |\n@@ -53,7 +53,7 @@ if (process.env.NODE_ENV !== 'production') {\n | `onSubscribe`       | Function, which receives listener (function, with a single argument) as an argument. Called when backend subscribes to messages from the other end (frontend). |\n | `onUnsubscribe`     | Function, which receives listener (function) as an argument. Called when backend unsubscribes to messages from the other end (frontend).                       |\n | `onMessage`         | Function, which receives 2 arguments: event (string) and payload (any). Called when backend emits a message, which should be sent to the frontend.             |\n-| `onSettingsUpdated` | A callback that will be called when the user updates the settings in the UI. You can use it for persisting user settings.                                      |       \n+| `onSettingsUpdated` | A callback that will be called when the user updates the settings in the UI. You can use it for persisting user settings.                                      |\n \n Unlike `connectToDevTools`, `connectWithCustomMessagingProtocol` returns a callback, which can be used for unsubscribing the backend from the global DevTools hook.\n \ndiff --git a/packages/react-devtools-extensions/src/contentScripts/hookSettingsInjector.js b/packages/react-devtools-extensions/src/contentScripts/hookSettingsInjector.js\nindex e26108e..da809f6 100644\n--- a/packages/react-devtools-extensions/src/contentScripts/hookSettingsInjector.js\n+++ b/packages/react-devtools-extensions/src/contentScripts/hookSettingsInjector.js\n@@ -24,6 +24,11 @@ async function messageListener(event: MessageEvent) {\n       if (typeof settings.hideConsoleLogsInStrictMode !== 'boolean') {\n         settings.hideConsoleLogsInStrictMode = false;\n       }\n+      if (\n+        typeof settings.disableSecondConsoleLogDimmingInStrictMode !== 'boolean'\n+      ) {\n+        settings.disableSecondConsoleLogDimmingInStrictMode = false;\n+      }\n \n       window.postMessage({\n         source: 'react-devtools-hook-settings-injector',\ndiff --git a/packages/react-devtools-inline/src/backend.js b/packages/react-devtools-inline/src/backend.js\nindex 3549704..849e103 100644\n--- a/packages/react-devtools-inline/src/backend.js\n+++ b/packages/react-devtools-inline/src/backend.js\n@@ -27,6 +27,7 @@ function startActivation(contentWindow: any, bridge: BackendBridge) {\n       componentFilters,\n       showInlineWarningsAndErrors,\n       hideConsoleLogsInStrictMode,\n+      disableSecondConsoleLogDimmingInStrictMode,\n     } = data;\n \n     contentWindow.__REACT_DEVTOOLS_APPEND_COMPONENT_STACK__ =\n@@ -38,6 +39,8 @@ function startActivation(contentWindow: any, bridge: BackendBridge) {\n       showInlineWarningsAndErrors;\n     contentWindow.__REACT_DEVTOOLS_HIDE_CONSOLE_LOGS_IN_STRICT_MODE__ =\n       hideConsoleLogsInStrictMode;\n+    contentWindow.__REACT_DEVTOOLS_DISABLE_SECOND_CONSOLE_LOG_DIMMING_IN_STRICT_MODE__ =\n+      disableSecondConsoleLogDimmingInStrictMode;\n \n     // TRICKY\n     // The backend entry point may be required in the context of an iframe or the parent window.\n@@ -53,6 +56,8 @@ function startActivation(contentWindow: any, bridge: BackendBridge) {\n         showInlineWarningsAndErrors;\n       window.__REACT_DEVTOOLS_HIDE_CONSOLE_LOGS_IN_STRICT_MODE__ =\n         hideConsoleLogsInStrictMode;\n+      window.__REACT_DEVTOOLS_DISABLE_SECOND_CONSOLE_LOG_DIMMING_IN_STRICT_MODE__ =\n+        disableSecondConsoleLogDimmingInStrictMode;\n     }\n \n     finishActivation(contentWindow, bridge);\ndiff --git a/packages/react-devtools-shared/src/__tests__/console-test.js b/packages/react-devtools-shared/src/__tests__/console-test.js\nindex 00d6d97..c37285e 100644\n--- a/packages/react-devtools-shared/src/__tests__/console-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/console-test.js\n@@ -733,4 +733,85 @@ describe('console', () => {\n         : 'in Child (at **)\\n    in Intermediate (at **)\\n    in Parent (at **)',\n     ]);\n   });\n+\n+  it('should not dim console logs if disableSecondConsoleLogDimmingInStrictMode is enabled', () => {\n+    global.__REACT_DEVTOOLS_GLOBAL_HOOK__.settings.appendComponentStack = false;\n+    global.__REACT_DEVTOOLS_GLOBAL_HOOK__.settings.hideConsoleLogsInStrictMode =\n+      false;\n+    global.__REACT_DEVTOOLS_GLOBAL_HOOK__.settings.disableSecondConsoleLogDimmingInStrictMode =\n+      true;\n+\n+    const container = document.createElement('div');\n+    const root = ReactDOMClient.createRoot(container);\n+\n+    function App() {\n+      console.log('log');\n+      console.warn('warn');\n+      console.error('error');\n+      return <div />;\n+    }\n+\n+    act(() =>\n+      root.render(\n+        <React.StrictMode>\n+          <App />\n+        </React.StrictMode>,\n+      ),\n+    );\n+\n+    // Both logs should be called (double logging)\n+    expect(global.consoleLogMock).toHaveBeenCalledTimes(2);\n+    expect(global.consoleWarnMock).toHaveBeenCalledTimes(2);\n+    expect(global.consoleErrorMock).toHaveBeenCalledTimes(2);\n+\n+    // The second log should NOT have dimming (no ANSI codes)\n+    expect(global.consoleLogMock.mock.calls[1]).toEqual(['log']);\n+    expect(global.consoleWarnMock.mock.calls[1]).toEqual(['warn']);\n+    expect(global.consoleErrorMock.mock.calls[1]).toEqual(['error']);\n+  });\n+\n+  it('should dim console logs if disableSecondConsoleLogDimmingInStrictMode is disabled', () => {\n+    global.__REACT_DEVTOOLS_GLOBAL_HOOK__.settings.appendComponentStack = false;\n+    global.__REACT_DEVTOOLS_GLOBAL_HOOK__.settings.hideConsoleLogsInStrictMode =\n+      false;\n+    global.__REACT_DEVTOOLS_GLOBAL_HOOK__.settings.disableSecondConsoleLogDimmingInStrictMode =\n+      false;\n+\n+    const container = document.createElement('div');\n+    const root = ReactDOMClient.createRoot(container);\n+\n+    function App() {\n+      console.log('log');\n+      console.warn('warn');\n+      console.error('error');\n+      return <div />;\n+    }\n+\n+    act(() =>\n+      root.render(\n+        <React.StrictMode>\n+          <App />\n+        </React.StrictMode>,\n+      ),\n+    );\n+\n+    // Both logs should be called (double logging)\n+    expect(global.consoleLogMock).toHaveBeenCalledTimes(2);\n+    expect(global.consoleWarnMock).toHaveBeenCalledTimes(2);\n+    expect(global.consoleErrorMock).toHaveBeenCalledTimes(2);\n+\n+    // The second log should have dimming (ANSI codes present)\n+    expect(global.consoleLogMock.mock.calls[1]).toEqual([\n+      '\\x1b[2;38;2;124;124;124m%s\\x1b[0m',\n+      'log',\n+    ]);\n+    expect(global.consoleWarnMock.mock.calls[1]).toEqual([\n+      '\\x1b[2;38;2;124;124;124m%s\\x1b[0m',\n+      'warn',\n+    ]);\n+    expect(global.consoleErrorMock.mock.calls[1]).toEqual([\n+      '\\x1b[2;38;2;124;124;124m%s\\x1b[0m',\n+      'error',\n+    ]);\n+  });\n });\ndiff --git a/packages/react-devtools-shared/src/__tests__/setupTests.js b/packages/react-devtools-shared/src/__tests__/setupTests.js\nindex aad3fbc..6efcefe 100644\n--- a/packages/react-devtools-shared/src/__tests__/setupTests.js\n+++ b/packages/react-devtools-shared/src/__tests__/setupTests.js\n@@ -248,6 +248,7 @@ beforeEach(() => {\n     breakOnConsoleErrors: false,\n     showInlineWarningsAndErrors: true,\n     hideConsoleLogsInStrictMode: false,\n+    disableSecondConsoleLogDimmingInStrictMode: false,\n   });\n \n   const bridgeListeners = [];\ndiff --git a/packages/react-devtools-shared/src/backend/types.js b/packages/react-devtools-shared/src/backend/types.js\nindex 67d6a5f..00c6635 100644\n--- a/packages/react-devtools-shared/src/backend/types.js\n+++ b/packages/react-devtools-shared/src/backend/types.js\n@@ -597,4 +597,5 @@ export type DevToolsHookSettings = {\n   breakOnConsoleErrors: boolean,\n   showInlineWarningsAndErrors: boolean,\n   hideConsoleLogsInStrictMode: boolean,\n+  disableSecondConsoleLogDimmingInStrictMode: boolean,\n };\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Settings/DebuggingSettings.js b/packages/react-devtools-shared/src/devtools/views/Settings/DebuggingSettings.js\nindex 5dfce3a..34b08c5 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Settings/DebuggingSettings.js\n+++ b/packages/react-devtools-shared/src/devtools/views/Settings/DebuggingSettings.js\n@@ -36,6 +36,10 @@ export default function DebuggingSettings({\n     useState(usedHookSettings.hideConsoleLogsInStrictMode);\n   const [showInlineWarningsAndErrors, setShowInlineWarningsAndErrors] =\n     useState(usedHookSettings.showInlineWarningsAndErrors);\n+  const [\n+    disableSecondConsoleLogDimmingInStrictMode,\n+    setDisableSecondConsoleLogDimmingInStrictMode,\n+  ] = useState(usedHookSettings.disableSecondConsoleLogDimmingInStrictMode);\n \n   useEffect(() => {\n     store.setShouldShowWarningsAndErrors(showInlineWarningsAndErrors);\n@@ -47,6 +51,7 @@ export default function DebuggingSettings({\n       breakOnConsoleErrors,\n       showInlineWarningsAndErrors,\n       hideConsoleLogsInStrictMode,\n+      disableSecondConsoleLogDimmingInStrictMode,\n     });\n   }, [\n     store,\n@@ -54,6 +59,7 @@ export default function DebuggingSettings({\n     breakOnConsoleErrors,\n     showInlineWarningsAndErrors,\n     hideConsoleLogsInStrictMode,\n+    disableSecondConsoleLogDimmingInStrictMode,\n   ]);\n \n   return (\n@@ -105,12 +111,49 @@ export default function DebuggingSettings({\n           <input\n             type=\"checkbox\"\n             checked={hideConsoleLogsInStrictMode}\n+            onChange={({currentTarget}) => {\n+              setHideConsoleLogsInStrictMode(currentTarget.checked);\n+              if (currentTarget.checked) {\n+                setDisableSecondConsoleLogDimmingInStrictMode(false);\n+              }\n+            }}\n+            className={styles.SettingRowCheckbox}\n+          />\n+          Hide logs during additional invocations in&nbsp;\n+          <a\n+            className={styles.StrictModeLink}\n+            target=\"_blank\"\n+            rel=\"noopener noreferrer\"\n+            href=\"https://react.dev/reference/react/StrictMode\">\n+            Strict Mode\n+          </a>\n+        </label>\n+      </div>\n+\n+      <div\n+        className={\n+          hideConsoleLogsInStrictMode\n+            ? `${styles.SettingDisabled} ${styles.SettingWrapper}`\n+            : styles.SettingWrapper\n+        }>\n+        <label\n+          className={\n+            hideConsoleLogsInStrictMode\n+              ? `${styles.SettingDisabled} ${styles.SettingRow}`\n+              : styles.SettingRow\n+          }>\n+          <input\n+            type=\"checkbox\"\n+            checked={disableSecondConsoleLogDimmingInStrictMode}\n+            disabled={hideConsoleLogsInStrictMode}\n             onChange={({currentTarget}) =>\n-              setHideConsoleLogsInStrictMode(currentTarget.checked)\n+              setDisableSecondConsoleLogDimmingInStrictMode(\n+                currentTarget.checked,\n+              )\n             }\n             className={styles.SettingRowCheckbox}\n           />\n-          Hide logs during additional invocations in&nbsp;\n+          Disable log dimming during additional invocations in&nbsp;\n           <a\n             className={styles.StrictModeLink}\n             target=\"_blank\"\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Settings/SettingsShared.css b/packages/react-devtools-shared/src/devtools/views/Settings/SettingsShared.css\nindex 41cd23c..71c5332 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Settings/SettingsShared.css\n+++ b/packages/react-devtools-shared/src/devtools/views/Settings/SettingsShared.css\n@@ -26,6 +26,11 @@\n   margin: 0.125rem 0.25rem 0.125rem 0;\n }\n \n+.SettingDisabled {\n+  opacity: 0.5;\n+  cursor: not-allowed;\n+}\n+\n .OptionGroup {\n   display: inline-flex;\n   flex-direction: row;\ndiff --git a/packages/react-devtools-shared/src/hook.js b/packages/react-devtools-shared/src/hook.js\nindex 699d230..97f8230 100644\n--- a/packages/react-devtools-shared/src/hook.js\n+++ b/packages/react-devtools-shared/src/hook.js\n@@ -367,17 +367,22 @@ export function installHook(\n           return;\n         }\n \n-        // Dim the text color of the double logs if we're not hiding them.\n-        // Firefox doesn't support ANSI escape sequences\n-        if (__IS_FIREFOX__) {\n-          originalMethod(\n-            ...formatWithStyles(args, FIREFOX_CONSOLE_DIMMING_COLOR),\n-          );\n+        if (settings.disableSecondConsoleLogDimmingInStrictMode) {\n+          // Don't dim the console logs\n+          originalMethod(...args);\n         } else {\n-          originalMethod(\n-            ANSI_STYLE_DIMMING_TEMPLATE,\n-            ...formatConsoleArguments(...args),\n-          );\n+          // Dim the text color of the double logs if we're not hiding them.\n+          // Firefox doesn't support ANSI escape sequences\n+          if (__IS_FIREFOX__) {\n+            originalMethod(\n+              ...formatWithStyles(args, FIREFOX_CONSOLE_DIMMING_COLOR),\n+            );\n+          } else {\n+            originalMethod(\n+              ANSI_STYLE_DIMMING_TEMPLATE,\n+              ...formatConsoleArguments(...args),\n+            );\n+          }\n         }\n       };\n \n@@ -579,7 +584,10 @@ export function installHook(\n           debugger;\n         }\n \n-        if (isRunningDuringStrictModeInvocation) {\n+        if (\n+          isRunningDuringStrictModeInvocation &&\n+          !settings.disableSecondConsoleLogDimmingInStrictMode\n+        ) {\n           // Dim the text color of the double logs if we're not hiding them.\n           // Firefox doesn't support ANSI escape sequences\n           if (__IS_FIREFOX__) {\n@@ -667,6 +675,7 @@ export function installHook(\n       breakOnConsoleErrors: false,\n       showInlineWarningsAndErrors: true,\n       hideConsoleLogsInStrictMode: false,\n+      disableSecondConsoleLogDimmingInStrictMode: false,\n     };\n     patchConsoleForErrorsAndWarnings();\n   } else {"}, {"role": "assistant", "content": "feat(devtools): add option to disable console log dimming in strict mode"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/tutorial/bigger-applications.md | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/docs/en/docs/tutorial/bigger-applications.md b/docs/en/docs/tutorial/bigger-applications.md\nindex 3cc9d7e..f6cee80 100644\n--- a/docs/en/docs/tutorial/bigger-applications.md\n+++ b/docs/en/docs/tutorial/bigger-applications.md\n@@ -56,7 +56,7 @@ from app.routers import items\n \n The same file structure with comments:\n \n-```\n+```bash\n .\n \u251c\u2500\u2500 app                  # \"app\" is a Python package\n \u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py      # this file makes \"app\" a \"Python package\""}, {"role": "assistant", "content": "docs: fix code block language annotation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-core/__tests__/component.spec.ts | 157 ++++++++++++++++++++++\n packages/runtime-core/src/component.ts            |  16 ++-\n 2 files changed, 167 insertions(+), 6 deletions(-)\n\ndiff --git a/packages/runtime-core/__tests__/component.spec.ts b/packages/runtime-core/__tests__/component.spec.ts\nnew file mode 100644\nindex 0000000..7b29e77\n--- /dev/null\n+++ b/packages/runtime-core/__tests__/component.spec.ts\n@@ -0,0 +1,157 @@\n+import {\n+  type ComponentInternalInstance,\n+  getCurrentInstance,\n+  h,\n+  nodeOps,\n+  render,\n+} from '@vue/runtime-test'\n+import { formatComponentName } from '../src/component'\n+\n+describe('formatComponentName', () => {\n+  test('default name', () => {\n+    let instance: ComponentInternalInstance | null = null\n+    const Comp = {\n+      setup() {\n+        instance = getCurrentInstance()\n+        return () => null\n+      },\n+    }\n+    render(h(Comp), nodeOps.createElement('div'))\n+\n+    expect(formatComponentName(null, Comp)).toBe('Anonymous')\n+    expect(formatComponentName(null, Comp, true)).toBe('App')\n+    expect(formatComponentName(instance, Comp)).toBe('Anonymous')\n+    expect(formatComponentName(instance, Comp, true)).toBe('App')\n+  })\n+\n+  test('name option', () => {\n+    let instance: ComponentInternalInstance | null = null\n+    const Comp = {\n+      name: 'number-input',\n+      setup() {\n+        instance = getCurrentInstance()\n+        return () => null\n+      },\n+    }\n+    render(h(Comp), nodeOps.createElement('div'))\n+\n+    expect(formatComponentName(null, Comp)).toBe('NumberInput')\n+    expect(formatComponentName(instance, Comp, true)).toBe('NumberInput')\n+  })\n+\n+  test('self recursive name', () => {\n+    let instance: ComponentInternalInstance | null = null\n+    const Comp = {\n+      components: {} as any,\n+      setup() {\n+        instance = getCurrentInstance()\n+        return () => null\n+      },\n+    }\n+    Comp.components.ToggleButton = Comp\n+    render(h(Comp), nodeOps.createElement('div'))\n+\n+    expect(formatComponentName(instance, Comp)).toBe('ToggleButton')\n+  })\n+\n+  test('name from parent', () => {\n+    let instance: ComponentInternalInstance | null = null\n+    const Comp = {\n+      setup() {\n+        instance = getCurrentInstance()\n+        return () => null\n+      },\n+    }\n+    const Parent = {\n+      components: {\n+        list_item: Comp,\n+      },\n+      render() {\n+        return h(Comp)\n+      },\n+    }\n+    render(h(Parent), nodeOps.createElement('div'))\n+\n+    expect(formatComponentName(instance, Comp)).toBe('ListItem')\n+  })\n+\n+  test('functional components', () => {\n+    const UserAvatar = () => null\n+    expect(formatComponentName(null, UserAvatar)).toBe('UserAvatar')\n+    UserAvatar.displayName = 'UserPicture'\n+    expect(formatComponentName(null, UserAvatar)).toBe('UserPicture')\n+    expect(formatComponentName(null, () => null)).toBe('Anonymous')\n+  })\n+\n+  test('Name from file', () => {\n+    const Comp = {\n+      __file: './src/locale-dropdown.vue',\n+    }\n+\n+    expect(formatComponentName(null, Comp)).toBe('LocaleDropdown')\n+  })\n+\n+  test('inferred name', () => {\n+    const Comp = {\n+      __name: 'MainSidebar',\n+    }\n+\n+    expect(formatComponentName(null, Comp)).toBe('MainSidebar')\n+  })\n+\n+  test('global component', () => {\n+    let instance: ComponentInternalInstance | null = null\n+    const Comp = {\n+      setup() {\n+        instance = getCurrentInstance()\n+        return () => null\n+      },\n+    }\n+    render(h(Comp), nodeOps.createElement('div'))\n+\n+    instance!.appContext.components.FieldLabel = Comp\n+\n+    expect(formatComponentName(instance, Comp)).toBe('FieldLabel')\n+  })\n+\n+  test('name precedence', () => {\n+    let instance: ComponentInternalInstance | null = null\n+    const Dummy = () => null\n+    const Comp: Record<string, any> = {\n+      components: { Dummy },\n+      setup() {\n+        instance = getCurrentInstance()\n+        return () => null\n+      },\n+    }\n+    const Parent = {\n+      components: { Dummy } as any,\n+      render() {\n+        return h(Comp)\n+      },\n+    }\n+    render(h(Parent), nodeOps.createElement('div'))\n+\n+    expect(formatComponentName(instance, Comp)).toBe('Anonymous')\n+    expect(formatComponentName(instance, Comp, true)).toBe('App')\n+\n+    instance!.appContext.components.CompA = Comp\n+    expect(formatComponentName(instance, Comp)).toBe('CompA')\n+    expect(formatComponentName(instance, Comp, true)).toBe('CompA')\n+\n+    Parent.components.CompB = Comp\n+    expect(formatComponentName(instance, Comp)).toBe('CompB')\n+\n+    Comp.components.CompC = Comp\n+    expect(formatComponentName(instance, Comp)).toBe('CompC')\n+\n+    Comp.__file = './CompD.js'\n+    expect(formatComponentName(instance, Comp)).toBe('CompD')\n+\n+    Comp.__name = 'CompE'\n+    expect(formatComponentName(instance, Comp)).toBe('CompE')\n+\n+    Comp.name = 'CompF'\n+    expect(formatComponentName(instance, Comp)).toBe('CompF')\n+  })\n+})\ndiff --git a/packages/runtime-core/src/component.ts b/packages/runtime-core/src/component.ts\nindex baa673f..4e1aa5e 100644\n--- a/packages/runtime-core/src/component.ts\n+++ b/packages/runtime-core/src/component.ts\n@@ -897,7 +897,7 @@ function setupStatefulComponent(\n         // bail here and wait for re-entry.\n         instance.asyncDep = setupResult\n         if (__DEV__ && !instance.suspense) {\n-          const name = Component.name ?? 'Anonymous'\n+          const name = formatComponentName(instance, Component)\n           warn(\n             `Component <${name}>: setup function returned a promise, but no ` +\n               `<Suspense> boundary was found in the parent component tree. ` +\n@@ -1229,9 +1229,11 @@ export function formatComponentName(\n     }\n   }\n \n-  if (!name && instance && instance.parent) {\n+  if (!name && instance) {\n     // try to infer the name based on reverse resolution\n-    const inferFromRegistry = (registry: Record<string, any> | undefined) => {\n+    const inferFromRegistry = (\n+      registry: Record<string, any> | undefined | null,\n+    ) => {\n       for (const key in registry) {\n         if (registry[key] === Component) {\n           return key\n@@ -1239,10 +1241,12 @@ export function formatComponentName(\n       }\n     }\n     name =\n-      inferFromRegistry(\n-        instance.components ||\n+      inferFromRegistry(instance.components) ||\n+      (instance.parent &&\n+        inferFromRegistry(\n           (instance.parent.type as ComponentOptions).components,\n-      ) || inferFromRegistry(instance.appContext.components)\n+        )) ||\n+      inferFromRegistry(instance.appContext.components)\n   }\n \n   return name ? classify(name) : isRoot ? `App` : `Anonymous`"}, {"role": "assistant", "content": "test(runtime-core): add formatComponentName tests"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .pre-commit-config.yaml | 6 ++++++\n 1 file changed, 6 insertions(+)\n\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex 5da3ccc..d88b70b 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -58,3 +58,9 @@ repos:\n         entry: uv run ./scripts/docs.py ensure-non-translated\n         files: ^docs/(?!en/).*|^scripts/docs\\.py$\n         pass_filenames: false\n+\n+      - id: fix-translations\n+        language: unsupported\n+        name: fix translations\n+        entry: uv run ./scripts/translation_fixer.py fix-pages\n+        files: ^docs/(?!en/).*/docs/.*\\.md$"}, {"role": "assistant", "content": "ci: add fix-translations pre-commit hook"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/app/core/layout/footer/footer.component.html | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/adev/src/app/core/layout/footer/footer.component.html b/adev/src/app/core/layout/footer/footer.component.html\nindex 2b053543..d49100e9 100644\n--- a/adev/src/app/core/layout/footer/footer.component.html\n+++ b/adev/src/app/core/layout/footer/footer.component.html\n@@ -93,7 +93,7 @@\n       </ul>\n     </div>\n     <div>\n-      <h2>Languages</h2>\n+      <h2>Community translations</h2>\n       <ul>\n         <li>\n           <a href=\"https://angular.cn/\" title=\"\u7b80\u4f53\u4e2d\u6587\u7248\">\u7b80\u4f53\u4e2d\u6587\u7248</a>"}, {"role": "assistant", "content": "docs: change language section to \"community translations\""}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/package.json                                   |  2 +-\n .../src/app/editor/terminal/interactive-terminal.ts | 15 +++++++++++++--\n .../app/editor/terminal/terminal-handler.service.ts | 21 ++++++++++++++++-----\n pnpm-lock.yaml                                      | 10 +++++-----\n 4 files changed, 35 insertions(+), 13 deletions(-)\n\ndiff --git a/adev/package.json b/adev/package.json\nindex 6d977a33..39788126 100644\n--- a/adev/package.json\n+++ b/adev/package.json\n@@ -48,7 +48,7 @@\n     \"@typescript/vfs\": \"1.6.2\",\n     \"@webcontainer/api\": \"1.6.1\",\n     \"@xterm/addon-fit\": \"0.11.0\",\n-    \"@xterm/xterm\": \"5.5.0\",\n+    \"@xterm/xterm\": \"6.0.0\",\n     \"algoliasearch\": \"5.46.2\",\n     \"angular-split\": \"20.0.0\",\n     \"crelt\": \"1.0.6\",\ndiff --git a/adev/src/app/editor/terminal/interactive-terminal.ts b/adev/src/app/editor/terminal/interactive-terminal.ts\nindex 33ed288c..cc95de50 100644\n--- a/adev/src/app/editor/terminal/interactive-terminal.ts\n+++ b/adev/src/app/editor/terminal/interactive-terminal.ts\n@@ -7,7 +7,7 @@\n  */\n \n import {Subject} from 'rxjs';\n-import {Terminal} from '@xterm/xterm';\n+import {Terminal, ITerminalOptions, ITerminalInitOnlyOptions} from '@xterm/xterm';\n \n import {CommandValidator} from './command-validator.service';\n \n@@ -21,6 +21,16 @@ export const ALLOWED_KEYS: Array<KeyboardEvent['key']> = [\n   'ArrowDown',\n ];\n \n+/** Set of defaults to use for all terminal instances in adev. */\n+export const adevTerminalDefaultOptions: ITerminalOptions = {\n+  convertEol: true,\n+  theme: {\n+    background: '#00000000',\n+  },\n+  fontFamily: 'courier-new, courier, monospace',\n+  fontSize: 15,\n+};\n+\n export class InteractiveTerminal extends Terminal {\n   private readonly breakProcess = new Subject<void>();\n \n@@ -28,10 +38,11 @@ export class InteractiveTerminal extends Terminal {\n   breakProcess$ = this.breakProcess.asObservable();\n \n   constructor(\n+    options: ITerminalOptions & ITerminalInitOnlyOptions,\n     readonly window: Window,\n     readonly commandValidator: CommandValidator,\n   ) {\n-    super({convertEol: true, disableStdin: false});\n+    super(options);\n \n     // bypass command validation if sudo=true is present in the query string\n     if (!this.window.location.search.includes('sudo=true')) {\ndiff --git a/adev/src/app/editor/terminal/terminal-handler.service.ts b/adev/src/app/editor/terminal/terminal-handler.service.ts\nindex 2ae13380..9bdb8dac 100644\n--- a/adev/src/app/editor/terminal/terminal-handler.service.ts\n+++ b/adev/src/app/editor/terminal/terminal-handler.service.ts\n@@ -9,7 +9,7 @@\n import {computed, inject, Injectable, signal, Signal, untracked} from '@angular/core';\n import {Terminal} from '@xterm/xterm';\n import {FitAddon} from '@xterm/addon-fit';\n-import {InteractiveTerminal} from './interactive-terminal';\n+import {InteractiveTerminal, adevTerminalDefaultOptions} from './interactive-terminal';\n import {WINDOW} from '@angular/docs';\n import {CommandValidator} from './command-validator.service';\n \n@@ -28,11 +28,18 @@ export class TerminalHandler {\n     // Because colors are parsed\n     // See https://github.com/xtermjs/xterm.js/blob/854e2736f66ca3e5d3ab5a7b65bf3fd6fba8b707/src/browser/services/ThemeService.ts#L125\n     [TerminalType.READONLY]: signal({\n-      instance: new Terminal({convertEol: true, disableStdin: true}),\n+      instance: new Terminal({\n+        ...adevTerminalDefaultOptions,\n+        disableStdin: true,\n+      }),\n       fitAddon: new FitAddon(),\n     }),\n     [TerminalType.INTERACTIVE]: signal({\n-      instance: new InteractiveTerminal(this.window, this.commandValidator),\n+      instance: new InteractiveTerminal(\n+        adevTerminalDefaultOptions,\n+        this.window,\n+        this.commandValidator,\n+      ),\n       fitAddon: new FitAddon(),\n     }),\n   };\n@@ -59,10 +66,14 @@ export class TerminalHandler {\n       instance.dispose();\n       fitAddon = new FitAddon();\n       if (type === TerminalType.READONLY) {\n-        instance = new Terminal({convertEol: true, disableStdin: true});\n+        instance = new Terminal({...adevTerminalDefaultOptions, disableStdin: true});\n         this.terminals[type].set({instance, fitAddon});\n       } else {\n-        const newInstance = new InteractiveTerminal(this.window, this.commandValidator);\n+        const newInstance = new InteractiveTerminal(\n+          adevTerminalDefaultOptions,\n+          this.window,\n+          this.commandValidator,\n+        );\n         instance = newInstance;\n         this.terminals[type].set({instance: newInstance, fitAddon});\n       }\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 9aa0bc63..b092da8a 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -609,8 +609,8 @@ importers:\n         specifier: 0.11.0\n         version: 0.11.0\n       '@xterm/xterm':\n-        specifier: 5.5.0\n-        version: 5.5.0\n+        specifier: 6.0.0\n+        version: 6.0.0\n       algoliasearch:\n         specifier: 5.46.2\n         version: 5.46.2\n@@ -5770,8 +5770,8 @@ packages:\n   '@xterm/addon-fit@0.11.0':\n     resolution: {integrity: sha512-jYcgT6xtVYhnhgxh3QgYDnnNMYTcf8ElbxxFzX0IZo+vabQqSPAjC3c1wJrKB5E19VwQei89QCiZZP86DCPF7g==}\n \n-  '@xterm/xterm@5.5.0':\n-    resolution: {integrity: sha512-hqJHYaQb5OptNunnyAnkHyM8aCjZ1MEIDTQu1iIbbTD/xops91NB5yq1ZK/dC2JDbVWtF23zUtl9JE2NqwT87A==}\n+  '@xterm/xterm@6.0.0':\n+    resolution: {integrity: sha512-TQwDdQGtwwDt+2cgKDLn0IRaSxYu1tSUjgKarSDkUM0ZNiSRXFpjxEsvc/Zgc5kq5omJ+V0a8/kIM2WD3sMOYg==}\n \n   '@xtuc/ieee754@1.2.0':\n     resolution: {integrity: sha512-DX8nKgqcGwsc0eJSqYt5lwP4DH5FlHnmuWWBRy7X0NcaGR0ZtuyeESgMwTYVEtxmsNGY+qit4QYT/MIYTOTPeA==}\n@@ -18723,7 +18723,7 @@ snapshots:\n \n   '@xterm/addon-fit@0.11.0': {}\n \n-  '@xterm/xterm@5.5.0': {}\n+  '@xterm/xterm@6.0.0': {}\n \n   '@xtuc/ieee754@1.2.0': {}\n "}, {"role": "assistant", "content": "build(docs-infra): Update dependency @xterm/xterm to v6"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../__tests__/transforms/vModel.spec.ts            | 17 +++++\n packages/compiler-core/src/errors.ts               |  2 +\n packages/compiler-core/src/transforms/vModel.ts    |  9 +++\n packages/compiler-dom/src/errors.ts                |  2 +-\n .../__snapshots__/compileScript.spec.ts.snap       | 38 ++++++++++\n .../compiler-sfc/__tests__/compileScript.spec.ts   | 81 ++++++++++++++++++++\n packages/compiler-sfc/src/compileScript.ts         | 54 +++++++++++++-\n .../compiler-sfc/src/script/importUsageCheck.ts    | 87 +++++++++++++++++-----\n 8 files changed, 269 insertions(+), 21 deletions(-)\n\ndiff --git a/packages/compiler-core/__tests__/transforms/vModel.spec.ts b/packages/compiler-core/__tests__/transforms/vModel.spec.ts\nindex 82dd490..1f27bad 100644\n--- a/packages/compiler-core/__tests__/transforms/vModel.spec.ts\n+++ b/packages/compiler-core/__tests__/transforms/vModel.spec.ts\n@@ -582,5 +582,22 @@ describe('compiler: transform v-model', () => {\n         }),\n       )\n     })\n+\n+    test('used on const binding', () => {\n+      const onError = vi.fn()\n+      parseWithVModel('<div v-model=\"c\" />', {\n+        onError,\n+        bindingMetadata: {\n+          c: BindingTypes.LITERAL_CONST,\n+        },\n+      })\n+\n+      expect(onError).toHaveBeenCalledTimes(1)\n+      expect(onError).toHaveBeenCalledWith(\n+        expect.objectContaining({\n+          code: ErrorCodes.X_V_MODEL_ON_CONST,\n+        }),\n+      )\n+    })\n   })\n })\ndiff --git a/packages/compiler-core/src/errors.ts b/packages/compiler-core/src/errors.ts\nindex 58e113a..ea8e8f2 100644\n--- a/packages/compiler-core/src/errors.ts\n+++ b/packages/compiler-core/src/errors.ts\n@@ -88,6 +88,7 @@ export enum ErrorCodes {\n   X_V_MODEL_MALFORMED_EXPRESSION,\n   X_V_MODEL_ON_SCOPE_VARIABLE,\n   X_V_MODEL_ON_PROPS,\n+  X_V_MODEL_ON_CONST,\n   X_INVALID_EXPRESSION,\n   X_KEEP_ALIVE_INVALID_CHILDREN,\n \n@@ -176,6 +177,7 @@ export const errorMessages: Record<ErrorCodes, string> = {\n   [ErrorCodes.X_V_MODEL_MALFORMED_EXPRESSION]: `v-model value must be a valid JavaScript member expression.`,\n   [ErrorCodes.X_V_MODEL_ON_SCOPE_VARIABLE]: `v-model cannot be used on v-for or v-slot scope variables because they are not writable.`,\n   [ErrorCodes.X_V_MODEL_ON_PROPS]: `v-model cannot be used on a prop, because local prop bindings are not writable.\\nUse a v-bind binding combined with a v-on listener that emits update:x event instead.`,\n+  [ErrorCodes.X_V_MODEL_ON_CONST]: `v-model cannot be used on a const binding because it is not writable.`,\n   [ErrorCodes.X_INVALID_EXPRESSION]: `Error parsing JavaScript expression: `,\n   [ErrorCodes.X_KEEP_ALIVE_INVALID_CHILDREN]: `<KeepAlive> expects exactly one child component.`,\n   [ErrorCodes.X_VNODE_HOOKS]: `@vnode-* hooks in templates are no longer supported. Use the vue: prefix instead. For example, @vnode-mounted should be changed to @vue:mounted. @vnode-* hooks support has been removed in 3.4.`,\ndiff --git a/packages/compiler-core/src/transforms/vModel.ts b/packages/compiler-core/src/transforms/vModel.ts\nindex 598c1ea..ff722db 100644\n--- a/packages/compiler-core/src/transforms/vModel.ts\n+++ b/packages/compiler-core/src/transforms/vModel.ts\n@@ -48,6 +48,15 @@ export const transformModel: DirectiveTransform = (dir, node, context) => {\n     return createTransformProps()\n   }\n \n+  // const bindings are not writable.\n+  if (\n+    bindingType === BindingTypes.LITERAL_CONST ||\n+    bindingType === BindingTypes.SETUP_CONST\n+  ) {\n+    context.onError(createCompilerError(ErrorCodes.X_V_MODEL_ON_CONST, exp.loc))\n+    return createTransformProps()\n+  }\n+\n   const maybeRef =\n     !__BROWSER__ &&\n     context.inline &&\ndiff --git a/packages/compiler-dom/src/errors.ts b/packages/compiler-dom/src/errors.ts\nindex faf6fb5..f7a5a44 100644\n--- a/packages/compiler-dom/src/errors.ts\n+++ b/packages/compiler-dom/src/errors.ts\n@@ -21,7 +21,7 @@ export function createDOMCompilerError(\n }\n \n export enum DOMErrorCodes {\n-  X_V_HTML_NO_EXPRESSION = 53 /* ErrorCodes.__EXTEND_POINT__ */,\n+  X_V_HTML_NO_EXPRESSION = 54 /* ErrorCodes.__EXTEND_POINT__ */,\n   X_V_HTML_WITH_CHILDREN,\n   X_V_TEXT_NO_EXPRESSION,\n   X_V_TEXT_WITH_CHILDREN,\ndiff --git a/packages/compiler-sfc/__tests__/__snapshots__/compileScript.spec.ts.snap b/packages/compiler-sfc/__tests__/__snapshots__/compileScript.spec.ts.snap\nindex 2acac64..795f0ae 100644\n--- a/packages/compiler-sfc/__tests__/__snapshots__/compileScript.spec.ts.snap\n+++ b/packages/compiler-sfc/__tests__/__snapshots__/compileScript.spec.ts.snap\n@@ -639,6 +639,44 @@ return { foo, bar, baz, y, z }\n }\"\n `;\n \n+exports[`SFC compile <script setup> > demote const reactive binding to let when used in v-model (inlineTemplate) 1`] = `\n+\"import { unref as _unref, resolveComponent as _resolveComponent, isRef as _isRef, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n+\n+import { reactive } from 'vue'\n+      \n+export default {\n+  setup(__props) {\n+\n+      let name = reactive({ first: 'john', last: 'doe' })\n+      \n+return (_ctx, _cache) => {\n+  const _component_MyComponent = _resolveComponent(\"MyComponent\")\n+\n+  return (_openBlock(), _createBlock(_component_MyComponent, {\n+    modelValue: _unref(name),\n+    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => (_isRef(name) ? (name).value = $event : name = $event))\n+  }, null, 8 /* PROPS */, [\"modelValue\"]))\n+}\n+}\n+\n+}\"\n+`;\n+\n+exports[`SFC compile <script setup> > demote const reactive binding to let when used in v-model 1`] = `\n+\"import { reactive } from 'vue'\n+      \n+export default {\n+  setup(__props, { expose: __expose }) {\n+  __expose();\n+\n+      let name = reactive({ first: 'john', last: 'doe' })\n+      \n+return { get name() { return name }, set name(v) { name = v }, reactive }\n+}\n+\n+}\"\n+`;\n+\n exports[`SFC compile <script setup> > errors > should allow defineProps/Emit() referencing imported binding 1`] = `\n \"import { bar } from './bar'\n         \ndiff --git a/packages/compiler-sfc/__tests__/compileScript.spec.ts b/packages/compiler-sfc/__tests__/compileScript.spec.ts\nindex b69bbca..5e547f6 100644\n--- a/packages/compiler-sfc/__tests__/compileScript.spec.ts\n+++ b/packages/compiler-sfc/__tests__/compileScript.spec.ts\n@@ -1,3 +1,4 @@\n+import { vi } from 'vitest'\n import { BindingTypes } from '@vue/compiler-core'\n import {\n   assertCode,\n@@ -7,6 +8,15 @@ import {\n } from './utils'\n import { type RawSourceMap, SourceMapConsumer } from 'source-map-js'\n \n+vi.mock('../src/warn', () => ({\n+  warn: vi.fn(),\n+  warnOnce: vi.fn(),\n+}))\n+\n+import { warnOnce } from '../src/warn'\n+\n+const warnOnceMock = vi.mocked(warnOnce)\n+\n describe('SFC compile <script setup>', () => {\n   test('should compile JS syntax', () => {\n     const { content } = compile(`\n@@ -74,6 +84,77 @@ describe('SFC compile <script setup>', () => {\n     assertCode(content)\n   })\n \n+  test('demote const reactive binding to let when used in v-model', () => {\n+    warnOnceMock.mockClear()\n+    const { content, bindings } = compile(`\n+      <script setup>\n+      import { reactive } from 'vue'\n+      const name = reactive({ first: 'john', last: 'doe' })\n+      </script>\n+\n+      <template>\n+        <MyComponent v-model=\"name\" />\n+      </template>\n+    `)\n+\n+    expect(content).toMatch(\n+      `let name = reactive({ first: 'john', last: 'doe' })`,\n+    )\n+    expect(bindings!.name).toBe(BindingTypes.SETUP_LET)\n+    expect(warnOnceMock).toHaveBeenCalledTimes(1)\n+    expect(warnOnceMock).toHaveBeenCalledWith(\n+      expect.stringContaining(\n+        '`v-model` cannot update a `const` reactive binding',\n+      ),\n+    )\n+    assertCode(content)\n+  })\n+\n+  test('demote const reactive binding to let when used in v-model (inlineTemplate)', () => {\n+    warnOnceMock.mockClear()\n+    const { content, bindings } = compile(\n+      `\n+      <script setup>\n+      import { reactive } from 'vue'\n+      const name = reactive({ first: 'john', last: 'doe' })\n+      </script>\n+\n+      <template>\n+        <MyComponent v-model=\"name\" />\n+      </template>\n+      `,\n+      { inlineTemplate: true },\n+    )\n+\n+    expect(content).toMatch(\n+      `let name = reactive({ first: 'john', last: 'doe' })`,\n+    )\n+    expect(bindings!.name).toBe(BindingTypes.SETUP_LET)\n+    expect(warnOnceMock).toHaveBeenCalledTimes(1)\n+    expect(warnOnceMock).toHaveBeenCalledWith(\n+      expect.stringContaining(\n+        '`v-model` cannot update a `const` reactive binding',\n+      ),\n+    )\n+    assertCode(content)\n+  })\n+\n+  test('v-model should error on literal const bindings', () => {\n+    expect(() =>\n+      compile(\n+        `\n+        <script setup>\n+        const foo = 1\n+        </script>\n+        <template>\n+          <input v-model=\"foo\" />\n+        </template>\n+        `,\n+        { inlineTemplate: true },\n+      ),\n+    ).toThrow('v-model cannot be used on a const binding')\n+  })\n+\n   describe('<script> and <script setup> co-usage', () => {\n     test('script first', () => {\n       const { content } = compile(`\ndiff --git a/packages/compiler-sfc/src/compileScript.ts b/packages/compiler-sfc/src/compileScript.ts\nindex de7dede..a60aba1 100644\n--- a/packages/compiler-sfc/src/compileScript.ts\n+++ b/packages/compiler-sfc/src/compileScript.ts\n@@ -64,7 +64,10 @@ import {\n   isTS,\n } from './script/utils'\n import { analyzeScriptBindings } from './script/analyzeScriptBindings'\n-import { isImportUsed } from './script/importUsageCheck'\n+import {\n+  isImportUsed,\n+  resolveTemplateVModelIdentifiers,\n+} from './script/importUsageCheck'\n import { processAwait } from './script/topLevelAwait'\n \n export interface SFCScriptCompileOptions {\n@@ -760,6 +763,55 @@ export function compileScript(\n     ctx.bindingMetadata[key] = setupBindings[key]\n   }\n \n+  // #11265, https://github.com/vitejs/rolldown-vite/issues/432\n+  // 6.1 demote `const foo = reactive()` to `let` when used as v-model target.\n+  // In non-inline template compilation, v-model assigns via `$setup.foo = $event`,\n+  // which requires a SETUP_LET binding (getter + setter) to keep script state in sync.\n+  // In inline mode, it generates `foo = $event`, which also requires `let`.\n+  if (sfc.template && !sfc.template.src && sfc.template.ast) {\n+    const vModelIds = resolveTemplateVModelIdentifiers(sfc)\n+    if (vModelIds.size) {\n+      const toDemote = new Set<string>()\n+      for (const id of vModelIds) {\n+        if (setupBindings[id] === BindingTypes.SETUP_REACTIVE_CONST) {\n+          toDemote.add(id)\n+        }\n+      }\n+\n+      if (toDemote.size) {\n+        for (const node of scriptSetupAst.body) {\n+          if (\n+            node.type === 'VariableDeclaration' &&\n+            node.kind === 'const' &&\n+            !node.declare\n+          ) {\n+            const demotedInDecl: string[] = []\n+            for (const decl of node.declarations) {\n+              if (decl.id.type === 'Identifier' && toDemote.has(decl.id.name)) {\n+                demotedInDecl.push(decl.id.name)\n+              }\n+            }\n+            if (demotedInDecl.length) {\n+              ctx.s.overwrite(\n+                node.start! + startOffset,\n+                node.start! + startOffset + 'const'.length,\n+                'let',\n+              )\n+              for (const id of demotedInDecl) {\n+                setupBindings[id] = BindingTypes.SETUP_LET\n+                ctx.bindingMetadata[id] = BindingTypes.SETUP_LET\n+                warnOnce(\n+                  `\\`v-model\\` cannot update a \\`const\\` reactive binding \\`${id}\\`. ` +\n+                    `The compiler has transformed it to \\`let\\` to make the update work.`,\n+                )\n+              }\n+            }\n+          }\n+        }\n+      }\n+    }\n+  }\n+\n   // 7. inject `useCssVars` calls\n   if (\n     sfc.cssVars.length &&\ndiff --git a/packages/compiler-sfc/src/script/importUsageCheck.ts b/packages/compiler-sfc/src/script/importUsageCheck.ts\nindex 22ef37c..9c087b4 100644\n--- a/packages/compiler-sfc/src/script/importUsageCheck.ts\n+++ b/packages/compiler-sfc/src/script/importUsageCheck.ts\n@@ -4,6 +4,7 @@ import {\n   NodeTypes,\n   type SimpleExpressionNode,\n   type TemplateChildNode,\n+  isSimpleIdentifier,\n   parserOptions,\n   walkIdentifiers,\n } from '@vue/compiler-dom'\n@@ -19,16 +20,38 @@ export function isImportUsed(local: string, sfc: SFCDescriptor): boolean {\n   return resolveTemplateUsedIdentifiers(sfc).has(local)\n }\n \n-const templateUsageCheckCache = createCache<Set<string>>()\n+const templateAnalysisCache = createCache<{\n+  usedIds?: Set<string>\n+  vModelIds: Set<string>\n+}>()\n+\n+export function resolveTemplateVModelIdentifiers(\n+  sfc: SFCDescriptor,\n+): Set<string> {\n+  return resolveTemplateAnalysisResult(sfc, false).vModelIds\n+}\n \n function resolveTemplateUsedIdentifiers(sfc: SFCDescriptor): Set<string> {\n+  return resolveTemplateAnalysisResult(sfc).usedIds!\n+}\n+\n+function resolveTemplateAnalysisResult(\n+  sfc: SFCDescriptor,\n+  collectUsedIds = true,\n+): {\n+  usedIds?: Set<string>\n+  vModelIds: Set<string>\n+} {\n   const { content, ast } = sfc.template!\n-  const cached = templateUsageCheckCache.get(content)\n-  if (cached) {\n+  const cached = templateAnalysisCache.get(content)\n+  if (cached && (!collectUsedIds || cached.usedIds)) {\n     return cached\n   }\n \n-  const ids = new Set<string>()\n+  // When `collectUsedIds` is false we skip the expensive identifier extraction\n+  // and only collect `vModelIds`.\n+  const ids = collectUsedIds ? new Set<string>() : undefined\n+  const vModelIds = new Set<string>()\n \n   ast!.children.forEach(walk)\n \n@@ -41,31 +64,56 @@ function resolveTemplateUsedIdentifiers(sfc: SFCDescriptor): Set<string> {\n           !parserOptions.isNativeTag!(tag) &&\n           !parserOptions.isBuiltInComponent!(tag)\n         ) {\n-          ids.add(camelize(tag))\n-          ids.add(capitalize(camelize(tag)))\n+          if (ids) {\n+            ids.add(camelize(tag))\n+            ids.add(capitalize(camelize(tag)))\n+          }\n         }\n         for (let i = 0; i < node.props.length; i++) {\n           const prop = node.props[i]\n           if (prop.type === NodeTypes.DIRECTIVE) {\n-            if (!isBuiltInDirective(prop.name)) {\n-              ids.add(`v${capitalize(camelize(prop.name))}`)\n+            if (ids) {\n+              if (!isBuiltInDirective(prop.name)) {\n+                ids.add(`v${capitalize(camelize(prop.name))}`)\n+              }\n+            }\n+\n+            // collect v-model target identifiers (simple identifiers only)\n+            if (prop.name === 'model') {\n+              const exp = prop.exp\n+              if (exp && exp.type === NodeTypes.SIMPLE_EXPRESSION) {\n+                const expString = exp.content.trim()\n+                if (\n+                  isSimpleIdentifier(expString) &&\n+                  expString !== 'undefined'\n+                ) {\n+                  vModelIds.add(expString)\n+                }\n+              }\n             }\n \n             // process dynamic directive arguments\n-            if (prop.arg && !(prop.arg as SimpleExpressionNode).isStatic) {\n+            if (\n+              ids &&\n+              prop.arg &&\n+              !(prop.arg as SimpleExpressionNode).isStatic\n+            ) {\n               extractIdentifiers(ids, prop.arg)\n             }\n \n-            if (prop.name === 'for') {\n-              extractIdentifiers(ids, prop.forParseResult!.source)\n-            } else if (prop.exp) {\n-              extractIdentifiers(ids, prop.exp)\n-            } else if (prop.name === 'bind' && !prop.exp) {\n-              // v-bind shorthand name as identifier\n-              ids.add(camelize((prop.arg as SimpleExpressionNode).content))\n+            if (ids) {\n+              if (prop.name === 'for') {\n+                extractIdentifiers(ids, prop.forParseResult!.source)\n+              } else if (prop.exp) {\n+                extractIdentifiers(ids, prop.exp)\n+              } else if (prop.name === 'bind' && !prop.exp) {\n+                // v-bind shorthand name as identifier\n+                ids.add(camelize((prop.arg as SimpleExpressionNode).content))\n+              }\n             }\n           }\n           if (\n+            ids &&\n             prop.type === NodeTypes.ATTRIBUTE &&\n             prop.name === 'ref' &&\n             prop.value?.content\n@@ -76,13 +124,14 @@ function resolveTemplateUsedIdentifiers(sfc: SFCDescriptor): Set<string> {\n         node.children.forEach(walk)\n         break\n       case NodeTypes.INTERPOLATION:\n-        extractIdentifiers(ids, node.content)\n+        if (ids) extractIdentifiers(ids, node.content)\n         break\n     }\n   }\n \n-  templateUsageCheckCache.set(content, ids)\n-  return ids\n+  const result = { usedIds: ids, vModelIds }\n+  templateAnalysisCache.set(content, result)\n+  return result\n }\n \n function extractIdentifiers(ids: Set<string>, node: ExpressionNode) {"}, {"role": "assistant", "content": "fix(compiler-sfc): handle v-model on const reactive bindings"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/backend/utils/parseStackTrace.js           | 60 +++++++++++++++++-----\n 1 file changed, 47 insertions(+), 13 deletions(-)\n\ndiff --git a/packages/react-devtools-shared/src/backend/utils/parseStackTrace.js b/packages/react-devtools-shared/src/backend/utils/parseStackTrace.js\nindex 300bfbe..e18c2d7 100644\n--- a/packages/react-devtools-shared/src/backend/utils/parseStackTrace.js\n+++ b/packages/react-devtools-shared/src/backend/utils/parseStackTrace.js\n@@ -154,41 +154,73 @@ function collectStackTrace(\n   // We mirror how V8 serializes stack frames and how we later parse them.\n   for (let i = framesToSkip; i < structuredStackTrace.length; i++) {\n     const callSite = structuredStackTrace[i];\n-    let name = callSite.getFunctionName() || '<anonymous>';\n+    let name =\n+      // $FlowFixMe[method-unbinding]\n+      typeof callSite.getFunctionName === 'function'\n+        ? callSite.getFunctionName() || '<anonymous>'\n+        : '';\n     if (\n       name.includes('react_stack_bottom_frame') ||\n       name.includes('react-stack-bottom-frame')\n     ) {\n       // Skip everything after the bottom frame since it'll be internals.\n       break;\n-    } else if (callSite.isNative()) {\n-      // $FlowFixMe[prop-missing]\n-      const isAsync = callSite.isAsync();\n+      // $FlowFixMe[method-unbinding]\n+    } else if (typeof callSite.isNative === 'function' && callSite.isNative()) {\n+      const isAsync =\n+        // $FlowFixMe[prop-missing]\n+        // $FlowFixMe[incompatible-use]\n+        typeof callSite.isAsync === 'function' && callSite.isAsync();\n       result.push([name, '', 0, 0, 0, 0, isAsync]);\n     } else {\n       // We encode complex function calls as if they're part of the function\n       // name since we cannot simulate the complex ones and they look the same\n       // as function names in UIs on the client as well as stacks.\n-      if (callSite.isConstructor()) {\n+      if (\n+        // $FlowFixMe[method-unbinding]\n+        typeof callSite.isConstructor === 'function' &&\n+        callSite.isConstructor()\n+      ) {\n         name = 'new ' + name;\n-      } else if (!callSite.isToplevel()) {\n+      } else if (\n+        // $FlowFixMe[method-unbinding]\n+        typeof callSite.isToplevel === 'function' &&\n+        !callSite.isToplevel()\n+      ) {\n         name = getMethodCallName(callSite);\n       }\n       if (name === '<anonymous>') {\n         name = '';\n       }\n-      let filename = callSite.getScriptNameOrSourceURL() || '<anonymous>';\n+      let filename =\n+        // $FlowFixMe[method-unbinding]\n+        typeof callSite.getScriptNameOrSourceURL === 'function'\n+          ? callSite.getScriptNameOrSourceURL() || '<anonymous>'\n+          : '';\n       if (filename === '<anonymous>') {\n         filename = '';\n-        if (callSite.isEval()) {\n-          const origin = callSite.getEvalOrigin();\n+        // $FlowFixMe[method-unbinding]\n+        if (typeof callSite.isEval === 'function' && callSite.isEval()) {\n+          const origin =\n+            // $FlowFixMe[method-unbinding]\n+            typeof callSite.getEvalOrigin === 'function'\n+              ? callSite.getEvalOrigin()\n+              : null;\n           if (origin) {\n             filename = origin.toString() + ', <anonymous>';\n           }\n         }\n       }\n-      const line = callSite.getLineNumber() || 0;\n-      const col = callSite.getColumnNumber() || 0;\n+      const line =\n+        // $FlowFixMe[method-unbinding]\n+        (typeof callSite.getLineNumber === 'function' &&\n+          callSite.getLineNumber()) ||\n+        0;\n+      const col =\n+        // $FlowFixMe[method-unbinding]\n+        (typeof callSite.getColumnNumber === 'function' &&\n+          callSite.getColumnNumber()) ||\n+        0;\n       const enclosingLine: number =\n         // $FlowFixMe[prop-missing]\n         typeof callSite.getEnclosingLineNumber === 'function'\n@@ -199,8 +231,10 @@ function collectStackTrace(\n         typeof callSite.getEnclosingColumnNumber === 'function'\n           ? (callSite: any).getEnclosingColumnNumber() || 0\n           : 0;\n-      // $FlowFixMe[prop-missing]\n-      const isAsync = callSite.isAsync();\n+      const isAsync =\n+        // $FlowFixMe[prop-missing]\n+        // $FlowFixMe[incompatible-use]\n+        typeof callSite.isAsync === 'function' && callSite.isAsync();\n       result.push([\n         name,\n         filename,"}, {"role": "assistant", "content": "fix: add defensive checks for callSite methods in stack trace parsing"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/simd/archsimd/_gen/simdgen/gen_simdTypes.go |  97 ++++++++++++++++++-\n src/simd/archsimd/_gen/simdgen/xed.go           | 121 +++++++++++++++---------\n src/simd/archsimd/cpu.go                        |  38 ++++++--\n src/simd/archsimd/ops_amd64.go                  |  12 +--\n 4 files changed, 205 insertions(+), 63 deletions(-)\n\ndiff --git a/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go b/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\nindex dd3a75eb..4f1c70e2 100644\n--- a/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\n+++ b/src/simd/archsimd/_gen/simdgen/gen_simdTypes.go\n@@ -189,6 +189,7 @@ type X86Features struct {}\n var X86 X86Features\n \n {{range .}}\n+{{$f := .}}\n {{- if eq .Feature \"AVX512\"}}\n // {{.Feature}} returns whether the CPU supports the AVX512F+CD+BW+DQ+VL features.\n //\n@@ -199,11 +200,19 @@ var X86 X86Features\n {{- else -}}\n // {{.Feature}} returns whether the CPU supports the {{.Feature}} feature.\n {{- end}}\n+{{- if ne .ImpliesAll \"\"}}\n+//\n+// If it returns true, then the CPU also supports {{.ImpliesAll}}.\n+{{- end}}\n //\n // {{.Feature}} is defined on all GOARCHes, but will only return true on\n // GOARCH {{.GoArch}}.\n-func (X86Features) {{.Feature}}() bool {\n-\treturn cpu.X86.Has{{.Feature}}\n+func ({{.FeatureVar}}Features) {{.Feature}}() bool {\n+{{- if .Virtual}}\n+\treturn {{range $i, $dep := .Implies}}{{if $i}} && {{end}}cpu.{{$f.FeatureVar}}.Has{{$dep}}{{end}}\n+{{- else}}\n+\treturn cpu.{{.FeatureVar}}.Has{{.Feature}}\n+{{- end}}\n }\n {{end}}\n `\n@@ -591,6 +600,65 @@ func writeSIMDTypes(typeMap simdTypeMap) *bytes.Buffer {\n \treturn buffer\n }\n \n+type goarchFeatures struct {\n+\t// featureVar is the name of the exported feature-check variable for this\n+\t// architecture.\n+\tfeatureVar string\n+\n+\t// features records per-feature information.\n+\tfeatures map[string]featureInfo\n+}\n+\n+type featureInfo struct {\n+\t// Implies is a list of other CPU features that are required for this\n+\t// feature. These are allowed to chain.\n+\t//\n+\t// For example, if the Frob feature lists \"Baz\", then if X.Frob() returns\n+\t// true, it must also be true that the CPU has feature Baz.\n+\tImplies []string\n+\n+\t// Virtual means this feature is not represented directly in internal/cpu,\n+\t// but is instead the logical AND of the features in Implies.\n+\tVirtual bool\n+}\n+\n+// goarchFeatureInfo maps from GOARCH to CPU feature to additional information\n+// about that feature. Not all features need to be in this map.\n+var goarchFeatureInfo = make(map[string]goarchFeatures)\n+\n+func registerFeatureInfo(goArch string, features goarchFeatures) {\n+\tgoarchFeatureInfo[goArch] = features\n+}\n+\n+func featureImplies(goarch string, base string) string {\n+\t// Compute the transitive closure of base.\n+\tvar list []string\n+\tvar visit func(f string)\n+\tvisit = func(f string) {\n+\t\tlist = append(list, f)\n+\t\tfor _, dep := range goarchFeatureInfo[goarch].features[f].Implies {\n+\t\t\tvisit(dep)\n+\t\t}\n+\t}\n+\tvisit(base)\n+\t// Drop base\n+\tlist = list[1:]\n+\t// Put in \"nice\" order\n+\tslices.Reverse(list)\n+\t// Combine into a comment-ready form\n+\tswitch len(list) {\n+\tcase 0:\n+\t\treturn \"\"\n+\tcase 1:\n+\t\treturn list[0]\n+\tcase 2:\n+\t\treturn list[0] + \" and \" + list[1]\n+\tdefault:\n+\t\tlist[len(list)-1] = \"and \" + list[len(list)-1]\n+\t\treturn strings.Join(list, \", \")\n+\t}\n+}\n+\n func writeSIMDFeatures(ops []Operation) *bytes.Buffer {\n \t// Gather all features\n \ttype featureKey struct {\n@@ -606,13 +674,36 @@ func writeSIMDFeatures(ops []Operation) *bytes.Buffer {\n \t\t\tfeatureSet[featureKey{op.GoArch, feature}] = struct{}{}\n \t\t}\n \t}\n-\tfeatures := slices.SortedFunc(maps.Keys(featureSet), func(a, b featureKey) int {\n+\tfeatureKeys := slices.SortedFunc(maps.Keys(featureSet), func(a, b featureKey) int {\n \t\tif c := cmp.Compare(a.GoArch, b.GoArch); c != 0 {\n \t\t\treturn c\n \t\t}\n \t\treturn compareNatural(a.Feature, b.Feature)\n \t})\n \n+\t// TODO: internal/cpu doesn't enforce these at all. You can even do\n+\t// GODEBUG=cpu.avx=off and it will happily turn off AVX without turning off\n+\t// AVX2. We need to push these dependencies into it somehow.\n+\ttype feature struct {\n+\t\tfeatureKey\n+\t\tFeatureVar string\n+\t\tVirtual    bool\n+\t\tImplies    []string\n+\t\tImpliesAll string\n+\t}\n+\tvar features []feature\n+\tfor _, k := range featureKeys {\n+\t\tfeatureVar := goarchFeatureInfo[k.GoArch].featureVar\n+\t\tfi := goarchFeatureInfo[k.GoArch].features[k.Feature]\n+\t\tfeatures = append(features, feature{\n+\t\t\tfeatureKey: k,\n+\t\t\tFeatureVar: featureVar,\n+\t\t\tVirtual:    fi.Virtual,\n+\t\t\tImplies:    fi.Implies,\n+\t\t\tImpliesAll: featureImplies(k.GoArch, k.Feature),\n+\t\t})\n+\t}\n+\n \t// If we ever have the same feature name on more than one GOARCH, we'll have\n \t// to be more careful about this.\n \tt := templateOf(simdFeaturesTemplate, \"features\")\ndiff --git a/src/simd/archsimd/_gen/simdgen/xed.go b/src/simd/archsimd/_gen/simdgen/xed.go\nindex 4ba6738e..49bedc9b 100644\n--- a/src/simd/archsimd/_gen/simdgen/xed.go\n+++ b/src/simd/archsimd/_gen/simdgen/xed.go\n@@ -5,7 +5,6 @@\n package main\n \n import (\n-\t\"cmp\"\n \t\"fmt\"\n \t\"log\"\n \t\"maps\"\n@@ -210,16 +209,9 @@ func loadXED(xedPath string) []*unify.Value {\n \t\t\t}\n \t\t\tlog.Printf(\"%d unhandled CPU features for %d instructions (use -v for details)\", len(unknownFeatures), nInst)\n \t\t} else {\n-\t\t\tkeys := slices.SortedFunc(maps.Keys(unknownFeatures), func(a, b cpuFeatureKey) int {\n-\t\t\t\treturn cmp.Or(cmp.Compare(a.Extension, b.Extension),\n-\t\t\t\t\tcmp.Compare(a.ISASet, b.ISASet))\n-\t\t\t})\n+\t\t\tkeys := slices.Sorted(maps.Keys(unknownFeatures))\n \t\t\tfor _, key := range keys {\n-\t\t\t\tif key.ISASet == \"\" || key.ISASet == key.Extension {\n-\t\t\t\t\tlog.Printf(\"unhandled Extension %s\", key.Extension)\n-\t\t\t\t} else {\n-\t\t\t\t\tlog.Printf(\"unhandled Extension %s and ISASet %s\", key.Extension, key.ISASet)\n-\t\t\t\t}\n+\t\t\t\tlog.Printf(\"unhandled ISASet %s\", key)\n \t\t\t\tlog.Printf(\"  opcodes: %s\", slices.Sorted(maps.Keys(unknownFeatures[key])))\n \t\t\t}\n \t\t}\n@@ -763,16 +755,24 @@ func instToUVal1(inst *xeddata.Inst, ops []operand, feature string, variant inst\n // decodeCPUFeature returns the CPU feature name required by inst. These match\n // the names of the \"Has*\" feature checks in the simd package.\n func decodeCPUFeature(inst *xeddata.Inst) (string, bool) {\n-\tkey := cpuFeatureKey{\n-\t\tExtension: inst.Extension,\n-\t\tISASet:    isaSetStrip.ReplaceAllLiteralString(inst.ISASet, \"\"),\n+\tisaSet := inst.ISASet\n+\tif isaSet == \"\" {\n+\t\t// Older instructions don't have an ISA set. Use their \"extension\"\n+\t\t// instead.\n+\t\tisaSet = inst.Extension\n+\t}\n+\t// We require AVX512VL to use AVX512 at all, so strip off the vector length\n+\t// suffixes.\n+\tif strings.HasPrefix(isaSet, \"AVX512\") {\n+\t\tisaSet = isaSetVL.ReplaceAllLiteralString(isaSet, \"\")\n \t}\n-\tfeat, ok := cpuFeatureMap[key]\n+\n+\tfeat, ok := cpuFeatureMap[isaSet]\n \tif !ok {\n-\t\timap := unknownFeatures[key]\n+\t\timap := unknownFeatures[isaSet]\n \t\tif imap == nil {\n \t\t\timap = make(map[string]struct{})\n-\t\t\tunknownFeatures[key] = imap\n+\t\t\tunknownFeatures[isaSet] = imap\n \t\t}\n \t\timap[inst.Opcode()] = struct{}{}\n \t\treturn \"\", false\n@@ -783,45 +783,74 @@ func decodeCPUFeature(inst *xeddata.Inst) (string, bool) {\n \treturn feat, true\n }\n \n-var isaSetStrip = regexp.MustCompile(\"_(128N?|256N?|512)$\")\n-\n-type cpuFeatureKey struct {\n-\tExtension, ISASet string\n-}\n-\n-// cpuFeatureMap maps from XED's \"EXTENSION\" and \"ISA_SET\" to a CPU feature name\n-// that can be used in the SIMD API.\n-var cpuFeatureMap = map[cpuFeatureKey]string{\n-\t{\"SHA\", \"SHA\"}: \"SHA\",\n+var isaSetVL = regexp.MustCompile(\"_(128N?|256N?|512)$\")\n \n-\t{\"AVX\", \"\"}:              \"AVX\",\n-\t{\"AVX_VNNI\", \"AVX_VNNI\"}: \"AVXVNNI\",\n-\t{\"AVX2\", \"\"}:             \"AVX2\",\n-\t{\"AVXAES\", \"\"}:           \"AVX, AES\",\n+// cpuFeatureMap maps from XED's \"ISA_SET\" (or \"EXTENSION\") to a CPU feature\n+// name to expose in the SIMD feature check API.\n+//\n+// See XED's datafiles/*/cpuid.xed.txt for how ISA set names map to CPUID flags.\n+var cpuFeatureMap = map[string]string{\n+\t\"AVX\":      \"AVX\",\n+\t\"AVX_VNNI\": \"AVXVNNI\",\n+\t\"AVX2\":     \"AVX2\",\n+\t\"AVXAES\":   \"AVXAES\",\n+\t\"SHA\":      \"SHA\",\n \n \t// AVX-512 foundational features. We combine all of these into one \"AVX512\" feature.\n-\t{\"AVX512EVEX\", \"AVX512F\"}:  \"AVX512\",\n-\t{\"AVX512EVEX\", \"AVX512CD\"}: \"AVX512\",\n-\t{\"AVX512EVEX\", \"AVX512BW\"}: \"AVX512\",\n-\t{\"AVX512EVEX\", \"AVX512DQ\"}: \"AVX512\",\n-\t// AVX512VL doesn't appear explicitly in the ISASet. I guess it's implied by\n-\t// the vector length suffix.\n+\t\"AVX512F\":  \"AVX512\",\n+\t\"AVX512BW\": \"AVX512\",\n+\t\"AVX512CD\": \"AVX512\",\n+\t\"AVX512DQ\": \"AVX512\",\n+\t// AVX512VL doesn't appear as its own ISASet; instead, the CPUID flag is\n+\t// required by the *_128 and *_256 ISASets. We fold it into \"AVX512\" anyway.\n \n \t// AVX-512 extension features\n-\t{\"AVX512EVEX\", \"AVX512_BITALG\"}:     \"AVX512BITALG\",\n-\t{\"AVX512EVEX\", \"AVX512_GFNI\"}:       \"AVX512GFNI\",\n-\t{\"AVX512EVEX\", \"AVX512_VBMI2\"}:      \"AVX512VBMI2\",\n-\t{\"AVX512EVEX\", \"AVX512_VBMI\"}:       \"AVX512VBMI\",\n-\t{\"AVX512EVEX\", \"AVX512_VNNI\"}:       \"AVX512VNNI\",\n-\t{\"AVX512EVEX\", \"AVX512_VPOPCNTDQ\"}:  \"AVX512VPOPCNTDQ\",\n-\t{\"AVX512EVEX\", \"AVX512_VAES\"}:       \"AVX512VAES\",\n-\t{\"AVX512EVEX\", \"AVX512_VPCLMULQDQ\"}: \"AVX512VPCLMULQDQ\",\n+\t\"AVX512_BITALG\":     \"AVX512BITALG\",\n+\t\"AVX512_GFNI\":       \"AVX512GFNI\",\n+\t\"AVX512_VBMI\":       \"AVX512VBMI\",\n+\t\"AVX512_VBMI2\":      \"AVX512VBMI2\",\n+\t\"AVX512_VNNI\":       \"AVX512VNNI\",\n+\t\"AVX512_VPOPCNTDQ\":  \"AVX512VPOPCNTDQ\",\n+\t\"AVX512_VAES\":       \"AVX512VAES\",\n+\t\"AVX512_VPCLMULQDQ\": \"AVX512VPCLMULQDQ\",\n \n \t// AVX 10.2 (not yet supported)\n-\t{\"AVX512EVEX\", \"AVX10_2_RC\"}: \"ignore\",\n+\t\"AVX10_2_RC\": \"ignore\",\n+}\n+\n+func init() {\n+\t// TODO: In general, Intel doesn't make any guarantees about what flags are\n+\t// set, so this means our feature checks need to ensure these, just to be\n+\t// sure.\n+\tvar features = map[string]featureInfo{\n+\t\t\"AVX2\":   {Implies: []string{\"AVX\"}},\n+\t\t\"AVX512\": {Implies: []string{\"AVX2\"}},\n+\n+\t\t\"AVXAES\": {Virtual: true, Implies: []string{\"AVX\", \"AES\"}},\n+\n+\t\t// AVX-512 subfeatures.\n+\t\t\"AVX512BITALG\":    {Implies: []string{\"AVX512\"}},\n+\t\t\"AVX512GFNI\":      {Implies: []string{\"AVX512\"}},\n+\t\t\"AVX512VBMI\":      {Implies: []string{\"AVX512\"}},\n+\t\t\"AVX512VBMI2\":     {Implies: []string{\"AVX512\"}},\n+\t\t\"AVX512VNNI\":      {Implies: []string{\"AVX512\"}},\n+\t\t\"AVX512VPOPCNTDQ\": {Implies: []string{\"AVX512\"}},\n+\t\t\"AVX512VAES\":      {Implies: []string{\"AVX512\"}},\n+\n+\t\t// AVX-VNNI and AVX-IFMA are \"backports\" of the AVX512-VNNI/IFMA\n+\t\t// instructions to VEX encoding, limited to 256 bit vectors. They're\n+\t\t// intended for lower end CPUs that want to support VNNI/IFMA without\n+\t\t// supporting AVX-512. As such, they're built on AVX2's VEX encoding.\n+\t\t\"AVXVNNI\": {Implies: []string{\"AVX2\"}},\n+\t\t\"AVXIFMA\": {Implies: []string{\"AVX2\"}},\n+\t}\n+\tregisterFeatureInfo(\"amd64\", goarchFeatures{\n+\t\tfeatureVar: \"X86\",\n+\t\tfeatures:   features,\n+\t})\n }\n \n-var unknownFeatures = map[cpuFeatureKey]map[string]struct{}{}\n+var unknownFeatures = map[string]map[string]struct{}{}\n \n // hasOptionalMask returns whether there is an optional mask operand in ops.\n func hasOptionalMask(ops []operand) bool {\ndiff --git a/src/simd/archsimd/cpu.go b/src/simd/archsimd/cpu.go\nindex d0c0ff54..1cd76526 100644\n--- a/src/simd/archsimd/cpu.go\n+++ b/src/simd/archsimd/cpu.go\n@@ -10,14 +10,6 @@ type X86Features struct{}\n \n var X86 X86Features\n \n-// AES returns whether the CPU supports the AES feature.\n-//\n-// AES is defined on all GOARCHes, but will only return true on\n-// GOARCH amd64.\n-func (X86Features) AES() bool {\n-\treturn cpu.X86.HasAES\n-}\n-\n // AVX returns whether the CPU supports the AVX feature.\n //\n // AVX is defined on all GOARCHes, but will only return true on\n@@ -28,6 +20,8 @@ func (X86Features) AVX() bool {\n \n // AVX2 returns whether the CPU supports the AVX2 feature.\n //\n+// If it returns true, then the CPU also supports AVX.\n+//\n // AVX2 is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX2() bool {\n@@ -41,6 +35,8 @@ func (X86Features) AVX2() bool {\n // Nearly every CPU that has shipped with any support for AVX-512 has\n // supported all five of these features.\n //\n+// If it returns true, then the CPU also supports AVX and AVX2.\n+//\n // AVX512 is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX512() bool {\n@@ -49,6 +45,8 @@ func (X86Features) AVX512() bool {\n \n // AVX512BITALG returns whether the CPU supports the AVX512BITALG feature.\n //\n+// If it returns true, then the CPU also supports AVX, AVX2, and AVX512.\n+//\n // AVX512BITALG is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX512BITALG() bool {\n@@ -57,6 +55,8 @@ func (X86Features) AVX512BITALG() bool {\n \n // AVX512GFNI returns whether the CPU supports the AVX512GFNI feature.\n //\n+// If it returns true, then the CPU also supports AVX, AVX2, and AVX512.\n+//\n // AVX512GFNI is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX512GFNI() bool {\n@@ -65,6 +65,8 @@ func (X86Features) AVX512GFNI() bool {\n \n // AVX512VAES returns whether the CPU supports the AVX512VAES feature.\n //\n+// If it returns true, then the CPU also supports AVX, AVX2, and AVX512.\n+//\n // AVX512VAES is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX512VAES() bool {\n@@ -73,6 +75,8 @@ func (X86Features) AVX512VAES() bool {\n \n // AVX512VBMI returns whether the CPU supports the AVX512VBMI feature.\n //\n+// If it returns true, then the CPU also supports AVX, AVX2, and AVX512.\n+//\n // AVX512VBMI is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX512VBMI() bool {\n@@ -81,6 +85,8 @@ func (X86Features) AVX512VBMI() bool {\n \n // AVX512VBMI2 returns whether the CPU supports the AVX512VBMI2 feature.\n //\n+// If it returns true, then the CPU also supports AVX, AVX2, and AVX512.\n+//\n // AVX512VBMI2 is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX512VBMI2() bool {\n@@ -89,6 +95,8 @@ func (X86Features) AVX512VBMI2() bool {\n \n // AVX512VNNI returns whether the CPU supports the AVX512VNNI feature.\n //\n+// If it returns true, then the CPU also supports AVX, AVX2, and AVX512.\n+//\n // AVX512VNNI is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX512VNNI() bool {\n@@ -105,14 +113,28 @@ func (X86Features) AVX512VPCLMULQDQ() bool {\n \n // AVX512VPOPCNTDQ returns whether the CPU supports the AVX512VPOPCNTDQ feature.\n //\n+// If it returns true, then the CPU also supports AVX, AVX2, and AVX512.\n+//\n // AVX512VPOPCNTDQ is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVX512VPOPCNTDQ() bool {\n \treturn cpu.X86.HasAVX512VPOPCNTDQ\n }\n \n+// AVXAES returns whether the CPU supports the AVXAES feature.\n+//\n+// If it returns true, then the CPU also supports AES and AVX.\n+//\n+// AVXAES is defined on all GOARCHes, but will only return true on\n+// GOARCH amd64.\n+func (X86Features) AVXAES() bool {\n+\treturn cpu.X86.HasAVX && cpu.X86.HasAES\n+}\n+\n // AVXVNNI returns whether the CPU supports the AVXVNNI feature.\n //\n+// If it returns true, then the CPU also supports AVX and AVX2.\n+//\n // AVXVNNI is defined on all GOARCHes, but will only return true on\n // GOARCH amd64.\n func (X86Features) AVXVNNI() bool {\ndiff --git a/src/simd/archsimd/ops_amd64.go b/src/simd/archsimd/ops_amd64.go\nindex bb162c4f..d65c7dde 100644\n--- a/src/simd/archsimd/ops_amd64.go\n+++ b/src/simd/archsimd/ops_amd64.go\n@@ -11,7 +11,7 @@ package archsimd\n // y is the chunk of dw array in use.\n // result = AddRoundKey(InvShiftRows(InvSubBytes(x)), y)\n //\n-// Asm: VAESDECLAST, CPU Feature: AVX, AES\n+// Asm: VAESDECLAST, CPU Feature: AVXAES\n func (x Uint8x16) AESDecryptLastRound(y Uint32x4) Uint8x16\n \n // AESDecryptLastRound performs a series of operations in AES cipher algorithm defined in FIPS 197.\n@@ -37,7 +37,7 @@ func (x Uint8x64) AESDecryptLastRound(y Uint32x16) Uint8x64\n // y is the chunk of dw array in use.\n // result = AddRoundKey(InvMixColumns(InvShiftRows(InvSubBytes(x))), y)\n //\n-// Asm: VAESDEC, CPU Feature: AVX, AES\n+// Asm: VAESDEC, CPU Feature: AVXAES\n func (x Uint8x16) AESDecryptOneRound(y Uint32x4) Uint8x16\n \n // AESDecryptOneRound performs a series of operations in AES cipher algorithm defined in FIPS 197.\n@@ -63,7 +63,7 @@ func (x Uint8x64) AESDecryptOneRound(y Uint32x16) Uint8x64\n // y is the chunk of w array in use.\n // result = AddRoundKey((ShiftRows(SubBytes(x))), y)\n //\n-// Asm: VAESENCLAST, CPU Feature: AVX, AES\n+// Asm: VAESENCLAST, CPU Feature: AVXAES\n func (x Uint8x16) AESEncryptLastRound(y Uint32x4) Uint8x16\n \n // AESEncryptLastRound performs a series of operations in AES cipher algorithm defined in FIPS 197.\n@@ -89,7 +89,7 @@ func (x Uint8x64) AESEncryptLastRound(y Uint32x16) Uint8x64\n // y is the chunk of w array in use.\n // result = AddRoundKey(MixColumns(ShiftRows(SubBytes(x))), y)\n //\n-// Asm: VAESENC, CPU Feature: AVX, AES\n+// Asm: VAESENC, CPU Feature: AVXAES\n func (x Uint8x16) AESEncryptOneRound(y Uint32x4) Uint8x16\n \n // AESEncryptOneRound performs a series of operations in AES cipher algorithm defined in FIPS 197.\n@@ -114,7 +114,7 @@ func (x Uint8x64) AESEncryptOneRound(y Uint32x16) Uint8x64\n // x is the chunk of w array in use.\n // result = InvMixColumns(x)\n //\n-// Asm: VAESIMC, CPU Feature: AVX, AES\n+// Asm: VAESIMC, CPU Feature: AVXAES\n func (x Uint32x4) AESInvMixColumns() Uint32x4\n \n /* AESRoundKeyGenAssist */\n@@ -129,7 +129,7 @@ func (x Uint32x4) AESInvMixColumns() Uint32x4\n //\n // rconVal results in better performance when it's a constant, a non-constant value will be translated into a jump table.\n //\n-// Asm: VAESKEYGENASSIST, CPU Feature: AVX, AES\n+// Asm: VAESKEYGENASSIST, CPU Feature: AVXAES\n func (x Uint32x4) AESRoundKeyGenAssist(rconVal uint8) Uint32x4\n \n /* Abs */"}, {"role": "assistant", "content": "refactor(simd): add CPU feature dependency tracking and virtual features"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n package.json   |   2 +-\n pnpm-lock.yaml | 104 +++++++++++++++++++++------------------------------------\n 2 files changed, 39 insertions(+), 67 deletions(-)\n\ndiff --git a/package.json b/package.json\nindex 0c98e2b..4e52e8b 100644\n--- a/package.json\n+++ b/package.json\n@@ -71,7 +71,7 @@\n     \"@rollup/plugin-replace\": \"5.0.4\",\n     \"@swc/core\": \"^1.14.0\",\n     \"@types/hash-sum\": \"^1.0.2\",\n-    \"@types/node\": \"^22.19.0\",\n+    \"@types/node\": \"^24.10.4\",\n     \"@types/semver\": \"^7.7.1\",\n     \"@types/serve-handler\": \"^6.1.4\",\n     \"@vitest/coverage-v8\": \"^3.2.4\",\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex e4548fc..26c8555 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -60,8 +60,8 @@ importers:\n         specifier: ^1.0.2\n         version: 1.0.2\n       '@types/node':\n-        specifier: ^22.19.0\n-        version: 22.19.0\n+        specifier: ^24.10.4\n+        version: 24.10.4\n       '@types/semver':\n         specifier: ^7.7.1\n         version: 7.7.1\n@@ -70,10 +70,10 @@ importers:\n         version: 6.1.4\n       '@vitest/coverage-v8':\n         specifier: ^3.2.4\n-        version: 3.2.4(vitest@3.2.4(@types/node@22.19.0)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))\n+        version: 3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))\n       '@vitest/eslint-plugin':\n         specifier: ^1.4.0\n-        version: 1.4.0(eslint@9.27.0)(typescript@5.6.3)(vitest@3.2.4(@types/node@22.19.0)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))\n+        version: 1.4.0(eslint@9.27.0)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))\n       '@vue/consolidate':\n         specifier: 1.0.0\n         version: 1.0.0\n@@ -175,10 +175,10 @@ importers:\n         version: 8.32.1(eslint@9.27.0)(typescript@5.6.3)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@22.19.0)(sass@1.93.3)\n+        version: 5.4.15(@types/node@24.10.4)(sass@1.93.3)\n       vitest:\n         specifier: ^3.2.4\n-        version: 3.2.4(@types/node@22.19.0)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n+        version: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n \n   packages-private/dts-built-test:\n     dependencies:\n@@ -218,10 +218,10 @@ importers:\n     devDependencies:\n       '@vitejs/plugin-vue':\n         specifier: 'catalog:'\n-        version: 6.0.1(vite@5.4.15(@types/node@22.19.0)(sass@1.93.3))(vue@packages+vue)\n+        version: 6.0.1(vite@5.4.15(@types/node@24.10.4)(sass@1.93.3))(vue@packages+vue)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@22.19.0)(sass@1.93.3)\n+        version: 5.4.15(@types/node@24.10.4)(sass@1.93.3)\n \n   packages-private/template-explorer:\n     dependencies:\n@@ -236,10 +236,10 @@ importers:\n     devDependencies:\n       '@vitejs/plugin-vue':\n         specifier: 'catalog:'\n-        version: 6.0.1(vite@5.4.15(@types/node@22.19.0)(sass@1.93.3))(vue@packages+vue)\n+        version: 6.0.1(vite@5.4.15(@types/node@24.10.4)(sass@1.93.3))(vue@packages+vue)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@22.19.0)(sass@1.93.3)\n+        version: 5.4.15(@types/node@24.10.4)(sass@1.93.3)\n       vue:\n         specifier: workspace:*\n         version: link:../../packages/vue\n@@ -986,35 +986,30 @@ packages:\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm]\n     os: [linux]\n-    libc: [glibc]\n \n   '@parcel/watcher-linux-arm64-glibc@2.4.1':\n     resolution: {integrity: sha512-BJ7mH985OADVLpbrzCLgrJ3TOpiZggE9FMblfO65PlOCdG++xJpKUJ0Aol74ZUIYfb8WsRlUdgrZxKkz3zXWYA==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@parcel/watcher-linux-arm64-musl@2.4.1':\n     resolution: {integrity: sha512-p4Xb7JGq3MLgAfYhslU2SjoV9G0kI0Xry0kuxeG/41UfpjHGOhv7UoUDAz/jb1u2elbhazy4rRBL8PegPJFBhA==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [arm64]\n     os: [linux]\n-    libc: [musl]\n \n   '@parcel/watcher-linux-x64-glibc@2.4.1':\n     resolution: {integrity: sha512-s9O3fByZ/2pyYDPoLM6zt92yu6P4E39a03zvO0qCHOTjxmt3GHRMLuRZEWhWLASTMSrrnVNWdVI/+pUElJBBBg==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [x64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@parcel/watcher-linux-x64-musl@2.4.1':\n     resolution: {integrity: sha512-L2nZTYR1myLNST0O632g0Dx9LyMNHrn6TOt76sYxWLdff3cB22/GZX2UPtJnaqQPdCRoszoY5rcOj4oMTtp5fQ==}\n     engines: {node: '>= 10.0.0'}\n     cpu: [x64]\n     os: [linux]\n-    libc: [musl]\n \n   '@parcel/watcher-win32-arm64@2.4.1':\n     resolution: {integrity: sha512-Uq2BPp5GWhrq/lcuItCHoqxjULU1QYEcyjSO5jqqOK8RNFDBQnenMMx4gAl3v8GiWa59E9+uDM7yZ6LxwUIfRg==}\n@@ -1147,67 +1142,56 @@ packages:\n     resolution: {integrity: sha512-PsNAbcyv9CcecAUagQefwX8fQn9LQ4nZkpDboBOttmyffnInRy8R8dSg6hxxl2Re5QhHBf6FYIDhIj5v982ATQ==}\n     cpu: [arm]\n     os: [linux]\n-    libc: [glibc]\n \n   '@rollup/rollup-linux-arm-musleabihf@4.52.5':\n     resolution: {integrity: sha512-Fw4tysRutyQc/wwkmcyoqFtJhh0u31K+Q6jYjeicsGJJ7bbEq8LwPWV/w0cnzOqR2m694/Af6hpFayLJZkG2VQ==}\n     cpu: [arm]\n     os: [linux]\n-    libc: [musl]\n \n   '@rollup/rollup-linux-arm64-gnu@4.52.5':\n     resolution: {integrity: sha512-a+3wVnAYdQClOTlyapKmyI6BLPAFYs0JM8HRpgYZQO02rMR09ZcV9LbQB+NL6sljzG38869YqThrRnfPMCDtZg==}\n     cpu: [arm64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@rollup/rollup-linux-arm64-musl@4.52.5':\n     resolution: {integrity: sha512-AvttBOMwO9Pcuuf7m9PkC1PUIKsfaAJ4AYhy944qeTJgQOqJYJ9oVl2nYgY7Rk0mkbsuOpCAYSs6wLYB2Xiw0Q==}\n     cpu: [arm64]\n     os: [linux]\n-    libc: [musl]\n \n   '@rollup/rollup-linux-loong64-gnu@4.52.5':\n     resolution: {integrity: sha512-DkDk8pmXQV2wVrF6oq5tONK6UHLz/XcEVow4JTTerdeV1uqPeHxwcg7aFsfnSm9L+OO8WJsWotKM2JJPMWrQtA==}\n     cpu: [loong64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@rollup/rollup-linux-ppc64-gnu@4.52.5':\n     resolution: {integrity: sha512-W/b9ZN/U9+hPQVvlGwjzi+Wy4xdoH2I8EjaCkMvzpI7wJUs8sWJ03Rq96jRnHkSrcHTpQe8h5Tg3ZzUPGauvAw==}\n     cpu: [ppc64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@rollup/rollup-linux-riscv64-gnu@4.52.5':\n     resolution: {integrity: sha512-sjQLr9BW7R/ZiXnQiWPkErNfLMkkWIoCz7YMn27HldKsADEKa5WYdobaa1hmN6slu9oWQbB6/jFpJ+P2IkVrmw==}\n     cpu: [riscv64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@rollup/rollup-linux-riscv64-musl@4.52.5':\n     resolution: {integrity: sha512-hq3jU/kGyjXWTvAh2awn8oHroCbrPm8JqM7RUpKjalIRWWXE01CQOf/tUNWNHjmbMHg/hmNCwc/Pz3k1T/j/Lg==}\n     cpu: [riscv64]\n     os: [linux]\n-    libc: [musl]\n \n   '@rollup/rollup-linux-s390x-gnu@4.52.5':\n     resolution: {integrity: sha512-gn8kHOrku8D4NGHMK1Y7NA7INQTRdVOntt1OCYypZPRt6skGbddska44K8iocdpxHTMMNui5oH4elPH4QOLrFQ==}\n     cpu: [s390x]\n     os: [linux]\n-    libc: [glibc]\n \n   '@rollup/rollup-linux-x64-gnu@4.52.5':\n     resolution: {integrity: sha512-hXGLYpdhiNElzN770+H2nlx+jRog8TyynpTVzdlc6bndktjKWyZyiCsuDAlpd+j+W+WNqfcyAWz9HxxIGfZm1Q==}\n     cpu: [x64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@rollup/rollup-linux-x64-musl@4.52.5':\n     resolution: {integrity: sha512-arCGIcuNKjBoKAXD+y7XomR9gY6Mw7HnFBv5Rw7wQRvwYLR7gBAgV7Mb2QTyjXfTveBNFAtPt46/36vV9STLNg==}\n     cpu: [x64]\n     os: [linux]\n-    libc: [musl]\n \n   '@rollup/rollup-openharmony-arm64@4.52.5':\n     resolution: {integrity: sha512-QoFqB6+/9Rly/RiPjaomPLmR/13cgkIGfA40LHly9zcH1S0bN2HVFYk3a1eAyHQyjs3ZJYlXvIGtcCs5tko9Cw==}\n@@ -1257,28 +1241,24 @@ packages:\n     engines: {node: '>=10'}\n     cpu: [arm64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@swc/core-linux-arm64-musl@1.14.0':\n     resolution: {integrity: sha512-uofpVoPCEUjYIv454ZEZ3sLgMD17nIwlz2z7bsn7rl301Kt/01umFA7MscUovFfAK2IRGck6XB+uulMu6aFhKQ==}\n     engines: {node: '>=10'}\n     cpu: [arm64]\n     os: [linux]\n-    libc: [musl]\n \n   '@swc/core-linux-x64-gnu@1.14.0':\n     resolution: {integrity: sha512-quTTx1Olm05fBfv66DEBuOsOgqdypnZ/1Bh3yGXWY7ANLFeeRpCDZpljD9BSjdsNdPOlwJmEUZXMHtGm3v1TZQ==}\n     engines: {node: '>=10'}\n     cpu: [x64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@swc/core-linux-x64-musl@1.14.0':\n     resolution: {integrity: sha512-caaNAu+aIqT8seLtCf08i8C3/UC5ttQujUjejhMcuS1/LoCKtNiUs4VekJd2UGt+pyuuSrQ6dKl8CbCfWvWeXw==}\n     engines: {node: '>=10'}\n     cpu: [x64]\n     os: [linux]\n-    libc: [musl]\n \n   '@swc/core-win32-arm64-msvc@1.14.0':\n     resolution: {integrity: sha512-EeW3jFlT3YNckJ6V/JnTfGcX7UHGyh6/AiCPopZ1HNaGiXVCKHPpVQZicmtyr/UpqxCXLrTgjHOvyMke7YN26A==}\n@@ -1337,8 +1317,8 @@ packages:\n   '@types/json-schema@7.0.15':\n     resolution: {integrity: sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==}\n \n-  '@types/node@22.19.0':\n-    resolution: {integrity: sha512-xpr/lmLPQEj+TUnHmR+Ab91/glhJvsqcjB+yY0Ix9GO70H6Lb4FHH5GeqdOE5btAx7eIMwuHkp4H2MSkLcqWbA==}\n+  '@types/node@24.10.4':\n+    resolution: {integrity: sha512-vnDVpYPMzs4wunl27jHrfmwojOGKya0xyM3sH+UE5iv5uPS6vX7UIoh6m+vQc5LGBq52HBKPIn/zcSZVzeDEZg==}\n \n   '@types/normalize-package-data@2.4.4':\n     resolution: {integrity: sha512-37i+OaWTh9qeK4LSHPsyRC7NahnGotNuZvjLSgcPzblpHB3rrCJxAOgI5gCdKm7coonsaX1Of0ILiTcnZjbfxA==}\n@@ -1471,49 +1451,41 @@ packages:\n     resolution: {integrity: sha512-jon9M7DKRLGZ9VYSkFMflvNqu9hDtOCEnO2QAryFWgT6o6AXU8du56V7YqnaLKr6rAbZBWYsYpikF226v423QA==}\n     cpu: [arm64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-arm64-musl@1.7.2':\n     resolution: {integrity: sha512-c8Cg4/h+kQ63pL43wBNaVMmOjXI/X62wQmru51qjfTvI7kmCy5uHTJvK/9LrF0G8Jdx8r34d019P1DVJmhXQpA==}\n     cpu: [arm64]\n     os: [linux]\n-    libc: [musl]\n \n   '@unrs/resolver-binding-linux-ppc64-gnu@1.7.2':\n     resolution: {integrity: sha512-A+lcwRFyrjeJmv3JJvhz5NbcCkLQL6Mk16kHTNm6/aGNc4FwPHPE4DR9DwuCvCnVHvF5IAd9U4VIs/VvVir5lg==}\n     cpu: [ppc64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-riscv64-gnu@1.7.2':\n     resolution: {integrity: sha512-hQQ4TJQrSQW8JlPm7tRpXN8OCNP9ez7PajJNjRD1ZTHQAy685OYqPrKjfaMw/8LiHCt8AZ74rfUVHP9vn0N69Q==}\n     cpu: [riscv64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-riscv64-musl@1.7.2':\n     resolution: {integrity: sha512-NoAGbiqrxtY8kVooZ24i70CjLDlUFI7nDj3I9y54U94p+3kPxwd2L692YsdLa+cqQ0VoqMWoehDFp21PKRUoIQ==}\n     cpu: [riscv64]\n     os: [linux]\n-    libc: [musl]\n \n   '@unrs/resolver-binding-linux-s390x-gnu@1.7.2':\n     resolution: {integrity: sha512-KaZByo8xuQZbUhhreBTW+yUnOIHUsv04P8lKjQ5otiGoSJ17ISGYArc+4vKdLEpGaLbemGzr4ZeUbYQQsLWFjA==}\n     cpu: [s390x]\n     os: [linux]\n-    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-x64-gnu@1.7.2':\n     resolution: {integrity: sha512-dEidzJDubxxhUCBJ/SHSMJD/9q7JkyfBMT77Px1npl4xpg9t0POLvnWywSk66BgZS/b2Hy9Y1yFaoMTFJUe9yg==}\n     cpu: [x64]\n     os: [linux]\n-    libc: [glibc]\n \n   '@unrs/resolver-binding-linux-x64-musl@1.7.2':\n     resolution: {integrity: sha512-RvP+Ux3wDjmnZDT4XWFfNBRVG0fMsc+yVzNFUqOflnDfZ9OYujv6nkh+GOr+watwrW4wdp6ASfG/e7bkDradsw==}\n     cpu: [x64]\n     os: [linux]\n-    libc: [musl]\n \n   '@unrs/resolver-binding-wasm32-wasi@1.7.2':\n     resolution: {integrity: sha512-y797JBmO9IsvXVRCKDXOxjyAE4+CcZpla2GSoBQ33TVb3ILXuFnMrbR/QQZoauBYeOFuu4w3ifWLw52sdHGz6g==}\n@@ -3478,8 +3450,8 @@ packages:\n     engines: {node: '>=0.8.0'}\n     hasBin: true\n \n-  undici-types@6.21.0:\n-    resolution: {integrity: sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==}\n+  undici-types@7.16.0:\n+    resolution: {integrity: sha512-Zz+aZWSj8LE6zoxD+xrjh4VfkIG8Ya6LvYkZqtUQGJPZjYl53ypCaUwWqo7eI0x66KBGeRo+mlBEkMSeSZ38Nw==}\n \n   unicorn-magic@0.1.0:\n     resolution: {integrity: sha512-lRfVq8fE8gz6QMBuDM6a+LO3IAzTi05H6gCVaUpir2E1Rwpo4ZUog45KpNXKC/Mn3Yb9UDuHumeFTo9iV/D9FQ==}\n@@ -4362,9 +4334,9 @@ snapshots:\n \n   '@types/json-schema@7.0.15': {}\n \n-  '@types/node@22.19.0':\n+  '@types/node@24.10.4':\n     dependencies:\n-      undici-types: 6.21.0\n+      undici-types: 7.16.0\n \n   '@types/normalize-package-data@2.4.4': {}\n \n@@ -4374,13 +4346,13 @@ snapshots:\n \n   '@types/serve-handler@6.1.4':\n     dependencies:\n-      '@types/node': 22.19.0\n+      '@types/node': 24.10.4\n \n   '@types/trusted-types@2.0.7': {}\n \n   '@types/yauzl@2.10.3':\n     dependencies:\n-      '@types/node': 22.19.0\n+      '@types/node': 24.10.4\n     optional: true\n \n   '@typescript-eslint/eslint-plugin@8.32.1(@typescript-eslint/parser@8.32.1(eslint@9.27.0)(typescript@5.6.3))(eslint@9.27.0)(typescript@5.6.3)':\n@@ -4565,13 +4537,13 @@ snapshots:\n   '@unrs/resolver-binding-win32-x64-msvc@1.7.2':\n     optional: true\n \n-  '@vitejs/plugin-vue@6.0.1(vite@5.4.15(@types/node@22.19.0)(sass@1.93.3))(vue@packages+vue)':\n+  '@vitejs/plugin-vue@6.0.1(vite@5.4.15(@types/node@24.10.4)(sass@1.93.3))(vue@packages+vue)':\n     dependencies:\n       '@rolldown/pluginutils': 1.0.0-beta.29\n-      vite: 5.4.15(@types/node@22.19.0)(sass@1.93.3)\n+      vite: 5.4.15(@types/node@24.10.4)(sass@1.93.3)\n       vue: link:packages/vue\n \n-  '@vitest/coverage-v8@3.2.4(vitest@3.2.4(@types/node@22.19.0)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))':\n+  '@vitest/coverage-v8@3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))':\n     dependencies:\n       '@ampproject/remapping': 2.3.0\n       '@bcoe/v8-coverage': 1.0.2\n@@ -4586,18 +4558,18 @@ snapshots:\n       std-env: 3.9.0\n       test-exclude: 7.0.1\n       tinyrainbow: 2.0.0\n-      vitest: 3.2.4(@types/node@22.19.0)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n+      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n     transitivePeerDependencies:\n       - supports-color\n \n-  '@vitest/eslint-plugin@1.4.0(eslint@9.27.0)(typescript@5.6.3)(vitest@3.2.4(@types/node@22.19.0)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))':\n+  '@vitest/eslint-plugin@1.4.0(eslint@9.27.0)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))':\n     dependencies:\n       '@typescript-eslint/scope-manager': 8.46.3\n       '@typescript-eslint/utils': 8.46.3(eslint@9.27.0)(typescript@5.6.3)\n       eslint: 9.27.0\n     optionalDependencies:\n       typescript: 5.6.3\n-      vitest: 3.2.4(@types/node@22.19.0)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n+      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n     transitivePeerDependencies:\n       - supports-color\n \n@@ -4609,13 +4581,13 @@ snapshots:\n       chai: 5.2.0\n       tinyrainbow: 2.0.0\n \n-  '@vitest/mocker@3.2.4(vite@5.4.19(@types/node@22.19.0)(sass@1.93.3))':\n+  '@vitest/mocker@3.2.4(vite@5.4.19(@types/node@24.10.4)(sass@1.93.3))':\n     dependencies:\n       '@vitest/spy': 3.2.4\n       estree-walker: 3.0.3\n       magic-string: 0.30.21\n     optionalDependencies:\n-      vite: 5.4.19(@types/node@22.19.0)(sass@1.93.3)\n+      vite: 5.4.19(@types/node@24.10.4)(sass@1.93.3)\n \n   '@vitest/pretty-format@3.2.4':\n     dependencies:\n@@ -6652,7 +6624,7 @@ snapshots:\n   uglify-js@3.19.1:\n     optional: true\n \n-  undici-types@6.21.0: {}\n+  undici-types@7.16.0: {}\n \n   unicorn-magic@0.1.0: {}\n \n@@ -6703,13 +6675,13 @@ snapshots:\n \n   vary@1.1.2: {}\n \n-  vite-node@3.2.4(@types/node@22.19.0)(sass@1.93.3):\n+  vite-node@3.2.4(@types/node@24.10.4)(sass@1.93.3):\n     dependencies:\n       cac: 6.7.14\n       debug: 4.4.1\n       es-module-lexer: 1.7.0\n       pathe: 2.0.3\n-      vite: 5.4.19(@types/node@22.19.0)(sass@1.93.3)\n+      vite: 5.4.19(@types/node@24.10.4)(sass@1.93.3)\n     transitivePeerDependencies:\n       - '@types/node'\n       - less\n@@ -6721,31 +6693,31 @@ snapshots:\n       - supports-color\n       - terser\n \n-  vite@5.4.15(@types/node@22.19.0)(sass@1.93.3):\n+  vite@5.4.15(@types/node@24.10.4)(sass@1.93.3):\n     dependencies:\n       esbuild: 0.21.5\n       postcss: 8.5.6\n       rollup: 4.52.5\n     optionalDependencies:\n-      '@types/node': 22.19.0\n+      '@types/node': 24.10.4\n       fsevents: 2.3.3\n       sass: 1.93.3\n \n-  vite@5.4.19(@types/node@22.19.0)(sass@1.93.3):\n+  vite@5.4.19(@types/node@24.10.4)(sass@1.93.3):\n     dependencies:\n       esbuild: 0.21.5\n       postcss: 8.5.6\n       rollup: 4.52.5\n     optionalDependencies:\n-      '@types/node': 22.19.0\n+      '@types/node': 24.10.4\n       fsevents: 2.3.3\n       sass: 1.93.3\n \n-  vitest@3.2.4(@types/node@22.19.0)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3):\n+  vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3):\n     dependencies:\n       '@types/chai': 5.2.2\n       '@vitest/expect': 3.2.4\n-      '@vitest/mocker': 3.2.4(vite@5.4.19(@types/node@22.19.0)(sass@1.93.3))\n+      '@vitest/mocker': 3.2.4(vite@5.4.19(@types/node@24.10.4)(sass@1.93.3))\n       '@vitest/pretty-format': 3.2.4\n       '@vitest/runner': 3.2.4\n       '@vitest/snapshot': 3.2.4\n@@ -6763,11 +6735,11 @@ snapshots:\n       tinyglobby: 0.2.14\n       tinypool: 1.1.1\n       tinyrainbow: 2.0.0\n-      vite: 5.4.19(@types/node@22.19.0)(sass@1.93.3)\n-      vite-node: 3.2.4(@types/node@22.19.0)(sass@1.93.3)\n+      vite: 5.4.19(@types/node@24.10.4)(sass@1.93.3)\n+      vite-node: 3.2.4(@types/node@24.10.4)(sass@1.93.3)\n       why-is-node-running: 2.3.0\n     optionalDependencies:\n-      '@types/node': 22.19.0\n+      '@types/node': 24.10.4\n       jsdom: 27.1.0(postcss@8.5.6)\n     transitivePeerDependencies:\n       - less"}, {"role": "assistant", "content": "build(deps): update @types/node to v24"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/apps/playground/package.json |  6 +++---\n compiler/apps/playground/yarn.lock    | 34 +++++++++++++++++-----------------\n 2 files changed, 20 insertions(+), 20 deletions(-)\n\ndiff --git a/compiler/apps/playground/package.json b/compiler/apps/playground/package.json\nindex e92826c..217153e 100644\n--- a/compiler/apps/playground/package.json\n+++ b/compiler/apps/playground/package.json\n@@ -35,13 +35,13 @@\n     \"lru-cache\": \"^11.2.2\",\n     \"lz-string\": \"^1.5.0\",\n     \"monaco-editor\": \"^0.52.0\",\n-    \"next\": \"15.5.7\",\n+    \"next\": \"15.5.9\",\n     \"notistack\": \"^3.0.0-alpha.7\",\n     \"prettier\": \"^3.3.3\",\n     \"pretty-format\": \"^29.3.1\",\n     \"re-resizable\": \"^6.9.16\",\n-    \"react\": \"19.2\",\n-    \"react-dom\": \"19.2\"\n+    \"react\": \"19.2.3\",\n+    \"react-dom\": \"19.2.3\"\n   },\n   \"devDependencies\": {\n     \"@types/node\": \"18.11.9\",\ndiff --git a/compiler/apps/playground/yarn.lock b/compiler/apps/playground/yarn.lock\nindex ce4928e..be63ac5 100644\n--- a/compiler/apps/playground/yarn.lock\n+++ b/compiler/apps/playground/yarn.lock\n@@ -715,10 +715,10 @@\n   dependencies:\n     \"@monaco-editor/loader\" \"^1.6.1\"\n \n-\"@next/env@15.5.7\":\n-  version \"15.5.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/env/-/env-15.5.7.tgz#4168db34ae3bc9fd9ad3b951d327f4cfc38d4362\"\n-  integrity sha512-4h6Y2NyEkIEN7Z8YxkA27pq6zTkS09bUSYC0xjd0NpwFxjnIKeZEeH591o5WECSmjpUhLn3H2QLJcDye3Uzcvg==\n+\"@next/env@15.5.9\":\n+  version \"15.5.9\"\n+  resolved \"https://registry.yarnpkg.com/@next/env/-/env-15.5.9.tgz#53c2c34dc17cd87b61f70c6cc211e303123b2ab8\"\n+  integrity sha512-4GlTZ+EJM7WaW2HEZcyU317tIQDjkQIyENDLxYJfSWlfqguN+dHkZgyQTV/7ykvobU7yEH5gKvreNrH4B6QgIg==\n \n \"@next/eslint-plugin-next@15.5.2\":\n   version \"15.5.2\"\n@@ -3204,12 +3204,12 @@ natural-compare@^1.4.0:\n   resolved \"https://registry.yarnpkg.com/natural-compare/-/natural-compare-1.4.0.tgz#4abebfeed7541f2c27acfb29bdbbd15c8d5ba4f7\"\n   integrity sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==\n \n-next@15.5.7:\n-  version \"15.5.7\"\n-  resolved \"https://registry.yarnpkg.com/next/-/next-15.5.7.tgz#4507700b2bbcaf2c9fb7a9ad25c0dac2ba4a9a75\"\n-  integrity sha512-+t2/0jIJ48kUpGKkdlhgkv+zPTEOoXyr60qXe68eB/pl3CMJaLeIGjzp5D6Oqt25hCBiBTt8wEeeAzfJvUKnPQ==\n+next@15.5.9:\n+  version \"15.5.9\"\n+  resolved \"https://registry.yarnpkg.com/next/-/next-15.5.9.tgz#1b80d05865cc27e710fb4dcfc6fd9e726ed12ad4\"\n+  integrity sha512-agNLK89seZEtC5zUHwtut0+tNrc0Xw4FT/Dg+B/VLEo9pAcS9rtTKpek3V6kVcVwsB2YlqMaHdfZL4eLEVYuCg==\n   dependencies:\n-    \"@next/env\" \"15.5.7\"\n+    \"@next/env\" \"15.5.9\"\n     \"@swc/helpers\" \"0.5.15\"\n     caniuse-lite \"^1.0.30001579\"\n     postcss \"8.4.31\"\n@@ -3582,10 +3582,10 @@ re-resizable@^6.9.16:\n   resolved \"https://registry.yarnpkg.com/re-resizable/-/re-resizable-6.10.0.tgz#d684a096ab438f1a93f59ad3a580a206b0ce31ee\"\n   integrity sha512-hysSK0xmA5nz24HBVztlk4yCqCLCvS32E6ZpWxVKop9x3tqCa4yAj1++facrmkOf62JsJHjmjABdKxXofYioCw==\n \n-react-dom@19.2:\n-  version \"19.2.0\"\n-  resolved \"https://registry.npmjs.org/react-dom/-/react-dom-19.2.0.tgz#00ed1e959c365e9a9d48f8918377465466ec3af8\"\n-  integrity sha512-UlbRu4cAiGaIewkPyiRGJk0imDN2T3JjieT6spoL2UeSf5od4n5LB/mQ4ejmxhCFT1tYe8IvaFulzynWovsEFQ==\n+react-dom@19.2.3:\n+  version \"19.2.3\"\n+  resolved \"https://registry.yarnpkg.com/react-dom/-/react-dom-19.2.3.tgz#f0b61d7e5c4a86773889fcc1853af3ed5f215b17\"\n+  integrity sha512-yELu4WmLPw5Mr/lmeEpox5rw3RETacE++JgHqQzd2dg+YbJuat3jH4ingc+WPZhxaoFzdv9y33G+F7Nl5O0GBg==\n   dependencies:\n     scheduler \"^0.27.0\"\n \n@@ -3599,10 +3599,10 @@ react-is@^18.0.0:\n   resolved \"https://registry.yarnpkg.com/react-is/-/react-is-18.3.1.tgz#e83557dc12eae63a99e003a46388b1dcbb44db7e\"\n   integrity sha512-/LLMVyas0ljjAtoYiPqYiL8VWXzUUdThrmU5+n20DZv+a+ClRoevUzw5JxU+Ieh5/c87ytoTBV9G1FiKfNJdmg==\n \n-react@19.2:\n-  version \"19.2.0\"\n-  resolved \"https://registry.npmjs.org/react/-/react-19.2.0.tgz#d33dd1721698f4376ae57a54098cb47fc75d93a5\"\n-  integrity sha512-tmbWg6W31tQLeB5cdIBOicJDJRR2KzXsV7uSK9iNfLWQ5bIZfxuPEHp7M8wiHyHnn0DD1i7w3Zmin0FtkrwoCQ==\n+react@19.2.3:\n+  version \"19.2.3\"\n+  resolved \"https://registry.yarnpkg.com/react/-/react-19.2.3.tgz#d83e5e8e7a258cf6b4fe28640515f99b87cd19b8\"\n+  integrity sha512-Ku/hhYbVjOQnXDZFv2+RibmLFGwFdeeKHFcOTlrt7xplBnya5OGn/hIRDsqDiSUcfORsDC7MPxwork8jBwsIWA==\n \n read-cache@^1.0.0:\n   version \"1.0.0\""}, {"role": "assistant", "content": "build(deps): update next and react dependencies"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-core/src/index.ts | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/packages/runtime-core/src/index.ts b/packages/runtime-core/src/index.ts\nindex 9910f82..c846833 100644\n--- a/packages/runtime-core/src/index.ts\n+++ b/packages/runtime-core/src/index.ts\n@@ -327,6 +327,7 @@ export type {\n   DirectiveHook,\n   ObjectDirective,\n   FunctionDirective,\n+  DirectiveModifiers,\n   DirectiveArguments,\n } from './directives'\n export type { SuspenseBoundary } from './components/Suspense'"}, {"role": "assistant", "content": "feat(types): export DirectiveModifiers type"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/cgo/ast.go | 11 +++--------\n 1 file changed, 3 insertions(+), 8 deletions(-)\n\ndiff --git a/src/cmd/cgo/ast.go b/src/cmd/cgo/ast.go\nindex 2da6ca5a..df0552f5 100644\n--- a/src/cmd/cgo/ast.go\n+++ b/src/cmd/cgo/ast.go\n@@ -301,17 +301,12 @@ func (f *File) saveExport(x any, context astContext) {\n \t\t\terror_(c.Pos(), \"export comment has wrong name %q, want %q\", name, n.Name.Name)\n \t\t}\n \n-\t\tdoc := \"\"\n-\t\tfor _, c1 := range n.Doc.List {\n-\t\t\tif c1 != c {\n-\t\t\t\tdoc += c1.Text + \"\\n\"\n-\t\t\t}\n-\t\t}\n-\n \t\tf.ExpFunc = append(f.ExpFunc, &ExpFunc{\n \t\t\tFunc:    n,\n \t\t\tExpName: name,\n-\t\t\tDoc:     doc,\n+\t\t\t// Caution: Do not set the Doc field on purpose\n+\t\t\t// to ensure that there are no unintended artifacts\n+\t\t\t// in the binary. See https://go.dev/issue/76697.\n \t\t})\n \t\tbreak\n \t}"}, {"role": "assistant", "content": "fix(cgo): remove doc field to prevent binary artifacts"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_lint_defs/src/builtin.rs            |  2 +-\n tests/ui/imports/ambiguous-10.rs                   |  4 ++--\n tests/ui/imports/ambiguous-10.stderr               | 10 +++++-----\n tests/ui/imports/ambiguous-12.rs                   |  4 ++--\n tests/ui/imports/ambiguous-12.stderr               | 10 +++++-----\n tests/ui/imports/ambiguous-13.rs                   |  4 ++--\n tests/ui/imports/ambiguous-13.stderr               | 10 +++++-----\n tests/ui/imports/ambiguous-14.rs                   |  4 ++--\n tests/ui/imports/ambiguous-14.stderr               | 10 +++++-----\n tests/ui/imports/ambiguous-15.rs                   |  4 ++--\n tests/ui/imports/ambiguous-15.stderr               | 10 +++++-----\n tests/ui/imports/ambiguous-16.rs                   |  4 ++--\n tests/ui/imports/ambiguous-16.stderr               | 10 +++++-----\n tests/ui/imports/ambiguous-17.rs                   |  4 ++--\n tests/ui/imports/ambiguous-17.stderr               | 10 +++++-----\n tests/ui/imports/ambiguous-2.rs                    |  4 ++--\n tests/ui/imports/ambiguous-2.stderr                | 10 +++++-----\n tests/ui/imports/ambiguous-3.rs                    |  4 ++--\n tests/ui/imports/ambiguous-3.stderr                | 10 +++++-----\n tests/ui/imports/ambiguous-4.rs                    |  4 ++--\n tests/ui/imports/ambiguous-4.stderr                | 10 +++++-----\n tests/ui/imports/ambiguous-5.rs                    |  4 ++--\n tests/ui/imports/ambiguous-5.stderr                | 10 +++++-----\n tests/ui/imports/ambiguous-6.rs                    |  4 ++--\n tests/ui/imports/ambiguous-6.stderr                | 10 +++++-----\n tests/ui/imports/ambiguous-9.rs                    |  6 +++---\n tests/ui/imports/ambiguous-9.stderr                | 16 ++++++++--------\n tests/ui/imports/ambiguous-panic-globvsglob.rs     |  4 ++--\n tests/ui/imports/ambiguous-panic-globvsglob.stderr | 10 +++++-----\n tests/ui/imports/duplicate.rs                      |  2 +-\n tests/ui/imports/duplicate.stderr                  | 10 +++++-----\n tests/ui/imports/glob-conflict-cross-crate-1.rs    |  6 +++---\n .../ui/imports/glob-conflict-cross-crate-1.stderr  | 16 ++++++++--------\n tests/ui/imports/glob-conflict-cross-crate-2.rs    |  4 ++--\n .../ui/imports/glob-conflict-cross-crate-2.stderr  | 10 +++++-----\n tests/ui/imports/glob-conflict-cross-crate-3.rs    |  6 +++---\n .../ui/imports/glob-conflict-cross-crate-3.stderr  | 16 ++++++++--------\n tests/ui/imports/issue-114682-2.rs                 |  6 +++---\n tests/ui/imports/issue-114682-2.stderr             | 16 ++++++++--------\n tests/ui/imports/issue-114682-4.rs                 |  2 +-\n tests/ui/imports/issue-114682-4.stderr             | 10 +++++-----\n tests/ui/imports/issue-114682-5.rs                 |  2 +-\n tests/ui/imports/issue-114682-5.stderr             | 10 +++++-----\n tests/ui/imports/issue-114682-6.rs                 |  4 ++--\n tests/ui/imports/issue-114682-6.stderr             | 10 +++++-----\n tests/ui/imports/overwrite-different-ambig-2.rs    |  4 +++-\n .../ui/imports/overwrite-different-ambig-2.stderr  | 22 +++++++++++-----------\n tests/ui/imports/unresolved-seg-after-ambiguous.rs |  2 +-\n .../imports/unresolved-seg-after-ambiguous.stderr  | 10 +++++-----\n 49 files changed, 188 insertions(+), 186 deletions(-)"}, {"role": "assistant", "content": "refactor(lint): rename ambiguous glob import lint"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../transforms/__snapshots__/vSlot.spec.ts.snap    | 58 ++++++++++++++++\n .../__tests__/transforms/transformText.spec.ts     | 19 +++++\n .../compiler-core/__tests__/transforms/vIf.spec.ts | 52 +++++++++++++-\n .../__tests__/transforms/vSlot.spec.ts             | 80 +++++++++++++++++++++-\n packages/compiler-core/src/parser.ts               | 10 +--\n packages/compiler-core/src/transforms/vIf.ts       | 23 +++----\n packages/compiler-core/src/transforms/vSlot.ts     | 14 ++--\n packages/compiler-core/src/utils.ts                | 21 ++++++\n .../__tests__/transforms/Transition.spec.ts        | 28 ++++++++\n .../__snapshots__/Transition.spec.ts.snap          | 17 +++++\n packages/compiler-dom/src/transforms/Transition.ts |  7 +-\n 11 files changed, 292 insertions(+), 37 deletions(-)\n\ndiff --git a/packages/compiler-core/__tests__/transforms/__snapshots__/vSlot.spec.ts.snap b/packages/compiler-core/__tests__/transforms/__snapshots__/vSlot.spec.ts.snap\nindex 2cd13ba..0ce4033 100644\n--- a/packages/compiler-core/__tests__/transforms/__snapshots__/vSlot.spec.ts.snap\n+++ b/packages/compiler-core/__tests__/transforms/__snapshots__/vSlot.spec.ts.snap\n@@ -139,6 +139,24 @@ return function render(_ctx, _cache) {\n }\"\n `;\n \n+exports[`compiler: transform component slots > named slots w/ implicit default slot containing non-breaking space 1`] = `\n+\"const _Vue = Vue\n+\n+return function render(_ctx, _cache) {\n+  with (_ctx) {\n+    const { resolveComponent: _resolveComponent, withCtx: _withCtx, openBlock: _openBlock, createBlock: _createBlock } = _Vue\n+\n+    const _component_Comp = _resolveComponent(\"Comp\")\n+\n+    return (_openBlock(), _createBlock(_component_Comp, null, {\n+      one: _withCtx(() => [\"foo\"]),\n+      default: _withCtx(() => [\" \u00a0 \"]),\n+      _: 1 /* STABLE */\n+    }))\n+  }\n+}\"\n+`;\n+\n exports[`compiler: transform component slots > nested slots scoping 1`] = `\n \"const { toDisplayString: _toDisplayString, resolveComponent: _resolveComponent, withCtx: _withCtx, createVNode: _createVNode, openBlock: _openBlock, createBlock: _createBlock } = Vue\n \n@@ -232,6 +250,20 @@ return function render(_ctx, _cache) {\n }\"\n `;\n \n+exports[`compiler: transform component slots > with whitespace: 'preserve' > implicit default slot with non-breaking space 1`] = `\n+\"const { resolveComponent: _resolveComponent, withCtx: _withCtx, openBlock: _openBlock, createBlock: _createBlock } = Vue\n+\n+return function render(_ctx, _cache) {\n+  const _component_Comp = _resolveComponent(\"Comp\")\n+\n+  return (_openBlock(), _createBlock(_component_Comp, null, {\n+    header: _withCtx(() => [\" Header \"]),\n+    default: _withCtx(() => [\"\\\\n        \u00a0\\\\n        \"]),\n+    _: 1 /* STABLE */\n+  }))\n+}\"\n+`;\n+\n exports[`compiler: transform component slots > with whitespace: 'preserve' > named default slot + implicit whitespace content 1`] = `\n \"const { resolveComponent: _resolveComponent, withCtx: _withCtx, openBlock: _openBlock, createBlock: _createBlock } = Vue\n \n@@ -268,6 +300,32 @@ return function render(_ctx, _cache) {\n }\"\n `;\n \n+exports[`compiler: transform component slots > with whitespace: 'preserve' > named slot with v-if + v-else and comments 1`] = `\n+\"const { createTextVNode: _createTextVNode, createCommentVNode: _createCommentVNode, resolveComponent: _resolveComponent, withCtx: _withCtx, createSlots: _createSlots, openBlock: _openBlock, createBlock: _createBlock } = Vue\n+\n+return function render(_ctx, _cache) {\n+  const _component_Comp = _resolveComponent(\"Comp\")\n+\n+  return (_openBlock(), _createBlock(_component_Comp, null, _createSlots({ _: 2 /* DYNAMIC */ }, [\n+    ok\n+      ? {\n+          name: \"one\",\n+          fn: _withCtx(() => [\n+            _createTextVNode(\"foo\")\n+          ]),\n+          key: \"0\"\n+        }\n+      : {\n+          name: \"two\",\n+          fn: _withCtx(() => [\n+            _createTextVNode(\"baz\")\n+          ]),\n+          key: \"1\"\n+        }\n+  ]), 1024 /* DYNAMIC_SLOTS */))\n+}\"\n+`;\n+\n exports[`compiler: transform component slots > with whitespace: 'preserve' > should not generate whitespace only default slot 1`] = `\n \"const { resolveComponent: _resolveComponent, withCtx: _withCtx, openBlock: _openBlock, createBlock: _createBlock } = Vue\n \ndiff --git a/packages/compiler-core/__tests__/transforms/transformText.spec.ts b/packages/compiler-core/__tests__/transforms/transformText.spec.ts\nindex 1a6d691..057250d 100644\n--- a/packages/compiler-core/__tests__/transforms/transformText.spec.ts\n+++ b/packages/compiler-core/__tests__/transforms/transformText.spec.ts\n@@ -4,6 +4,7 @@ import {\n   type ForNode,\n   NodeTypes,\n   generate,\n+  isWhitespaceText,\n   baseParse as parse,\n   transform,\n } from '../../src'\n@@ -109,6 +110,24 @@ describe('compiler: transform text', () => {\n     expect(generate(root).code).toMatchSnapshot()\n   })\n \n+  test('whitespace text', () => {\n+    const root = transformWithTextOpt(`<div/>hello<div/>  <div/>`)\n+    expect(root.children.length).toBe(5)\n+    expect(root.children[0].type).toBe(NodeTypes.ELEMENT)\n+    expect(root.children[1].type).toBe(NodeTypes.TEXT_CALL)\n+    expect(root.children[2].type).toBe(NodeTypes.ELEMENT)\n+    expect(root.children[3].type).toBe(NodeTypes.TEXT_CALL)\n+    expect(root.children[4].type).toBe(NodeTypes.ELEMENT)\n+\n+    expect(root.children.map(isWhitespaceText)).toEqual([\n+      false,\n+      false,\n+      false,\n+      true,\n+      false,\n+    ])\n+  })\n+\n   test('consecutive text mixed with elements', () => {\n     const root = transformWithTextOpt(\n       `<div/>{{ foo }} bar {{ baz }}<div/>hello<div/>`,\ndiff --git a/packages/compiler-core/__tests__/transforms/vIf.spec.ts b/packages/compiler-core/__tests__/transforms/vIf.spec.ts\nindex 1e0067a..fe3aef7 100644\n--- a/packages/compiler-core/__tests__/transforms/vIf.spec.ts\n+++ b/packages/compiler-core/__tests__/transforms/vIf.spec.ts\n@@ -266,6 +266,31 @@ describe('compiler: v-if', () => {\n           loc: node3.loc,\n         },\n       ])\n+\n+      const { node: node4 } = parseWithIfTransform(\n+        `<div v-if=\"bar\"/>foo<div v-else/>`,\n+        { onError },\n+        2,\n+      )\n+      expect(onError.mock.calls[3]).toMatchObject([\n+        {\n+          code: ErrorCodes.X_V_ELSE_NO_ADJACENT_IF,\n+          loc: node4.loc,\n+        },\n+      ])\n+\n+      // Non-breaking space\n+      const { node: node5 } = parseWithIfTransform(\n+        `<div v-if=\"bar\"/>\\u00a0<div v-else/>`,\n+        { onError },\n+        2,\n+      )\n+      expect(onError.mock.calls[4]).toMatchObject([\n+        {\n+          code: ErrorCodes.X_V_ELSE_NO_ADJACENT_IF,\n+          loc: node5.loc,\n+        },\n+      ])\n     })\n \n     test('error on v-else-if missing adjacent v-if or v-else-if', () => {\n@@ -305,6 +330,31 @@ describe('compiler: v-if', () => {\n         },\n       ])\n \n+      const { node: node4 } = parseWithIfTransform(\n+        `<div v-if=\"bar\"/>foo<div v-else-if=\"foo\"/>`,\n+        { onError },\n+        2,\n+      )\n+      expect(onError.mock.calls[3]).toMatchObject([\n+        {\n+          code: ErrorCodes.X_V_ELSE_NO_ADJACENT_IF,\n+          loc: node4.loc,\n+        },\n+      ])\n+\n+      // Non-breaking space\n+      const { node: node5 } = parseWithIfTransform(\n+        `<div v-if=\"bar\"/>\\u00a0<div v-else-if=\"foo\"/>`,\n+        { onError },\n+        2,\n+      )\n+      expect(onError.mock.calls[4]).toMatchObject([\n+        {\n+          code: ErrorCodes.X_V_ELSE_NO_ADJACENT_IF,\n+          loc: node5.loc,\n+        },\n+      ])\n+\n       const {\n         node: { branches },\n       } = parseWithIfTransform(\n@@ -313,7 +363,7 @@ describe('compiler: v-if', () => {\n         0,\n       )\n \n-      expect(onError.mock.calls[3]).toMatchObject([\n+      expect(onError.mock.calls[5]).toMatchObject([\n         {\n           code: ErrorCodes.X_V_ELSE_NO_ADJACENT_IF,\n           loc: branches[branches.length - 1].loc,\ndiff --git a/packages/compiler-core/__tests__/transforms/vSlot.spec.ts b/packages/compiler-core/__tests__/transforms/vSlot.spec.ts\nindex 1213e21..97f6810 100644\n--- a/packages/compiler-core/__tests__/transforms/vSlot.spec.ts\n+++ b/packages/compiler-core/__tests__/transforms/vSlot.spec.ts\n@@ -28,8 +28,12 @@ import { createObjectMatcher } from '../testUtils'\n import { PatchFlags } from '@vue/shared'\n import { transformFor } from '../../src/transforms/vFor'\n import { transformIf } from '../../src/transforms/vIf'\n+import { transformText } from '../../src/transforms/transformText'\n \n-function parseWithSlots(template: string, options: CompilerOptions = {}) {\n+function parseWithSlots(\n+  template: string,\n+  options: CompilerOptions & { transformText?: boolean } = {},\n+) {\n   const ast = parse(template, {\n     whitespace: options.whitespace,\n   })\n@@ -43,6 +47,7 @@ function parseWithSlots(template: string, options: CompilerOptions = {}) {\n       transformSlotOutlet,\n       transformElement,\n       trackSlotScopes,\n+      ...(options.transformText ? [transformText] : []),\n     ],\n     directiveTransforms: {\n       on: transformOn,\n@@ -307,6 +312,40 @@ describe('compiler: transform component slots', () => {\n     expect(generate(root).code).toMatchSnapshot()\n   })\n \n+  test('named slots w/ implicit default slot containing non-breaking space', () => {\n+    const { root, slots } = parseWithSlots(\n+      `<Comp>\n+        \\u00a0\n+        <template #one>foo</template>\n+      </Comp>`,\n+    )\n+    expect(slots).toMatchObject(\n+      createSlotMatcher({\n+        one: {\n+          type: NodeTypes.JS_FUNCTION_EXPRESSION,\n+          params: undefined,\n+          returns: [\n+            {\n+              type: NodeTypes.TEXT,\n+              content: `foo`,\n+            },\n+          ],\n+        },\n+        default: {\n+          type: NodeTypes.JS_FUNCTION_EXPRESSION,\n+          params: undefined,\n+          returns: [\n+            {\n+              type: NodeTypes.TEXT,\n+              content: ` \\u00a0 `,\n+            },\n+          ],\n+        },\n+      }),\n+    )\n+    expect(generate(root).code).toMatchSnapshot()\n+  })\n+\n   test('dynamically named slots', () => {\n     const { root, slots } = parseWithSlots(\n       `<Comp>\n@@ -1011,6 +1050,27 @@ describe('compiler: transform component slots', () => {\n       expect(generate(root, { prefixIdentifiers: true }).code).toMatchSnapshot()\n     })\n \n+    test('implicit default slot with non-breaking space', () => {\n+      const source = `\n+      <Comp>\n+        &nbsp;\n+        <template #header> Header </template>\n+      </Comp>\n+      `\n+      const { root } = parseWithSlots(source, {\n+        whitespace: 'preserve',\n+      })\n+\n+      const slots = (root as any).children[0].codegenNode.children\n+        .properties as ObjectExpression['properties']\n+\n+      expect(\n+        slots.some(p => (p.key as SimpleExpressionNode).content === 'default'),\n+      ).toBe(true)\n+\n+      expect(generate(root, { prefixIdentifiers: true }).code).toMatchSnapshot()\n+    })\n+\n     test('named slot with v-if + v-else', () => {\n       const source = `\n         <Comp>\n@@ -1024,5 +1084,23 @@ describe('compiler: transform component slots', () => {\n \n       expect(generate(root, { prefixIdentifiers: true }).code).toMatchSnapshot()\n     })\n+\n+    test('named slot with v-if + v-else and comments', () => {\n+      const source = `\n+        <Comp>\n+          <template #one v-if=\"ok\">foo</template>\n+          <!-- start -->\n+\n+          <!-- end -->\n+          <template #two v-else>baz</template>\n+        </Comp>\n+      `\n+      const { root } = parseWithSlots(source, {\n+        transformText: true,\n+        whitespace: 'preserve',\n+      })\n+\n+      expect(generate(root, { prefixIdentifiers: true }).code).toMatchSnapshot()\n+    })\n   })\n })\ndiff --git a/packages/compiler-core/src/parser.ts b/packages/compiler-core/src/parser.ts\nindex 2d85289..debf11f 100644\n--- a/packages/compiler-core/src/parser.ts\n+++ b/packages/compiler-core/src/parser.ts\n@@ -40,6 +40,7 @@ import {\n } from './errors'\n import {\n   forAliasRE,\n+  isAllWhitespace,\n   isCoreComponent,\n   isSimpleIdentifier,\n   isStaticArgOf,\n@@ -881,15 +882,6 @@ function condenseWhitespace(nodes: TemplateChildNode[]): TemplateChildNode[] {\n   return removedWhitespace ? nodes.filter(Boolean) : nodes\n }\n \n-function isAllWhitespace(str: string) {\n-  for (let i = 0; i < str.length; i++) {\n-    if (!isWhitespace(str.charCodeAt(i))) {\n-      return false\n-    }\n-  }\n-  return true\n-}\n-\n function hasNewlineChar(str: string) {\n   for (let i = 0; i < str.length; i++) {\n     const c = str.charCodeAt(i)\ndiff --git a/packages/compiler-core/src/transforms/vIf.ts b/packages/compiler-core/src/transforms/vIf.ts\nindex 7457532..63a65cb 100644\n--- a/packages/compiler-core/src/transforms/vIf.ts\n+++ b/packages/compiler-core/src/transforms/vIf.ts\n@@ -32,7 +32,13 @@ import { processExpression } from './transformExpression'\n import { validateBrowserExpression } from '../validateExpression'\n import { cloneLoc } from '../parser'\n import { CREATE_COMMENT, FRAGMENT } from '../runtimeHelpers'\n-import { findDir, findProp, getMemoedVNodeCall, injectProp } from '../utils'\n+import {\n+  findDir,\n+  findProp,\n+  getMemoedVNodeCall,\n+  injectProp,\n+  isCommentOrWhitespace,\n+} from '../utils'\n import { PatchFlags } from '@vue/shared'\n \n export const transformIf: NodeTransform = createStructuralDirectiveTransform(\n@@ -125,18 +131,11 @@ export function processIf(\n     let i = siblings.indexOf(node)\n     while (i-- >= -1) {\n       const sibling = siblings[i]\n-      if (sibling && sibling.type === NodeTypes.COMMENT) {\n-        context.removeNode(sibling)\n-        __DEV__ && comments.unshift(sibling)\n-        continue\n-      }\n-\n-      if (\n-        sibling &&\n-        sibling.type === NodeTypes.TEXT &&\n-        !sibling.content.trim().length\n-      ) {\n+      if (sibling && isCommentOrWhitespace(sibling)) {\n         context.removeNode(sibling)\n+        if (__DEV__ && sibling.type === NodeTypes.COMMENT) {\n+          comments.unshift(sibling)\n+        }\n         continue\n       }\n \ndiff --git a/packages/compiler-core/src/transforms/vSlot.ts b/packages/compiler-core/src/transforms/vSlot.ts\nindex 3493934..f9a1b72 100644\n--- a/packages/compiler-core/src/transforms/vSlot.ts\n+++ b/packages/compiler-core/src/transforms/vSlot.ts\n@@ -26,9 +26,11 @@ import {\n   assert,\n   findDir,\n   hasScopeRef,\n+  isCommentOrWhitespace,\n   isStaticExp,\n   isTemplateNode,\n   isVSlot,\n+  isWhitespaceText,\n } from '../utils'\n import { CREATE_SLOTS, RENDER_LIST, WITH_CTX } from '../runtimeHelpers'\n import { createForLoopParams, finalizeForParseResult } from './vFor'\n@@ -230,7 +232,7 @@ export function buildSlots(\n       let prev\n       while (j--) {\n         prev = children[j]\n-        if (prev.type !== NodeTypes.COMMENT && isNonWhitespaceContent(prev)) {\n+        if (!isCommentOrWhitespace(prev)) {\n           break\n         }\n       }\n@@ -327,7 +329,7 @@ export function buildSlots(\n       // #3766\n       // with whitespace: 'preserve', whitespaces between slots will end up in\n       // implicitDefaultChildren. Ignore if all implicit children are whitespaces.\n-      implicitDefaultChildren.some(node => isNonWhitespaceContent(node))\n+      !implicitDefaultChildren.every(isWhitespaceText)\n     ) {\n       // implicit default slot (mixed with named slots)\n       if (hasNamedDefaultSlot) {\n@@ -419,11 +421,3 @@ function hasForwardedSlots(children: TemplateChildNode[]): boolean {\n   }\n   return false\n }\n-\n-function isNonWhitespaceContent(node: TemplateChildNode): boolean {\n-  if (node.type !== NodeTypes.TEXT && node.type !== NodeTypes.TEXT_CALL)\n-    return true\n-  return node.type === NodeTypes.TEXT\n-    ? !!node.content.trim()\n-    : isNonWhitespaceContent(node.content)\n-}\ndiff --git a/packages/compiler-core/src/utils.ts b/packages/compiler-core/src/utils.ts\nindex e04247d..aa426bb 100644\n--- a/packages/compiler-core/src/utils.ts\n+++ b/packages/compiler-core/src/utils.ts\n@@ -42,6 +42,7 @@ import type { PropsExpression } from './transforms/transformElement'\n import { parseExpression } from '@babel/parser'\n import type { Expression, Node } from '@babel/types'\n import { unwrapTSNode } from './babelUtils'\n+import { isWhitespace } from './tokenizer'\n \n export const isStaticExp = (p: JSChildNode): p is SimpleExpressionNode =>\n   p.type === NodeTypes.SIMPLE_EXPRESSION && p.isStatic\n@@ -568,3 +569,23 @@ export function getMemoedVNodeCall(\n }\n \n export const forAliasRE: RegExp = /([\\s\\S]*?)\\s+(?:in|of)\\s+(\\S[\\s\\S]*)/\n+\n+export function isAllWhitespace(str: string): boolean {\n+  for (let i = 0; i < str.length; i++) {\n+    if (!isWhitespace(str.charCodeAt(i))) {\n+      return false\n+    }\n+  }\n+  return true\n+}\n+\n+export function isWhitespaceText(node: TemplateChildNode): boolean {\n+  return (\n+    (node.type === NodeTypes.TEXT && isAllWhitespace(node.content)) ||\n+    (node.type === NodeTypes.TEXT_CALL && isWhitespaceText(node.content))\n+  )\n+}\n+\n+export function isCommentOrWhitespace(node: TemplateChildNode): boolean {\n+  return node.type === NodeTypes.COMMENT || isWhitespaceText(node)\n+}\ndiff --git a/packages/compiler-dom/__tests__/transforms/Transition.spec.ts b/packages/compiler-dom/__tests__/transforms/Transition.spec.ts\nindex 8f64adb..93039d2 100644\n--- a/packages/compiler-dom/__tests__/transforms/Transition.spec.ts\n+++ b/packages/compiler-dom/__tests__/transforms/Transition.spec.ts\n@@ -135,6 +135,18 @@ describe('Transition multi children warnings', () => {\n       false,\n     )\n   })\n+\n+  test('non-breaking spaces are treated as normal text', () => {\n+    checkWarning(\n+      `\n+      <transition>\n+        \\u00a0\n+        <div>foo</div>\n+      </transition>\n+      `,\n+      true,\n+    )\n+  })\n })\n \n test('inject persisted when child has v-show', () => {\n@@ -164,3 +176,19 @@ test('the v-if/else-if/else branches in Transition should ignore comments', () =\n     `).code,\n   ).toMatchSnapshot()\n })\n+\n+test('comments and preserved whitespace are ignored', () => {\n+  expect(\n+    compile(\n+      `\n+      <transition>\n+        <!-- foo --> <!-- bar -->\n+        <div>foo bar</div>\n+      </transition>\n+      `,\n+      {\n+        whitespace: 'preserve',\n+      },\n+    ).code,\n+  ).toMatchSnapshot()\n+})\ndiff --git a/packages/compiler-dom/__tests__/transforms/__snapshots__/Transition.spec.ts.snap b/packages/compiler-dom/__tests__/transforms/__snapshots__/Transition.spec.ts.snap\nindex aa08c13..404ad8c 100644\n--- a/packages/compiler-dom/__tests__/transforms/__snapshots__/Transition.spec.ts.snap\n+++ b/packages/compiler-dom/__tests__/transforms/__snapshots__/Transition.spec.ts.snap\n@@ -1,5 +1,22 @@\n // Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html\n \n+exports[`comments and preserved whitespace are ignored 1`] = `\n+\"const _Vue = Vue\n+\n+return function render(_ctx, _cache) {\n+  with (_ctx) {\n+    const { createCommentVNode: _createCommentVNode, createElementVNode: _createElementVNode, Transition: _Transition, withCtx: _withCtx, openBlock: _openBlock, createBlock: _createBlock } = _Vue\n+\n+    return (_openBlock(), _createBlock(_Transition, null, {\n+      default: _withCtx(() => [\n+        _createElementVNode(\"div\", null, \"foo bar\")\n+      ]),\n+      _: 1 /* STABLE */\n+    }))\n+  }\n+}\"\n+`;\n+\n exports[`inject persisted when child has v-show 1`] = `\n \"const _Vue = Vue\n \ndiff --git a/packages/compiler-dom/src/transforms/Transition.ts b/packages/compiler-dom/src/transforms/Transition.ts\nindex f6cf968..ccf96e8 100644\n--- a/packages/compiler-dom/src/transforms/Transition.ts\n+++ b/packages/compiler-dom/src/transforms/Transition.ts\n@@ -4,6 +4,7 @@ import {\n   type IfBranchNode,\n   type NodeTransform,\n   NodeTypes,\n+  isCommentOrWhitespace,\n } from '@vue/compiler-core'\n import { TRANSITION } from '../runtimeHelpers'\n import { DOMErrorCodes, createDOMCompilerError } from '../errors'\n@@ -56,11 +57,9 @@ export const transformTransition: NodeTransform = (node, context) => {\n }\n \n function hasMultipleChildren(node: ComponentNode | IfBranchNode): boolean {\n-  // #1352 filter out potential comment nodes.\n+  // filter out potential comment nodes (#1352) and whitespace (#4637)\n   const children = (node.children = node.children.filter(\n-    c =>\n-      c.type !== NodeTypes.COMMENT &&\n-      !(c.type === NodeTypes.TEXT && !c.content.trim()),\n+    c => !isCommentOrWhitespace(c),\n   ))\n   const child = children[0]\n   return ("}, {"role": "assistant", "content": "fix(compiler-core): handle non-breaking spaces in whitespace detection"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../signals-visualizer.component.ts                | 14 ++++---\n .../signals-visualizer/signals-visualizer.ts       | 49 ++++++++++++++--------\n 2 files changed, 41 insertions(+), 22 deletions(-)\n\ndiff --git a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.component.ts b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.component.ts\nindex 206e3855..19afb4ed 100644\n--- a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.component.ts\n+++ b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.component.ts\n@@ -62,9 +62,6 @@ export class SignalsVisualizerComponent {\n     return Array.from(clusterIds).map((id) => graph.clusters[id]);\n   });\n \n-  private onResize = () => this.signalsVisualizer?.resize();\n-  private observer = new ResizeObserver(this.onResize);\n-\n   constructor() {\n     const injector = inject(Injector);\n \n@@ -73,9 +70,18 @@ export class SignalsVisualizerComponent {\n         this.setUpSignalsVisualizer();\n \n         runInInjectionContext(injector, () => {\n+          let lastElement: ElementPosition | undefined;\n+\n           effect(() => {\n             const graph = this.graph();\n             this.signalsVisualizer!.render(graph!);\n+            const currElement = untracked(this.element);\n+\n+            // Snap to root node only if the element changes.\n+            if (lastElement !== currElement) {\n+              this.signalsVisualizer!.snapToRootNode();\n+            }\n+            lastElement = currElement;\n           });\n \n           effect(() => {\n@@ -92,12 +98,10 @@ export class SignalsVisualizerComponent {\n             untracked(() => this.signalsVisualizer!.reset());\n           });\n         });\n-        this.observer.observe(this.svgHost().nativeElement);\n       },\n     });\n \n     inject(DestroyRef).onDestroy(() => {\n-      this.observer.disconnect();\n       this.signalsVisualizer?.cleanup();\n     });\n   }\ndiff --git a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.ts b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.ts\nindex 377ccd7a..a430c667 100644\n--- a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.ts\n+++ b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.ts\n@@ -53,6 +53,8 @@ const NODE_WIDTH = 100;\n const NODE_HEIGHT = 60;\n const NODE_EPOCH_UPDATE_ANIM_DURATION = 250;\n \n+const TEMPL_NODE_ZOOM_SCALE = 0.8;\n+\n const CLUSTER_EXPAND_ANIM_DURATION = 1100; // Empirical value based on Dagre's behavior with an included leeway\n \n // Terminology:\n@@ -88,7 +90,6 @@ export class SignalsGraphVisualizer {\n \n     const d3svg = d3.select(this.svg);\n     d3svg.attr('height', '100%').attr('width', '100%');\n-    this.resize();\n \n     const g = d3svg.append('g');\n \n@@ -100,6 +101,36 @@ export class SignalsGraphVisualizer {\n     d3svg.call(this.zoomController);\n   }\n \n+  /** Snaps to the root node \u2013\u00a0either the template or the first node depending which exists. */\n+  snapToRootNode() {\n+    let node =\n+      this.inputGraph?.nodes.find((n) => isSignalNode(n) && n.kind === 'template') ??\n+      this.inputGraph?.nodes[0];\n+\n+    if (!node) {\n+      return;\n+    }\n+\n+    // TODO(Georgi): Drop `any` when Dagre is updated.\n+    const dagreNode = this.graph.node(node.id) as any;\n+    if (!dagreNode) {\n+      return;\n+    }\n+\n+    const contWidth = this.svg.clientWidth;\n+    const contHeight = this.svg.clientHeight;\n+    const x = contWidth / 2 - dagreNode.x * TEMPL_NODE_ZOOM_SCALE;\n+    const y = contHeight / 2 - dagreNode.y * TEMPL_NODE_ZOOM_SCALE;\n+\n+    d3.select(this.svg)\n+      .transition()\n+      .duration(500)\n+      .call(\n+        this.zoomController.transform,\n+        d3.zoomIdentity.translate(x, y).scale(TEMPL_NODE_ZOOM_SCALE),\n+      );\n+  }\n+\n   setSelected(selected: string | null) {\n     d3.select(this.svg)\n       .select('.output .nodes')\n@@ -144,28 +175,12 @@ export class SignalsGraphVisualizer {\n \n     this.drender(g, this.graph);\n \n-    // if there are no nodes, we reset the transform to 0\n-    const {width, height} = this.graph.graph();\n-    const xTransform = isFinite(width) ? -width / 2 : 0;\n-    const yTransform = isFinite(height) ? -height / 2 : 0;\n-    g.select('.output').attr('transform', `translate(${xTransform}, ${yTransform})`);\n-\n     this.addCloseButtonsToClusters(g);\n     this.reinforceNodeDimensions();\n \n     this.inputGraph = signalGraph;\n   }\n \n-  resize() {\n-    const svg = d3.select(this.svg);\n-    svg.attr('viewBox', [\n-      -this.svg.clientWidth / 2,\n-      -this.svg.clientHeight / 2,\n-      this.svg.clientWidth,\n-      this.svg.clientHeight,\n-    ]);\n-  }\n-\n   setClusterState(clusterId: string, expanded: boolean) {\n     if (!this.inputGraph) {\n       return;"}, {"role": "assistant", "content": "refactor(devtools): snap to root node on signal graph render"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n packages/core/src/change_detection/lifecycle_hooks.ts | 19 +++++++++++++++----\n 1 file changed, 15 insertions(+), 4 deletions(-)\n\ndiff --git a/packages/core/src/change_detection/lifecycle_hooks.ts b/packages/core/src/change_detection/lifecycle_hooks.ts\nindex 94ac41ed..4a61dc26 100644\n--- a/packages/core/src/change_detection/lifecycle_hooks.ts\n+++ b/packages/core/src/change_detection/lifecycle_hooks.ts\n@@ -9,7 +9,8 @@ import {SimpleChanges} from './simple_change';\n \n /**\n  * @description\n- * A lifecycle hook that is called when any data-bound property of a directive changes.\n+ * A lifecycle hook that is called when the value of one or more component or directive inputs\n+ * change. This includes both signal-based and decorator-based inputs.\n  * Define an `ngOnChanges()` method to handle the changes.\n  *\n  * @see {@link DoCheck}\n@@ -18,9 +19,19 @@ import {SimpleChanges} from './simple_change';\n  *\n  * @usageNotes\n  * The following snippet shows how a component can implement this interface to\n- * define an on-changes handler for an input property.\n- *\n- * {@example core/ts/metadata/lifecycle_hooks_spec.ts region='OnChanges'}\n+ * define an on-changes handler for an input property. While you should prefer\n+ * `computed` and `effect` when working with signal-based inputs, the `ngOnChanges`\n+ * method does include value changes for signal-based inputs.\n+ *\n+ * ```ts\n+ * @Component({ ... })\n+ * export class UserProfile implements OnChanges {\n+ *   userId = input<number>(0);\n+ *   ngOnChanges(changes: SimpleChanges<UserProfile>) {\n+ *     // changes.userId contains the old and new value.\n+ *   }\n+ * }\n+ * ```\n  *\n  * @publicApi\n  */"}, {"role": "assistant", "content": "docs: update OnChanges API reference w/ signal input"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/tr/llm-prompt.md | 52 +++++++++++++++++++++++++++++++++++++++++++++++++++\n 1 file changed, 52 insertions(+)\n\ndiff --git a/docs/tr/llm-prompt.md b/docs/tr/llm-prompt.md\nnew file mode 100644\nindex 0000000..38377f4\n--- /dev/null\n+++ b/docs/tr/llm-prompt.md\n@@ -0,0 +1,52 @@\n+### Target language\n+\n+Translate to Turkish (T\u00fcrk\u00e7e).\n+\n+Language code: tr.\n+\n+### Grammar and tone\n+\n+1) Use instructional Turkish, consistent with existing Turkish docs.\n+2) Use imperative/guide language when appropriate (e.g. \u201ca\u00e7al\u0131m\u201d, \u201cgidin\u201d, \u201ckopyalayal\u0131m\u201d).\n+\n+### Headings\n+\n+1) Follow existing Turkish heading style (Title Case where used; no trailing period).\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Turkish docs (they frequently use ASCII quotes in prose).\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Turkish docs.\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Do not translate technical terms like path, route, request, response, query, body, cookie, and header, keep them as is.\n+\n+- Suffixing is very important, when adding Turkish suffixes to the English words, do that based on the pronunciation of the word and with an apostrophe.\n+\n+- Suffixes also changes based on what word comes next in Turkish too, here is an example:\n+\n+\"Server'a gelen request'leri intercept... \" or this could have been \"request'e\", \"request'i\" etc.\n+\n+- Some words are tricky like \"path'e\" can't be used like \"path'a\" but it could have been \"path'i\" \"path'leri\" etc.\n+\n+- You can use a more instructional style, that is consistent with the document, you can add the Turkish version of the term in parenthesis if it is not something very obvious, or an advanced concept, but do not over do it, do it only the first time it is mentioned, but keep the English term as the primary word.\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | Not`\n+- `/// note | Teknik Detaylar`\n+- `/// tip | \u0130pucu`\n+- `/// warning | Uyar\u0131`\n+- `/// info | Bilgi`\n+- `/// check | Ek bilgi`\n+\n+Prefer `\u0130pucu` over `Ipucu`."}, {"role": "assistant", "content": "docs: add turkish translation prompt guide"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/__tests__/store-test.js                    | 95 +++++++++++++++++++++-\n 1 file changed, 93 insertions(+), 2 deletions(-)\n\ndiff --git a/packages/react-devtools-shared/src/__tests__/store-test.js b/packages/react-devtools-shared/src/__tests__/store-test.js\nindex c4fe7d3..8c9beb1 100644\n--- a/packages/react-devtools-shared/src/__tests__/store-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/store-test.js\n@@ -7,7 +7,12 @@\n  * @flow\n  */\n \n+import semver from 'semver';\n+\n import {getVersionedRenderImplementation} from './utils';\n+import {ReactVersion} from '../../../../ReactVersions';\n+\n+const ReactVersionTestingAgainst = process.env.REACT_VERSION || ReactVersion;\n \n describe('Store', () => {\n   let React;\n@@ -3143,8 +3148,9 @@ describe('Store', () => {\n     expect(store).toMatchInlineSnapshot(``);\n   });\n \n-  // @reactVersion >= 17.0\n-  it('should track suspended by in filtered fallback', async () => {\n+  // Can't suspend the root in React 17.\n+  // @reactVersion >= 18.0\n+  it('should track suspended-by in filtered fallback suspending the root', async () => {\n     function IgnoreMe({promise}) {\n       return readValue(promise);\n     }\n@@ -3196,6 +3202,91 @@ describe('Store', () => {\n     `);\n   });\n \n+  // @reactVersion >= 17.0\n+  it('should track suspended-by in filtered fallback', async () => {\n+    function IgnoreMe({promise}) {\n+      return readValue(promise);\n+    }\n+\n+    function Component({promise}) {\n+      if (promise) {\n+        return readValue(promise);\n+      }\n+      return null;\n+    }\n+\n+    await actAsync(\n+      async () =>\n+        (store.componentFilters = [createDisplayNameFilter('^IgnoreMe', true)]),\n+    );\n+\n+    let resolveFallback;\n+    const fallbackPromise = new Promise(resolve => {\n+      resolveFallback = resolve;\n+    });\n+    let resolveContent;\n+    const contentPromise = new Promise(resolve => {\n+      resolveContent = resolve;\n+    });\n+\n+    await actAsync(() =>\n+      render(\n+        <React.Suspense\n+          fallback={<Component key=\"root-fallback\" />}\n+          name=\"root\">\n+          <React.Suspense\n+            name=\"main\"\n+            fallback={<IgnoreMe promise={fallbackPromise} />}>\n+            <Component promise={contentPromise} />\n+          </React.Suspense>\n+        </React.Suspense>,\n+      ),\n+    );\n+\n+    if (semver.lt(ReactVersionTestingAgainst, '18.0.0')) {\n+      // React 17 commits partial trees hidden which causes the \"main\"\n+      // Suspense boundary to be included.\n+      // React 18 and upwards excluded partial tree entirely.\n+      expect(store).toMatchInlineSnapshot(`\n+        [root]\n+          \u25be <Suspense name=\"root\">\n+              <Component key=\"root-fallback\">\n+        [suspense-root]  rects={null}\n+          <Suspense name=\"root\" rects={null}>\n+            <Suspense name=\"main\" rects={null}>\n+      `);\n+    } else {\n+      expect(store).toMatchInlineSnapshot(`\n+        [root]\n+          \u25be <Suspense name=\"root\">\n+              <Component key=\"root-fallback\">\n+        [suspense-root]  rects={null}\n+          <Suspense name=\"root\" rects={null}>\n+      `);\n+    }\n+\n+    await actAsync(() => resolveFallback('loading'));\n+    expect(store).toMatchInlineSnapshot(`\n+      [root]\n+        \u25be <Suspense name=\"root\">\n+            <Suspense name=\"main\">\n+      [suspense-root]  rects={null}\n+        <Suspense name=\"root\" rects={null}>\n+          <Suspense name=\"main\" rects={null}>\n+    `);\n+\n+    await actAsync(() => resolveContent('content'));\n+    expect(store).toMatchInlineSnapshot(`\n+      [root]\n+        \u25be <Suspense name=\"root\">\n+          \u25be <Suspense name=\"main\">\n+              <Component>\n+      [suspense-root]  rects={null}\n+        <Suspense name=\"root\" rects={null}>\n+          <Suspense name=\"main\" rects={null}>\n+    `);\n+  });\n+\n   // @reactVersion >= 19\n   it('should keep suspended boundaries in the Suspense tree but not hidden Activity', async () => {\n     const Activity = React.Activity || React.unstable_Activity;"}, {"role": "assistant", "content": "test(store): add suspended-by tracking test for filtered fallback"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/sort/sort.go | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/sort/sort.go b/src/sort/sort.go\nindex fd3cd6da..087e7d03 100644\n--- a/src/sort/sort.go\n+++ b/src/sort/sort.go\n@@ -197,7 +197,7 @@ func Float64sAreSorted(x []float64) bool { return slices.IsSorted(x) }\n func StringsAreSorted(x []string) bool { return slices.IsSorted(x) }\n \n // Notes on stable sorting:\n-// The used algorithms are simple and provable correct on all input and use\n+// The used algorithms are simple and provably correct on all input and use\n // only logarithmic additional stack space. They perform well if compared\n // experimentally to other stable in-place sorting algorithms.\n //"}, {"role": "assistant", "content": "docs: fix typo in sort package comments"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/compile/internal/ssa/_gen/AMD64.rules      |   8 +\n src/cmd/compile/internal/ssa/rewriteAMD64.go       | 168 +++++++++++++++++++++\n .../archsimd/internal/simd_test/compare_test.go    |  34 +++++\n test/codegen/simd.go                               |  31 +++-\n 4 files changed, 239 insertions(+), 2 deletions(-)\n\ndiff --git a/src/cmd/compile/internal/ssa/_gen/AMD64.rules b/src/cmd/compile/internal/ssa/_gen/AMD64.rules\nindex 9c541868..9cd23c62 100644\n--- a/src/cmd/compile/internal/ssa/_gen/AMD64.rules\n+++ b/src/cmd/compile/internal/ssa/_gen/AMD64.rules\n@@ -1824,3 +1824,11 @@\n (EQ (VPTEST x:(VPAND(D|Q)512 j k) y) yes no) && x == y && x.Uses == 2 => (EQ (VPTEST j k) yes no)\n (EQ (VPTEST x:(VPANDN(128|256) j k) y) yes no) && x == y && x.Uses == 2 => (ULT (VPTEST k j) yes no) // AndNot has swapped its operand order\n (EQ (VPTEST x:(VPANDN(D|Q)512 j k) y) yes no) && x == y && x.Uses == 2 => (ULT (VPTEST k j) yes no) // AndNot has swapped its operand order\n+\n+// optimize x.IsNaN().Or(y.IsNaN())\n+(VPOR128 (VCMPP(S|D)128 [3] x x) (VCMPP(S|D)128 [3] y y)) => (VCMPP(S|D)128 [3] x y)\n+(VPOR256 (VCMPP(S|D)256 [3] x x) (VCMPP(S|D)256 [3] y y)) => (VCMPP(S|D)256 [3] x y)\n+(VPORD512 (VPMOVMToVec32x16 (VCMPPS512 [3] x x)) (VPMOVMToVec32x16 (VCMPPS512 [3] y y))) =>\n+\t(VPMOVMToVec32x16 (VCMPPS512 [3] x y))\n+(VPORD512 (VPMOVMToVec64x8  (VCMPPD512 [3] x x)) (VPMOVMToVec64x8  (VCMPPD512 [3] y y))) =>\n+\t(VPMOVMToVec64x8  (VCMPPD512 [3] x y))\ndiff --git a/src/cmd/compile/internal/ssa/rewriteAMD64.go b/src/cmd/compile/internal/ssa/rewriteAMD64.go\nindex 0b2bb74c..3eb2a627 100644\n--- a/src/cmd/compile/internal/ssa/rewriteAMD64.go\n+++ b/src/cmd/compile/internal/ssa/rewriteAMD64.go\n@@ -1382,6 +1382,10 @@ func rewriteValueAMD64(v *Value) bool {\n \t\treturn rewriteValueAMD64_OpAMD64VPOPCNTQMasked256(v)\n \tcase OpAMD64VPOPCNTQMasked512:\n \t\treturn rewriteValueAMD64_OpAMD64VPOPCNTQMasked512(v)\n+\tcase OpAMD64VPOR128:\n+\t\treturn rewriteValueAMD64_OpAMD64VPOR128(v)\n+\tcase OpAMD64VPOR256:\n+\t\treturn rewriteValueAMD64_OpAMD64VPOR256(v)\n \tcase OpAMD64VPORD512:\n \t\treturn rewriteValueAMD64_OpAMD64VPORD512(v)\n \tcase OpAMD64VPORDMasked128:\n@@ -56768,9 +56772,173 @@ func rewriteValueAMD64_OpAMD64VPOPCNTQMasked512(v *Value) bool {\n \t}\n \treturn false\n }\n+func rewriteValueAMD64_OpAMD64VPOR128(v *Value) bool {\n+\tv_1 := v.Args[1]\n+\tv_0 := v.Args[0]\n+\t// match: (VPOR128 (VCMPPS128 [3] x x) (VCMPPS128 [3] y y))\n+\t// result: (VCMPPS128 [3] x y)\n+\tfor {\n+\t\tfor _i0 := 0; _i0 <= 1; _i0, v_0, v_1 = _i0+1, v_1, v_0 {\n+\t\t\tif v_0.Op != OpAMD64VCMPPS128 || auxIntToUint8(v_0.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tx := v_0.Args[1]\n+\t\t\tif x != v_0.Args[0] || v_1.Op != OpAMD64VCMPPS128 || auxIntToUint8(v_1.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\ty := v_1.Args[1]\n+\t\t\tif y != v_1.Args[0] {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv.reset(OpAMD64VCMPPS128)\n+\t\t\tv.AuxInt = uint8ToAuxInt(3)\n+\t\t\tv.AddArg2(x, y)\n+\t\t\treturn true\n+\t\t}\n+\t\tbreak\n+\t}\n+\t// match: (VPOR128 (VCMPPD128 [3] x x) (VCMPPD128 [3] y y))\n+\t// result: (VCMPPD128 [3] x y)\n+\tfor {\n+\t\tfor _i0 := 0; _i0 <= 1; _i0, v_0, v_1 = _i0+1, v_1, v_0 {\n+\t\t\tif v_0.Op != OpAMD64VCMPPD128 || auxIntToUint8(v_0.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tx := v_0.Args[1]\n+\t\t\tif x != v_0.Args[0] || v_1.Op != OpAMD64VCMPPD128 || auxIntToUint8(v_1.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\ty := v_1.Args[1]\n+\t\t\tif y != v_1.Args[0] {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv.reset(OpAMD64VCMPPD128)\n+\t\t\tv.AuxInt = uint8ToAuxInt(3)\n+\t\t\tv.AddArg2(x, y)\n+\t\t\treturn true\n+\t\t}\n+\t\tbreak\n+\t}\n+\treturn false\n+}\n+func rewriteValueAMD64_OpAMD64VPOR256(v *Value) bool {\n+\tv_1 := v.Args[1]\n+\tv_0 := v.Args[0]\n+\t// match: (VPOR256 (VCMPPS256 [3] x x) (VCMPPS256 [3] y y))\n+\t// result: (VCMPPS256 [3] x y)\n+\tfor {\n+\t\tfor _i0 := 0; _i0 <= 1; _i0, v_0, v_1 = _i0+1, v_1, v_0 {\n+\t\t\tif v_0.Op != OpAMD64VCMPPS256 || auxIntToUint8(v_0.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tx := v_0.Args[1]\n+\t\t\tif x != v_0.Args[0] || v_1.Op != OpAMD64VCMPPS256 || auxIntToUint8(v_1.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\ty := v_1.Args[1]\n+\t\t\tif y != v_1.Args[0] {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv.reset(OpAMD64VCMPPS256)\n+\t\t\tv.AuxInt = uint8ToAuxInt(3)\n+\t\t\tv.AddArg2(x, y)\n+\t\t\treturn true\n+\t\t}\n+\t\tbreak\n+\t}\n+\t// match: (VPOR256 (VCMPPD256 [3] x x) (VCMPPD256 [3] y y))\n+\t// result: (VCMPPD256 [3] x y)\n+\tfor {\n+\t\tfor _i0 := 0; _i0 <= 1; _i0, v_0, v_1 = _i0+1, v_1, v_0 {\n+\t\t\tif v_0.Op != OpAMD64VCMPPD256 || auxIntToUint8(v_0.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tx := v_0.Args[1]\n+\t\t\tif x != v_0.Args[0] || v_1.Op != OpAMD64VCMPPD256 || auxIntToUint8(v_1.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\ty := v_1.Args[1]\n+\t\t\tif y != v_1.Args[0] {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv.reset(OpAMD64VCMPPD256)\n+\t\t\tv.AuxInt = uint8ToAuxInt(3)\n+\t\t\tv.AddArg2(x, y)\n+\t\t\treturn true\n+\t\t}\n+\t\tbreak\n+\t}\n+\treturn false\n+}\n func rewriteValueAMD64_OpAMD64VPORD512(v *Value) bool {\n \tv_1 := v.Args[1]\n \tv_0 := v.Args[0]\n+\tb := v.Block\n+\ttyp := &b.Func.Config.Types\n+\t// match: (VPORD512 (VPMOVMToVec32x16 (VCMPPS512 [3] x x)) (VPMOVMToVec32x16 (VCMPPS512 [3] y y)))\n+\t// result: (VPMOVMToVec32x16 (VCMPPS512 [3] x y))\n+\tfor {\n+\t\tfor _i0 := 0; _i0 <= 1; _i0, v_0, v_1 = _i0+1, v_1, v_0 {\n+\t\t\tif v_0.Op != OpAMD64VPMOVMToVec32x16 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv_0_0 := v_0.Args[0]\n+\t\t\tif v_0_0.Op != OpAMD64VCMPPS512 || auxIntToUint8(v_0_0.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tx := v_0_0.Args[1]\n+\t\t\tif x != v_0_0.Args[0] || v_1.Op != OpAMD64VPMOVMToVec32x16 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv_1_0 := v_1.Args[0]\n+\t\t\tif v_1_0.Op != OpAMD64VCMPPS512 || auxIntToUint8(v_1_0.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\ty := v_1_0.Args[1]\n+\t\t\tif y != v_1_0.Args[0] {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv.reset(OpAMD64VPMOVMToVec32x16)\n+\t\t\tv0 := b.NewValue0(v.Pos, OpAMD64VCMPPS512, typ.Mask)\n+\t\t\tv0.AuxInt = uint8ToAuxInt(3)\n+\t\t\tv0.AddArg2(x, y)\n+\t\t\tv.AddArg(v0)\n+\t\t\treturn true\n+\t\t}\n+\t\tbreak\n+\t}\n+\t// match: (VPORD512 (VPMOVMToVec64x8 (VCMPPD512 [3] x x)) (VPMOVMToVec64x8 (VCMPPD512 [3] y y)))\n+\t// result: (VPMOVMToVec64x8 (VCMPPD512 [3] x y))\n+\tfor {\n+\t\tfor _i0 := 0; _i0 <= 1; _i0, v_0, v_1 = _i0+1, v_1, v_0 {\n+\t\t\tif v_0.Op != OpAMD64VPMOVMToVec64x8 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv_0_0 := v_0.Args[0]\n+\t\t\tif v_0_0.Op != OpAMD64VCMPPD512 || auxIntToUint8(v_0_0.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tx := v_0_0.Args[1]\n+\t\t\tif x != v_0_0.Args[0] || v_1.Op != OpAMD64VPMOVMToVec64x8 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv_1_0 := v_1.Args[0]\n+\t\t\tif v_1_0.Op != OpAMD64VCMPPD512 || auxIntToUint8(v_1_0.AuxInt) != 3 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\ty := v_1_0.Args[1]\n+\t\t\tif y != v_1_0.Args[0] {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tv.reset(OpAMD64VPMOVMToVec64x8)\n+\t\t\tv0 := b.NewValue0(v.Pos, OpAMD64VCMPPD512, typ.Mask)\n+\t\t\tv0.AuxInt = uint8ToAuxInt(3)\n+\t\t\tv0.AddArg2(x, y)\n+\t\t\tv.AddArg(v0)\n+\t\t\treturn true\n+\t\t}\n+\t\tbreak\n+\t}\n \t// match: (VPORD512 x l:(VMOVDQUload512 {sym} [off] ptr mem))\n \t// cond: canMergeLoad(v, l) && clobber(l)\n \t// result: (VPORD512load {sym} [off] x ptr mem)\ndiff --git a/src/simd/archsimd/internal/simd_test/compare_test.go b/src/simd/archsimd/internal/simd_test/compare_test.go\nindex e678676b..ea8514ac 100644\n--- a/src/simd/archsimd/internal/simd_test/compare_test.go\n+++ b/src/simd/archsimd/internal/simd_test/compare_test.go\n@@ -309,4 +309,38 @@ func TestIsNaN(t *testing.T) {\n \t\ttestFloat32x16UnaryCompare(t, archsimd.Float32x16.IsNaN, isNaNSlice[float32])\n \t\ttestFloat64x8UnaryCompare(t, archsimd.Float64x8.IsNaN, isNaNSlice[float64])\n \t}\n+\n+\t// Test x.IsNaN().Or(y.IsNaN()), which is optimized to VCMPP(S|D) $3, x, y.\n+\twant32 := mapCompare(func(x, y float32) bool { return x != x || y != y })\n+\twant64 := mapCompare(func(x, y float64) bool { return x != x || y != y })\n+\ttestFloat32x4Compare(t,\n+\t\tfunc(x, y archsimd.Float32x4) archsimd.Mask32x4 {\n+\t\t\treturn x.IsNaN().Or(y.IsNaN())\n+\t\t}, want32)\n+\ttestFloat64x2Compare(t,\n+\t\tfunc(x, y archsimd.Float64x2) archsimd.Mask64x2 {\n+\t\t\treturn x.IsNaN().Or(y.IsNaN())\n+\t\t}, want64)\n+\n+\tif archsimd.X86.AVX2() {\n+\t\ttestFloat32x8Compare(t,\n+\t\t\tfunc(x, y archsimd.Float32x8) archsimd.Mask32x8 {\n+\t\t\t\treturn x.IsNaN().Or(y.IsNaN())\n+\t\t\t}, want32)\n+\t\ttestFloat64x4Compare(t,\n+\t\t\tfunc(x, y archsimd.Float64x4) archsimd.Mask64x4 {\n+\t\t\t\treturn x.IsNaN().Or(y.IsNaN())\n+\t\t\t}, want64)\n+\t}\n+\n+\tif archsimd.X86.AVX512() {\n+\t\ttestFloat32x16Compare(t,\n+\t\t\tfunc(x, y archsimd.Float32x16) archsimd.Mask32x16 {\n+\t\t\t\treturn x.IsNaN().Or(y.IsNaN())\n+\t\t\t}, want32)\n+\t\ttestFloat64x8Compare(t,\n+\t\t\tfunc(x, y archsimd.Float64x8) archsimd.Mask64x8 {\n+\t\t\t\treturn x.IsNaN().Or(y.IsNaN())\n+\t\t\t}, want64)\n+\t}\n }\ndiff --git a/test/codegen/simd.go b/test/codegen/simd.go\nindex 8f3a1a9f..04e01944 100644\n--- a/test/codegen/simd.go\n+++ b/test/codegen/simd.go\n@@ -6,11 +6,14 @@\n \n // These tests check code generation of simd peephole optimizations.\n \n-//go:build goexperiment.simd\n+//go:build goexperiment.simd && amd64\n \n package codegen\n \n-import \"simd/archsimd\"\n+import (\n+\t\"math\"\n+\t\"simd/archsimd\"\n+)\n \n func vptest1() bool {\n \tv1 := archsimd.LoadUint64x2Slice([]uint64{0, 1})\n@@ -77,3 +80,27 @@ func simdMaskedMerge() archsimd.Int16x16 {\n \tmask := archsimd.Mask16x16FromBits(5)\n \treturn x.Add(y).Merge(x, mask) // amd64:`VPBLENDVB\\s.*$`\n }\n+\n+var nan = math.NaN()\n+var floats64s = []float64{0, 1, 2, nan, 4, nan, 6, 7, 8, 9, 10, 11, nan, 13, 14, 15}\n+var sinkInt64s = make([]int64, 100)\n+\n+func simdIsNaN() {\n+\tx := archsimd.LoadFloat64x4Slice(floats64s)\n+\ty := archsimd.LoadFloat64x4Slice(floats64s[4:])\n+\ta := x.IsNaN()\n+\tb := y.IsNaN()\n+\t// amd64:\"VCMPPD [$]3,\" -\"VPOR\"\n+\tc := a.Or(b)\n+\tc.ToInt64x4().StoreSlice(sinkInt64s)\n+}\n+\n+func simdIsNaN512() {\n+\tx := archsimd.LoadFloat64x8Slice(floats64s)\n+\ty := archsimd.LoadFloat64x8Slice(floats64s[8:])\n+\ta := x.IsNaN()\n+\tb := y.IsNaN()\n+\t// amd64:\"VCMPPD [$]3,\" -\"VPOR\"\n+\tc := a.Or(b)\n+\tc.ToInt64x8().StoreSlice(sinkInt64s)\n+}"}, {"role": "assistant", "content": "feat(ssa): optimize IsNaN or pattern for SIMD comparisons"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_codegen_llvm/src/attributes.rs      | 11 +-------\n library/alloc/src/slice.rs                         |  8 +++---\n library/alloc/src/vec/mod.rs                       |  6 +----\n .../lib-optimizations/append-elements.rs           | 30 ----------------------\n 4 files changed, 5 insertions(+), 50 deletions(-)\n\ndiff --git a/compiler/rustc_codegen_llvm/src/attributes.rs b/compiler/rustc_codegen_llvm/src/attributes.rs\nindex bf6bb81b53b..a25ce9e5a90 100644\n--- a/compiler/rustc_codegen_llvm/src/attributes.rs\n+++ b/compiler/rustc_codegen_llvm/src/attributes.rs\n@@ -517,16 +517,7 @@ pub(crate) fn llfn_attrs_from_instance<'ll, 'tcx>(\n         to_add.push(llvm::CreateAllocKindAttr(cx.llcx, AllocKindFlags::Free));\n         // applies to argument place instead of function place\n         let allocated_pointer = AttributeKind::AllocatedPointer.create_attr(cx.llcx);\n-        let attrs: &[_] = if llvm_util::get_version() >= (21, 0, 0) {\n-            // \"Does not capture provenance\" means \"if the function call stashes the pointer somewhere,\n-            // accessing that pointer after the function returns is UB\". That is definitely the case here since\n-            // freeing will destroy the provenance.\n-            let captures_addr = AttributeKind::CapturesAddress.create_attr(cx.llcx);\n-            &[allocated_pointer, captures_addr]\n-        } else {\n-            &[allocated_pointer]\n-        };\n-        attributes::apply_to_llfn(llfn, AttributePlace::Argument(0), attrs);\n+        attributes::apply_to_llfn(llfn, AttributePlace::Argument(0), &[allocated_pointer]);\n     }\n     if let Some(align) = codegen_fn_attrs.alignment {\n         llvm::set_alignment(llfn, align);\ndiff --git a/library/alloc/src/slice.rs b/library/alloc/src/slice.rs\nindex 58abf4bd657..e7d0fc3454e 100644\n--- a/library/alloc/src/slice.rs\n+++ b/library/alloc/src/slice.rs\n@@ -448,11 +448,9 @@ fn to_vec<A: Allocator>(s: &[Self], alloc: A) -> Vec<Self, A> {\n                 // SAFETY:\n                 // allocated above with the capacity of `s`, and initialize to `s.len()` in\n                 // ptr::copy_to_non_overlapping below.\n-                if s.len() > 0 {\n-                    unsafe {\n-                        s.as_ptr().copy_to_nonoverlapping(v.as_mut_ptr(), s.len());\n-                        v.set_len(s.len());\n-                    }\n+                unsafe {\n+                    s.as_ptr().copy_to_nonoverlapping(v.as_mut_ptr(), s.len());\n+                    v.set_len(s.len());\n                 }\n                 v\n             }\ndiff --git a/library/alloc/src/vec/mod.rs b/library/alloc/src/vec/mod.rs\nindex ac86399df7a..379e964f0a0 100644\n--- a/library/alloc/src/vec/mod.rs\n+++ b/library/alloc/src/vec/mod.rs\n@@ -2818,11 +2818,7 @@ unsafe fn append_elements(&mut self, other: *const [T]) {\n         let count = other.len();\n         self.reserve(count);\n         let len = self.len();\n-        if count > 0 {\n-            unsafe {\n-                ptr::copy_nonoverlapping(other as *const T, self.as_mut_ptr().add(len), count)\n-            };\n-        }\n+        unsafe { ptr::copy_nonoverlapping(other as *const T, self.as_mut_ptr().add(len), count) };\n         self.len += count;\n     }\n \ndiff --git a/tests/codegen-llvm/lib-optimizations/append-elements.rs b/tests/codegen-llvm/lib-optimizations/append-elements.rs\ndeleted file mode 100644\nindex 8ee520a131f..00000000000\n--- a/tests/codegen-llvm/lib-optimizations/append-elements.rs\n+++ /dev/null\n@@ -1,30 +0,0 @@\n-//@ compile-flags: -O -Zmerge-functions=disabled\n-//@ min-llvm-version: 21\n-#![crate_type = \"lib\"]\n-\n-//! Check that a temporary intermediate allocations can eliminated and replaced\n-//! with memcpy forwarding.\n-//! This requires Vec code to be structured in a way that avoids phi nodes from the\n-//! zero-capacity length flowing into the memcpy arguments.\n-\n-// CHECK-LABEL: @vec_append_with_temp_alloc\n-#[no_mangle]\n-pub fn vec_append_with_temp_alloc(dst: &mut Vec<u8>, src: &[u8]) {\n-    // CHECK-NOT: call void @llvm.memcpy\n-    // CHECK: call void @llvm.memcpy.{{.*}}%dst.i{{.*}}%src.0\n-    // CHECK-NOT: call void @llvm.memcpy\n-    let temp = src.to_vec();\n-    dst.extend(&temp);\n-    // CHECK: ret\n-}\n-\n-// CHECK-LABEL: @string_append_with_temp_alloc\n-#[no_mangle]\n-pub fn string_append_with_temp_alloc(dst: &mut String, src: &str) {\n-    // CHECK-NOT: call void @llvm.memcpy\n-    // CHECK: call void @llvm.memcpy.{{.*}}%dst.i{{.*}}%src.0\n-    // CHECK-NOT: call void @llvm.memcpy\n-    let temp = src.to_string();\n-    dst.push_str(&temp);\n-    // CHECK: ret\n-}"}, {"role": "assistant", "content": "refactor: remove unnecessary zero-length checks in copy operations"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../babel-plugin-react-compiler/src/HIR/HIR.ts     |   1 +\n .../src/Inference/DropManualMemoization.ts         |   3 +\n .../Validation/ValidateExhaustiveDependencies.ts   | 148 ++++++++++-----\n .../ValidatePreservedManualMemoization.ts          |   4 +\n .../error.invalid-exhaustive-deps.expect.md        | 109 -----------\n ...-exhaustive-deps-violation-in-effects.expect.md |   0\n ...es-with-exhaustive-deps-violation-in-effects.js |   0\n ...rror.invalid-dep-on-ref-current-value.expect.md |  40 ++++\n .../error.invalid-dep-on-ref-current-value.js      |  10 +\n ...ive-deps-disallow-unused-stable-types.expect.md |  10 +-\n ...exhaustive-deps-disallow-unused-stable-types.js |   0\n .../error.invalid-exhaustive-deps.expect.md        | 204 +++++++++++++++++++++\n .../error.invalid-exhaustive-deps.js               |   0\n ...issing-nonreactive-dep-inner-function.expect.md |  43 +++++\n ...valid-missing-nonreactive-dep-inner-function.js |  15 ++\n ...id-missing-nonreactive-dep-unmemoized.expect.md |  43 +++++\n ...r.invalid-missing-nonreactive-dep-unmemoized.js |  13 ++\n ...error.invalid-missing-nonreactive-dep.expect.md |  40 ++++\n .../error.invalid-missing-nonreactive-dep.js       |  10 +\n .../error.sketchy-code-exhaustive-deps.expect.md   |   6 +-\n .../error.sketchy-code-exhaustive-deps.js          |   0\n ...ive-deps-allow-constant-folded-values.expect.md |   0\n ...exhaustive-deps-allow-constant-folded-values.js |   0\n ...onreactive-stable-types-as-extra-deps.expect.md |   0\n ...allow-nonreactive-stable-types-as-extra-deps.js |   0\n .../exhaustive-deps.expect.md                      |   0\n .../{ => exhaustive-deps}/exhaustive-deps.js       |   0\n ...seMemo-unrelated-mutation-in-depslist.expect.md |   6 +-\n 28 files changed, 545 insertions(+), 160 deletions(-)\n\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts b/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\nindex 9fb360c..3e4cbb9 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\n@@ -807,6 +807,7 @@ export type ManualMemoDependency = {\n       }\n     | {kind: 'Global'; identifierName: string};\n   path: DependencyPath;\n+  loc: SourceLocation;\n };\n \n export type StartMemoize = {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Inference/DropManualMemoization.ts b/compiler/packages/babel-plugin-react-compiler/src/Inference/DropManualMemoization.ts\nindex 0138e52..647562a 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Inference/DropManualMemoization.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Inference/DropManualMemoization.ts\n@@ -65,6 +65,7 @@ export function collectMaybeMemoDependencies(\n           identifierName: value.binding.name,\n         },\n         path: [],\n+        loc: value.loc,\n       };\n     }\n     case 'PropertyLoad': {\n@@ -74,6 +75,7 @@ export function collectMaybeMemoDependencies(\n           root: object.root,\n           // TODO: determine if the access is optional\n           path: [...object.path, {property: value.property, optional}],\n+          loc: value.loc,\n         };\n       }\n       break;\n@@ -95,6 +97,7 @@ export function collectMaybeMemoDependencies(\n             constant: false,\n           },\n           path: [],\n+          loc: value.place.loc,\n         };\n       }\n       break;\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\nindex 5035fa9..2e6217b 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\n@@ -241,11 +241,10 @@ export function validateExhaustiveDependencies(\n           matched.add(manualDependency);\n         }\n       }\n-      const isOptionalDependency =\n-        !reactive.has(inferredDependency.identifier.id) &&\n-        (isStableType(inferredDependency.identifier) ||\n-          isPrimitiveType(inferredDependency.identifier));\n-      if (hasMatchingManualDependency || isOptionalDependency) {\n+      if (\n+        hasMatchingManualDependency ||\n+        isOptionalDependency(inferredDependency, reactive)\n+      ) {\n         continue;\n       }\n       missing.push(inferredDependency);\n@@ -274,54 +273,106 @@ export function validateExhaustiveDependencies(\n     }\n \n     if (missing.length !== 0 || extra.length !== 0) {\n-      let suggestions: Array<CompilerSuggestion> | null = null;\n+      let suggestion: CompilerSuggestion | null = null;\n       if (startMemo.depsLoc != null && typeof startMemo.depsLoc !== 'symbol') {\n-        suggestions = [\n-          {\n-            description: 'Update dependencies',\n-            range: [startMemo.depsLoc.start.index, startMemo.depsLoc.end.index],\n-            op: CompilerSuggestionOperation.Replace,\n-            text: `[${inferred.map(printInferredDependency).join(', ')}]`,\n-          },\n-        ];\n+        suggestion = {\n+          description: 'Update dependencies',\n+          range: [startMemo.depsLoc.start.index, startMemo.depsLoc.end.index],\n+          op: CompilerSuggestionOperation.Replace,\n+          text: `[${inferred\n+            .filter(\n+              dep =>\n+                dep.kind === 'Local' && !isOptionalDependency(dep, reactive),\n+            )\n+            .map(printInferredDependency)\n+            .join(', ')}]`,\n+        };\n       }\n-      if (missing.length !== 0) {\n-        const diagnostic = CompilerDiagnostic.create({\n-          category: ErrorCategory.MemoDependencies,\n-          reason: 'Found missing memoization dependencies',\n-          description:\n-            'Missing dependencies can cause a value not to update when those inputs change, ' +\n-            'resulting in stale UI',\n-          suggestions,\n+      const diagnostic = CompilerDiagnostic.create({\n+        category: ErrorCategory.MemoDependencies,\n+        reason: 'Found missing/extra memoization dependencies',\n+        description: [\n+          missing.length !== 0\n+            ? 'Missing dependencies can cause a value to update less often than it should, ' +\n+              'resulting in stale UI'\n+            : null,\n+          extra.length !== 0\n+            ? 'Extra dependencies can cause a value to update more often than it should, ' +\n+              'resulting in performance problems such as excessive renders or effects firing too often'\n+            : null,\n+        ]\n+          .filter(Boolean)\n+          .join('. '),\n+        suggestions: suggestion != null ? [suggestion] : null,\n+      });\n+      for (const dep of missing) {\n+        let reactiveStableValueHint = '';\n+        if (isStableType(dep.identifier)) {\n+          reactiveStableValueHint =\n+            '. Refs, setState functions, and other \"stable\" values generally do not need to be added ' +\n+            'as dependencies, but this variable may change over time to point to different values';\n+        }\n+        diagnostic.withDetails({\n+          kind: 'error',\n+          message: `Missing dependency \\`${printInferredDependency(dep)}\\`${reactiveStableValueHint}`,\n+          loc: dep.loc,\n         });\n-        for (const dep of missing) {\n-          let reactiveStableValueHint = '';\n-          if (isStableType(dep.identifier)) {\n-            reactiveStableValueHint =\n-              '. Refs, setState functions, and other \"stable\" values generally do not need to be added as dependencies, but this variable may change over time to point to different values';\n-          }\n+      }\n+      for (const dep of extra) {\n+        if (dep.root.kind === 'Global') {\n           diagnostic.withDetails({\n             kind: 'error',\n-            message: `Missing dependency \\`${printInferredDependency(dep)}\\`${reactiveStableValueHint}`,\n-            loc: dep.loc,\n+            message:\n+              `Unnecessary dependency \\`${printManualMemoDependency(dep)}\\`. ` +\n+              'Values declared outside of a component/hook should not be listed as ' +\n+              'dependencies as the component will not re-render if they change',\n+            loc: dep.loc ?? startMemo.depsLoc ?? value.loc,\n           });\n+          error.pushDiagnostic(diagnostic);\n+        } else {\n+          const root = dep.root.value;\n+          const matchingInferred = inferred.find(\n+            (\n+              inferredDep,\n+            ): inferredDep is Extract<InferredDependency, {kind: 'Local'}> => {\n+              return (\n+                inferredDep.kind === 'Local' &&\n+                inferredDep.identifier.id === root.identifier.id &&\n+                isSubPathIgnoringOptionals(inferredDep.path, dep.path)\n+              );\n+            },\n+          );\n+          if (\n+            matchingInferred != null &&\n+            !isOptionalDependency(matchingInferred, reactive)\n+          ) {\n+            diagnostic.withDetails({\n+              kind: 'error',\n+              message:\n+                `Overly precise dependency \\`${printManualMemoDependency(dep)}\\`, ` +\n+                `use \\`${printInferredDependency(matchingInferred)}\\` instead`,\n+              loc: dep.loc ?? startMemo.depsLoc ?? value.loc,\n+            });\n+          } else {\n+            /**\n+             * Else this dependency doesn't correspond to anything referenced in the memo function,\n+             * or is an optional dependency so we don't want to suggest adding it\n+             */\n+            diagnostic.withDetails({\n+              kind: 'error',\n+              message: `Unnecessary dependency \\`${printManualMemoDependency(dep)}\\``,\n+              loc: dep.loc ?? startMemo.depsLoc ?? value.loc,\n+            });\n+          }\n         }\n-        error.pushDiagnostic(diagnostic);\n-      } else if (extra.length !== 0) {\n-        const diagnostic = CompilerDiagnostic.create({\n-          category: ErrorCategory.MemoDependencies,\n-          reason: 'Found unnecessary memoization dependencies',\n-          description:\n-            'Unnecessary dependencies can cause a value to update more often than necessary, ' +\n-            'causing performance regressions and effects to fire more often than expected',\n-        });\n+      }\n+      if (suggestion != null) {\n         diagnostic.withDetails({\n-          kind: 'error',\n-          message: `Unnecessary dependencies ${extra.map(dep => `\\`${printManualMemoDependency(dep)}\\``).join(', ')}`,\n-          loc: startMemo.depsLoc ?? value.loc,\n+          kind: 'hint',\n+          message: `Inferred dependencies: \\`${suggestion.text}\\``,\n         });\n-        error.pushDiagnostic(diagnostic);\n       }\n+      error.pushDiagnostic(diagnostic);\n     }\n \n     dependencies.clear();\n@@ -826,3 +877,14 @@ export function findOptionalPlaces(\n   }\n   return optionals;\n }\n+\n+function isOptionalDependency(\n+  inferredDependency: Extract<InferredDependency, {kind: 'Local'}>,\n+  reactive: Set<IdentifierId>,\n+): boolean {\n+  return (\n+    !reactive.has(inferredDependency.identifier.id) &&\n+    (isStableType(inferredDependency.identifier) ||\n+      isPrimitiveType(inferredDependency.identifier))\n+  );\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidatePreservedManualMemoization.ts b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidatePreservedManualMemoization.ts\nindex 48cec3c..9b1bf22 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidatePreservedManualMemoization.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidatePreservedManualMemoization.ts\n@@ -242,6 +242,7 @@ function validateInferredDep(\n     normalizedDep = {\n       root: maybeNormalizedRoot.root,\n       path: [...maybeNormalizedRoot.path, ...dep.path],\n+      loc: maybeNormalizedRoot.loc,\n     };\n   } else {\n     CompilerError.invariant(dep.identifier.name?.kind === 'named', {\n@@ -270,6 +271,7 @@ function validateInferredDep(\n         constant: false,\n       },\n       path: [...dep.path],\n+      loc: GeneratedSource,\n     };\n   }\n   for (const decl of declsWithinMemoBlock) {\n@@ -383,6 +385,7 @@ class Visitor extends ReactiveFunctionVisitor<VisitorState> {\n                   constant: false,\n                 },\n                 path: [],\n+                loc: storeTarget.loc,\n               });\n             }\n           }\n@@ -413,6 +416,7 @@ class Visitor extends ReactiveFunctionVisitor<VisitorState> {\n           constant: false,\n         },\n         path: [],\n+        loc: lvalue.loc,\n       });\n     }\n   }\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.expect.md\ndeleted file mode 100644\nindex ed317be..0000000\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.expect.md\n+++ /dev/null\n@@ -1,109 +0,0 @@\n-\n-## Input\n-\n-```javascript\n-// @validateExhaustiveMemoizationDependencies\n-import {useMemo} from 'react';\n-import {Stringify} from 'shared-runtime';\n-\n-function Component({x, y, z}) {\n-  const a = useMemo(() => {\n-    return x?.y.z?.a;\n-    // error: too precise\n-  }, [x?.y.z?.a.b]);\n-  const b = useMemo(() => {\n-    return x.y.z?.a;\n-    // ok, not our job to type check nullability\n-  }, [x.y.z.a]);\n-  const c = useMemo(() => {\n-    return x?.y.z.a?.b;\n-    // error: too precise\n-  }, [x?.y.z.a?.b.z]);\n-  const d = useMemo(() => {\n-    return x?.y?.[(console.log(y), z?.b)];\n-    // ok\n-  }, [x?.y, y, z?.b]);\n-  const e = useMemo(() => {\n-    const e = [];\n-    e.push(x);\n-    return e;\n-    // ok\n-  }, [x]);\n-  const f = useMemo(() => {\n-    return [];\n-    // error: unnecessary\n-  }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n-  const ref1 = useRef(null);\n-  const ref2 = useRef(null);\n-  const ref = z ? ref1 : ref2;\n-  const cb = useMemo(() => {\n-    return () => {\n-      return ref.current;\n-    };\n-    // error: ref is a stable type but reactive\n-  }, []);\n-  return <Stringify results={[a, b, c, d, e, f, cb]} />;\n-}\n-\n-```\n-\n-\n-## Error\n-\n-```\n-Found 4 errors:\n-\n-Error: Found missing memoization dependencies\n-\n-Missing dependencies can cause a value not to update when those inputs change, resulting in stale UI.\n-\n-error.invalid-exhaustive-deps.ts:7:11\n-   5 | function Component({x, y, z}) {\n-   6 |   const a = useMemo(() => {\n->  7 |     return x?.y.z?.a;\n-     |            ^^^^^^^^^ Missing dependency `x?.y.z?.a`\n-   8 |     // error: too precise\n-   9 |   }, [x?.y.z?.a.b]);\n-  10 |   const b = useMemo(() => {\n-\n-Error: Found missing memoization dependencies\n-\n-Missing dependencies can cause a value not to update when those inputs change, resulting in stale UI.\n-\n-error.invalid-exhaustive-deps.ts:15:11\n-  13 |   }, [x.y.z.a]);\n-  14 |   const c = useMemo(() => {\n-> 15 |     return x?.y.z.a?.b;\n-     |            ^^^^^^^^^^^ Missing dependency `x?.y.z.a?.b`\n-  16 |     // error: too precise\n-  17 |   }, [x?.y.z.a?.b.z]);\n-  18 |   const d = useMemo(() => {\n-\n-Error: Found unnecessary memoization dependencies\n-\n-Unnecessary dependencies can cause a value to update more often than necessary, causing performance regressions and effects to fire more often than expected.\n-\n-error.invalid-exhaustive-deps.ts:31:5\n-  29 |     return [];\n-  30 |     // error: unnecessary\n-> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n-     |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Unnecessary dependencies `x`, `y.z`, `z?.y?.a`, `UNUSED_GLOBAL`\n-  32 |   const ref1 = useRef(null);\n-  33 |   const ref2 = useRef(null);\n-  34 |   const ref = z ? ref1 : ref2;\n-\n-Error: Found missing memoization dependencies\n-\n-Missing dependencies can cause a value not to update when those inputs change, resulting in stale UI.\n-\n-error.invalid-exhaustive-deps.ts:37:13\n-  35 |   const cb = useMemo(() => {\n-  36 |     return () => {\n-> 37 |       return ref.current;\n-     |              ^^^ Missing dependency `ref`. Refs, setState functions, and other \"stable\" values generally do not need to be added as dependencies, but this variable may change over time to point to different values\n-  38 |     };\n-  39 |     // error: ref is a stable type but reactive\n-  40 |   }, []);\n-```\n-          \n-      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/compile-files-with-exhaustive-deps-violation-in-effects.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/compile-files-with-exhaustive-deps-violation-in-effects.expect.md\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/compile-files-with-exhaustive-deps-violation-in-effects.expect.md\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/compile-files-with-exhaustive-deps-violation-in-effects.expect.md\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/compile-files-with-exhaustive-deps-violation-in-effects.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/compile-files-with-exhaustive-deps-violation-in-effects.js\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/compile-files-with-exhaustive-deps-violation-in-effects.js\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/compile-files-with-exhaustive-deps-violation-in-effects.js\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-dep-on-ref-current-value.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-dep-on-ref-current-value.expect.md\nnew file mode 100644\nindex 0000000..ab9b408\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-dep-on-ref-current-value.expect.md\n@@ -0,0 +1,40 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveMemoizationDependencies\n+\n+function Component() {\n+  const ref = useRef(null);\n+  const onChange = useCallback(() => {\n+    return ref.current.value;\n+  }, [ref.current.value]);\n+\n+  return <input ref={ref} onChange={onChange} />;\n+}\n+\n+```\n+\n+\n+## Error\n+\n+```\n+Found 1 error:\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Extra dependencies can cause a value to update more often than it should, resulting in performance problems such as excessive renders or effects firing too often.\n+\n+error.invalid-dep-on-ref-current-value.ts:7:6\n+   5 |   const onChange = useCallback(() => {\n+   6 |     return ref.current.value;\n+>  7 |   }, [ref.current.value]);\n+     |       ^^^^^^^^^^^^^^^^^ Unnecessary dependency `ref.current.value`\n+   8 |\n+   9 |   return <input ref={ref} onChange={onChange} />;\n+  10 | }\n+\n+Inferred dependencies: `[]`\n+```\n+          \n+      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-dep-on-ref-current-value.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-dep-on-ref-current-value.js\nnew file mode 100644\nindex 0000000..f7a3ee4\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-dep-on-ref-current-value.js\n@@ -0,0 +1,10 @@\n+// @validateExhaustiveMemoizationDependencies\n+\n+function Component() {\n+  const ref = useRef(null);\n+  const onChange = useCallback(() => {\n+    return ref.current.value;\n+  }, [ref.current.value]);\n+\n+  return <input ref={ref} onChange={onChange} />;\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md\nsimilarity index 67%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md\nindex b6d8a46..30ab558 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md\n@@ -25,18 +25,20 @@ function Component() {\n ```\n Found 1 error:\n \n-Error: Found unnecessary memoization dependencies\n+Error: Found missing/extra memoization dependencies\n \n-Unnecessary dependencies can cause a value to update more often than necessary, causing performance regressions and effects to fire more often than expected.\n+Extra dependencies can cause a value to update more often than it should, resulting in performance problems such as excessive renders or effects firing too often.\n \n-error.invalid-exhaustive-deps-disallow-unused-stable-types.ts:11:5\n+error.invalid-exhaustive-deps-disallow-unused-stable-types.ts:11:13\n    9 |     return [state];\n   10 |     // error: `setState` is a stable type, but not actually referenced\n > 11 |   }, [state, setState]);\n-     |      ^^^^^^^^^^^^^^^^^ Unnecessary dependencies `setState`\n+     |              ^^^^^^^^ Unnecessary dependency `setState`\n   12 |\n   13 |   return 'oops';\n   14 | }\n+\n+Inferred dependencies: `[state]`\n ```\n           \n       \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps-disallow-unused-stable-types.js\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.js\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps-disallow-unused-stable-types.js\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps.expect.md\nnew file mode 100644\nindex 0000000..7f94c03\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps.expect.md\n@@ -0,0 +1,204 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveMemoizationDependencies\n+import {useMemo} from 'react';\n+import {Stringify} from 'shared-runtime';\n+\n+function Component({x, y, z}) {\n+  const a = useMemo(() => {\n+    return x?.y.z?.a;\n+    // error: too precise\n+  }, [x?.y.z?.a.b]);\n+  const b = useMemo(() => {\n+    return x.y.z?.a;\n+    // ok, not our job to type check nullability\n+  }, [x.y.z.a]);\n+  const c = useMemo(() => {\n+    return x?.y.z.a?.b;\n+    // error: too precise\n+  }, [x?.y.z.a?.b.z]);\n+  const d = useMemo(() => {\n+    return x?.y?.[(console.log(y), z?.b)];\n+    // ok\n+  }, [x?.y, y, z?.b]);\n+  const e = useMemo(() => {\n+    const e = [];\n+    e.push(x);\n+    return e;\n+    // ok\n+  }, [x]);\n+  const f = useMemo(() => {\n+    return [];\n+    // error: unnecessary\n+  }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+  const ref1 = useRef(null);\n+  const ref2 = useRef(null);\n+  const ref = z ? ref1 : ref2;\n+  const cb = useMemo(() => {\n+    return () => {\n+      return ref.current;\n+    };\n+    // error: ref is a stable type but reactive\n+  }, []);\n+  return <Stringify results={[a, b, c, d, e, f, cb]} />;\n+}\n+\n+```\n+\n+\n+## Error\n+\n+```\n+Found 5 errors:\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Missing dependencies can cause a value to update less often than it should, resulting in stale UI. Extra dependencies can cause a value to update more often than it should, resulting in performance problems such as excessive renders or effects firing too often.\n+\n+error.invalid-exhaustive-deps.ts:7:11\n+   5 | function Component({x, y, z}) {\n+   6 |   const a = useMemo(() => {\n+>  7 |     return x?.y.z?.a;\n+     |            ^^^^^^^^^ Missing dependency `x?.y.z?.a`\n+   8 |     // error: too precise\n+   9 |   }, [x?.y.z?.a.b]);\n+  10 |   const b = useMemo(() => {\n+\n+error.invalid-exhaustive-deps.ts:9:6\n+   7 |     return x?.y.z?.a;\n+   8 |     // error: too precise\n+>  9 |   }, [x?.y.z?.a.b]);\n+     |       ^^^^^^^^^^^ Overly precise dependency `x?.y.z?.a.b`, use `x?.y.z?.a` instead\n+  10 |   const b = useMemo(() => {\n+  11 |     return x.y.z?.a;\n+  12 |     // ok, not our job to type check nullability\n+\n+Inferred dependencies: `[x?.y.z?.a]`\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Missing dependencies can cause a value to update less often than it should, resulting in stale UI. Extra dependencies can cause a value to update more often than it should, resulting in performance problems such as excessive renders or effects firing too often.\n+\n+error.invalid-exhaustive-deps.ts:15:11\n+  13 |   }, [x.y.z.a]);\n+  14 |   const c = useMemo(() => {\n+> 15 |     return x?.y.z.a?.b;\n+     |            ^^^^^^^^^^^ Missing dependency `x?.y.z.a?.b`\n+  16 |     // error: too precise\n+  17 |   }, [x?.y.z.a?.b.z]);\n+  18 |   const d = useMemo(() => {\n+\n+error.invalid-exhaustive-deps.ts:17:6\n+  15 |     return x?.y.z.a?.b;\n+  16 |     // error: too precise\n+> 17 |   }, [x?.y.z.a?.b.z]);\n+     |       ^^^^^^^^^^^^^ Overly precise dependency `x?.y.z.a?.b.z`, use `x?.y.z.a?.b` instead\n+  18 |   const d = useMemo(() => {\n+  19 |     return x?.y?.[(console.log(y), z?.b)];\n+  20 |     // ok\n+\n+Inferred dependencies: `[x?.y.z.a?.b]`\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Extra dependencies can cause a value to update more often than it should, resulting in performance problems such as excessive renders or effects firing too often.\n+\n+error.invalid-exhaustive-deps.ts:31:6\n+  29 |     return [];\n+  30 |     // error: unnecessary\n+> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+     |       ^ Unnecessary dependency `x`\n+  32 |   const ref1 = useRef(null);\n+  33 |   const ref2 = useRef(null);\n+  34 |   const ref = z ? ref1 : ref2;\n+\n+error.invalid-exhaustive-deps.ts:31:9\n+  29 |     return [];\n+  30 |     // error: unnecessary\n+> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+     |          ^^^ Unnecessary dependency `y.z`\n+  32 |   const ref1 = useRef(null);\n+  33 |   const ref2 = useRef(null);\n+  34 |   const ref = z ? ref1 : ref2;\n+\n+error.invalid-exhaustive-deps.ts:31:14\n+  29 |     return [];\n+  30 |     // error: unnecessary\n+> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+     |               ^^^^^^^ Unnecessary dependency `z?.y?.a`\n+  32 |   const ref1 = useRef(null);\n+  33 |   const ref2 = useRef(null);\n+  34 |   const ref = z ? ref1 : ref2;\n+\n+error.invalid-exhaustive-deps.ts:31:23\n+  29 |     return [];\n+  30 |     // error: unnecessary\n+> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+     |                        ^^^^^^^^^^^^^ Unnecessary dependency `UNUSED_GLOBAL`. Values declared outside of a component/hook should not be listed as dependencies as the component will not re-render if they change\n+  32 |   const ref1 = useRef(null);\n+  33 |   const ref2 = useRef(null);\n+  34 |   const ref = z ? ref1 : ref2;\n+\n+Inferred dependencies: `[]`\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Extra dependencies can cause a value to update more often than it should, resulting in performance problems such as excessive renders or effects firing too often.\n+\n+error.invalid-exhaustive-deps.ts:31:6\n+  29 |     return [];\n+  30 |     // error: unnecessary\n+> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+     |       ^ Unnecessary dependency `x`\n+  32 |   const ref1 = useRef(null);\n+  33 |   const ref2 = useRef(null);\n+  34 |   const ref = z ? ref1 : ref2;\n+\n+error.invalid-exhaustive-deps.ts:31:9\n+  29 |     return [];\n+  30 |     // error: unnecessary\n+> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+     |          ^^^ Unnecessary dependency `y.z`\n+  32 |   const ref1 = useRef(null);\n+  33 |   const ref2 = useRef(null);\n+  34 |   const ref = z ? ref1 : ref2;\n+\n+error.invalid-exhaustive-deps.ts:31:14\n+  29 |     return [];\n+  30 |     // error: unnecessary\n+> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+     |               ^^^^^^^ Unnecessary dependency `z?.y?.a`\n+  32 |   const ref1 = useRef(null);\n+  33 |   const ref2 = useRef(null);\n+  34 |   const ref = z ? ref1 : ref2;\n+\n+error.invalid-exhaustive-deps.ts:31:23\n+  29 |     return [];\n+  30 |     // error: unnecessary\n+> 31 |   }, [x, y.z, z?.y?.a, UNUSED_GLOBAL]);\n+     |                        ^^^^^^^^^^^^^ Unnecessary dependency `UNUSED_GLOBAL`. Values declared outside of a component/hook should not be listed as dependencies as the component will not re-render if they change\n+  32 |   const ref1 = useRef(null);\n+  33 |   const ref2 = useRef(null);\n+  34 |   const ref = z ? ref1 : ref2;\n+\n+Inferred dependencies: `[]`\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Missing dependencies can cause a value to update less often than it should, resulting in stale UI.\n+\n+error.invalid-exhaustive-deps.ts:37:13\n+  35 |   const cb = useMemo(() => {\n+  36 |     return () => {\n+> 37 |       return ref.current;\n+     |              ^^^ Missing dependency `ref`. Refs, setState functions, and other \"stable\" values generally do not need to be added as dependencies, but this variable may change over time to point to different values\n+  38 |     };\n+  39 |     // error: ref is a stable type but reactive\n+  40 |   }, []);\n+\n+Inferred dependencies: `[ref]`\n+```\n+          \n+      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps.js\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.js\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-exhaustive-deps.js\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-inner-function.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-inner-function.expect.md\nnew file mode 100644\nindex 0000000..6d03fb4\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-inner-function.expect.md\n@@ -0,0 +1,43 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveMemoizationDependencies\n+\n+import {useMemo} from 'react';\n+import {makeObject_Primitives} from 'shared-runtime';\n+\n+function useHook() {\n+  const object = makeObject_Primitives();\n+  const fn = useCallback(() => {\n+    const g = () => {\n+      return [object];\n+    };\n+    return g;\n+  });\n+  return fn;\n+}\n+\n+```\n+\n+\n+## Error\n+\n+```\n+Found 1 error:\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Missing dependencies can cause a value to update less often than it should, resulting in stale UI.\n+\n+error.invalid-missing-nonreactive-dep-inner-function.ts:10:14\n+   8 |   const fn = useCallback(() => {\n+   9 |     const g = () => {\n+> 10 |       return [object];\n+     |               ^^^^^^ Missing dependency `object`\n+  11 |     };\n+  12 |     return g;\n+  13 |   });\n+```\n+          \n+      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-inner-function.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-inner-function.js\nnew file mode 100644\nindex 0000000..02ba7b8\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-inner-function.js\n@@ -0,0 +1,15 @@\n+// @validateExhaustiveMemoizationDependencies\n+\n+import {useMemo} from 'react';\n+import {makeObject_Primitives} from 'shared-runtime';\n+\n+function useHook() {\n+  const object = makeObject_Primitives();\n+  const fn = useCallback(() => {\n+    const g = () => {\n+      return [object];\n+    };\n+    return g;\n+  });\n+  return fn;\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-unmemoized.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-unmemoized.expect.md\nnew file mode 100644\nindex 0000000..a6868ef\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-unmemoized.expect.md\n@@ -0,0 +1,43 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveMemoizationDependencies\n+\n+import {useMemo} from 'react';\n+import {makeObject_Primitives, useIdentity} from 'shared-runtime';\n+\n+function useHook() {\n+  // object is non-reactive but not memoized bc the mutation surrounds a hook\n+  const object = makeObject_Primitives();\n+  useIdentity();\n+  object.x = 0;\n+  const array = useMemo(() => [object], []);\n+  return array;\n+}\n+\n+```\n+\n+\n+## Error\n+\n+```\n+Found 1 error:\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Missing dependencies can cause a value to update less often than it should, resulting in stale UI.\n+\n+error.invalid-missing-nonreactive-dep-unmemoized.ts:11:31\n+   9 |   useIdentity();\n+  10 |   object.x = 0;\n+> 11 |   const array = useMemo(() => [object], []);\n+     |                                ^^^^^^ Missing dependency `object`\n+  12 |   return array;\n+  13 | }\n+  14 |\n+\n+Inferred dependencies: `[object]`\n+```\n+          \n+      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-unmemoized.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-unmemoized.js\nnew file mode 100644\nindex 0000000..c790ce1\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep-unmemoized.js\n@@ -0,0 +1,13 @@\n+// @validateExhaustiveMemoizationDependencies\n+\n+import {useMemo} from 'react';\n+import {makeObject_Primitives, useIdentity} from 'shared-runtime';\n+\n+function useHook() {\n+  // object is non-reactive but not memoized bc the mutation surrounds a hook\n+  const object = makeObject_Primitives();\n+  useIdentity();\n+  object.x = 0;\n+  const array = useMemo(() => [object], []);\n+  return array;\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep.expect.md\nnew file mode 100644\nindex 0000000..f342349\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep.expect.md\n@@ -0,0 +1,40 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveMemoizationDependencies\n+\n+import {useMemo} from 'react';\n+import {makeObject_Primitives} from 'shared-runtime';\n+\n+function useHook() {\n+  const object = makeObject_Primitives();\n+  const array = useMemo(() => [object], []);\n+  return array;\n+}\n+\n+```\n+\n+\n+## Error\n+\n+```\n+Found 1 error:\n+\n+Error: Found missing/extra memoization dependencies\n+\n+Missing dependencies can cause a value to update less often than it should, resulting in stale UI.\n+\n+error.invalid-missing-nonreactive-dep.ts:8:31\n+   6 | function useHook() {\n+   7 |   const object = makeObject_Primitives();\n+>  8 |   const array = useMemo(() => [object], []);\n+     |                                ^^^^^^ Missing dependency `object`\n+   9 |   return array;\n+  10 | }\n+  11 |\n+\n+Inferred dependencies: `[object]`\n+```\n+          \n+      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep.js\nnew file mode 100644\nindex 0000000..bfc81d9\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.invalid-missing-nonreactive-dep.js\n@@ -0,0 +1,10 @@\n+// @validateExhaustiveMemoizationDependencies\n+\n+import {useMemo} from 'react';\n+import {makeObject_Primitives} from 'shared-runtime';\n+\n+function useHook() {\n+  const object = makeObject_Primitives();\n+  const array = useMemo(() => [object], []);\n+  return array;\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.sketchy-code-exhaustive-deps.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.sketchy-code-exhaustive-deps.expect.md\nsimilarity index 77%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.sketchy-code-exhaustive-deps.expect.md\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.sketchy-code-exhaustive-deps.expect.md\nindex 332fee9..0422a07 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.sketchy-code-exhaustive-deps.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.sketchy-code-exhaustive-deps.expect.md\n@@ -25,9 +25,9 @@ function Component() {\n ```\n Found 1 error:\n \n-Error: Found missing memoization dependencies\n+Error: Found missing/extra memoization dependencies\n \n-Missing dependencies can cause a value not to update when those inputs change, resulting in stale UI.\n+Missing dependencies can cause a value to update less often than it should, resulting in stale UI.\n \n error.sketchy-code-exhaustive-deps.ts:8:16\n    6 |   const foo = useCallback(\n@@ -37,6 +37,8 @@ error.sketchy-code-exhaustive-deps.ts:8:16\n    9 |     }, // eslint-disable-next-line react-hooks/exhaustive-deps\n   10 |     []\n   11 |   );\n+\n+Inferred dependencies: `[item]`\n ```\n           \n       \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.sketchy-code-exhaustive-deps.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.sketchy-code-exhaustive-deps.js\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.sketchy-code-exhaustive-deps.js\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/error.sketchy-code-exhaustive-deps.js\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-constant-folded-values.expect.md\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.expect.md\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-constant-folded-values.expect.md\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-constant-folded-values.js\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.js\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-constant-folded-values.js\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.expect.md\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.expect.md\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.expect.md\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.js\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.js\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps-allow-nonreactive-stable-types-as-extra-deps.js\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps.expect.md\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps.expect.md\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps.expect.md\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps.js\nsimilarity index 100%\nrename from compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps.js\nrename to compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps/exhaustive-deps.js\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/error.useMemo-unrelated-mutation-in-depslist.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/error.useMemo-unrelated-mutation-in-depslist.expect.md\nindex 7d21252..7831aea 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/error.useMemo-unrelated-mutation-in-depslist.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/error.useMemo-unrelated-mutation-in-depslist.expect.md\n@@ -32,9 +32,9 @@ function useFoo(input1) {\n ```\n Found 1 error:\n \n-Error: Found missing memoization dependencies\n+Error: Found missing/extra memoization dependencies\n \n-Missing dependencies can cause a value not to update when those inputs change, resulting in stale UI.\n+Missing dependencies can cause a value to update less often than it should, resulting in stale UI.\n \n error.useMemo-unrelated-mutation-in-depslist.ts:18:14\n   16 |   const memoized = useMemo(() => {\n@@ -44,6 +44,8 @@ error.useMemo-unrelated-mutation-in-depslist.ts:18:14\n   19 |\n   20 |   return [x, memoized];\n   21 | }\n+\n+Inferred dependencies: `[x, y]`\n ```\n           \n       \n\\ No newline at end of file"}, {"role": "assistant", "content": "refactor(compiler): improve exhaustive deps validation with better error"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/eslint-plugin-react-hooks/src/shared/ReactCompiler.ts | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/packages/eslint-plugin-react-hooks/src/shared/ReactCompiler.ts b/packages/eslint-plugin-react-hooks/src/shared/ReactCompiler.ts\nindex 854e261..b35e626 100644\n--- a/packages/eslint-plugin-react-hooks/src/shared/ReactCompiler.ts\n+++ b/packages/eslint-plugin-react-hooks/src/shared/ReactCompiler.ts\n@@ -151,6 +151,7 @@ function makeRule(rule: LintRule): Rule.RuleModule {\n       docs: {\n         description: rule.description,\n         recommended: rule.preset === LintRulePreset.Recommended,\n+        url: `https://react.dev/reference/eslint-plugin-react-hooks/lints/${rule.name}`,\n       },\n       fixable: 'code',\n       hasSuggestions: true,"}, {"role": "assistant", "content": "docs: add url to eslint rule metadata"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/build-docs.yml | 2 +-\n .github/workflows/test.yml       | 4 ++--\n 2 files changed, 3 insertions(+), 3 deletions(-)\n\ndiff --git a/.github/workflows/build-docs.yml b/.github/workflows/build-docs.yml\nindex 2198fe6..d1b3893 100644\n--- a/.github/workflows/build-docs.yml\n+++ b/.github/workflows/build-docs.yml\n@@ -97,7 +97,7 @@ jobs:\n           path: docs/${{ matrix.lang }}/.cache\n       - name: Build Docs\n         run: uv run ./scripts/docs.py build-lang ${{ matrix.lang }}\n-      - uses: actions/upload-artifact@v5\n+      - uses: actions/upload-artifact@v6\n         with:\n           name: docs-site-${{ matrix.lang }}\n           path: ./site/**\ndiff --git a/.github/workflows/test.yml b/.github/workflows/test.yml\nindex 605d7c8..891f767 100644\n--- a/.github/workflows/test.yml\n+++ b/.github/workflows/test.yml\n@@ -84,7 +84,7 @@ jobs:\n       # Do not store coverage for all possible combinations to avoid file size max errors in Smokeshow\n       - name: Store coverage files\n         if: matrix.coverage == 'coverage'\n-        uses: actions/upload-artifact@v5\n+        uses: actions/upload-artifact@v6\n         with:\n           name: coverage-${{ runner.os }}-${{ matrix.python-version }}-${{ hashFiles('**/coverage/.coverage.*') }}\n           path: coverage\n@@ -121,7 +121,7 @@ jobs:\n       - run: uv run coverage combine coverage\n       - run: uv run coverage html --title \"Coverage for ${{ github.sha }}\"\n       - name: Store coverage HTML\n-        uses: actions/upload-artifact@v5\n+        uses: actions/upload-artifact@v6\n         with:\n           name: coverage-html\n           path: htmlcov"}, {"role": "assistant", "content": "ci: update upload-artifact action to v6"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/content/ai/ai-tutor.md | 11 ++++++++++-\n 1 file changed, 10 insertions(+), 1 deletion(-)\n\ndiff --git a/adev/src/content/ai/ai-tutor.md b/adev/src/content/ai/ai-tutor.md\nindex fd3b01ae..7c922be0 100644\n--- a/adev/src/content/ai/ai-tutor.md\n+++ b/adev/src/content/ai/ai-tutor.md\n@@ -108,7 +108,7 @@ If the tutor doesn't respond correctly or you suspect an issue with your applica\n \n ## **Your Learning Journey: The Phased Path**\n \n-You will build your application over a four-phase journey. You can follow this path from start to finish to create a complete, fully-functional Angular application. Each module builds logically upon the last, taking you from the basics to advanced, real-world features.\n+You will build your application over a five-phase journey. You can follow this path from start to finish to create a complete, fully-functional Angular application. Each module builds logically upon the last, taking you from the basics to advanced, real-world features.\n \n **A Note on Automated Setup:** Some modules require a setup step, like creating interfaces or mock data. In these cases, the tutor will present you with the code and file instructions. You will be responsible for creating and modifying these files as instructed before the exercise begins.\n \n@@ -141,6 +141,15 @@ You will build your application over a four-phase journey. You can follow this p\n - **Module 16:** Introduction to Forms\n - **Module 17:** Intro to Angular Material\n \n+### **Phase 5: Experimental Signal Forms (\u26a0\ufe0f WARNING: Subject to Change)**\n+\n+**CRITICAL NOTE FOR THIS PHASE:** Signal Forms are currently an [**EXPERIMENTAL** feature](/reference/releases#experimental). The API may change significantly in future Angular releases. Please proceed with the understanding that this section demonstrates a cutting-edge feature.\n+\n+- **Module 18**: **Introduction to Signal Forms**\n+- **Module 19**: **Submitting & Resetting**\n+- **Module 20**: **Validation in Signal Forms**\n+- **Module 21**: **Field State & Error Messages**\n+\n ---\n \n ## **A Note on AI & Feedback**"}, {"role": "assistant", "content": "docs: add ai tutor signal forms docs"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n scripts/translate.py | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/scripts/translate.py b/scripts/translate.py\nindex ffecfde..c7e6c7e 100644\n--- a/scripts/translate.py\n+++ b/scripts/translate.py\n@@ -25,7 +25,7 @@ non_translated_sections = (\n     \"contributing.md\",\n )\n \n-general_prompt_path = Path(__file__).absolute().parent / \"llm-general-prompt.md\"\n+general_prompt_path = Path(__file__).absolute().parent / \"general-llm-prompt.md\"\n general_prompt = general_prompt_path.read_text(encoding=\"utf-8\")\n \n app = typer.Typer()"}, {"role": "assistant", "content": "fix(scripts): correct general prompt filename"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_hir_typeck/src/pat.rs  | 13 ++++----\n tests/ui/pattern/type_mismatch.rs     | 63 ++++++++++++++++++++++++++++++++++-\n tests/ui/pattern/type_mismatch.stderr | 61 +++++++++++++++++++++++++++++++--\n 3 files changed, 128 insertions(+), 9 deletions(-)"}, {"role": "assistant", "content": "fix(pat): improve pattern type mismatch diagnostics"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 5498039..a25c94b 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -20,6 +20,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udd28 Refactor translation script to allow committing in place. PR [#14687](https://github.com/fastapi/fastapi/pull/14687) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc1b Fix translation script path. PR [#14685](https://github.com/fastapi/fastapi/pull/14685) by [@tiangolo](https://github.com/tiangolo).\n * \u2705 Enable tests in CI for scripts. PR [#14684](https://github.com/fastapi/fastapi/pull/14684) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd27 Add pre-commit local script to fix language translations. PR [#14683](https://github.com/fastapi/fastapi/pull/14683) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: add release note for translation script refactor"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../src/statemanager/navigation_state_manager.ts   | 13 ++++++++++--\n .../router/test/with_platform_navigation.spec.ts   | 24 +++++++++++++++++++++-\n 2 files changed, 34 insertions(+), 3 deletions(-)\n\ndiff --git a/packages/router/src/statemanager/navigation_state_manager.ts b/packages/router/src/statemanager/navigation_state_manager.ts\nindex 8bfac6fa..260b3639 100644\n--- a/packages/router/src/statemanager/navigation_state_manager.ts\n+++ b/packages/router/src/statemanager/navigation_state_manager.ts\n@@ -199,8 +199,17 @@ export class NavigationStateManager extends StateManager {\n         resolve();\n       });\n     } else if (e instanceof NavigationCancel || e instanceof NavigationError) {\n-      // TODO(atscott): We want to keep the navigation event on redirects if\n-      // the URL wasn't committed yet rather than cancelling it.\n+      // If redirecting and the URL hasn't been committed yet (via precommmitHandler),\n+      // the redirect will be handled by `commitUrl` using `controller.redirect` and\n+      // we should retain the current NavigateEvent.\n+      // Otherwise, a full cancellation and rollback is needed.\n+      const redirectingBeforeUrlCommit =\n+        e instanceof NavigationCancel &&\n+        e.code === NavigationCancellationCode.Redirect &&\n+        !!this.currentNavigation.commitUrl;\n+      if (redirectingBeforeUrlCommit) {\n+        return;\n+      }\n       void this.cancel(transition, e);\n     } else if (e instanceof NavigationEnd) {\n       const {resolveHandler, removeAbortListener} = this.currentNavigation;\ndiff --git a/packages/router/test/with_platform_navigation.spec.ts b/packages/router/test/with_platform_navigation.spec.ts\nindex 47b05cc6..7e32e9de 100644\n--- a/packages/router/test/with_platform_navigation.spec.ts\n+++ b/packages/router/test/with_platform_navigation.spec.ts\n@@ -7,7 +7,7 @@\n  */\n \n import {TestBed} from '@angular/core/testing';\n-import {provideRouter, Router} from '../src';\n+import {NavigationStart, provideRouter, Router} from '../src';\n import {withExperimentalPlatformNavigation, withRouterConfig} from '../src/provide_router';\n import {withBody} from '@angular/private/testing';\n import {\n@@ -15,6 +15,7 @@ import {\n   Location,\n   PlatformNavigation,\n   BrowserPlatformLocation,\n+  \u0275PRECOMMIT_HANDLER_SUPPORTED as PRECOMMIT_HANDLER_SUPPORTED,\n } from '@angular/common';\n import {\n   \u0275FakeNavigation as FakeNavigation,\n@@ -22,6 +23,7 @@ import {\n   provideLocationMocks,\n } from '@angular/common/testing';\n import {timeout, useAutoTick} from './helpers';\n+import {inject} from '@angular/core';\n \n /// <reference types=\"dom-navigation\" />\n \n@@ -159,6 +161,26 @@ describe('withPlatformNavigation feature', () => {\n       expect(navigateEvents.length).toBe(1);\n       expect(navigateEvents[0].navigationType).toBe('traverse');\n     });\n+\n+    it('retains a single NavigateEvent across redirects', async () => {\n+      const navigateEvents: NavigateEvent[] = [];\n+      navigation.addEventListener('navigate', (e: NavigateEvent) => navigateEvents.push(e));\n+\n+      router.resetConfig([\n+        {path: 'first', canActivate: [() => inject(Router).parseUrl('/redirected')], children: []},\n+        {path: '**', children: []},\n+      ]);\n+      const navPromise = router.navigateByUrl('/first');\n+      if (TestBed.inject(PRECOMMIT_HANDLER_SUPPORTED)) {\n+        router.events.subscribe((e) => {\n+          if (e instanceof NavigationStart) {\n+            expect(navigateEvents.length).toBe(1);\n+          }\n+        });\n+      }\n+      await navPromise;\n+      expect(navigateEvents.length).toBe(1);\n+    });\n   });\n \n   describe('eager url update', () => {"}, {"role": "assistant", "content": "refactor(router): Retain original navigateEvent across redirects"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_codegen_llvm/src/mono_item.rs | 2 +-\n compiler/rustc_codegen_llvm/src/va_arg.rs    | 9 ---------\n compiler/rustc_span/src/symbol.rs            | 1 -\n compiler/rustc_target/src/asm/mod.rs         | 2 +-\n compiler/rustc_target/src/callconv/mod.rs    | 2 +-\n compiler/rustc_target/src/spec/mod.rs        | 7 ++-----\n compiler/rustc_target/src/target_features.rs | 8 +-------\n src/tools/miri/src/shims/alloc.rs            | 1 -\n 8 files changed, 6 insertions(+), 26 deletions(-)"}, {"role": "assistant", "content": "refactor: remove unused sparc target code"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../ng-devtools/src/lib/shared/button/button.component.scss       | 8 ++++++++\n .../ng-devtools/src/lib/shared/button/button.component.spec.ts    | 5 +++++\n .../ng-devtools/src/lib/shared/button/button.component.ts         | 3 ++-\n 3 files changed, 15 insertions(+), 1 deletion(-)\n\ndiff --git a/devtools/projects/ng-devtools/src/lib/shared/button/button.component.scss b/devtools/projects/ng-devtools/src/lib/shared/button/button.component.scss\nindex d4aa9310..118580ec 100644\n--- a/devtools/projects/ng-devtools/src/lib/shared/button/button.component.scss\n+++ b/devtools/projects/ng-devtools/src/lib/shared/button/button.component.scss\n@@ -20,6 +20,14 @@\n     color: var(--septenary-contrast);\n   }\n \n+  &.type-secondary {\n+    border-radius: 2rem;\n+    background: transparent;\n+    box-sizing: border-box;\n+    border: 1px solid var(--quaternary-contrast);\n+    color: var(--color-text);\n+  }\n+\n   &.type-icon {\n     background: transparent;\n     border: none;\ndiff --git a/devtools/projects/ng-devtools/src/lib/shared/button/button.component.spec.ts b/devtools/projects/ng-devtools/src/lib/shared/button/button.component.spec.ts\nindex 6cfeb0a5..25e69b85 100644\n--- a/devtools/projects/ng-devtools/src/lib/shared/button/button.component.spec.ts\n+++ b/devtools/projects/ng-devtools/src/lib/shared/button/button.component.spec.ts\n@@ -31,6 +31,11 @@ describe('ButtonComponent', () => {\n     expect(element.classList.contains('size-compact')).toBeFalse();\n   });\n \n+  it('should change the type to secondary', () => {\n+    expect(component.btnType()).toEqual('secondary');\n+    expect(element.classList.contains('type-secondary')).toBeTrue();\n+  });\n+\n   it('should be compact size', async () => {\n     fixture.componentRef.setInput('size', 'compact');\n     await fixture.whenStable();\ndiff --git a/devtools/projects/ng-devtools/src/lib/shared/button/button.component.ts b/devtools/projects/ng-devtools/src/lib/shared/button/button.component.ts\nindex 10f67393..925823f7 100644\n--- a/devtools/projects/ng-devtools/src/lib/shared/button/button.component.ts\n+++ b/devtools/projects/ng-devtools/src/lib/shared/button/button.component.ts\n@@ -8,7 +8,7 @@\n \n import {ChangeDetectionStrategy, Component, input} from '@angular/core';\n \n-type ButtonType = 'primary' | 'icon';\n+type ButtonType = 'primary' | 'secondary' | 'icon';\n type ButtonSize = 'standard' | 'mid' | 'compact';\n \n @Component({\n@@ -19,6 +19,7 @@ type ButtonSize = 'standard' | 'mid' | 'compact';\n   host: {\n     class: 'ng-button',\n     '[class.type-primary]': `btnType() === 'primary'`,\n+    '[class.type-secondary]': `btnType() === 'secondary'`,\n     '[class.type-icon]': `btnType() === 'icon'`,\n     '[class.size-compact]': `size() === 'compact'`,\n     '[class.size-mid]': `size() === 'mid'`,"}, {"role": "assistant", "content": "refactor(devtools): add secondary type button"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n ...ReactDOMServerPartialHydration-test.internal.js | 166 +++++++++++++++++++++\n .../src/ReactFiberHydrationContext.js              |  39 +++++\n .../react-reconciler/src/ReactFiberWorkLoop.js     |   9 +-\n 3 files changed, 213 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js b/packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js\nindex d13303f..502ac8c 100644\n--- a/packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js\n+++ b/packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js\n@@ -4063,4 +4063,170 @@ describe('ReactDOMServerPartialHydration', () => {\n     expect(span.style.display).toBe('');\n     expect(ref.current).toBe(span);\n   });\n+\n+  // Regression for https://github.com/facebook/react/issues/35210 and other issues where lazy elements created in flight\n+  // caused hydration issues b/c the replay pathway did not correctly reset the hydration cursor\n+  it('Can hydrate even when lazy content resumes immediately inside a HostComponent', async () => {\n+    let resolve;\n+    const promise = new Promise(r => {\n+      resolve = () => r({default: 'value'});\n+    });\n+\n+    const lazyContent = React.lazy(() => {\n+      Scheduler.log('Lazy initializer called');\n+      return promise;\n+    });\n+\n+    function App() {\n+      return <label>{lazyContent}</label>;\n+    }\n+\n+    // Server-rendered HTML\n+    const container = document.createElement('div');\n+    container.innerHTML = '<label>value</label>';\n+\n+    const hydrationErrors = [];\n+\n+    React.startTransition(() => {\n+      ReactDOMClient.hydrateRoot(container, <App />, {\n+        onRecoverableError(error) {\n+          console.log('[DEBUG] hydration error:', error.message);\n+          hydrationErrors.push(error.message);\n+        },\n+      });\n+    });\n+\n+    await waitFor(['Lazy initializer called']);\n+    resolve();\n+    await waitForAll([]);\n+\n+    // Without the fix, hydration cursor is wrong and causes mismatch\n+    expect(hydrationErrors).toEqual([]);\n+    expect(container.innerHTML).toEqual('<label>value</label>');\n+  });\n+\n+  it('Can hydrate even when lazy content resumes immediately inside a HostSingleton', async () => {\n+    let resolve;\n+    const promise = new Promise(r => {\n+      resolve = () => r({default: <div>value</div>});\n+    });\n+\n+    const lazyContent = React.lazy(() => {\n+      Scheduler.log('Lazy initializer called');\n+      return promise;\n+    });\n+\n+    function App() {\n+      return (\n+        <html>\n+          <body>{lazyContent}</body>\n+        </html>\n+      );\n+    }\n+\n+    // Server-rendered HTML\n+    document.body.innerHTML = '<div>value</div>';\n+\n+    const hydrationErrors = [];\n+\n+    React.startTransition(() => {\n+      ReactDOMClient.hydrateRoot(document, <App />, {\n+        onRecoverableError(error) {\n+          console.log('[DEBUG] hydration error:', error.message);\n+          hydrationErrors.push(error.message);\n+        },\n+      });\n+    });\n+\n+    await waitFor(['Lazy initializer called']);\n+    resolve();\n+    await waitForAll([]);\n+\n+    expect(hydrationErrors).toEqual([]);\n+    expect(document.documentElement.outerHTML).toEqual(\n+      '<html><head></head><body><div>value</div></body></html>',\n+    );\n+  });\n+\n+  it('Can hydrate even when lazy content resumes immediately inside a Suspense', async () => {\n+    let resolve;\n+    const promise = new Promise(r => {\n+      resolve = () => r({default: 'value'});\n+    });\n+\n+    const lazyContent = React.lazy(() => {\n+      Scheduler.log('Lazy initializer called');\n+      return promise;\n+    });\n+\n+    function App() {\n+      return <Suspense>{lazyContent}</Suspense>;\n+    }\n+\n+    // Server-rendered HTML\n+    const container = document.createElement('div');\n+    container.innerHTML = '<!--$-->value<!--/$-->';\n+\n+    const hydrationErrors = [];\n+\n+    let root;\n+    React.startTransition(() => {\n+      root = ReactDOMClient.hydrateRoot(container, <App />, {\n+        onRecoverableError(error) {\n+          console.log('[DEBUG] hydration error:', error.message);\n+          hydrationErrors.push(error.message);\n+        },\n+      });\n+    });\n+\n+    await waitFor(['Lazy initializer called']);\n+    resolve();\n+    await waitForAll([]);\n+\n+    expect(hydrationErrors).toEqual([]);\n+    expect(container.innerHTML).toEqual('<!--$-->value<!--/$-->');\n+    root.unmount();\n+    expect(container.innerHTML).toEqual('<!--$--><!--/$-->');\n+  });\n+\n+  it('Can hydrate even when lazy content resumes immediately inside an Activity', async () => {\n+    let resolve;\n+    const promise = new Promise(r => {\n+      resolve = () => r({default: 'value'});\n+    });\n+\n+    const lazyContent = React.lazy(() => {\n+      Scheduler.log('Lazy initializer called');\n+      return promise;\n+    });\n+\n+    function App() {\n+      return <Activity mode=\"visible\">{lazyContent}</Activity>;\n+    }\n+\n+    // Server-rendered HTML\n+    const container = document.createElement('div');\n+    container.innerHTML = '<!--&-->value<!--/&-->';\n+\n+    const hydrationErrors = [];\n+\n+    let root;\n+    React.startTransition(() => {\n+      root = ReactDOMClient.hydrateRoot(container, <App />, {\n+        onRecoverableError(error) {\n+          console.log('[DEBUG] hydration error:', error.message);\n+          hydrationErrors.push(error.message);\n+        },\n+      });\n+    });\n+\n+    await waitFor(['Lazy initializer called']);\n+    resolve();\n+    await waitForAll([]);\n+\n+    expect(hydrationErrors).toEqual([]);\n+    expect(container.innerHTML).toEqual('<!--&-->value<!--/&-->');\n+    root.unmount();\n+    expect(container.innerHTML).toEqual('<!--&--><!--/&-->');\n+  });\n });\ndiff --git a/packages/react-reconciler/src/ReactFiberHydrationContext.js b/packages/react-reconciler/src/ReactFiberHydrationContext.js\nindex 00e2fcd..0c75820 100644\n--- a/packages/react-reconciler/src/ReactFiberHydrationContext.js\n+++ b/packages/react-reconciler/src/ReactFiberHydrationContext.js\n@@ -173,6 +173,7 @@ function enterHydrationState(fiber: Fiber): boolean {\n   didSuspendOrErrorDEV = false;\n   hydrationDiffRootDEV = null;\n   rootOrSingletonContext = true;\n+\n   return true;\n }\n \n@@ -834,6 +835,43 @@ function resetHydrationState(): void {\n   didSuspendOrErrorDEV = false;\n }\n \n+// Restore the hydration cursor when unwinding a HostComponent that already\n+// claimed a DOM node. This is a fork of popHydrationState that does all the\n+// same validity checks but restores the cursor to this fiber's DOM node\n+// instead of advancing past it. It also does NOT clear unhydrated tail nodes\n+// or throw on mismatches since we're unwinding, not completing.\n+//\n+// This is needed when replaySuspendedUnitOfWork calls unwindInterruptedWork\n+// before re-running beginWork on the same fiber, or when throwAndUnwindWorkLoop\n+// calls unwindWork on ancestor fibers.\n+function popHydrationStateOnInterruptedWork(fiber: Fiber): void {\n+  if (!supportsHydration) {\n+    return;\n+  }\n+  if (fiber !== hydrationParentFiber) {\n+    // We're deeper than the current hydration context, inside an inserted\n+    // tree. Don't touch the cursor.\n+    return;\n+  }\n+  if (!isHydrating) {\n+    // If we're not currently hydrating but we're in a hydration context, then\n+    // we were an insertion and now need to pop up to reenter hydration of our\n+    // siblings. Same as popHydrationState.\n+    popToNextHostParent(fiber);\n+    isHydrating = true;\n+    return;\n+  }\n+\n+  // We're in a valid hydration context. Restore the cursor to this fiber's\n+  // DOM node so that when beginWork re-runs, it can claim the same node.\n+  // Unlike popHydrationState, we do NOT check for unhydrated tail nodes\n+  // or advance the cursor - we're restoring, not completing.\n+  popToNextHostParent(fiber);\n+  if (fiber.tag === HostComponent && fiber.stateNode != null) {\n+    nextHydratableInstance = fiber.stateNode;\n+  }\n+}\n+\n export function upgradeHydrationErrorsToRecoverable(): Array<\n   CapturedValue<mixed>,\n > | null {\n@@ -905,6 +943,7 @@ export {\n   reenterHydrationStateFromDehydratedActivityInstance,\n   reenterHydrationStateFromDehydratedSuspenseInstance,\n   resetHydrationState,\n+  popHydrationStateOnInterruptedWork,\n   claimHydratableSingleton,\n   tryToClaimNextHydratableInstance,\n   tryToClaimNextHydratableTextInstance,\ndiff --git a/packages/react-reconciler/src/ReactFiberWorkLoop.js b/packages/react-reconciler/src/ReactFiberWorkLoop.js\nindex f720045..9f21041 100644\n--- a/packages/react-reconciler/src/ReactFiberWorkLoop.js\n+++ b/packages/react-reconciler/src/ReactFiberWorkLoop.js\n@@ -120,7 +120,10 @@ import {\n \n import {createWorkInProgress, resetWorkInProgress} from './ReactFiber';\n import {isRootDehydrated} from './ReactFiberShellHydration';\n-import {getIsHydrating} from './ReactFiberHydrationContext';\n+import {\n+  getIsHydrating,\n+  popHydrationStateOnInterruptedWork,\n+} from './ReactFiberHydrationContext';\n import {\n   NoMode,\n   ProfileMode,\n@@ -3109,6 +3112,10 @@ function replayBeginWork(unitOfWork: Fiber): null | Fiber {\n       // promises that a host component might suspend on are definitely cached\n       // because they are controlled by us. So don't bother.\n       resetHooksOnUnwind(unitOfWork);\n+      // We are about to retry this host component and need to ensure the hydration\n+      // state is appropriate for hydrating this unit. Other fiber types hydrate differently\n+      // and aren't reliant on the cursor positioning so this function is only for HostComponent\n+      popHydrationStateOnInterruptedWork(unitOfWork);\n       // Fallthrough to the next branch.\n     }\n     default: {"}, {"role": "assistant", "content": "fix(hydration): reset cursor when replaying suspended host components"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n CHANGELOG.md                          | 9 +++++++++\n package.json                          | 2 +-\n packages/compiler-core/package.json   | 2 +-\n packages/compiler-dom/package.json    | 2 +-\n packages/compiler-sfc/package.json    | 2 +-\n packages/compiler-ssr/package.json    | 2 +-\n packages/reactivity/package.json      | 2 +-\n packages/runtime-core/package.json    | 2 +-\n packages/runtime-dom/package.json     | 2 +-\n packages/server-renderer/package.json | 2 +-\n packages/shared/package.json          | 2 +-\n packages/vue-compat/package.json      | 2 +-\n packages/vue/package.json             | 2 +-\n 13 files changed, 21 insertions(+), 12 deletions(-)\n\ndiff --git a/CHANGELOG.md b/CHANGELOG.md\nindex edb9534..3a07176 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -1,3 +1,12 @@\n+## [3.5.24](https://github.com/vuejs/core/compare/v3.5.23...v3.5.24) (2025-11-07)\n+\n+\n+### Reverts\n+\n+* Revert \"fix(compiler-core): correctly handle ts type assertions in expression\u2026\" (#14062) ([11ec51a](https://github.com/vuejs/core/commit/11ec51aa5a7914745fee10ed2b9f9464fab4d02c)), closes [#14062](https://github.com/vuejs/core/issues/14062) [#14060](https://github.com/vuejs/core/issues/14060)\n+\n+\n+\n ## [3.5.23](https://github.com/vuejs/core/compare/v3.5.22...v3.5.23) (2025-11-06)\n \n \ndiff --git a/package.json b/package.json\nindex 2263e58..2ba9d2b 100644\n--- a/package.json\n+++ b/package.json\n@@ -1,6 +1,6 @@\n {\n   \"private\": true,\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"packageManager\": \"pnpm@10.20.0\",\n   \"type\": \"module\",\n   \"scripts\": {\ndiff --git a/packages/compiler-core/package.json b/packages/compiler-core/package.json\nindex 67da3bc..2ff4004 100644\n--- a/packages/compiler-core/package.json\n+++ b/packages/compiler-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-core\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"@vue/compiler-core\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/compiler-core.esm-bundler.js\",\ndiff --git a/packages/compiler-dom/package.json b/packages/compiler-dom/package.json\nindex e96077c..8dec245 100644\n--- a/packages/compiler-dom/package.json\n+++ b/packages/compiler-dom/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-dom\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"@vue/compiler-dom\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/compiler-dom.esm-bundler.js\",\ndiff --git a/packages/compiler-sfc/package.json b/packages/compiler-sfc/package.json\nindex 4c20dda..e822d6e 100644\n--- a/packages/compiler-sfc/package.json\n+++ b/packages/compiler-sfc/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-sfc\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"@vue/compiler-sfc\",\n   \"main\": \"dist/compiler-sfc.cjs.js\",\n   \"module\": \"dist/compiler-sfc.esm-browser.js\",\ndiff --git a/packages/compiler-ssr/package.json b/packages/compiler-ssr/package.json\nindex 0c41506..6d5d3f4 100644\n--- a/packages/compiler-ssr/package.json\n+++ b/packages/compiler-ssr/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compiler-ssr\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"@vue/compiler-ssr\",\n   \"main\": \"dist/compiler-ssr.cjs.js\",\n   \"types\": \"dist/compiler-ssr.d.ts\",\ndiff --git a/packages/reactivity/package.json b/packages/reactivity/package.json\nindex 2307d36..a5d36a0 100644\n--- a/packages/reactivity/package.json\n+++ b/packages/reactivity/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/reactivity\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"@vue/reactivity\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/reactivity.esm-bundler.js\",\ndiff --git a/packages/runtime-core/package.json b/packages/runtime-core/package.json\nindex 5f5b101..7c11de3 100644\n--- a/packages/runtime-core/package.json\n+++ b/packages/runtime-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/runtime-core\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"@vue/runtime-core\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/runtime-core.esm-bundler.js\",\ndiff --git a/packages/runtime-dom/package.json b/packages/runtime-dom/package.json\nindex 27f1bc6..9aab9f0 100644\n--- a/packages/runtime-dom/package.json\n+++ b/packages/runtime-dom/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/runtime-dom\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"@vue/runtime-dom\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/runtime-dom.esm-bundler.js\",\ndiff --git a/packages/server-renderer/package.json b/packages/server-renderer/package.json\nindex 5f12901..61d8ec3 100644\n--- a/packages/server-renderer/package.json\n+++ b/packages/server-renderer/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/server-renderer\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"@vue/server-renderer\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/server-renderer.esm-bundler.js\",\ndiff --git a/packages/shared/package.json b/packages/shared/package.json\nindex 37de8f7..6863722 100644\n--- a/packages/shared/package.json\n+++ b/packages/shared/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/shared\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"internal utils shared across @vue packages\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/shared.esm-bundler.js\",\ndiff --git a/packages/vue-compat/package.json b/packages/vue-compat/package.json\nindex 182a91c..e39861a 100644\n--- a/packages/vue-compat/package.json\n+++ b/packages/vue-compat/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@vue/compat\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"Vue 3 compatibility build for Vue 2\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/vue.runtime.esm-bundler.js\",\ndiff --git a/packages/vue/package.json b/packages/vue/package.json\nindex 9a448f9..ee136ff 100644\n--- a/packages/vue/package.json\n+++ b/packages/vue/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"vue\",\n-  \"version\": \"3.5.23\",\n+  \"version\": \"3.5.24\",\n   \"description\": \"The progressive JavaScript framework for building modern web UI.\",\n   \"main\": \"index.js\",\n   \"module\": \"dist/vue.runtime.esm-bundler.js\","}, {"role": "assistant", "content": "chore: release v3.5.24"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/apps/playground/.gitignore                |   1 +\n .../playground/components/Editor/ConfigEditor.tsx  |  25 +++--\n compiler/apps/playground/next-env.d.ts             |   6 --\n compiler/apps/playground/package.json              |   2 +-\n compiler/apps/playground/tsconfig.json             |   2 +-\n compiler/apps/playground/yarn.lock                 | 112 ++++++++++-----------\n 6 files changed, 77 insertions(+), 71 deletions(-)\n\ndiff --git a/compiler/apps/playground/.gitignore b/compiler/apps/playground/.gitignore\nindex 2d1f4fd..38f7fe0 100644\n--- a/compiler/apps/playground/.gitignore\n+++ b/compiler/apps/playground/.gitignore\n@@ -12,6 +12,7 @@\n # next.js\n /.next/\n /out/\n+/next-env.d.ts\n \n # production\n /build\ndiff --git a/compiler/apps/playground/components/Editor/ConfigEditor.tsx b/compiler/apps/playground/components/Editor/ConfigEditor.tsx\nindex cf80b48..e78ff35 100644\n--- a/compiler/apps/playground/components/Editor/ConfigEditor.tsx\n+++ b/compiler/apps/playground/components/Editor/ConfigEditor.tsx\n@@ -14,7 +14,6 @@ import React, {\n   unstable_ViewTransition as ViewTransition,\n   unstable_addTransitionType as addTransitionType,\n   startTransition,\n-  Activity,\n } from 'react';\n import {Resizable} from 're-resizable';\n import {useStore, useStoreDispatch} from '../StoreContext';\n@@ -34,9 +33,14 @@ export default function ConfigEditor({\n }): React.ReactElement {\n   const [isExpanded, setIsExpanded] = useState(false);\n \n+  // TODO: Add back <Activity> after upgrading next.js\n   return (\n     <>\n-      <Activity mode={isExpanded ? 'visible' : 'hidden'}>\n+      <div\n+        style={{\n+          display: isExpanded ? 'block' : 'none',\n+        }}>\n+        {/* <Activity mode={isExpanded ? 'visible' : 'hidden'}> */}\n         <ExpandedEditor\n           onToggle={() => {\n             startTransition(() => {\n@@ -46,8 +50,13 @@ export default function ConfigEditor({\n           }}\n           formattedAppliedConfig={formattedAppliedConfig}\n         />\n-      </Activity>\n-      <Activity mode={isExpanded ? 'hidden' : 'visible'}>\n+      </div>\n+      <div\n+        style={{\n+          display: !isExpanded ? 'block' : 'none',\n+        }}>\n+        {/* </Activity>\n+        <Activity mode={isExpanded ? 'hidden' : 'visible'}></Activity> */}\n         <CollapsedEditor\n           onToggle={() => {\n             startTransition(() => {\n@@ -56,7 +65,8 @@ export default function ConfigEditor({\n             });\n           }}\n         />\n-      </Activity>\n+      </div>\n+      {/* </Activity> */}\n     </>\n   );\n }\n@@ -116,8 +126,9 @@ function ExpandedEditor({\n \n   return (\n     <ViewTransition\n-      enter={{[CONFIG_PANEL_TRANSITION]: 'slide-in', default: 'none'}}\n-      exit={{[CONFIG_PANEL_TRANSITION]: 'slide-out', default: 'none'}}>\n+      update={{[CONFIG_PANEL_TRANSITION]: 'slide-in', default: 'none'}}>\n+      {/* enter={{[CONFIG_PANEL_TRANSITION]: 'slide-in', default: 'none'}}\n+      exit={{[CONFIG_PANEL_TRANSITION]: 'slide-out', default: 'none'}}> */}\n       <Resizable\n         minWidth={300}\n         maxWidth={600}\ndiff --git a/compiler/apps/playground/next-env.d.ts b/compiler/apps/playground/next-env.d.ts\ndeleted file mode 100644\nindex 9edff1c..0000000\n--- a/compiler/apps/playground/next-env.d.ts\n+++ /dev/null\n@@ -1,6 +0,0 @@\n-/// <reference types=\"next\" />\n-/// <reference types=\"next/image-types/global\" />\n-import \"./.next/types/routes.d.ts\";\n-\n-// NOTE: This file should not be edited\n-// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.\ndiff --git a/compiler/apps/playground/package.json b/compiler/apps/playground/package.json\nindex 23b192f..e92826c 100644\n--- a/compiler/apps/playground/package.json\n+++ b/compiler/apps/playground/package.json\n@@ -35,7 +35,7 @@\n     \"lru-cache\": \"^11.2.2\",\n     \"lz-string\": \"^1.5.0\",\n     \"monaco-editor\": \"^0.52.0\",\n-    \"next\": \"15.6.0-canary.7\",\n+    \"next\": \"15.5.7\",\n     \"notistack\": \"^3.0.0-alpha.7\",\n     \"prettier\": \"^3.3.3\",\n     \"pretty-format\": \"^29.3.1\",\ndiff --git a/compiler/apps/playground/tsconfig.json b/compiler/apps/playground/tsconfig.json\nindex 4f70dce..1ead55c 100644\n--- a/compiler/apps/playground/tsconfig.json\n+++ b/compiler/apps/playground/tsconfig.json\n@@ -19,7 +19,7 @@\n     \"moduleResolution\": \"node\",\n     \"resolveJsonModule\": true,\n     \"isolatedModules\": true,\n-    \"jsx\": \"react-jsx\",\n+    \"jsx\": \"preserve\",\n     \"incremental\": true,\n     \"plugins\": [\n       {\ndiff --git a/compiler/apps/playground/yarn.lock b/compiler/apps/playground/yarn.lock\nindex 42e8deb..ce4928e 100644\n--- a/compiler/apps/playground/yarn.lock\n+++ b/compiler/apps/playground/yarn.lock\n@@ -715,10 +715,10 @@\n   dependencies:\n     \"@monaco-editor/loader\" \"^1.6.1\"\n \n-\"@next/env@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/env/-/env-15.6.0-canary.7.tgz#cdbf2967a9437ef09eef755e203f315acc4d8d8f\"\n-  integrity sha512-LNZ7Yd3Cl9rKvjYdeJmszf2HmSDP76SQmfafKep2Ux16ZXKoN5OjwVHFTltKNdsB3vt2t+XJzLP2rhw5lBoFBA==\n+\"@next/env@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/env/-/env-15.5.7.tgz#4168db34ae3bc9fd9ad3b951d327f4cfc38d4362\"\n+  integrity sha512-4h6Y2NyEkIEN7Z8YxkA27pq6zTkS09bUSYC0xjd0NpwFxjnIKeZEeH591o5WECSmjpUhLn3H2QLJcDye3Uzcvg==\n \n \"@next/eslint-plugin-next@15.5.2\":\n   version \"15.5.2\"\n@@ -727,45 +727,45 @@\n   dependencies:\n     fast-glob \"3.3.1\"\n \n-\"@next/swc-darwin-arm64@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/swc-darwin-arm64/-/swc-darwin-arm64-15.6.0-canary.7.tgz#628cd34ce9120000f1cb5b08963426431174fc57\"\n-  integrity sha512-POsBrxhrR3qvqXV+JZ6ZoBc8gJf8rhYe+OedceI1piPVqtJYOJa3EB4eaqcc+kMsllKRrH/goNlhLwtyhE+0Qg==\n-\n-\"@next/swc-darwin-x64@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/swc-darwin-x64/-/swc-darwin-x64-15.6.0-canary.7.tgz#37d4ebab14da74a2f8028daf6d76aab410153e06\"\n-  integrity sha512-lmk9ysBuSiPlAJZTCo/3O4mXNFosg6EDIf4GrmynIwCG2as6/KxzyD1WqFp56Exp8eFDjP7SFapD10sV43vCsA==\n-\n-\"@next/swc-linux-arm64-gnu@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/swc-linux-arm64-gnu/-/swc-linux-arm64-gnu-15.6.0-canary.7.tgz#ce700cc0e0d24763136838223105a524b36694fa\"\n-  integrity sha512-why8k6d0SBm3AKoOD5S7ir3g+BF34l9oFKIoZrLaZaKBvNGpFcjc7Ovc2TunNMeaMJzv9k1dHYSap0EI5oSuzg==\n-\n-\"@next/swc-linux-arm64-musl@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/swc-linux-arm64-musl/-/swc-linux-arm64-musl-15.6.0-canary.7.tgz#c791b8e15bf2c338b4cc0387fe7afb3ef83ecfcf\"\n-  integrity sha512-HzvTRsKvYj32Va4YuJN3n3xOxvk+6QwB63d/EsgmdkeA/vrqciUAmJDYpuzZEvRc3Yp2nyPq8KZxtHAr6ISZ2Q==\n-\n-\"@next/swc-linux-x64-gnu@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/swc-linux-x64-gnu/-/swc-linux-x64-gnu-15.6.0-canary.7.tgz#c01c3a3d8e71660c49298dd053d078379b6b5919\"\n-  integrity sha512-6yRFrg2qWXOqa+1BI53J9EmHWFzKg9U2r+5R7n7BFUp8PH5SC92WBsmYTnh/RkvAYvdupiVzMervwwswCs6kFg==\n-\n-\"@next/swc-linux-x64-musl@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/swc-linux-x64-musl/-/swc-linux-x64-musl-15.6.0-canary.7.tgz#3f4b39faef4a5f88b13e4c726b008ddc9717f819\"\n-  integrity sha512-O/JjvOvNK/Wao/OIQaA6evDkxkmFFQgJ1/hI1dVk6/PAeKmW2/Q+6Dodh97eAkOwedS1ZdQl2mojf87TzLvzdQ==\n-\n-\"@next/swc-win32-arm64-msvc@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/swc-win32-arm64-msvc/-/swc-win32-arm64-msvc-15.6.0-canary.7.tgz#9bc5da0907b7ce67eedda02a6d56a09d9a539ccf\"\n-  integrity sha512-p9DvrDgnePofZCtiWVY7qZtwXxiOGJlAyy2LoGPYSGOUDhjbTG8j6XMUFXpV9UwpH+l7st522psO1BVzbpT8IQ==\n-\n-\"@next/swc-win32-x64-msvc@15.6.0-canary.7\":\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/@next/swc-win32-x64-msvc/-/swc-win32-x64-msvc-15.6.0-canary.7.tgz#5b271c591ccbe67d5fa966dd22db86c547414fd1\"\n-  integrity sha512-f1ywT3xWu4StWKA1mZRyGfelu/h+W0OEEyBxQNXzXyYa0VGZb9LyCNb5cYoNKBm0Bw18Hp1PVe0bHuusemGCcw==\n+\"@next/swc-darwin-arm64@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/swc-darwin-arm64/-/swc-darwin-arm64-15.5.7.tgz#f0c9ccfec2cd87cbd4b241ce4c779a7017aed958\"\n+  integrity sha512-IZwtxCEpI91HVU/rAUOOobWSZv4P2DeTtNaCdHqLcTJU4wdNXgAySvKa/qJCgR5m6KI8UsKDXtO2B31jcaw1Yw==\n+\n+\"@next/swc-darwin-x64@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/swc-darwin-x64/-/swc-darwin-x64-15.5.7.tgz#18009e9fcffc5c0687cc9db24182ddeac56280d9\"\n+  integrity sha512-UP6CaDBcqaCBuiq/gfCEJw7sPEoX1aIjZHnBWN9v9qYHQdMKvCKcAVs4OX1vIjeE+tC5EIuwDTVIoXpUes29lg==\n+\n+\"@next/swc-linux-arm64-gnu@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/swc-linux-arm64-gnu/-/swc-linux-arm64-gnu-15.5.7.tgz#fe7c7e08264cf522d4e524299f6d3e63d68d579a\"\n+  integrity sha512-NCslw3GrNIw7OgmRBxHtdWFQYhexoUCq+0oS2ccjyYLtcn1SzGzeM54jpTFonIMUjNbHmpKpziXnpxhSWLcmBA==\n+\n+\"@next/swc-linux-arm64-musl@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/swc-linux-arm64-musl/-/swc-linux-arm64-musl-15.5.7.tgz#94228fe293475ec34a5a54284e1056876f43a3cf\"\n+  integrity sha512-nfymt+SE5cvtTrG9u1wdoxBr9bVB7mtKTcj0ltRn6gkP/2Nu1zM5ei8rwP9qKQP0Y//umK+TtkKgNtfboBxRrw==\n+\n+\"@next/swc-linux-x64-gnu@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/swc-linux-x64-gnu/-/swc-linux-x64-gnu-15.5.7.tgz#078c71201dfe7fcfb8fa6dc92aae6c94bc011cdc\"\n+  integrity sha512-hvXcZvCaaEbCZcVzcY7E1uXN9xWZfFvkNHwbe/n4OkRhFWrs1J1QV+4U1BN06tXLdaS4DazEGXwgqnu/VMcmqw==\n+\n+\"@next/swc-linux-x64-musl@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/swc-linux-x64-musl/-/swc-linux-x64-musl-15.5.7.tgz#72947f5357f9226292353e0bb775643da3c7a182\"\n+  integrity sha512-4IUO539b8FmF0odY6/SqANJdgwn1xs1GkPO5doZugwZ3ETF6JUdckk7RGmsfSf7ws8Qb2YB5It33mvNL/0acqA==\n+\n+\"@next/swc-win32-arm64-msvc@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/swc-win32-arm64-msvc/-/swc-win32-arm64-msvc-15.5.7.tgz#397b912cd51c6a80e32b9c0507ecd82514353941\"\n+  integrity sha512-CpJVTkYI3ZajQkC5vajM7/ApKJUOlm6uP4BknM3XKvJ7VXAvCqSjSLmM0LKdYzn6nBJVSjdclx8nYJSa3xlTgQ==\n+\n+\"@next/swc-win32-x64-msvc@15.5.7\":\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/@next/swc-win32-x64-msvc/-/swc-win32-x64-msvc-15.5.7.tgz#e02b543d9dc6c1631d4ac239cb1177245dfedfe4\"\n+  integrity sha512-gMzgBX164I6DN+9/PGA+9dQiwmTkE4TloBNx8Kv9UiGARsr9Nba7IpcBRA1iTV9vwlYnrE3Uy6I7Aj6qLjQuqw==\n \n \"@nodelib/fs.scandir@2.1.5\":\n   version \"2.1.5\"\n@@ -3204,25 +3204,25 @@ natural-compare@^1.4.0:\n   resolved \"https://registry.yarnpkg.com/natural-compare/-/natural-compare-1.4.0.tgz#4abebfeed7541f2c27acfb29bdbbd15c8d5ba4f7\"\n   integrity sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==\n \n-next@15.6.0-canary.7:\n-  version \"15.6.0-canary.7\"\n-  resolved \"https://registry.yarnpkg.com/next/-/next-15.6.0-canary.7.tgz#bfc2ac3c9a78e23d550c303d18247a263e6b5bc1\"\n-  integrity sha512-4ukX2mxat9wWT6E0Gw/3TOR9ULV1q399E42F86cwsPSFgTWa04ABhcTqO0r9J/QR1YWPR8WEgh9qUzmWA/1yEw==\n+next@15.5.7:\n+  version \"15.5.7\"\n+  resolved \"https://registry.yarnpkg.com/next/-/next-15.5.7.tgz#4507700b2bbcaf2c9fb7a9ad25c0dac2ba4a9a75\"\n+  integrity sha512-+t2/0jIJ48kUpGKkdlhgkv+zPTEOoXyr60qXe68eB/pl3CMJaLeIGjzp5D6Oqt25hCBiBTt8wEeeAzfJvUKnPQ==\n   dependencies:\n-    \"@next/env\" \"15.6.0-canary.7\"\n+    \"@next/env\" \"15.5.7\"\n     \"@swc/helpers\" \"0.5.15\"\n     caniuse-lite \"^1.0.30001579\"\n     postcss \"8.4.31\"\n     styled-jsx \"5.1.6\"\n   optionalDependencies:\n-    \"@next/swc-darwin-arm64\" \"15.6.0-canary.7\"\n-    \"@next/swc-darwin-x64\" \"15.6.0-canary.7\"\n-    \"@next/swc-linux-arm64-gnu\" \"15.6.0-canary.7\"\n-    \"@next/swc-linux-arm64-musl\" \"15.6.0-canary.7\"\n-    \"@next/swc-linux-x64-gnu\" \"15.6.0-canary.7\"\n-    \"@next/swc-linux-x64-musl\" \"15.6.0-canary.7\"\n-    \"@next/swc-win32-arm64-msvc\" \"15.6.0-canary.7\"\n-    \"@next/swc-win32-x64-msvc\" \"15.6.0-canary.7\"\n+    \"@next/swc-darwin-arm64\" \"15.5.7\"\n+    \"@next/swc-darwin-x64\" \"15.5.7\"\n+    \"@next/swc-linux-arm64-gnu\" \"15.5.7\"\n+    \"@next/swc-linux-arm64-musl\" \"15.5.7\"\n+    \"@next/swc-linux-x64-gnu\" \"15.5.7\"\n+    \"@next/swc-linux-x64-musl\" \"15.5.7\"\n+    \"@next/swc-win32-arm64-msvc\" \"15.5.7\"\n+    \"@next/swc-win32-x64-msvc\" \"15.5.7\"\n     sharp \"^0.34.3\"\n \n node-releases@^2.0.18:"}, {"role": "assistant", "content": "fix(playground): downgrade next.js and replace Activity component"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../babel-plugin-react-compiler/src/HIR/HIR.ts     |   5 +\n .../src/Validation/ValidateNoSetStateInEffects.ts  |  16 +-\n ...State-in-useEffect-via-useEffectEvent.expect.md |  71 ++++++++\n ...lid-setState-in-useEffect-via-useEffectEvent.js |  13 ++\n ...useEffect-via-useEffectEvent-listener.expect.md | 116 +++++++++++++\n ...ate-in-useEffect-via-useEffectEvent-listener.js |  29 ++++\n ...useEffect-via-useEffectEvent-with-ref.expect.md | 192 +++++++++++++++++++++\n ...ate-in-useEffect-via-useEffectEvent-with-ref.js |  59 +++++++\n 8 files changed, 500 insertions(+), 1 deletion(-)\n\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts b/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\nindex 3e4cbb9..fe850f9 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\n@@ -2023,6 +2023,11 @@ export function isUseInsertionEffectHookType(id: Identifier): boolean {\n     id.type.shapeId === 'BuiltInUseInsertionEffectHook'\n   );\n }\n+export function isUseEffectEventType(id: Identifier): boolean {\n+  return (\n+    id.type.kind === 'Function' && id.type.shapeId === 'BuiltInUseEffectEvent'\n+  );\n+}\n \n export function isUseContextHookType(id: Identifier): boolean {\n   return (\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateNoSetStateInEffects.ts b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateNoSetStateInEffects.ts\nindex 795969b..86070e2 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateNoSetStateInEffects.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateNoSetStateInEffects.ts\n@@ -16,6 +16,7 @@ import {\n   IdentifierId,\n   isSetStateType,\n   isUseEffectHookType,\n+  isUseEffectEventType,\n   isUseInsertionEffectHookType,\n   isUseLayoutEffectHookType,\n   isUseRefType,\n@@ -98,7 +99,20 @@ export function validateNoSetStateInEffects(\n             instr.value.kind === 'MethodCall'\n               ? instr.value.receiver\n               : instr.value.callee;\n-          if (\n+\n+          if (isUseEffectEventType(callee.identifier)) {\n+            const arg = instr.value.args[0];\n+            if (arg !== undefined && arg.kind === 'Identifier') {\n+              const setState = setStateFunctions.get(arg.identifier.id);\n+              if (setState !== undefined) {\n+                /**\n+                 * This effect event function calls setState synchonously,\n+                 * treat it as a setState function for transitive tracking\n+                 */\n+                setStateFunctions.set(instr.lvalue.identifier.id, setState);\n+              }\n+            }\n+          } else if (\n             isUseEffectHookType(callee.identifier) ||\n             isUseLayoutEffectHookType(callee.identifier) ||\n             isUseInsertionEffectHookType(callee.identifier)\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/invalid-setState-in-useEffect-via-useEffectEvent.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/invalid-setState-in-useEffect-via-useEffectEvent.expect.md\nnew file mode 100644\nindex 0000000..9461692\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/invalid-setState-in-useEffect-via-useEffectEvent.expect.md\n@@ -0,0 +1,71 @@\n+\n+## Input\n+\n+```javascript\n+// @loggerTestOnly @validateNoSetStateInEffects\n+import {useEffect, useEffectEvent, useState} from 'react';\n+\n+function Component() {\n+  const [state, setState] = useState(0);\n+  const effectEvent = useEffectEvent(() => {\n+    setState(true);\n+  });\n+  useEffect(() => {\n+    effectEvent();\n+  }, []);\n+  return state;\n+}\n+\n+```\n+\n+## Code\n+\n+```javascript\n+import { c as _c } from \"react/compiler-runtime\"; // @loggerTestOnly @validateNoSetStateInEffects\n+import { useEffect, useEffectEvent, useState } from \"react\";\n+\n+function Component() {\n+  const $ = _c(4);\n+  const [state, setState] = useState(0);\n+  let t0;\n+  if ($[0] === Symbol.for(\"react.memo_cache_sentinel\")) {\n+    t0 = () => {\n+      setState(true);\n+    };\n+    $[0] = t0;\n+  } else {\n+    t0 = $[0];\n+  }\n+  const effectEvent = useEffectEvent(t0);\n+  let t1;\n+  if ($[1] !== effectEvent) {\n+    t1 = () => {\n+      effectEvent();\n+    };\n+    $[1] = effectEvent;\n+    $[2] = t1;\n+  } else {\n+    t1 = $[2];\n+  }\n+  let t2;\n+  if ($[3] === Symbol.for(\"react.memo_cache_sentinel\")) {\n+    t2 = [];\n+    $[3] = t2;\n+  } else {\n+    t2 = $[3];\n+  }\n+  useEffect(t1, t2);\n+  return state;\n+}\n+\n+```\n+\n+## Logs\n+\n+```\n+{\"kind\":\"CompileError\",\"detail\":{\"options\":{\"category\":\"EffectSetState\",\"reason\":\"Calling setState synchronously within an effect can trigger cascading renders\",\"description\":\"Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\\n* Update external systems with the latest state from React.\\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\\n\\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect)\",\"suggestions\":null,\"details\":[{\"kind\":\"error\",\"loc\":{\"start\":{\"line\":10,\"column\":4,\"index\":267},\"end\":{\"line\":10,\"column\":15,\"index\":278},\"filename\":\"invalid-setState-in-useEffect-via-useEffectEvent.ts\",\"identifierName\":\"effectEvent\"},\"message\":\"Avoid calling setState() directly within an effect\"}]}},\"fnLoc\":null}\n+{\"kind\":\"CompileSuccess\",\"fnLoc\":{\"start\":{\"line\":4,\"column\":0,\"index\":108},\"end\":{\"line\":13,\"column\":1,\"index\":309},\"filename\":\"invalid-setState-in-useEffect-via-useEffectEvent.ts\"},\"fnName\":\"Component\",\"memoSlots\":4,\"memoBlocks\":3,\"memoValues\":3,\"prunedMemoBlocks\":0,\"prunedMemoValues\":0}\n+```\n+      \n+### Eval output\n+(kind: exception) Fixture not implemented\n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/invalid-setState-in-useEffect-via-useEffectEvent.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/invalid-setState-in-useEffect-via-useEffectEvent.js\nnew file mode 100644\nindex 0000000..a838e58\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/invalid-setState-in-useEffect-via-useEffectEvent.js\n@@ -0,0 +1,13 @@\n+// @loggerTestOnly @validateNoSetStateInEffects\n+import {useEffect, useEffectEvent, useState} from 'react';\n+\n+function Component() {\n+  const [state, setState] = useState(0);\n+  const effectEvent = useEffectEvent(() => {\n+    setState(true);\n+  });\n+  useEffect(() => {\n+    effectEvent();\n+  }, []);\n+  return state;\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-listener.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-listener.expect.md\nnew file mode 100644\nindex 0000000..d426c74\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-listener.expect.md\n@@ -0,0 +1,116 @@\n+\n+## Input\n+\n+```javascript\n+// @validateNoSetStateInEffects @loggerTestOnly @compilationMode:\"infer\"\n+import {useEffect, useEffectEvent, useState} from 'react';\n+\n+const shouldSetState = false;\n+\n+function Component() {\n+  const [state, setState] = useState(0);\n+  const effectEvent = useEffectEvent(() => {\n+    setState(10);\n+  });\n+  useEffect(() => {\n+    setTimeout(effectEvent, 10);\n+  });\n+\n+  const effectEventWithTimeout = useEffectEvent(() => {\n+    setTimeout(() => {\n+      setState(20);\n+    }, 10);\n+  });\n+  useEffect(() => {\n+    effectEventWithTimeout();\n+  }, []);\n+  return state;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{}],\n+};\n+\n+```\n+\n+## Code\n+\n+```javascript\n+import { c as _c } from \"react/compiler-runtime\"; // @validateNoSetStateInEffects @loggerTestOnly @compilationMode:\"infer\"\n+import { useEffect, useEffectEvent, useState } from \"react\";\n+\n+const shouldSetState = false;\n+\n+function Component() {\n+  const $ = _c(7);\n+  const [state, setState] = useState(0);\n+  let t0;\n+  if ($[0] === Symbol.for(\"react.memo_cache_sentinel\")) {\n+    t0 = () => {\n+      setState(10);\n+    };\n+    $[0] = t0;\n+  } else {\n+    t0 = $[0];\n+  }\n+  const effectEvent = useEffectEvent(t0);\n+  let t1;\n+  if ($[1] !== effectEvent) {\n+    t1 = () => {\n+      setTimeout(effectEvent, 10);\n+    };\n+    $[1] = effectEvent;\n+    $[2] = t1;\n+  } else {\n+    t1 = $[2];\n+  }\n+  useEffect(t1);\n+  let t2;\n+  if ($[3] === Symbol.for(\"react.memo_cache_sentinel\")) {\n+    t2 = () => {\n+      setTimeout(() => {\n+        setState(20);\n+      }, 10);\n+    };\n+    $[3] = t2;\n+  } else {\n+    t2 = $[3];\n+  }\n+  const effectEventWithTimeout = useEffectEvent(t2);\n+  let t3;\n+  if ($[4] !== effectEventWithTimeout) {\n+    t3 = () => {\n+      effectEventWithTimeout();\n+    };\n+    $[4] = effectEventWithTimeout;\n+    $[5] = t3;\n+  } else {\n+    t3 = $[5];\n+  }\n+  let t4;\n+  if ($[6] === Symbol.for(\"react.memo_cache_sentinel\")) {\n+    t4 = [];\n+    $[6] = t4;\n+  } else {\n+    t4 = $[6];\n+  }\n+  useEffect(t3, t4);\n+  return state;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{}],\n+};\n+\n+```\n+\n+## Logs\n+\n+```\n+{\"kind\":\"CompileSuccess\",\"fnLoc\":{\"start\":{\"line\":6,\"column\":0,\"index\":164},\"end\":{\"line\":24,\"column\":1,\"index\":551},\"filename\":\"valid-setState-in-useEffect-via-useEffectEvent-listener.ts\"},\"fnName\":\"Component\",\"memoSlots\":7,\"memoBlocks\":5,\"memoValues\":5,\"prunedMemoBlocks\":0,\"prunedMemoValues\":0}\n+```\n+      \n+### Eval output\n+(kind: exception) (0 , _react.useEffectEvent) is not a function\n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-listener.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-listener.js\nnew file mode 100644\nindex 0000000..e2ebd7f\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-listener.js\n@@ -0,0 +1,29 @@\n+// @validateNoSetStateInEffects @loggerTestOnly @compilationMode:\"infer\"\n+import {useEffect, useEffectEvent, useState} from 'react';\n+\n+const shouldSetState = false;\n+\n+function Component() {\n+  const [state, setState] = useState(0);\n+  const effectEvent = useEffectEvent(() => {\n+    setState(10);\n+  });\n+  useEffect(() => {\n+    setTimeout(effectEvent, 10);\n+  });\n+\n+  const effectEventWithTimeout = useEffectEvent(() => {\n+    setTimeout(() => {\n+      setState(20);\n+    }, 10);\n+  });\n+  useEffect(() => {\n+    effectEventWithTimeout();\n+  }, []);\n+  return state;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{}],\n+};\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-with-ref.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-with-ref.expect.md\nnew file mode 100644\nindex 0000000..f24c39c\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-with-ref.expect.md\n@@ -0,0 +1,192 @@\n+\n+## Input\n+\n+```javascript\n+// @validateNoSetStateInEffects @enableAllowSetStateFromRefsInEffects @loggerTestOnly @compilationMode:\"infer\"\n+import {useState, useRef, useEffect, useEffectEvent} from 'react';\n+\n+function Component({x, y}) {\n+  const previousXRef = useRef(null);\n+  const previousYRef = useRef(null);\n+\n+  const [data, setData] = useState(null);\n+\n+  const effectEvent = useEffectEvent(() => {\n+    const data = load({x, y});\n+    setData(data);\n+  });\n+\n+  useEffect(() => {\n+    const previousX = previousXRef.current;\n+    previousXRef.current = x;\n+    const previousY = previousYRef.current;\n+    previousYRef.current = y;\n+    if (!areEqual(x, previousX) || !areEqual(y, previousY)) {\n+      effectEvent();\n+    }\n+  }, [x, y]);\n+\n+  const effectEvent2 = useEffectEvent((xx, yy) => {\n+    const previousX = previousXRef.current;\n+    previousXRef.current = xx;\n+    const previousY = previousYRef.current;\n+    previousYRef.current = yy;\n+    if (!areEqual(xx, previousX) || !areEqual(yy, previousY)) {\n+      const data = load({x: xx, y: yy});\n+      setData(data);\n+    }\n+  });\n+\n+  useEffect(() => {\n+    effectEvent2(x, y);\n+  }, [x, y]);\n+\n+  return data;\n+}\n+\n+function areEqual(a, b) {\n+  return a === b;\n+}\n+\n+function load({x, y}) {\n+  return x * y;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{x: 0, y: 0}],\n+  sequentialRenders: [\n+    {x: 0, y: 0},\n+    {x: 1, y: 0},\n+    {x: 1, y: 1},\n+  ],\n+};\n+\n+```\n+\n+## Code\n+\n+```javascript\n+import { c as _c } from \"react/compiler-runtime\"; // @validateNoSetStateInEffects @enableAllowSetStateFromRefsInEffects @loggerTestOnly @compilationMode:\"infer\"\n+import { useState, useRef, useEffect, useEffectEvent } from \"react\";\n+\n+function Component(t0) {\n+  const $ = _c(18);\n+  const { x, y } = t0;\n+  const previousXRef = useRef(null);\n+  const previousYRef = useRef(null);\n+\n+  const [data, setData] = useState(null);\n+  let t1;\n+  if ($[0] !== x || $[1] !== y) {\n+    t1 = () => {\n+      const data_0 = load({ x, y });\n+      setData(data_0);\n+    };\n+    $[0] = x;\n+    $[1] = y;\n+    $[2] = t1;\n+  } else {\n+    t1 = $[2];\n+  }\n+  const effectEvent = useEffectEvent(t1);\n+  let t2;\n+  if ($[3] !== effectEvent || $[4] !== x || $[5] !== y) {\n+    t2 = () => {\n+      const previousX = previousXRef.current;\n+      previousXRef.current = x;\n+      const previousY = previousYRef.current;\n+      previousYRef.current = y;\n+      if (!areEqual(x, previousX) || !areEqual(y, previousY)) {\n+        effectEvent();\n+      }\n+    };\n+    $[3] = effectEvent;\n+    $[4] = x;\n+    $[5] = y;\n+    $[6] = t2;\n+  } else {\n+    t2 = $[6];\n+  }\n+  let t3;\n+  if ($[7] !== x || $[8] !== y) {\n+    t3 = [x, y];\n+    $[7] = x;\n+    $[8] = y;\n+    $[9] = t3;\n+  } else {\n+    t3 = $[9];\n+  }\n+  useEffect(t2, t3);\n+  let t4;\n+  if ($[10] === Symbol.for(\"react.memo_cache_sentinel\")) {\n+    t4 = (xx, yy) => {\n+      const previousX_0 = previousXRef.current;\n+      previousXRef.current = xx;\n+      const previousY_0 = previousYRef.current;\n+      previousYRef.current = yy;\n+      if (!areEqual(xx, previousX_0) || !areEqual(yy, previousY_0)) {\n+        const data_1 = load({ x: xx, y: yy });\n+        setData(data_1);\n+      }\n+    };\n+    $[10] = t4;\n+  } else {\n+    t4 = $[10];\n+  }\n+  const effectEvent2 = useEffectEvent(t4);\n+  let t5;\n+  if ($[11] !== effectEvent2 || $[12] !== x || $[13] !== y) {\n+    t5 = () => {\n+      effectEvent2(x, y);\n+    };\n+    $[11] = effectEvent2;\n+    $[12] = x;\n+    $[13] = y;\n+    $[14] = t5;\n+  } else {\n+    t5 = $[14];\n+  }\n+  let t6;\n+  if ($[15] !== x || $[16] !== y) {\n+    t6 = [x, y];\n+    $[15] = x;\n+    $[16] = y;\n+    $[17] = t6;\n+  } else {\n+    t6 = $[17];\n+  }\n+  useEffect(t5, t6);\n+  return data;\n+}\n+\n+function areEqual(a, b) {\n+  return a === b;\n+}\n+\n+function load({ x, y }) {\n+  return x * y;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{ x: 0, y: 0 }],\n+  sequentialRenders: [\n+    { x: 0, y: 0 },\n+    { x: 1, y: 0 },\n+    { x: 1, y: 1 },\n+  ],\n+};\n+\n+```\n+\n+## Logs\n+\n+```\n+{\"kind\":\"CompileSuccess\",\"fnLoc\":{\"start\":{\"line\":4,\"column\":0,\"index\":179},\"end\":{\"line\":41,\"column\":1,\"index\":1116},\"filename\":\"valid-setState-in-useEffect-via-useEffectEvent-with-ref.ts\"},\"fnName\":\"Component\",\"memoSlots\":18,\"memoBlocks\":6,\"memoValues\":6,\"prunedMemoBlocks\":0,\"prunedMemoValues\":0}\n+```\n+      \n+### Eval output\n+(kind: ok) [[ (exception in render) TypeError: (0 , _react.useEffectEvent) is not a function ]]\n+[[ (exception in render) TypeError: (0 , _react.useEffectEvent) is not a function ]]\n+[[ (exception in render) TypeError: (0 , _react.useEffectEvent) is not a function ]]\n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-with-ref.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-with-ref.js\nnew file mode 100644\nindex 0000000..1436edf\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/valid-setState-in-useEffect-via-useEffectEvent-with-ref.js\n@@ -0,0 +1,59 @@\n+// @validateNoSetStateInEffects @enableAllowSetStateFromRefsInEffects @loggerTestOnly @compilationMode:\"infer\"\n+import {useState, useRef, useEffect, useEffectEvent} from 'react';\n+\n+function Component({x, y}) {\n+  const previousXRef = useRef(null);\n+  const previousYRef = useRef(null);\n+\n+  const [data, setData] = useState(null);\n+\n+  const effectEvent = useEffectEvent(() => {\n+    const data = load({x, y});\n+    setData(data);\n+  });\n+\n+  useEffect(() => {\n+    const previousX = previousXRef.current;\n+    previousXRef.current = x;\n+    const previousY = previousYRef.current;\n+    previousYRef.current = y;\n+    if (!areEqual(x, previousX) || !areEqual(y, previousY)) {\n+      effectEvent();\n+    }\n+  }, [x, y]);\n+\n+  const effectEvent2 = useEffectEvent((xx, yy) => {\n+    const previousX = previousXRef.current;\n+    previousXRef.current = xx;\n+    const previousY = previousYRef.current;\n+    previousYRef.current = yy;\n+    if (!areEqual(xx, previousX) || !areEqual(yy, previousY)) {\n+      const data = load({x: xx, y: yy});\n+      setData(data);\n+    }\n+  });\n+\n+  useEffect(() => {\n+    effectEvent2(x, y);\n+  }, [x, y]);\n+\n+  return data;\n+}\n+\n+function areEqual(a, b) {\n+  return a === b;\n+}\n+\n+function load({x, y}) {\n+  return x * y;\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{x: 0, y: 0}],\n+  sequentialRenders: [\n+    {x: 0, y: 0},\n+    {x: 1, y: 0},\n+    {x: 1, y: 1},\n+  ],\n+};"}, {"role": "assistant", "content": "fix(compiler): track setState through useEffectEvent calls"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n fixtures/eslint-v6/index.js | 4 ++--\n fixtures/eslint-v7/index.js | 4 ++--\n fixtures/eslint-v8/index.js | 4 ++--\n fixtures/eslint-v9/index.js | 6 ++++--\n 4 files changed, 10 insertions(+), 8 deletions(-)\n\ndiff --git a/fixtures/eslint-v6/index.js b/fixtures/eslint-v6/index.js\nindex 23af473..143228e 100644\n--- a/fixtures/eslint-v6/index.js\n+++ b/fixtures/eslint-v6/index.js\n@@ -159,9 +159,9 @@ function InvalidGlobals() {\n   return <div>Done</div>;\n }\n \n-// Invalid: useMemo with wrong deps - triggers preserve-manual-memoization\n+// Invalid: useMemo with wrong deps\n function InvalidUseMemo({items}) {\n-  // eslint-disable-next-line react-hooks/preserve-manual-memoization, react-hooks/exhaustive-deps\n+  // eslint-disable-next-line react-hooks/exhaustive-deps\n   const sorted = useMemo(() => [...items].sort(), []);\n   return <div>{sorted.length}</div>;\n }\ndiff --git a/fixtures/eslint-v7/index.js b/fixtures/eslint-v7/index.js\nindex 23af473..143228e 100644\n--- a/fixtures/eslint-v7/index.js\n+++ b/fixtures/eslint-v7/index.js\n@@ -159,9 +159,9 @@ function InvalidGlobals() {\n   return <div>Done</div>;\n }\n \n-// Invalid: useMemo with wrong deps - triggers preserve-manual-memoization\n+// Invalid: useMemo with wrong deps\n function InvalidUseMemo({items}) {\n-  // eslint-disable-next-line react-hooks/preserve-manual-memoization, react-hooks/exhaustive-deps\n+  // eslint-disable-next-line react-hooks/exhaustive-deps\n   const sorted = useMemo(() => [...items].sort(), []);\n   return <div>{sorted.length}</div>;\n }\ndiff --git a/fixtures/eslint-v8/index.js b/fixtures/eslint-v8/index.js\nindex 23af473..143228e 100644\n--- a/fixtures/eslint-v8/index.js\n+++ b/fixtures/eslint-v8/index.js\n@@ -159,9 +159,9 @@ function InvalidGlobals() {\n   return <div>Done</div>;\n }\n \n-// Invalid: useMemo with wrong deps - triggers preserve-manual-memoization\n+// Invalid: useMemo with wrong deps\n function InvalidUseMemo({items}) {\n-  // eslint-disable-next-line react-hooks/preserve-manual-memoization, react-hooks/exhaustive-deps\n+  // eslint-disable-next-line react-hooks/exhaustive-deps\n   const sorted = useMemo(() => [...items].sort(), []);\n   return <div>{sorted.length}</div>;\n }\ndiff --git a/fixtures/eslint-v9/index.js b/fixtures/eslint-v9/index.js\nindex 23af473..5a43235 100644\n--- a/fixtures/eslint-v9/index.js\n+++ b/fixtures/eslint-v9/index.js\n@@ -70,6 +70,7 @@ function ComponentWithoutDeclaringPropAsDep(props) {\n     console.log(props.foo);\n     // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, []);\n+  // eslint-disable-next-line react-hooks/void-use-memo\n   useMemo(() => {\n     console.log(props.foo);\n     // eslint-disable-next-line react-hooks/exhaustive-deps\n@@ -82,6 +83,7 @@ function ComponentWithoutDeclaringPropAsDep(props) {\n     console.log(props.foo);\n     // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, []);\n+  // eslint-disable-next-line react-hooks/void-use-memo\n   React.useMemo(() => {\n     console.log(props.foo);\n     // eslint-disable-next-line react-hooks/exhaustive-deps\n@@ -159,9 +161,9 @@ function InvalidGlobals() {\n   return <div>Done</div>;\n }\n \n-// Invalid: useMemo with wrong deps - triggers preserve-manual-memoization\n+// Invalid: useMemo with wrong deps\n function InvalidUseMemo({items}) {\n-  // eslint-disable-next-line react-hooks/preserve-manual-memoization, react-hooks/exhaustive-deps\n+  // eslint-disable-next-line react-hooks/exhaustive-deps\n   const sorted = useMemo(() => [...items].sort(), []);\n   return <div>{sorted.length}</div>;\n }"}, {"role": "assistant", "content": "test(fixtures): update eslint disable comments for react-hooks rules"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages-private/dts-test/setupHelpers.test-d.ts | 10 ++++++++++\n packages/runtime-core/src/apiSetupHelpers.ts     |  6 ++++--\n 2 files changed, 14 insertions(+), 2 deletions(-)\n\ndiff --git a/packages-private/dts-test/setupHelpers.test-d.ts b/packages-private/dts-test/setupHelpers.test-d.ts\nindex 656f1da..0cf713a 100644\n--- a/packages-private/dts-test/setupHelpers.test-d.ts\n+++ b/packages-private/dts-test/setupHelpers.test-d.ts\n@@ -33,6 +33,16 @@ describe('defineProps w/ type declaration', () => {\n   expectType<boolean>(props.boolAndUndefined)\n })\n \n+describe('defineProps w/ never prop', () => {\n+  const props = defineProps<{\n+    foo?: never\n+    bar: number\n+  }>()\n+\n+  expectType<never | undefined>(props.foo)\n+  expectType<number>(props.bar)\n+})\n+\n describe('defineProps w/ generics', () => {\n   function test<T extends boolean>() {\n     const props = defineProps<{ foo: T; bar: string; x?: boolean }>()\ndiff --git a/packages/runtime-core/src/apiSetupHelpers.ts b/packages/runtime-core/src/apiSetupHelpers.ts\nindex 67e1d55..250f4f5 100644\n--- a/packages/runtime-core/src/apiSetupHelpers.ts\n+++ b/packages/runtime-core/src/apiSetupHelpers.ts\n@@ -98,8 +98,10 @@ export type DefineProps<T, BKeys extends keyof T> = Readonly<T> & {\n }\n \n type BooleanKey<T, K extends keyof T = keyof T> = K extends any\n-  ? [T[K]] extends [boolean | undefined]\n-    ? K\n+  ? T[K] extends boolean | undefined\n+    ? T[K] extends never | undefined\n+      ? never\n+      : K\n     : never\n   : never\n "}, {"role": "assistant", "content": "fix(types): exclude never props from boolean key detection"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/runtime_build_and_test.yml                      | 8 +++++---\n .../react-devtools-shared/src/__tests__/profilerContext-test.js   | 2 +-\n 2 files changed, 6 insertions(+), 4 deletions(-)\n\ndiff --git a/.github/workflows/runtime_build_and_test.yml b/.github/workflows/runtime_build_and_test.yml\nindex 735ac6e..25282e8 100644\n--- a/.github/workflows/runtime_build_and_test.yml\n+++ b/.github/workflows/runtime_build_and_test.yml\n@@ -454,9 +454,11 @@ jobs:\n       fail-fast: false\n       matrix:\n         shard:\n-          - 1/3\n-          - 2/3\n-          - 3/3\n+          - 1/5\n+          - 2/5\n+          - 3/5\n+          - 4/5\n+          - 5/5\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@v4\ndiff --git a/packages/react-devtools-shared/src/__tests__/profilerContext-test.js b/packages/react-devtools-shared/src/__tests__/profilerContext-test.js\nindex 7864f97..a1e47de 100644\n--- a/packages/react-devtools-shared/src/__tests__/profilerContext-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/profilerContext-test.js\n@@ -654,7 +654,7 @@ describe('ProfilerContext', () => {\n     expect(store.profilerStore.isProfilingBasedOnUserInput).toBe(false);\n \n     document.body.removeChild(profilerContainer);\n-  });\n+  }, 20000);\n \n   it('should navigate between commits when the keyboard shortcut is pressed', async () => {\n     const Parent = () => <Child />;"}, {"role": "assistant", "content": "ci: increase test shards and extend timeout"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 9c4fe05..2eb6746 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -15,6 +15,7 @@ hide:\n \n ### Internal\n \n+* \ud83c\udf10 Update translation prompts. PR [#14619](https://github.com/fastapi/fastapi/pull/14619) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd28 Update LLM translation script to guide reviewers to change the prompt. PR [#14614](https://github.com/fastapi/fastapi/pull/14614) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc77 Do not run translations on cron while finishing updating existing languages. PR [#14613](https://github.com/fastapi/fastapi/pull/14613) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd25 Remove test variants for Pydantic v1 in test_request_params. PR [#14612](https://github.com/fastapi/fastapi/pull/14612) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../template/pipeline/src/phases/var_counting.ts   | 93 +++++++++++++---------\n 1 file changed, 54 insertions(+), 39 deletions(-)\n\ndiff --git a/packages/compiler/src/template/pipeline/src/phases/var_counting.ts b/packages/compiler/src/template/pipeline/src/phases/var_counting.ts\nindex efc01304..258502ff 100644\n--- a/packages/compiler/src/template/pipeline/src/phases/var_counting.ts\n+++ b/packages/compiler/src/template/pipeline/src/phases/var_counting.ts\n@@ -7,6 +7,7 @@\n  */\n \n import * as ir from '../../ir';\n+import * as o from '../../../../output/output_ast';\n import {CompilationJob, ComponentCompilationJob} from '../compilation';\n \n /**\n@@ -28,50 +29,64 @@ export function countVariables(job: CompilationJob): void {\n     // Count variables on expressions inside ops. We do this later because some of these expressions\n     // might be conditional (e.g. `pipeBinding` inside of a ternary), and we don't want to interfere\n     // with indices for top-level binding slots (e.g. `property`).\n-    for (const op of unit.ops()) {\n-      ir.visitExpressionsInOp(op, (expr) => {\n-        if (!ir.isIrExpression(expr)) {\n-          return;\n-        }\n+    const firstPassCountExpressionVars = (expr: o.Expression) => {\n+      if (!ir.isIrExpression(expr)) {\n+        return;\n+      }\n \n-        // TemplateDefinitionBuilder assigns variable offsets for everything but pure functions\n-        // first, and then assigns offsets to pure functions lazily. We emulate that behavior by\n-        // assigning offsets in two passes instead of one, only in compatibility mode.\n-        if (\n-          job.compatibility === ir.CompatibilityMode.TemplateDefinitionBuilder &&\n-          expr instanceof ir.PureFunctionExpr\n-        ) {\n-          return;\n-        }\n+      // TemplateDefinitionBuilder assigns variable offsets for everything but pure functions\n+      // first, and then assigns offsets to pure functions lazily. We emulate that behavior by\n+      // assigning offsets in two passes instead of one, only in compatibility mode.\n+      if (\n+        job.compatibility === ir.CompatibilityMode.TemplateDefinitionBuilder &&\n+        expr instanceof ir.PureFunctionExpr\n+      ) {\n+        return;\n+      }\n \n-        // Some expressions require knowledge of the number of variable slots consumed.\n-        if (ir.hasUsesVarOffsetTrait(expr)) {\n-          expr.varOffset = varCount;\n-        }\n+      // Some expressions require knowledge of the number of variable slots consumed.\n+      if (ir.hasUsesVarOffsetTrait(expr)) {\n+        expr.varOffset = varCount;\n+      }\n \n-        if (ir.hasConsumesVarsTrait(expr)) {\n-          varCount += varsUsedByIrExpression(expr);\n-        }\n-      });\n-    }\n+      if (ir.hasConsumesVarsTrait(expr)) {\n+        varCount += varsUsedByIrExpression(expr);\n+      }\n+    };\n \n     // Compatibility mode pass for pure function offsets (as explained above).\n+    const secondPassCountExpressionVars = (expr: o.Expression) => {\n+      if (!ir.isIrExpression(expr) || !(expr instanceof ir.PureFunctionExpr)) {\n+        return;\n+      }\n+\n+      // Some expressions require knowledge of the number of variable slots consumed.\n+      if (ir.hasUsesVarOffsetTrait(expr)) {\n+        expr.varOffset = varCount;\n+      }\n+\n+      if (ir.hasConsumesVarsTrait(expr)) {\n+        varCount += varsUsedByIrExpression(expr);\n+      }\n+    };\n+\n+    // Note: we iterate over `create` and `update` separately, instead of going using `unit.ops()`,\n+    // because `unit.ops()` will visit nested ops too (e.g. the `ListenerOp.handlerOps`). We\n+    // don't want that, because the `visitExpressionsInOp` call below will visit the same nested\n+    // ops again, leading to vars in some expressions to be counted twice.\n+    for (const createOp of unit.create) {\n+      ir.visitExpressionsInOp(createOp, firstPassCountExpressionVars);\n+    }\n+    for (const updateOp of unit.update) {\n+      ir.visitExpressionsInOp(updateOp, firstPassCountExpressionVars);\n+    }\n+\n     if (job.compatibility === ir.CompatibilityMode.TemplateDefinitionBuilder) {\n-      for (const op of unit.ops()) {\n-        ir.visitExpressionsInOp(op, (expr) => {\n-          if (!ir.isIrExpression(expr) || !(expr instanceof ir.PureFunctionExpr)) {\n-            return;\n-          }\n-\n-          // Some expressions require knowledge of the number of variable slots consumed.\n-          if (ir.hasUsesVarOffsetTrait(expr)) {\n-            expr.varOffset = varCount;\n-          }\n-\n-          if (ir.hasConsumesVarsTrait(expr)) {\n-            varCount += varsUsedByIrExpression(expr);\n-          }\n-        });\n+      for (const createOp of unit.create) {\n+        ir.visitExpressionsInOp(createOp, secondPassCountExpressionVars);\n+      }\n+      for (const updateOp of unit.update) {\n+        ir.visitExpressionsInOp(updateOp, secondPassCountExpressionVars);\n       }\n     }\n \n@@ -164,7 +179,7 @@ function varsUsedByOp(op: (ir.CreateOp | ir.UpdateOp) & ir.ConsumesVarsTrait): n\n   }\n }\n \n-export function varsUsedByIrExpression(expr: ir.Expression & ir.ConsumesVarsTrait): number {\n+function varsUsedByIrExpression(expr: ir.Expression & ir.ConsumesVarsTrait): number {\n   switch (expr.kind) {\n     case ir.ExpressionKind.PureFunctionExpr:\n       return 1 + expr.args.length;"}, {"role": "assistant", "content": "fix(compiler): variable counter visiting some expressions twice"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n package.json                                 |  2 +-\n scripts/rollup/build-all-release-channels.js | 47 +++++++++++++++++-----------\n 2 files changed, 29 insertions(+), 20 deletions(-)\n\ndiff --git a/package.json b/package.json\nindex 1b88aa1..0108818 100644\n--- a/package.json\n+++ b/package.json\n@@ -123,7 +123,7 @@\n   \"scripts\": {\n     \"prebuild\": \"./scripts/react-compiler/link-compiler.sh\",\n     \"build\": \"node ./scripts/rollup/build-all-release-channels.js\",\n-    \"build-for-devtools\": \"cross-env RELEASE_CHANNEL=experimental yarn build react/index,react/jsx,react/compiler-runtime,react-dom/index,react-dom/client,react-dom/unstable_testing,react-dom/test-utils,react-is,react-debug-tools,scheduler,react-test-renderer,react-refresh,react-art --type=NODE\",\n+    \"build-for-devtools\": \"cross-env yarn build react/index,react/jsx,react/compiler-runtime,react-dom/index,react-dom/client,react-dom/unstable_testing,react-dom/test-utils,react-is,react-debug-tools,scheduler,react-test-renderer,react-refresh,react-art --type=NODE --release-channel=experimental\",\n     \"build-for-devtools-dev\": \"yarn build-for-devtools --type=NODE_DEV\",\n     \"build-for-devtools-prod\": \"yarn build-for-devtools --type=NODE_PROD\",\n     \"build-for-flight-dev\": \"cross-env RELEASE_CHANNEL=experimental node ./scripts/rollup/build.js react/index,react/jsx,react.react-server,react-dom/index,react-dom/client,react-dom/server,react-dom.react-server,react-dom-server.node,react-dom-server-legacy.node,scheduler,react-server-dom-webpack/ --type=NODE_DEV,ESM_PROD,NODE_ES2015 && mv ./build/node_modules ./build/oss-experimental\",\ndiff --git a/scripts/rollup/build-all-release-channels.js b/scripts/rollup/build-all-release-channels.js\nindex 47d3ac9..95aef66 100644\n--- a/scripts/rollup/build-all-release-channels.js\n+++ b/scripts/rollup/build-all-release-channels.js\n@@ -124,25 +124,34 @@ async function main() {\n         throw new Error(`Unknown release channel ${argv.releaseChannel}`);\n     }\n   } else {\n-    // Running locally, no concurrency. Move each channel's build artifacts into\n-    // a temporary directory so that they don't conflict.\n-    buildForChannel('stable', '', '');\n-    const stableDir = tmp.dirSync().name;\n-    crossDeviceRenameSync('./build', stableDir);\n-    processStable(stableDir);\n-    buildForChannel('experimental', '', '');\n-    const experimentalDir = tmp.dirSync().name;\n-    crossDeviceRenameSync('./build', experimentalDir);\n-    processExperimental(experimentalDir);\n-\n-    // Then merge the experimental folder into the stable one. processExperimental\n-    // will have already removed conflicting files.\n-    //\n-    // In CI, merging is handled by the GitHub Download Artifacts plugin.\n-    mergeDirsSync(experimentalDir + '/', stableDir + '/');\n-\n-    // Now restore the combined directory back to its original name\n-    crossDeviceRenameSync(stableDir, './build');\n+    const releaseChannel = argv.releaseChannel;\n+    if (releaseChannel === 'stable') {\n+      buildForChannel('stable', '', '');\n+      processStable('./build');\n+    } else if (releaseChannel === 'experimental') {\n+      buildForChannel('experimental', '', '');\n+      processExperimental('./build');\n+    } else {\n+      // Running locally, no concurrency. Move each channel's build artifacts into\n+      // a temporary directory so that they don't conflict.\n+      buildForChannel('stable', '', '');\n+      const stableDir = tmp.dirSync().name;\n+      crossDeviceRenameSync('./build', stableDir);\n+      processStable(stableDir);\n+      buildForChannel('experimental', '', '');\n+      const experimentalDir = tmp.dirSync().name;\n+      crossDeviceRenameSync('./build', experimentalDir);\n+      processExperimental(experimentalDir);\n+\n+      // Then merge the experimental folder into the stable one. processExperimental\n+      // will have already removed conflicting files.\n+      //\n+      // In CI, merging is handled by the GitHub Download Artifacts plugin.\n+      mergeDirsSync(experimentalDir + '/', stableDir + '/');\n+\n+      // Now restore the combined directory back to its original name\n+      crossDeviceRenameSync(stableDir, './build');\n+    }\n   }\n }\n "}, {"role": "assistant", "content": "build: support single release channel builds locally"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n packages/compiler/src/expression_parser/ast.ts | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/packages/compiler/src/expression_parser/ast.ts b/packages/compiler/src/expression_parser/ast.ts\nindex b351da84..79d822c6 100644\n--- a/packages/compiler/src/expression_parser/ast.ts\n+++ b/packages/compiler/src/expression_parser/ast.ts\n@@ -385,7 +385,7 @@ export class Unary extends Binary {\n   private constructor(\n     span: ParseSpan,\n     sourceSpan: AbsoluteSourceSpan,\n-    public operator: string,\n+    public operator: '+' | '-',\n     public expr: AST,\n     binaryOp: BinaryOperation,\n     binaryLeft: AST,"}, {"role": "assistant", "content": "refactor(compiler): tighten `Unary.operator` type"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../imports/overwrite-different-warn-ambiguity.rs  | 28 ++++++++++++++++++++++\n 1 file changed, 28 insertions(+)\n\ndiff --git a/tests/ui/imports/overwrite-different-warn-ambiguity.rs b/tests/ui/imports/overwrite-different-warn-ambiguity.rs\nnew file mode 100644\nindex 00000000000..f843208b37d\n--- /dev/null\n+++ b/tests/ui/imports/overwrite-different-warn-ambiguity.rs\n@@ -0,0 +1,28 @@\n+//@ check-pass\n+//@ edition:2024\n+\n+mod framing {\n+    mod public_message_in {\n+        mod public_message {\n+            mod public_message {\n+                pub struct ConfirmedTranscriptHashInput;\n+            }\n+            mod public_message_in {\n+                use super::*;\n+                #[derive(Debug)]\n+                pub struct ConfirmedTranscriptHashInput;\n+            }\n+            pub use public_message::*;\n+            use public_message_in::*;\n+        }\n+        mod public_message_in {\n+            #[derive(Debug)]\n+            pub struct ConfirmedTranscriptHashInput;\n+        }\n+        pub use public_message::*;\n+        use public_message_in::*;\n+    }\n+    use public_message_in::*;\n+}\n+\n+fn main() {}"}, {"role": "assistant", "content": "test: add import ambiguity warning test"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/packages/snap/src/fixture-utils.ts | 30 ++++++++++-------------------\n 1 file changed, 10 insertions(+), 20 deletions(-)\n\ndiff --git a/compiler/packages/snap/src/fixture-utils.ts b/compiler/packages/snap/src/fixture-utils.ts\nindex ebf6a34..fae6afe 100644\n--- a/compiler/packages/snap/src/fixture-utils.ts\n+++ b/compiler/packages/snap/src/fixture-utils.ts\n@@ -44,21 +44,6 @@ function stripExtension(filename: string, extensions: Array<string>): string {\n   return filename;\n }\n \n-/**\n- * Strip all extensions from a filename\n- * e.g., \"foo.expect.md\" -> \"foo\"\n- */\n-function stripAllExtensions(filename: string): string {\n-  let result = filename;\n-  while (true) {\n-    const extension = path.extname(result);\n-    if (extension === '') {\n-      return result;\n-    }\n-    result = path.basename(result, extension);\n-  }\n-}\n-\n export async function readTestFilter(): Promise<TestFilter | null> {\n   if (!(await exists(FILTER_PATH))) {\n     throw new Error(`testfilter file not found at \\`${FILTER_PATH}\\``);\n@@ -134,13 +119,15 @@ async function readInputFixtures(\n           // `alias-while` => search for `alias-while{.js,.jsx,.ts,.tsx}`\n           // `alias-while.js` => search as-is\n           // `alias-while.expect.md` => search for `alias-while{.js,.jsx,.ts,.tsx}`\n-          const basename = path.basename(pattern);\n-          const basenameWithoutExt = stripAllExtensions(basename);\n-          const hasExtension = basename !== basenameWithoutExt;\n+          const patternWithoutExt = stripExtension(pattern, [\n+            ...INPUT_EXTENSIONS,\n+            SNAPSHOT_EXTENSION,\n+          ]);\n+          const hasExtension = pattern !== patternWithoutExt;\n           const globPattern =\n             hasExtension && !pattern.endsWith(SNAPSHOT_EXTENSION)\n               ? pattern\n-              : `${basenameWithoutExt}{${INPUT_EXTENSIONS.join(',')}}`;\n+              : `${patternWithoutExt}{${INPUT_EXTENSIONS.join(',')}}`;\n           return glob.glob(globPattern, {\n             cwd: rootDir,\n           });\n@@ -181,7 +168,10 @@ async function readOutputFixtures(\n       await Promise.all(\n         filter.paths.map(pattern => {\n           // Strip all extensions and find matching .expect.md files\n-          const basenameWithoutExt = stripAllExtensions(pattern);\n+          const basenameWithoutExt = stripExtension(pattern, [\n+            ...INPUT_EXTENSIONS,\n+            SNAPSHOT_EXTENSION,\n+          ]);\n           return glob.glob(`${basenameWithoutExt}${SNAPSHOT_EXTENSION}`, {\n             cwd: rootDir,\n           });"}, {"role": "assistant", "content": "refactor: simplify extension stripping in fixture utils"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_middle/src/thir.rs                       |  6 ------\n compiler/rustc_mir_build/src/builder/block.rs           |  1 +\n compiler/rustc_mir_build/src/builder/expr/as_operand.rs |  1 +\n compiler/rustc_mir_build/src/builder/expr/as_place.rs   |  1 +\n compiler/rustc_mir_build/src/builder/expr/as_rvalue.rs  |  1 +\n compiler/rustc_mir_build/src/builder/expr/as_temp.rs    |  2 +-\n compiler/rustc_mir_build/src/builder/expr/into.rs       |  1 +\n compiler/rustc_mir_build/src/builder/expr/stmt.rs       |  2 +-\n compiler/rustc_mir_build/src/builder/matches/mod.rs     |  2 +-\n compiler/rustc_mir_build/src/builder/mod.rs             |  4 ++--\n compiler/rustc_mir_build/src/builder/scope.rs           | 10 +++++++++-\n 11 files changed, 19 insertions(+), 12 deletions(-)\n\ndiff --git a/compiler/rustc_middle/src/thir.rs b/compiler/rustc_middle/src/thir.rs\nindex 86bd6fb803b..86c19520e07 100644\n--- a/compiler/rustc_middle/src/thir.rs\n+++ b/compiler/rustc_middle/src/thir.rs\n@@ -116,12 +116,6 @@ pub struct Param<'tcx> {\n     pub hir_id: Option<HirId>,\n }\n \n-#[derive(Copy, Clone, Debug, HashStable)]\n-pub enum LintLevel {\n-    Inherited,\n-    Explicit(HirId),\n-}\n-\n #[derive(Clone, Debug, HashStable)]\n pub struct Block {\n     /// Whether the block itself has a label. Used by `label: {}`\ndiff --git a/compiler/rustc_mir_build/src/builder/block.rs b/compiler/rustc_mir_build/src/builder/block.rs\nindex d8837d2b195..bfbb6fa7d16 100644\n--- a/compiler/rustc_mir_build/src/builder/block.rs\n+++ b/compiler/rustc_mir_build/src/builder/block.rs\n@@ -7,6 +7,7 @@\n \n use crate::builder::ForGuard::OutsideGuard;\n use crate::builder::matches::{DeclareLetBindings, ScheduleDrops};\n+use crate::builder::scope::LintLevel;\n use crate::builder::{BlockAnd, BlockAndExtension, BlockFrame, Builder};\n \n impl<'a, 'tcx> Builder<'a, 'tcx> {\ndiff --git a/compiler/rustc_mir_build/src/builder/expr/as_operand.rs b/compiler/rustc_mir_build/src/builder/expr/as_operand.rs\nindex c9c166b7f01..d2f06cc9d57 100644\n--- a/compiler/rustc_mir_build/src/builder/expr/as_operand.rs\n+++ b/compiler/rustc_mir_build/src/builder/expr/as_operand.rs\n@@ -6,6 +6,7 @@\n use tracing::{debug, instrument};\n \n use crate::builder::expr::category::Category;\n+use crate::builder::scope::LintLevel;\n use crate::builder::{BlockAnd, BlockAndExtension, Builder, NeedsTemporary};\n \n impl<'a, 'tcx> Builder<'a, 'tcx> {\ndiff --git a/compiler/rustc_mir_build/src/builder/expr/as_place.rs b/compiler/rustc_mir_build/src/builder/expr/as_place.rs\nindex db9aa3cd870..139c6da29d4 100644\n--- a/compiler/rustc_mir_build/src/builder/expr/as_place.rs\n+++ b/compiler/rustc_mir_build/src/builder/expr/as_place.rs\n@@ -16,6 +16,7 @@\n \n use crate::builder::ForGuard::{OutsideGuard, RefWithinGuard};\n use crate::builder::expr::category::Category;\n+use crate::builder::scope::LintLevel;\n use crate::builder::{BlockAnd, BlockAndExtension, Builder, Capture, CaptureMap};\n \n /// The \"outermost\" place that holds this value.\ndiff --git a/compiler/rustc_mir_build/src/builder/expr/as_rvalue.rs b/compiler/rustc_mir_build/src/builder/expr/as_rvalue.rs\nindex 3d1774bd1d6..8de79ab2531 100644\n--- a/compiler/rustc_mir_build/src/builder/expr/as_rvalue.rs\n+++ b/compiler/rustc_mir_build/src/builder/expr/as_rvalue.rs\n@@ -18,6 +18,7 @@\n \n use crate::builder::expr::as_place::PlaceBase;\n use crate::builder::expr::category::{Category, RvalueFunc};\n+use crate::builder::scope::LintLevel;\n use crate::builder::{BlockAnd, BlockAndExtension, Builder, NeedsTemporary};\n \n impl<'a, 'tcx> Builder<'a, 'tcx> {\ndiff --git a/compiler/rustc_mir_build/src/builder/expr/as_temp.rs b/compiler/rustc_mir_build/src/builder/expr/as_temp.rs\nindex 2aace64062c..55296c647c8 100644\n--- a/compiler/rustc_mir_build/src/builder/expr/as_temp.rs\n+++ b/compiler/rustc_mir_build/src/builder/expr/as_temp.rs\n@@ -7,7 +7,7 @@\n use rustc_middle::thir::*;\n use tracing::{debug, instrument};\n \n-use crate::builder::scope::DropKind;\n+use crate::builder::scope::{DropKind, LintLevel};\n use crate::builder::{BlockAnd, BlockAndExtension, Builder};\n \n impl<'a, 'tcx> Builder<'a, 'tcx> {\ndiff --git a/compiler/rustc_mir_build/src/builder/expr/into.rs b/compiler/rustc_mir_build/src/builder/expr/into.rs\nindex 9731f0de135..60e05b691a8 100644\n--- a/compiler/rustc_mir_build/src/builder/expr/into.rs\n+++ b/compiler/rustc_mir_build/src/builder/expr/into.rs\n@@ -16,6 +16,7 @@\n \n use crate::builder::expr::category::{Category, RvalueFunc};\n use crate::builder::matches::{DeclareLetBindings, HasMatchGuard};\n+use crate::builder::scope::LintLevel;\n use crate::builder::{BlockAnd, BlockAndExtension, BlockFrame, Builder, NeedsTemporary};\n use crate::errors::{LoopMatchArmWithGuard, LoopMatchUnsupportedType};\n \ndiff --git a/compiler/rustc_mir_build/src/builder/expr/stmt.rs b/compiler/rustc_mir_build/src/builder/expr/stmt.rs\nindex f28e483b6a5..3d603afbaa4 100644\n--- a/compiler/rustc_mir_build/src/builder/expr/stmt.rs\n+++ b/compiler/rustc_mir_build/src/builder/expr/stmt.rs\n@@ -5,7 +5,7 @@\n use rustc_span::source_map::Spanned;\n use tracing::debug;\n \n-use crate::builder::scope::BreakableTarget;\n+use crate::builder::scope::{BreakableTarget, LintLevel};\n use crate::builder::{BlockAnd, BlockAndExtension, BlockFrame, Builder};\n \n impl<'a, 'tcx> Builder<'a, 'tcx> {\ndiff --git a/compiler/rustc_mir_build/src/builder/matches/mod.rs b/compiler/rustc_mir_build/src/builder/matches/mod.rs\nindex 49caee4a189..565d97fa68b 100644\n--- a/compiler/rustc_mir_build/src/builder/matches/mod.rs\n+++ b/compiler/rustc_mir_build/src/builder/matches/mod.rs\n@@ -29,7 +29,7 @@\n use crate::builder::expr::as_place::PlaceBuilder;\n use crate::builder::matches::buckets::PartitionedCandidates;\n use crate::builder::matches::user_ty::ProjectedUserTypesNode;\n-use crate::builder::scope::DropKind;\n+use crate::builder::scope::{DropKind, LintLevel};\n use crate::builder::{\n     BlockAnd, BlockAndExtension, Builder, GuardFrame, GuardFrameLocal, LocalsForNode,\n };\ndiff --git a/compiler/rustc_mir_build/src/builder/mod.rs b/compiler/rustc_mir_build/src/builder/mod.rs\nindex 40f1fe0d5d1..132062961da 100644\n--- a/compiler/rustc_mir_build/src/builder/mod.rs\n+++ b/compiler/rustc_mir_build/src/builder/mod.rs\n@@ -38,14 +38,14 @@\n use rustc_middle::hir::place::PlaceBase as HirPlaceBase;\n use rustc_middle::middle::region;\n use rustc_middle::mir::*;\n-use rustc_middle::thir::{self, ExprId, LintLevel, LocalVarId, Param, ParamId, PatKind, Thir};\n+use rustc_middle::thir::{self, ExprId, LocalVarId, Param, ParamId, PatKind, Thir};\n use rustc_middle::ty::{self, ScalarInt, Ty, TyCtxt, TypeVisitableExt, TypingMode};\n use rustc_middle::{bug, span_bug};\n use rustc_session::lint;\n use rustc_span::{Span, Symbol, sym};\n \n use crate::builder::expr::as_place::PlaceBuilder;\n-use crate::builder::scope::DropKind;\n+use crate::builder::scope::{DropKind, LintLevel};\n use crate::errors;\n \n pub(crate) fn closure_saved_names_of_captured_variables<'tcx>(\ndiff --git a/compiler/rustc_mir_build/src/builder/scope.rs b/compiler/rustc_mir_build/src/builder/scope.rs\nindex 98170405253..b10df60e0f7 100644\n--- a/compiler/rustc_mir_build/src/builder/scope.rs\n+++ b/compiler/rustc_mir_build/src/builder/scope.rs\n@@ -89,7 +89,7 @@\n use rustc_index::{IndexSlice, IndexVec};\n use rustc_middle::middle::region;\n use rustc_middle::mir::{self, *};\n-use rustc_middle::thir::{AdtExpr, AdtExprBase, ArmId, ExprId, ExprKind, LintLevel};\n+use rustc_middle::thir::{AdtExpr, AdtExprBase, ArmId, ExprId, ExprKind};\n use rustc_middle::ty::{self, Ty, TyCtxt, TypeVisitableExt, ValTree};\n use rustc_middle::{bug, span_bug};\n use rustc_pattern_analysis::rustc::RustcPatCtxt;\n@@ -522,6 +522,14 @@ fn topmost(&self) -> region::Scope {\n     }\n }\n \n+/// Used by [`Builder::in_scope`] to create source scopes mapping from MIR back to HIR at points\n+/// where lint levels change.\n+#[derive(Copy, Clone, Debug)]\n+pub(crate) enum LintLevel {\n+    Inherited,\n+    Explicit(HirId),\n+}\n+\n impl<'a, 'tcx> Builder<'a, 'tcx> {\n     // Adding and removing scopes\n     // =========================="}, {"role": "assistant", "content": "refactor(mir_build): move LintLevel from thir to builder scope"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex c4b88a4..584137f 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -9,6 +9,7 @@ hide:\n \n ### Translations\n \n+* \ud83d\udd27 Add LLM prompt file for Traditional Chinese, generated from the existing translations. PR [#14550](https://github.com/fastapi/fastapi/pull/14550) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd27 Add LLM prompt file for Simplified Chinese, generated from the existing translations. PR [#14549](https://github.com/fastapi/fastapi/pull/14549) by [@tiangolo](https://github.com/tiangolo).\n \n ### Internal"}, {"role": "assistant", "content": "docs: add traditional chinese llm prompt to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/react-server/src/ReactFlightReplyServer.js | 4 +++-\n 1 file changed, 3 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/react-server/src/ReactFlightReplyServer.js b/packages/react-server/src/ReactFlightReplyServer.js\nindex 1831a35..4d5a6da 100644\n--- a/packages/react-server/src/ReactFlightReplyServer.js\n+++ b/packages/react-server/src/ReactFlightReplyServer.js\n@@ -132,8 +132,10 @@ ReactPromise.prototype.then = function <T>(\n         let inspectedValue = chunk.value;\n         // Recursively check if the value is itself a ReactPromise and if so if it points\n         // back to itself. This helps catch recursive thenables early error.\n+        let cycleProtection = 0;\n         while (inspectedValue instanceof ReactPromise) {\n-          if (inspectedValue === chunk) {\n+          cycleProtection++;\n+          if (inspectedValue === chunk || cycleProtection > 1000) {\n             if (typeof reject === 'function') {\n               reject(new Error('Cannot have cyclic thenables.'));\n             }"}, {"role": "assistant", "content": "fix(react-server): add cycle protection limit for thenable detection"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/dist/imports.go | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/cmd/dist/imports.go b/src/cmd/dist/imports.go\nindex 0ec2b06c..c00369a6 100644\n--- a/src/cmd/dist/imports.go\n+++ b/src/cmd/dist/imports.go\n@@ -259,6 +259,6 @@ func resolveVendor(imp, srcDir string) string {\n \t} else if strings.HasPrefix(srcDir, filepath.Join(goroot, \"src\")) {\n \t\treturn path.Join(\"vendor\", imp)\n \t} else {\n-\t\tpanic(fmt.Sprintf(\"srcDir %q not in GOOROT/src\", srcDir))\n+\t\tpanic(fmt.Sprintf(\"srcDir %q not in GOROOT/src\", srcDir))\n \t}\n }"}, {"role": "assistant", "content": "fix: correct typo in panic message"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n packages/common/http/src/xsrf.ts | 1 -\n 1 file changed, 1 deletion(-)\n\ndiff --git a/packages/common/http/src/xsrf.ts b/packages/common/http/src/xsrf.ts\nindex f6e485e4..c893474d 100644\n--- a/packages/common/http/src/xsrf.ts\n+++ b/packages/common/http/src/xsrf.ts\n@@ -41,7 +41,6 @@ export const XSRF_DEFAULT_HEADER_NAME = 'X-XSRF-TOKEN';\n export const XSRF_HEADER_NAME = new InjectionToken<string>(\n   typeof ngDevMode !== 'undefined' && ngDevMode ? 'XSRF_HEADER_NAME' : '',\n   {\n-    providedIn: 'root',\n     factory: () => XSRF_DEFAULT_HEADER_NAME,\n   },\n );"}, {"role": "assistant", "content": "refactor(http): remove redundant providedIn: 'root' in XSRF_HEADER_NAME"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n vscode-ng-language-service/tools/release.mts | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/vscode-ng-language-service/tools/release.mts b/vscode-ng-language-service/tools/release.mts\nindex d01e5482..37049db9 100644\n--- a/vscode-ng-language-service/tools/release.mts\n+++ b/vscode-ng-language-service/tools/release.mts\n@@ -481,6 +481,7 @@ async function publishExtension(): Promise<void> {\n async function cherryPickChangelog(changelog: string, newVersion: string): Promise<void> {\n   console.log(chalk.blue('Cherry-picking changelog to main...'));\n \n+  await exec(`git stash`);\n   await exec(`git fetch ${angularRepoRemote} main`);\n   const cherryPickBranch = `vscode-changelog-cherry-pick${newVersion}`;\n   await exec(`git branch -D ${cherryPickBranch}`).catch(() => {});"}, {"role": "assistant", "content": "build: update cherrypick changelog to stash"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n library/std/src/sys/thread/unix.rs | 9 +++++++++\n 1 file changed, 9 insertions(+)\n\ndiff --git a/library/std/src/sys/thread/unix.rs b/library/std/src/sys/thread/unix.rs\nindex d0396ed7130..f0cfdb95639 100644\n--- a/library/std/src/sys/thread/unix.rs\n+++ b/library/std/src/sys/thread/unix.rs\n@@ -45,6 +45,15 @@ impl Thread {\n     // unsafe: see thread::Builder::spawn_unchecked for safety requirements\n     #[cfg_attr(miri, track_caller)] // even without panics, this helps for Miri backtraces\n     pub unsafe fn new(stack: usize, init: Box<ThreadInit>) -> io::Result<Thread> {\n+        // FIXME: remove this block once wasi-sdk is updated with the fix from\n+        // https://github.com/WebAssembly/wasi-libc/pull/716\n+        // WASI does not support threading via pthreads. While wasi-libc provides\n+        // pthread stubs, pthread_create returns EAGAIN, which causes confusing\n+        // errors. We return UNSUPPORTED_PLATFORM directly instead.\n+        if cfg!(target_os = \"wasi\") {\n+            return Err(io::Error::UNSUPPORTED_PLATFORM);\n+        }\n+\n         let data = init;\n         let mut attr: mem::MaybeUninit<libc::pthread_attr_t> = mem::MaybeUninit::uninit();\n         assert_eq!(libc::pthread_attr_init(attr.as_mut_ptr()), 0);"}, {"role": "assistant", "content": "fix(thread): return unsupported error for wasi threading"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/compile/internal/ssagen/ssa.go               | 2 +-\n src/simd/archsimd/_gen/simdgen/gen_simdMachineOps.go | 2 +-\n src/simd/archsimd/_gen/simdgen/gen_simdssa.go        | 2 +-\n 3 files changed, 3 insertions(+), 3 deletions(-)\n\ndiff --git a/src/cmd/compile/internal/ssagen/ssa.go b/src/cmd/compile/internal/ssagen/ssa.go\nindex 33fcf979..dd5baa0e 100644\n--- a/src/cmd/compile/internal/ssagen/ssa.go\n+++ b/src/cmd/compile/internal/ssagen/ssa.go\n@@ -7795,7 +7795,7 @@ func AddrAuto(a *obj.Addr, v *ssa.Value) {\n // Call returns a new CALL instruction for the SSA value v.\n // It uses PrepareCall to prepare the call.\n func (s *State) Call(v *ssa.Value) *obj.Prog {\n-\tpPosIsStmt := s.pp.Pos.IsStmt() // The statement-ness fo the call comes from ssaGenState\n+\tpPosIsStmt := s.pp.Pos.IsStmt() // The statement-ness of the call comes from ssaGenState\n \ts.PrepareCall(v)\n \n \tp := s.Prog(obj.ACALL)\ndiff --git a/src/simd/archsimd/_gen/simdgen/gen_simdMachineOps.go b/src/simd/archsimd/_gen/simdgen/gen_simdMachineOps.go\nindex 3d99dd2a..94b122ac 100644\n--- a/src/simd/archsimd/_gen/simdgen/gen_simdMachineOps.go\n+++ b/src/simd/archsimd/_gen/simdgen/gen_simdMachineOps.go\n@@ -181,7 +181,7 @@ func writeSIMDMachineOps(ops []Operation) *bytes.Buffer {\n \t\t}\n \t\thasMerging = gOp.hasMaskedMerging(maskType, shapeOut)\n \t\tif hasMerging && !resultInArg0 {\n-\t\t\t// We have to copy the slice here becasue the sort will be visible from other\n+\t\t\t// We have to copy the slice here because the sort will be visible from other\n \t\t\t// aliases when no reslicing is happening.\n \t\t\tnewIn := make([]Operand, len(op.In), len(op.In)+1)\n \t\t\tcopy(newIn, op.In)\ndiff --git a/src/simd/archsimd/_gen/simdgen/gen_simdssa.go b/src/simd/archsimd/_gen/simdgen/gen_simdssa.go\nindex 876ffabe..96d09668 100644\n--- a/src/simd/archsimd/_gen/simdgen/gen_simdssa.go\n+++ b/src/simd/archsimd/_gen/simdgen/gen_simdssa.go\n@@ -133,7 +133,7 @@ func writeSIMDSSA(ops []Operation) *bytes.Buffer {\n \t\tif mem == NoMem && op.hasMaskedMerging(maskType, shapeOut) {\n \t\t\tregShapeMerging := regShape\n \t\t\tif shapeOut != OneVregOutAtIn {\n-\t\t\t\t// We have to copy the slice here becasue the sort will be visible from other\n+\t\t\t\t// We have to copy the slice here because the sort will be visible from other\n \t\t\t\t// aliases when no reslicing is happening.\n \t\t\t\tnewIn := make([]Operand, len(op.In), len(op.In)+1)\n \t\t\t\tcopy(newIn, op.In)"}, {"role": "assistant", "content": "docs: fix typos in code comments"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 2eb6746..34ed433 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -15,6 +15,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udc65 Update FastAPI People - Contributors and Translators. PR [#14625](https://github.com/fastapi/fastapi/pull/14625) by [@tiangolo](https://github.com/tiangolo).\n * \ud83c\udf10 Update translation prompts. PR [#14619](https://github.com/fastapi/fastapi/pull/14619) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd28 Update LLM translation script to guide reviewers to change the prompt. PR [#14614](https://github.com/fastapi/fastapi/pull/14614) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc77 Do not run translations on cron while finishing updating existing languages. PR [#14613](https://github.com/fastapi/fastapi/pull/14613) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/app/core/layout/footer/footer.component.html | 3 +++\n 1 file changed, 3 insertions(+)\n\ndiff --git a/adev/src/app/core/layout/footer/footer.component.html b/adev/src/app/core/layout/footer/footer.component.html\nindex d49100e9..7b2627bd 100644\n--- a/adev/src/app/core/layout/footer/footer.component.html\n+++ b/adev/src/app/core/layout/footer/footer.component.html\n@@ -107,6 +107,9 @@\n         <li>\n           <a href=\"https://angular.kr/\" title=\"\ud55c\uad6d\uc5b4\">\ud55c\uad6d\uc5b4</a>\n         </li>\n+        <li>\n+          <a href=\"https://angular-docs.ru/\" title=\"\u0420\u0443\u0441\u0441\u043a\u0438\u0439\">\u0420\u0443\u0441\u0441\u043a\u0438\u0439</a>\n+        </li>\n       </ul>\n     </div>\n   </div>"}, {"role": "assistant", "content": "docs(docs-infra): Add community russian translation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex a25c94b..5bd1b03 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -13,6 +13,7 @@ hide:\n \n ### Translations\n \n+* \ud83c\udf10 Update translations for uk (update-outdated). PR [#14587](https://github.com/fastapi/fastapi/pull/14587) by [@tiangolo](https://github.com/tiangolo).\n * \ud83c\udf10 Update translations for es (update-outdated). PR [#14686](https://github.com/fastapi/fastapi/pull/14686) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd27 Add LLM prompt file for Turkish, generated from the existing translations. PR [#14547](https://github.com/fastapi/fastapi/pull/14547) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd27 Add LLM prompt file for Traditional Chinese, generated from the existing translations. PR [#14550](https://github.com/fastapi/fastapi/pull/14550) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: update release notes with uk translation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../components/search-dialog/search-dialog.component.ts            | 3 +--\n .../references/api-reference-list/api-reference-list.component.ts  | 7 ++-----\n 2 files changed, 3 insertions(+), 7 deletions(-)\n\ndiff --git a/adev/shared-docs/components/search-dialog/search-dialog.component.ts b/adev/shared-docs/components/search-dialog/search-dialog.component.ts\nindex 4eb83ac6..688d3fa7 100644\n--- a/adev/shared-docs/components/search-dialog/search-dialog.component.ts\n+++ b/adev/shared-docs/components/search-dialog/search-dialog.component.ts\n@@ -54,7 +54,6 @@ export class SearchDialog {\n   readonly onClose = output();\n   readonly dialog = viewChild.required<ElementRef<HTMLDialogElement>>('searchDialog');\n   readonly items = viewChildren(SearchItem);\n-  readonly textField = viewChild(TextField);\n \n   readonly history = inject(SearchHistory);\n   private readonly search = inject(Search);\n@@ -98,7 +97,7 @@ export class SearchDialog {\n         }\n         // We want to select the pre-existing text on opening\n         // In order to change the search input with minimal user interaction.\n-        this.textField()?.input().nativeElement.select();\n+        this.searchForm().focusBoundControl();\n       },\n     });\n \ndiff --git a/adev/src/app/features/references/api-reference-list/api-reference-list.component.ts b/adev/src/app/features/references/api-reference-list/api-reference-list.component.ts\nindex e4099e3e..770395ad 100644\n--- a/adev/src/app/features/references/api-reference-list/api-reference-list.component.ts\n+++ b/adev/src/app/features/references/api-reference-list/api-reference-list.component.ts\n@@ -18,7 +18,6 @@ import {\n   inject,\n   input,\n   linkedSignal,\n-  viewChild,\n } from '@angular/core';\n import {Select, SelectOption, TextField} from '@angular/docs';\n import {FormField, form} from '@angular/forms/signals';\n@@ -62,7 +61,6 @@ export default class ApiReferenceList {\n   // services\n   private readonly apiReferenceManager = inject(ApiReferenceManager);\n   private readonly router = inject(Router);\n-  private readonly filterInput = viewChild.required(TextField);\n   private readonly injector = inject(EnvironmentInjector);\n \n   // inputs\n@@ -137,13 +135,12 @@ export default class ApiReferenceList {\n \n   constructor() {\n     effect(() => {\n-      const filterInput = this.filterInput();\n+      const filterInput = this.form.query();\n       afterNextRender(\n         {\n           write: () => {\n-            // Why not improve this once https://github.com/orgs/angular/projects/60?pane=issue&itemId=143488813 is done\n             if (matchMedia('(hover: hover) and (pointer:fine)').matches) {\n-              scheduleOnIdle(() => filterInput.focus());\n+              scheduleOnIdle(() => filterInput.focusBoundControl());\n             }\n           },\n         },"}, {"role": "assistant", "content": "docs(docs-infra): use Signals Forms focusBoundControl"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .mailmap | 1 +\n 1 file changed, 1 insertion(+)"}, {"role": "assistant", "content": "chore: add mailmap entry"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../react-devtools-shared/src/__tests__/storeComponentFilters-test.js   | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js\nindex 45b89ec..16b013c 100644\n--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js\n@@ -753,7 +753,7 @@ describe('Store component filters', () => {\n     });\n   });\n \n-  // @reactVersion >= 16.6\n+  // @reactVersion >= 18.0\n   it('resets forced error and fallback states when filters are changed', async () => {\n     store.componentFilters = [];\n     class ErrorBoundary extends React.Component {"}, {"role": "assistant", "content": "test: update react version constraint for filter test"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/src/content/guide/di/hierarchical-dependency-injection.md | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/adev/src/content/guide/di/hierarchical-dependency-injection.md b/adev/src/content/guide/di/hierarchical-dependency-injection.md\nindex 13a09681..72df6158 100644\n--- a/adev/src/content/guide/di/hierarchical-dependency-injection.md\n+++ b/adev/src/content/guide/di/hierarchical-dependency-injection.md\n@@ -959,8 +959,8 @@ export class VillainsList {}\n \n By providing `VillainsService` in the `VillainsList` metadata and nowhere else, the service becomes available only in the `VillainsList` and its subcomponent tree.\n \n-`VillainService` is a singleton with respect to `VillainsList` because that is where it is declared.\n-As long as `VillainsList` does not get destroyed it will be the same instance of `VillainService` but if there are multiple instances of `VillainsList`, then each instance of `VillainsList` will have its own instance of `VillainService`.\n+`VillainsService` is a singleton with respect to `VillainsList` because that is where it is declared.\n+As long as `VillainsList` does not get destroyed it will be the same instance of `VillainsService` but if there are multiple instances of `VillainsList`, then each instance of `VillainsList` will have its own instance of `VillainsService`.\n \n ### Scenario: multiple edit sessions\n "}, {"role": "assistant", "content": "docs: update hierarchical-dependency-injection.md"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n package.json                       |   4 +-\n packages/compiler-sfc/package.json |   2 +-\n packages/runtime-dom/package.json  |   2 +-\n pnpm-lock.yaml                     | 118 +++++++++++++++----------------------\n 4 files changed, 50 insertions(+), 76 deletions(-)\n\ndiff --git a/package.json b/package.json\nindex bf0be54..6800cb1 100644\n--- a/package.json\n+++ b/package.json\n@@ -1,7 +1,7 @@\n {\n   \"private\": true,\n   \"version\": \"3.5.25\",\n-  \"packageManager\": \"pnpm@10.20.0\",\n+  \"packageManager\": \"pnpm@10.25.0\",\n   \"type\": \"module\",\n   \"scripts\": {\n     \"dev\": \"node scripts/dev.js\",\n@@ -96,7 +96,7 @@\n     \"pretty-bytes\": \"^7.1.0\",\n     \"pug\": \"^3.0.3\",\n     \"puppeteer\": \"~24.28.0\",\n-    \"rimraf\": \"^6.1.0\",\n+    \"rimraf\": \"^6.1.2\",\n     \"rollup\": \"^4.53.3\",\n     \"rollup-plugin-dts\": \"^6.3.0\",\n     \"rollup-plugin-esbuild\": \"^6.2.1\",\ndiff --git a/packages/compiler-sfc/package.json b/packages/compiler-sfc/package.json\nindex 2661f7b..bdb605d 100644\n--- a/packages/compiler-sfc/package.json\n+++ b/packages/compiler-sfc/package.json\n@@ -62,6 +62,6 @@\n     \"postcss-modules\": \"^6.0.1\",\n     \"postcss-selector-parser\": \"^7.1.0\",\n     \"pug\": \"^3.0.3\",\n-    \"sass\": \"^1.93.3\"\n+    \"sass\": \"^1.96.0\"\n   }\n }\ndiff --git a/packages/runtime-dom/package.json b/packages/runtime-dom/package.json\nindex 663ba52..d712948 100644\n--- a/packages/runtime-dom/package.json\n+++ b/packages/runtime-dom/package.json\n@@ -52,7 +52,7 @@\n     \"@vue/shared\": \"workspace:*\",\n     \"@vue/runtime-core\": \"workspace:*\",\n     \"@vue/reactivity\": \"workspace:*\",\n-    \"csstype\": \"^3.1.3\"\n+    \"csstype\": \"^3.2.3\"\n   },\n   \"devDependencies\": {\n     \"@types/trusted-types\": \"^2.0.7\"\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 0e64ff5..1cd7b36 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -70,10 +70,10 @@ importers:\n         version: 6.1.4\n       '@vitest/coverage-v8':\n         specifier: ^3.2.4\n-        version: 3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))\n+        version: 3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0))\n       '@vitest/eslint-plugin':\n         specifier: ^1.4.0\n-        version: 1.4.0(eslint@9.27.0)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))\n+        version: 1.4.0(eslint@9.27.0)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0))\n       '@vue/consolidate':\n         specifier: 1.0.0\n         version: 1.0.0\n@@ -135,8 +135,8 @@ importers:\n         specifier: ~24.28.0\n         version: 24.28.0(typescript@5.6.3)\n       rimraf:\n-        specifier: ^6.1.0\n-        version: 6.1.0\n+        specifier: ^6.1.2\n+        version: 6.1.2\n       rollup:\n         specifier: ^4.53.3\n         version: 4.53.3\n@@ -175,10 +175,10 @@ importers:\n         version: 8.32.1(eslint@9.27.0)(typescript@5.6.3)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@24.10.4)(sass@1.93.3)\n+        version: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n       vitest:\n         specifier: ^3.2.4\n-        version: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n+        version: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0)\n \n   packages-private/dts-built-test:\n     dependencies:\n@@ -218,10 +218,10 @@ importers:\n     devDependencies:\n       '@vitejs/plugin-vue':\n         specifier: 'catalog:'\n-        version: 6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.93.3))(vue@packages+vue)\n+        version: 6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@24.10.4)(sass@1.93.3)\n+        version: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n \n   packages-private/template-explorer:\n     dependencies:\n@@ -236,10 +236,10 @@ importers:\n     devDependencies:\n       '@vitejs/plugin-vue':\n         specifier: 'catalog:'\n-        version: 6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.93.3))(vue@packages+vue)\n+        version: 6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)\n       vite:\n         specifier: 'catalog:'\n-        version: 5.4.15(@types/node@24.10.4)(sass@1.93.3)\n+        version: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n       vue:\n         specifier: workspace:*\n         version: link:../../packages/vue\n@@ -333,8 +333,8 @@ importers:\n         specifier: ^3.0.3\n         version: 3.0.3\n       sass:\n-        specifier: ^1.93.3\n-        version: 1.93.3\n+        specifier: ^1.96.0\n+        version: 1.96.0\n \n   packages/compiler-ssr:\n     dependencies:\n@@ -372,8 +372,8 @@ importers:\n         specifier: workspace:*\n         version: link:../shared\n       csstype:\n-        specifier: ^3.1.3\n-        version: 3.1.3\n+        specifier: ^3.2.3\n+        version: 3.2.3\n     devDependencies:\n       '@types/trusted-types':\n         specifier: ^2.0.7\n@@ -1924,8 +1924,8 @@ packages:\n     resolution: {integrity: sha512-zDMqXh8Vs1CdRYZQ2M633m/SFgcjlu8RB8b/1h82i+6vpArF507NSYIWJHGlJaTWoS+imcnctmEz43txhbVkOw==}\n     engines: {node: '>=20'}\n \n-  csstype@3.1.3:\n-    resolution: {integrity: sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==}\n+  csstype@3.2.3:\n+    resolution: {integrity: sha512-z1HGKcYy2xA8AGQfwrn0PAy+PB7X/GSj3UVJW9qKyn43xWa+gl5nXmU4qqLMRzWVLFC8KusUX8T/0kCiOYpAIQ==}\n \n   data-uri-to-buffer@6.0.2:\n     resolution: {integrity: sha512-7hvf7/GW8e86rW0ptuwS3OcBGDjIi6SZva7hCyWC0yYry2cOPmLIjXAUHI6DK2HsnwJd9ifmt57i8eV2n4YNpw==}\n@@ -2253,10 +2253,6 @@ packages:\n     resolution: {integrity: sha512-Ld2g8rrAyMYFXBhEqMz8ZAHBi4J4uS1i/CxGMDnjyFWddMXLVcDp051DZfu+t7+ab7Wv6SMqpWmyFIj5UbfFvg==}\n     engines: {node: '>=14'}\n \n-  foreground-child@3.3.1:\n-    resolution: {integrity: sha512-gIXjKqtFuWEgzFRJA9WCQeSJLZDjgJUOMCMzxtvFq/37KojM1BFGufqsCy0r4qSQmYLsZYMeyRqzIWOMup03sw==}\n-    engines: {node: '>=14'}\n-\n   fs-extra@11.2.0:\n     resolution: {integrity: sha512-PmDi3uwK5nFuXh7XDTlVnS17xJS7vW36is2+w3xcv8SVxiB4NyATf4ctkVY5bkSjX0Y4nbvZCq1/EjtEyr9ktw==}\n     engines: {node: '>=14.14'}\n@@ -2324,10 +2320,9 @@ packages:\n     resolution: {integrity: sha512-7Bv8RF0k6xjo7d4A/PxYLbUCfb6c+Vpd2/mB2yRDlew7Jb5hEXiCD9ibfO7wpk8i4sevK6DFny9h7EYbM3/sHg==}\n     hasBin: true\n \n-  glob@11.0.3:\n-    resolution: {integrity: sha512-2Nim7dha1KVkaiF4q6Dj+ngPPMdfvLJEOpZk/jKiUAkqKebpGAWQXAq9z1xu9HKu5lWfqw/FASuccEjyznjPaA==}\n+  glob@13.0.0:\n+    resolution: {integrity: sha512-tvZgpqk6fz4BaNZ66ZsRaZnbHvP/jG3uKJvAZOwEVUL4RTA5nJeeLYfyN9/VA8NX/V3IBG+hkeuGpKjvELkVhA==}\n     engines: {node: 20 || >=22}\n-    hasBin: true\n \n   globals@14.0.0:\n     resolution: {integrity: sha512-oahGvuMGQlPw/ivIYBjVSrWAfWLBeku5tpPE2fOPLi+WHffIWbuh2tCjhyQhTBPMf5E9jDEH4FOmTYgYwbKwtQ==}\n@@ -2545,10 +2540,6 @@ packages:\n   jackspeak@3.4.3:\n     resolution: {integrity: sha512-OGlZQpz2yfahA/Rd1Y8Cd9SIEsqvXkLVoSw/cgwhnhFMDbsQFeZYoJJ7bIZBS9BcamUW96asq/npPWugM+RQBw==}\n \n-  jackspeak@4.1.1:\n-    resolution: {integrity: sha512-zptv57P3GpL+O0I7VdMJNBZCu+BPHVQUk55Ft8/QCJjTVxrnJHuVuX/0Bl2A6/+2oyR/ZMEuFKwmzqqZ/U5nPQ==}\n-    engines: {node: 20 || >=22}\n-\n   js-stringify@1.0.2:\n     resolution: {integrity: sha512-rtS5ATOo2Q5k1G+DADISilDA6lv79zIiwFd6CcjuIxGKLFm5C+RLImRscVap9k55i+MOZwgliw+NejvkLuGD5g==}\n \n@@ -2859,9 +2850,6 @@ packages:\n     resolution: {integrity: sha512-5NPgf87AT2STgwa2ntRMr45jTKrYBGkVU36yT0ig/n/GMAa3oPqhZfIQ2kMEimReg0+t9kZViDVZ83qfVUlckg==}\n     engines: {node: '>= 14'}\n \n-  package-json-from-dist@1.0.0:\n-    resolution: {integrity: sha512-dATvCeZN/8wQsGywez1mzHtTlP22H8OEfPrVMLNr4/eGa+ijtLn/6M5f0dY8UKNrC2O9UCU6SSoG3qRKnt7STw==}\n-\n   package-json-from-dist@1.0.1:\n     resolution: {integrity: sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw==}\n \n@@ -3130,8 +3118,8 @@ packages:\n   rfdc@1.4.1:\n     resolution: {integrity: sha512-q1b3N5QkRUWUl7iyylaaj3kOpIT0N2i9MqIEQXP73GVsN9cw3fdx8X63cEmWhJGi2PPCF23Ijp7ktmd39rawIA==}\n \n-  rimraf@6.1.0:\n-    resolution: {integrity: sha512-DxdlA1bdNzkZK7JiNWH+BAx1x4tEJWoTofIopFo6qWUU94jYrFZ0ubY05TqH3nWPJ1nKa1JWVFDINZ3fnrle/A==}\n+  rimraf@6.1.2:\n+    resolution: {integrity: sha512-cFCkPslJv7BAXJsYlK1dZsbP8/ZNLkCAQ0bi1hf5EKX2QHegmDFEFA6QhuYJlk7UDdc+02JjO80YSOrWPpw06g==}\n     engines: {node: 20 || >=22}\n     hasBin: true\n \n@@ -3171,8 +3159,8 @@ packages:\n   safer-buffer@2.1.2:\n     resolution: {integrity: sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==}\n \n-  sass@1.93.3:\n-    resolution: {integrity: sha512-elOcIZRTM76dvxNAjqYrucTSI0teAF/L2Lv0s6f6b7FOwcwIuA357bIE871580AjHJuSvLIRUosgV+lIWx6Rgg==}\n+  sass@1.96.0:\n+    resolution: {integrity: sha512-8u4xqqUeugGNCYwr9ARNtQKTOj4KmYiJAVKXf2CTIivTCR51j96htbMKWDru8H5SaQWpyVgTfOF8Ylyf5pun1Q==}\n     engines: {node: '>=14.0.0'}\n     hasBin: true\n \n@@ -4531,13 +4519,13 @@ snapshots:\n   '@unrs/resolver-binding-win32-x64-msvc@1.7.2':\n     optional: true\n \n-  '@vitejs/plugin-vue@6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.93.3))(vue@packages+vue)':\n+  '@vitejs/plugin-vue@6.0.3(vite@5.4.15(@types/node@24.10.4)(sass@1.96.0))(vue@packages+vue)':\n     dependencies:\n       '@rolldown/pluginutils': 1.0.0-beta.53\n-      vite: 5.4.15(@types/node@24.10.4)(sass@1.93.3)\n+      vite: 5.4.15(@types/node@24.10.4)(sass@1.96.0)\n       vue: link:packages/vue\n \n-  '@vitest/coverage-v8@3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))':\n+  '@vitest/coverage-v8@3.2.4(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0))':\n     dependencies:\n       '@ampproject/remapping': 2.3.0\n       '@bcoe/v8-coverage': 1.0.2\n@@ -4552,18 +4540,18 @@ snapshots:\n       std-env: 3.9.0\n       test-exclude: 7.0.1\n       tinyrainbow: 2.0.0\n-      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n+      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0)\n     transitivePeerDependencies:\n       - supports-color\n \n-  '@vitest/eslint-plugin@1.4.0(eslint@9.27.0)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3))':\n+  '@vitest/eslint-plugin@1.4.0(eslint@9.27.0)(typescript@5.6.3)(vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0))':\n     dependencies:\n       '@typescript-eslint/scope-manager': 8.46.3\n       '@typescript-eslint/utils': 8.46.3(eslint@9.27.0)(typescript@5.6.3)\n       eslint: 9.27.0\n     optionalDependencies:\n       typescript: 5.6.3\n-      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3)\n+      vitest: 3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0)\n     transitivePeerDependencies:\n       - supports-color\n \n@@ -4575,13 +4563,13 @@ snapshots:\n       chai: 5.2.0\n       tinyrainbow: 2.0.0\n \n-  '@vitest/mocker@3.2.4(vite@5.4.19(@types/node@24.10.4)(sass@1.93.3))':\n+  '@vitest/mocker@3.2.4(vite@5.4.19(@types/node@24.10.4)(sass@1.96.0))':\n     dependencies:\n       '@vitest/spy': 3.2.4\n       estree-walker: 3.0.3\n       magic-string: 0.30.21\n     optionalDependencies:\n-      vite: 5.4.19(@types/node@24.10.4)(sass@1.93.3)\n+      vite: 5.4.19(@types/node@24.10.4)(sass@1.96.0)\n \n   '@vitest/pretty-format@3.2.4':\n     dependencies:\n@@ -4982,7 +4970,7 @@ snapshots:\n     transitivePeerDependencies:\n       - postcss\n \n-  csstype@3.1.3: {}\n+  csstype@3.2.3: {}\n \n   data-uri-to-buffer@6.0.2: {}\n \n@@ -5351,11 +5339,6 @@ snapshots:\n       cross-spawn: 7.0.6\n       signal-exit: 4.1.0\n \n-  foreground-child@3.3.1:\n-    dependencies:\n-      cross-spawn: 7.0.6\n-      signal-exit: 4.1.0\n-\n   fs-extra@11.2.0:\n     dependencies:\n       graceful-fs: 4.2.11\n@@ -5436,16 +5419,13 @@ snapshots:\n       jackspeak: 3.4.3\n       minimatch: 9.0.5\n       minipass: 7.1.2\n-      package-json-from-dist: 1.0.0\n+      package-json-from-dist: 1.0.1\n       path-scurry: 1.11.1\n \n-  glob@11.0.3:\n+  glob@13.0.0:\n     dependencies:\n-      foreground-child: 3.3.1\n-      jackspeak: 4.1.1\n       minimatch: 10.1.1\n       minipass: 7.1.2\n-      package-json-from-dist: 1.0.1\n       path-scurry: 2.0.0\n \n   globals@14.0.0: {}\n@@ -5636,10 +5616,6 @@ snapshots:\n     optionalDependencies:\n       '@pkgjs/parseargs': 0.11.0\n \n-  jackspeak@4.1.1:\n-    dependencies:\n-      '@isaacs/cliui': 8.0.2\n-\n   js-stringify@1.0.2: {}\n \n   js-tokens@4.0.0: {}\n@@ -5956,8 +5932,6 @@ snapshots:\n       degenerator: 5.0.1\n       netmask: 2.0.2\n \n-  package-json-from-dist@1.0.0: {}\n-\n   package-json-from-dist@1.0.1: {}\n \n   pako@1.0.11: {}\n@@ -6275,9 +6249,9 @@ snapshots:\n \n   rfdc@1.4.1: {}\n \n-  rimraf@6.1.0:\n+  rimraf@6.1.2:\n     dependencies:\n-      glob: 11.0.3\n+      glob: 13.0.0\n       package-json-from-dist: 1.0.1\n \n   rollup-plugin-dts@6.3.0(rollup@4.53.3)(typescript@5.6.3):\n@@ -6342,7 +6316,7 @@ snapshots:\n \n   safer-buffer@2.1.2: {}\n \n-  sass@1.93.3:\n+  sass@1.96.0:\n     dependencies:\n       chokidar: 4.0.1\n       immutable: 5.0.2\n@@ -6669,13 +6643,13 @@ snapshots:\n \n   vary@1.1.2: {}\n \n-  vite-node@3.2.4(@types/node@24.10.4)(sass@1.93.3):\n+  vite-node@3.2.4(@types/node@24.10.4)(sass@1.96.0):\n     dependencies:\n       cac: 6.7.14\n       debug: 4.4.1\n       es-module-lexer: 1.7.0\n       pathe: 2.0.3\n-      vite: 5.4.19(@types/node@24.10.4)(sass@1.93.3)\n+      vite: 5.4.19(@types/node@24.10.4)(sass@1.96.0)\n     transitivePeerDependencies:\n       - '@types/node'\n       - less\n@@ -6687,7 +6661,7 @@ snapshots:\n       - supports-color\n       - terser\n \n-  vite@5.4.15(@types/node@24.10.4)(sass@1.93.3):\n+  vite@5.4.15(@types/node@24.10.4)(sass@1.96.0):\n     dependencies:\n       esbuild: 0.21.5\n       postcss: 8.5.6\n@@ -6695,9 +6669,9 @@ snapshots:\n     optionalDependencies:\n       '@types/node': 24.10.4\n       fsevents: 2.3.3\n-      sass: 1.93.3\n+      sass: 1.96.0\n \n-  vite@5.4.19(@types/node@24.10.4)(sass@1.93.3):\n+  vite@5.4.19(@types/node@24.10.4)(sass@1.96.0):\n     dependencies:\n       esbuild: 0.21.5\n       postcss: 8.5.6\n@@ -6705,13 +6679,13 @@ snapshots:\n     optionalDependencies:\n       '@types/node': 24.10.4\n       fsevents: 2.3.3\n-      sass: 1.93.3\n+      sass: 1.96.0\n \n-  vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.93.3):\n+  vitest@3.2.4(@types/node@24.10.4)(jsdom@27.1.0(postcss@8.5.6))(sass@1.96.0):\n     dependencies:\n       '@types/chai': 5.2.2\n       '@vitest/expect': 3.2.4\n-      '@vitest/mocker': 3.2.4(vite@5.4.19(@types/node@24.10.4)(sass@1.93.3))\n+      '@vitest/mocker': 3.2.4(vite@5.4.19(@types/node@24.10.4)(sass@1.96.0))\n       '@vitest/pretty-format': 3.2.4\n       '@vitest/runner': 3.2.4\n       '@vitest/snapshot': 3.2.4\n@@ -6729,8 +6703,8 @@ snapshots:\n       tinyglobby: 0.2.14\n       tinypool: 1.1.1\n       tinyrainbow: 2.0.0\n-      vite: 5.4.19(@types/node@24.10.4)(sass@1.93.3)\n-      vite-node: 3.2.4(@types/node@24.10.4)(sass@1.93.3)\n+      vite: 5.4.19(@types/node@24.10.4)(sass@1.96.0)\n+      vite-node: 3.2.4(@types/node@24.10.4)(sass@1.96.0)\n       why-is-node-running: 2.3.0\n     optionalDependencies:\n       '@types/node': 24.10.4"}, {"role": "assistant", "content": "build(deps): update pnpm and dependencies"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/net/fd_windows.go   | 2 +-\n src/net/file_windows.go | 2 +-\n 2 files changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/src/net/fd_windows.go b/src/net/fd_windows.go\nindex 52985be8..c28ce045 100644\n--- a/src/net/fd_windows.go\n+++ b/src/net/fd_windows.go\n@@ -248,7 +248,7 @@ func (fd *netFD) dup() (*os.File, error) {\n \terr := fd.pfd.RawControl(func(fd uintptr) {\n \t\th, syserr = dupSocket(syscall.Handle(fd))\n \t})\n-\tif err != nil {\n+\tif err == nil {\n \t\terr = syserr\n \t}\n \tif err != nil {\ndiff --git a/src/net/file_windows.go b/src/net/file_windows.go\nindex b4eb00e5..6a630503 100644\n--- a/src/net/file_windows.go\n+++ b/src/net/file_windows.go\n@@ -39,7 +39,7 @@ func dupFileSocket(f *os.File) (syscall.Handle, error) {\n \terr = sc.Control(func(fd uintptr) {\n \t\th, syserr = dupSocket(syscall.Handle(fd))\n \t})\n-\tif err != nil {\n+\tif err == nil {\n \t\terr = syserr\n \t}\n \tif err != nil {"}, {"role": "assistant", "content": "fix(net): correct error assignment logic in windows socket duplication"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../internal/fips140test/cast_fips140v1.26_test.go | 16 -----------\n ...ast_fips140v1.0_test.go => fips140v1.0_test.go} |  4 +++\n .../internal/fips140test/fips140v1.26_test.go      | 33 ++++++++++++++++++++++\n src/crypto/internal/fips140test/fips_test.go       |  2 ++\n 4 files changed, 39 insertions(+), 16 deletions(-)\n\ndiff --git a/src/crypto/internal/fips140test/cast_fips140v1.26_test.go b/src/crypto/internal/fips140test/cast_fips140v1.26_test.go\ndeleted file mode 100644\nindex ef79068c..00000000\n--- a/src/crypto/internal/fips140test/cast_fips140v1.26_test.go\n+++ /dev/null\n@@ -1,16 +0,0 @@\n-// Copyright 2024 The Go Authors. All rights reserved.\n-// Use of this source code is governed by a BSD-style\n-// license that can be found in the LICENSE file.\n-\n-//go:build !fips140v1.0\n-\n-package fipstest\n-\n-import \"crypto/internal/fips140/mldsa\"\n-\n-func fips140v126Conditionals() {\n-\t// ML-DSA sign and verify PCT\n-\tkMLDSA := mldsa.GenerateKey44()\n-\t// ML-DSA-44\n-\tmldsa.SignDeterministic(kMLDSA, make([]byte, 32), \"\")\n-}\ndiff --git a/src/crypto/internal/fips140test/cast_fips140v1.0_test.go b/src/crypto/internal/fips140test/fips140v1.0_test.go\nsimilarity index 75%\nrename from src/crypto/internal/fips140test/cast_fips140v1.0_test.go\nrename to src/crypto/internal/fips140test/fips140v1.0_test.go\nindex b9ddfe4d..262ef61d 100644\n--- a/src/crypto/internal/fips140test/cast_fips140v1.0_test.go\n+++ b/src/crypto/internal/fips140test/fips140v1.0_test.go\n@@ -6,4 +6,8 @@\n \n package fipstest\n \n+import \"testing\"\n+\n func fips140v126Conditionals() {}\n+\n+func testFIPS140v126(t *testing.T, plaintext []byte) {}\ndiff --git a/src/crypto/internal/fips140test/fips140v1.26_test.go b/src/crypto/internal/fips140test/fips140v1.26_test.go\nnew file mode 100644\nindex 00000000..6cd9f4fe\n--- /dev/null\n+++ b/src/crypto/internal/fips140test/fips140v1.26_test.go\n@@ -0,0 +1,33 @@\n+// Copyright 2024 The Go Authors. All rights reserved.\n+// Use of this source code is governed by a BSD-style\n+// license that can be found in the LICENSE file.\n+\n+//go:build !fips140v1.0\n+\n+package fipstest\n+\n+import (\n+\t\"crypto/internal/fips140/mldsa\"\n+\t\"testing\"\n+)\n+\n+func fips140v126Conditionals() {\n+\t// ML-DSA sign and verify PCT\n+\tkMLDSA := mldsa.GenerateKey44()\n+\t// ML-DSA-44\n+\tmldsa.SignDeterministic(kMLDSA, make([]byte, 32), \"\")\n+}\n+\n+func testFIPS140v126(t *testing.T, plaintext []byte) {\n+\tt.Run(\"ML-DSA KeyGen, SigGen, SigVer\", func(t *testing.T) {\n+\t\tensureServiceIndicator(t)\n+\t\tk := mldsa.GenerateKey44()\n+\n+\t\tsig, err := mldsa.SignDeterministic(k, plaintext, \"\")\n+\t\tfatalIfErr(t, err)\n+\t\tt.Logf(\"ML-DSA signature: %x\", sig)\n+\n+\t\terr = mldsa.Verify(k.PublicKey(), plaintext, sig, \"\")\n+\t\tfatalIfErr(t, err)\n+\t})\n+}\ndiff --git a/src/crypto/internal/fips140test/fips_test.go b/src/crypto/internal/fips140test/fips_test.go\nindex 52fc9d34..7f2824ca 100644\n--- a/src/crypto/internal/fips140test/fips_test.go\n+++ b/src/crypto/internal/fips140test/fips_test.go\n@@ -101,6 +101,8 @@ func TestFIPS140(t *testing.T) {\n \taesBlock, err := aes.New(aesKey)\n \tfatalIfErr(t, err)\n \n+\ttestFIPS140v126(t, plaintext)\n+\n \tt.Run(\"AES-CTR\", func(t *testing.T) {\n \t\tensureServiceIndicator(t)\n \t\tctr := aes.NewCTR(aesBlock, aesIV)"}, {"role": "assistant", "content": "test(fips140): add ML-DSA tests and reorganize version conditionals"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../react-client/src/__tests__/ReactFlight-test.js    | 19 +++++++++++++++++++\n .../src/__tests__/ReactFlightDOMReply-test.js         | 11 +++++++++++\n 2 files changed, 30 insertions(+)\n\ndiff --git a/packages/react-client/src/__tests__/ReactFlight-test.js b/packages/react-client/src/__tests__/ReactFlight-test.js\nindex b2dcd69..b4a0723 100644\n--- a/packages/react-client/src/__tests__/ReactFlight-test.js\n+++ b/packages/react-client/src/__tests__/ReactFlight-test.js\n@@ -724,6 +724,25 @@ describe('ReactFlight', () => {\n     });\n   });\n \n+  it('can transport cyclic arrays', async () => {\n+    function ComponentClient({prop, obj}) {\n+      expect(prop[1]).toBe(prop);\n+      expect(prop[0]).toBe(obj);\n+    }\n+    const Component = clientReference(ComponentClient);\n+\n+    const obj = {};\n+    const cyclic = [obj];\n+    cyclic[1] = cyclic;\n+    const model = <Component prop={cyclic} obj={obj} />;\n+\n+    const transport = ReactNoopFlightServer.render(model);\n+\n+    await act(async () => {\n+      ReactNoop.render(await ReactNoopFlightClient.read(transport));\n+    });\n+  });\n+\n   it('can render a lazy component as a shared component on the server', async () => {\n     function SharedComponent({text}) {\n       return (\ndiff --git a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMReply-test.js b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMReply-test.js\nindex 2181eb5..4097189 100644\n--- a/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMReply-test.js\n+++ b/packages/react-server-dom-webpack/src/__tests__/ReactFlightDOMReply-test.js\n@@ -650,6 +650,17 @@ describe('ReactFlightDOMReply', () => {\n     expect(root.prop.obj).toBe(root.prop);\n   });\n \n+  it('can transport cyclic arrays', async () => {\n+    const obj = {};\n+    const cyclic = [obj];\n+    cyclic[1] = cyclic;\n+\n+    const body = await ReactServerDOMClient.encodeReply({prop: cyclic, obj});\n+    const root = await ReactServerDOMServer.decodeReply(body, webpackServerMap);\n+    expect(root.prop[1]).toBe(root.prop);\n+    expect(root.prop[0]).toBe(root.obj);\n+  });\n+\n   it('can abort an unresolved model and get the partial result', async () => {\n     const promise = new Promise(r => {});\n     const controller = new AbortController();"}, {"role": "assistant", "content": "test: add cyclic array transport tests"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/internal/coverage/decodemeta/decodefile.go | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/internal/coverage/decodemeta/decodefile.go b/src/internal/coverage/decodemeta/decodefile.go\nindex 6f4dd1a3..474844bf 100644\n--- a/src/internal/coverage/decodemeta/decodefile.go\n+++ b/src/internal/coverage/decodemeta/decodefile.go\n@@ -75,7 +75,7 @@ func (r *CoverageMetaFileReader) readFileHeader() error {\n \t// Vet the version. If this is a meta-data file from the future,\n \t// we won't be able to read it.\n \tif r.hdr.Version > coverage.MetaFileVersion {\n-\t\treturn fmt.Errorf(\"meta-data file withn unknown version %d (expected %d)\", r.hdr.Version, coverage.MetaFileVersion)\n+\t\treturn fmt.Errorf(\"meta-data file with an unknown version %d (expected %d)\", r.hdr.Version, coverage.MetaFileVersion)\n \t}\n \n \t// Read package offsets for good measure"}, {"role": "assistant", "content": "fix(coverage): correct typo in error message"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../dts-test/defineComponent.test-d.tsx            | 35 ++++++++++++++++++++++\n packages/runtime-core/src/apiDefineComponent.ts    |  2 +-\n packages/runtime-core/src/componentOptions.ts      |  4 +--\n 3 files changed, 38 insertions(+), 3 deletions(-)\n\ndiff --git a/packages-private/dts-test/defineComponent.test-d.tsx b/packages-private/dts-test/defineComponent.test-d.tsx\nindex 1967668..9dc5bf8 100644\n--- a/packages-private/dts-test/defineComponent.test-d.tsx\n+++ b/packages-private/dts-test/defineComponent.test-d.tsx\n@@ -2107,3 +2107,38 @@ defineComponent({\n     expectType<string>(this.$props)\n   },\n })\n+\n+// #14117\n+defineComponent({\n+  setup() {\n+    const setup1 = ref('setup1')\n+    const setup2 = ref('setup2')\n+    return { setup1, setup2 }\n+  },\n+  data() {\n+    return {\n+      data1: 1,\n+    }\n+  },\n+  props: {\n+    props1: {\n+      type: String,\n+    },\n+  },\n+  methods: {\n+    methods1() {\n+      return `methods1`\n+    },\n+  },\n+  computed: {\n+    computed1() {\n+      this.setup1\n+      this.setup2\n+      this.data1\n+      this.props1\n+      this.methods1()\n+      return `computed1`\n+    },\n+  },\n+  expose: ['setup1'],\n+})\ndiff --git a/packages/runtime-core/src/apiDefineComponent.ts b/packages/runtime-core/src/apiDefineComponent.ts\nindex 68155e8..e83715f 100644\n--- a/packages/runtime-core/src/apiDefineComponent.ts\n+++ b/packages/runtime-core/src/apiDefineComponent.ts\n@@ -272,7 +272,7 @@ export function defineComponent<\n         Slots,\n         LocalComponents,\n         Directives,\n-        Exposed\n+        string\n       >\n     >,\n ): DefineComponent<\ndiff --git a/packages/runtime-core/src/componentOptions.ts b/packages/runtime-core/src/componentOptions.ts\nindex 35f2f0c..fc41b04 100644\n--- a/packages/runtime-core/src/componentOptions.ts\n+++ b/packages/runtime-core/src/componentOptions.ts\n@@ -1194,7 +1194,7 @@ export type ComponentOptionsWithoutProps<\n       S,\n       LC,\n       Directives,\n-      Exposed\n+      string\n     >\n   >\n \n@@ -1256,7 +1256,7 @@ export type ComponentOptionsWithArrayProps<\n       S,\n       LC,\n       Directives,\n-      Exposed\n+      string\n     >\n   >\n "}, {"role": "assistant", "content": "fix(types): fix computed this context with expose option"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_hir_analysis/src/collect.rs         |  8 +-\n .../src/hir_ty_lowering/bounds.rs                  |  5 +-\n .../rustc_hir_analysis/src/hir_ty_lowering/mod.rs  | 89 +++++-----------------\n compiler/rustc_hir_analysis/src/lib.rs             |  6 +-\n compiler/rustc_hir_typeck/src/expr.rs              |  7 +-\n compiler/rustc_hir_typeck/src/fn_ctxt/_impl.rs     | 13 ++--\n compiler/rustc_hir_typeck/src/method/confirm.rs    |  7 +-\n src/librustdoc/clean/mod.rs                        | 22 +-----\n 8 files changed, 48 insertions(+), 109 deletions(-)\n\ndiff --git a/compiler/rustc_hir_analysis/src/collect.rs b/compiler/rustc_hir_analysis/src/collect.rs\nindex bacdf004980..2c025340938 100644\n--- a/compiler/rustc_hir_analysis/src/collect.rs\n+++ b/compiler/rustc_hir_analysis/src/collect.rs\n@@ -47,9 +47,7 @@\n use tracing::{debug, instrument};\n \n use crate::errors;\n-use crate::hir_ty_lowering::{\n-    FeedConstTy, HirTyLowerer, InherentAssocCandidate, RegionInferReason,\n-};\n+use crate::hir_ty_lowering::{HirTyLowerer, InherentAssocCandidate, RegionInferReason};\n \n pub(crate) mod dump;\n mod generics_of;\n@@ -1499,7 +1497,7 @@ fn const_param_default<'tcx>(\n \n     let ct = icx\n         .lowerer()\n-        .lower_const_arg(default_ct, FeedConstTy::with_type_of(tcx, def_id, identity_args));\n+        .lower_const_arg(default_ct, tcx.type_of(def_id).instantiate(tcx, identity_args));\n     ty::EarlyBinder::bind(ct)\n }\n \n@@ -1557,7 +1555,7 @@ fn const_of_item<'tcx>(\n     let identity_args = ty::GenericArgs::identity_for_item(tcx, def_id);\n     let ct = icx\n         .lowerer()\n-        .lower_const_arg(ct_arg, FeedConstTy::with_type_of(tcx, def_id.to_def_id(), identity_args));\n+        .lower_const_arg(ct_arg, tcx.type_of(def_id.to_def_id()).instantiate(tcx, identity_args));\n     if let Err(e) = icx.check_tainted_by_errors()\n         && !ct.references_error()\n     {\ndiff --git a/compiler/rustc_hir_analysis/src/hir_ty_lowering/bounds.rs b/compiler/rustc_hir_analysis/src/hir_ty_lowering/bounds.rs\nindex 0a874b88180..d6441702b26 100644\n--- a/compiler/rustc_hir_analysis/src/hir_ty_lowering/bounds.rs\n+++ b/compiler/rustc_hir_analysis/src/hir_ty_lowering/bounds.rs\n@@ -20,7 +20,7 @@\n \n use crate::errors;\n use crate::hir_ty_lowering::{\n-    AssocItemQSelf, FeedConstTy, GenericsArgsErrExtend, HirTyLowerer, ImpliedBoundsContext,\n+    AssocItemQSelf, GenericsArgsErrExtend, HirTyLowerer, ImpliedBoundsContext,\n     OverlappingAsssocItemConstraints, PredicateFilter, RegionInferReason,\n };\n \n@@ -543,7 +543,6 @@ pub(super) fn lower_assoc_item_constraint(\n                 let term = match term {\n                     hir::Term::Ty(ty) => self.lower_ty(ty).into(),\n                     hir::Term::Const(ct) => {\n-                        // Provide the resolved type of the associated constant\n                         let ty = projection_term.map_bound(|alias| {\n                             tcx.type_of(alias.def_id).instantiate(tcx, alias.args)\n                         });\n@@ -554,7 +553,7 @@ pub(super) fn lower_assoc_item_constraint(\n                             constraint.hir_id,\n                         );\n \n-                        self.lower_const_arg(ct, FeedConstTy::WithTy(ty)).into()\n+                        self.lower_const_arg(ct, ty).into()\n                     }\n                 };\n \ndiff --git a/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs b/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\nindex be5ac21e2ca..3dcc0232b30 100644\n--- a/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\n+++ b/compiler/rustc_hir_analysis/src/hir_ty_lowering/mod.rs\n@@ -253,35 +253,6 @@ fn to_string(&self, tcx: TyCtxt<'_>) -> String {\n     }\n }\n \n-/// In some cases, [`hir::ConstArg`]s that are being used in the type system\n-/// through const generics need to have their type \"fed\" to them\n-/// using the query system.\n-///\n-/// Use this enum with `<dyn HirTyLowerer>::lower_const_arg` to instruct it with the\n-/// desired behavior.\n-#[derive(Debug, Clone, Copy)]\n-pub enum FeedConstTy<'tcx> {\n-    /// Feed the type to the (anno) const arg.\n-    WithTy(Ty<'tcx>),\n-    /// Don't feed the type.\n-    No,\n-}\n-\n-impl<'tcx> FeedConstTy<'tcx> {\n-    /// The `DefId` belongs to the const param that we are supplying\n-    /// this (anon) const arg to.\n-    ///\n-    /// The list of generic args is used to instantiate the parameters\n-    /// used by the type of the const param specified by `DefId`.\n-    pub fn with_type_of(\n-        tcx: TyCtxt<'tcx>,\n-        def_id: DefId,\n-        generic_args: &[ty::GenericArg<'tcx>],\n-    ) -> Self {\n-        Self::WithTy(tcx.type_of(def_id).instantiate(tcx, generic_args))\n-    }\n-}\n-\n #[derive(Debug, Clone, Copy)]\n enum LowerTypeRelativePathMode {\n     Type(PermitVariants),\n@@ -733,7 +704,7 @@ fn provided_kind(\n                         // Ambig portions of `ConstArg` are handled in the match arm below\n                         .lower_const_arg(\n                             ct.as_unambig_ct(),\n-                            FeedConstTy::with_type_of(tcx, param.def_id, preceding_args),\n+                            tcx.type_of(param.def_id).instantiate(tcx, preceding_args),\n                         )\n                         .into(),\n                     (&GenericParamDefKind::Const { .. }, GenericArg::Infer(inf)) => {\n@@ -1322,7 +1293,7 @@ fn probe_single_bound_for_assoc_item<I>(\n                                             constraint.hir_id,\n                                         );\n \n-                                        self.lower_const_arg(ct, FeedConstTy::WithTy(ty)).into()\n+                                        self.lower_const_arg(ct, ty).into()\n                                     }\n                                 };\n                                 if term.references_error() {\n@@ -2347,16 +2318,10 @@ pub(crate) fn lower_const_param(&self, param_def_id: DefId, path_hir_id: HirId)\n \n     /// Lower a [`hir::ConstArg`] to a (type-level) [`ty::Const`](Const).\n     #[instrument(skip(self), level = \"debug\")]\n-    pub fn lower_const_arg(\n-        &self,\n-        const_arg: &hir::ConstArg<'tcx>,\n-        feed: FeedConstTy<'tcx>,\n-    ) -> Const<'tcx> {\n+    pub fn lower_const_arg(&self, const_arg: &hir::ConstArg<'tcx>, ty: Ty<'tcx>) -> Const<'tcx> {\n         let tcx = self.tcx();\n \n-        if let FeedConstTy::WithTy(anon_const_type) = feed\n-            && let hir::ConstArgKind::Anon(anon) = &const_arg.kind\n-        {\n+        if let hir::ConstArgKind::Anon(anon) = &const_arg.kind {\n             // FIXME(generic_const_parameter_types): Ideally we remove these errors below when\n             // we have the ability to intermix typeck of anon const const args with the parent\n             // bodies typeck.\n@@ -2366,7 +2331,7 @@ pub fn lower_const_arg(\n             // hir typeck was using equality but mir borrowck wound up using subtyping as that could\n             // result in a non-infer in hir typeck but a region variable in borrowck.\n             if tcx.features().generic_const_parameter_types()\n-                && (anon_const_type.has_free_regions() || anon_const_type.has_erased_regions())\n+                && (ty.has_free_regions() || ty.has_erased_regions())\n             {\n                 let e = self.dcx().span_err(\n                     const_arg.span,\n@@ -2378,7 +2343,7 @@ pub fn lower_const_arg(\n             // We must error if the instantiated type has any inference variables as we will\n             // use this type to feed the `type_of` and query results must not contain inference\n             // variables otherwise we will ICE.\n-            if anon_const_type.has_non_region_infer() {\n+            if ty.has_non_region_infer() {\n                 let e = self.dcx().span_err(\n                     const_arg.span,\n                     \"anonymous constants with inferred types are not yet supported\",\n@@ -2388,7 +2353,7 @@ pub fn lower_const_arg(\n             }\n             // We error when the type contains unsubstituted generics since we do not currently\n             // give the anon const any of the generics from the parent.\n-            if anon_const_type.has_non_region_param() {\n+            if ty.has_non_region_param() {\n                 let e = self.dcx().span_err(\n                     const_arg.span,\n                     \"anonymous constants referencing generics are not yet supported\",\n@@ -2397,12 +2362,12 @@ pub fn lower_const_arg(\n                 return ty::Const::new_error(tcx, e);\n             }\n \n-            tcx.feed_anon_const_type(anon.def_id, ty::EarlyBinder::bind(anon_const_type));\n+            tcx.feed_anon_const_type(anon.def_id, ty::EarlyBinder::bind(ty));\n         }\n \n         let hir_id = const_arg.hir_id;\n         match const_arg.kind {\n-            hir::ConstArgKind::Tup(exprs) => self.lower_const_arg_tup(exprs, feed, const_arg.span),\n+            hir::ConstArgKind::Tup(exprs) => self.lower_const_arg_tup(exprs, ty, const_arg.span),\n             hir::ConstArgKind::Path(hir::QPath::Resolved(maybe_qself, path)) => {\n                 debug!(?maybe_qself, ?path);\n                 let opt_self_ty = maybe_qself.as_ref().map(|qself| self.lower_ty(qself));\n@@ -2426,16 +2391,12 @@ pub fn lower_const_arg(\n             hir::ConstArgKind::TupleCall(qpath, args) => {\n                 self.lower_const_arg_tuple_call(hir_id, qpath, args, const_arg.span)\n             }\n-            hir::ConstArgKind::Array(array_expr) => self.lower_const_arg_array(array_expr, feed),\n+            hir::ConstArgKind::Array(array_expr) => self.lower_const_arg_array(array_expr, ty),\n             hir::ConstArgKind::Anon(anon) => self.lower_const_arg_anon(anon),\n             hir::ConstArgKind::Infer(()) => self.ct_infer(None, const_arg.span),\n             hir::ConstArgKind::Error(e) => ty::Const::new_error(tcx, e),\n-            hir::ConstArgKind::Literal(kind) if let FeedConstTy::WithTy(anon_const_type) = feed => {\n-                self.lower_const_arg_literal(&kind, anon_const_type, const_arg.span)\n-            }\n-            hir::ConstArgKind::Literal(..) => {\n-                let e = self.dcx().span_err(const_arg.span, \"literal of unknown type\");\n-                ty::Const::new_error(tcx, e)\n+            hir::ConstArgKind::Literal(kind) => {\n+                self.lower_const_arg_literal(&kind, ty, const_arg.span)\n             }\n         }\n     }\n@@ -2443,14 +2404,10 @@ pub fn lower_const_arg(\n     fn lower_const_arg_array(\n         &self,\n         array_expr: &'tcx hir::ConstArgArrayExpr<'tcx>,\n-        feed: FeedConstTy<'tcx>,\n+        ty: Ty<'tcx>,\n     ) -> Const<'tcx> {\n         let tcx = self.tcx();\n \n-        let FeedConstTy::WithTy(ty) = feed else {\n-            return Const::new_error_with_message(tcx, array_expr.span, \"unsupported const array\");\n-        };\n-\n         let ty::Array(elem_ty, _) = ty.kind() else {\n             return Const::new_error_with_message(\n                 tcx,\n@@ -2462,7 +2419,7 @@ fn lower_const_arg_array(\n         let elems = array_expr\n             .elems\n             .iter()\n-            .map(|elem| self.lower_const_arg(elem, FeedConstTy::WithTy(*elem_ty)))\n+            .map(|elem| self.lower_const_arg(elem, *elem_ty))\n             .collect::<Vec<_>>();\n \n         let valtree = ty::ValTree::from_branches(tcx, elems);\n@@ -2545,7 +2502,7 @@ fn lower_const_arg_tuple_call(\n             .iter()\n             .zip(args)\n             .map(|(field_def, arg)| {\n-                self.lower_const_arg(arg, FeedConstTy::with_type_of(tcx, field_def.did, adt_args))\n+                self.lower_const_arg(arg, tcx.type_of(field_def.did).instantiate(tcx, adt_args))\n             })\n             .collect::<Vec<_>>();\n \n@@ -2564,15 +2521,11 @@ fn lower_const_arg_tuple_call(\n     fn lower_const_arg_tup(\n         &self,\n         exprs: &'tcx [&'tcx hir::ConstArg<'tcx>],\n-        feed: FeedConstTy<'tcx>,\n+        ty: Ty<'tcx>,\n         span: Span,\n     ) -> Const<'tcx> {\n         let tcx = self.tcx();\n \n-        let FeedConstTy::WithTy(ty) = feed else {\n-            return Const::new_error_with_message(tcx, span, \"const tuple lack type information\");\n-        };\n-\n         let ty::Tuple(tys) = ty.kind() else {\n             let e = tcx.dcx().span_err(span, format!(\"expected `{}`, found const tuple\", ty));\n             return Const::new_error(tcx, e);\n@@ -2581,7 +2534,7 @@ fn lower_const_arg_tup(\n         let exprs = exprs\n             .iter()\n             .zip(tys.iter())\n-            .map(|(expr, ty)| self.lower_const_arg(expr, FeedConstTy::WithTy(ty)))\n+            .map(|(expr, ty)| self.lower_const_arg(expr, ty))\n             .collect::<Vec<_>>();\n \n         let valtree = ty::ValTree::from_branches(tcx, exprs);\n@@ -2668,7 +2621,7 @@ fn lower_const_arg_struct(\n \n                         self.lower_const_arg(\n                             expr.expr,\n-                            FeedConstTy::with_type_of(tcx, field_def.did, adt_args),\n+                            tcx.type_of(field_def.did).instantiate(tcx, adt_args),\n                         )\n                     }\n                     None => {\n@@ -3030,7 +2983,7 @@ pub fn lower_ty(&self, hir_ty: &hir::Ty<'tcx>) -> Ty<'tcx> {\n                 .unwrap_or_else(|guar| Ty::new_error(tcx, guar))\n             }\n             hir::TyKind::Array(ty, length) => {\n-                let length = self.lower_const_arg(length, FeedConstTy::WithTy(tcx.types.usize));\n+                let length = self.lower_const_arg(length, tcx.types.usize);\n                 Ty::new_array_with_const_len(tcx, self.lower_ty(ty), length)\n             }\n             hir::TyKind::Infer(()) => {\n@@ -3070,8 +3023,8 @@ fn lower_pat_ty_pat(\n                     // Keep this list of types in sync with the list of types that\n                     // the `RangePattern` trait is implemented for.\n                     ty::Int(_) | ty::Uint(_) | ty::Char => {\n-                        let start = self.lower_const_arg(start, FeedConstTy::WithTy(ty));\n-                        let end = self.lower_const_arg(end, FeedConstTy::WithTy(ty));\n+                        let start = self.lower_const_arg(start, ty);\n+                        let end = self.lower_const_arg(end, ty);\n                         Ok(ty::PatternKind::Range { start, end })\n                     }\n                     _ => Err(self\ndiff --git a/compiler/rustc_hir_analysis/src/lib.rs b/compiler/rustc_hir_analysis/src/lib.rs\nindex 7296ba6f964..a51355adf72 100644\n--- a/compiler/rustc_hir_analysis/src/lib.rs\n+++ b/compiler/rustc_hir_analysis/src/lib.rs\n@@ -101,7 +101,7 @@\n use rustc_trait_selection::traits;\n \n pub use crate::collect::suggest_impl_trait;\n-use crate::hir_ty_lowering::{FeedConstTy, HirTyLowerer};\n+use crate::hir_ty_lowering::HirTyLowerer;\n \n rustc_fluent_macro::fluent_messages! { \"../messages.ftl\" }\n \n@@ -301,8 +301,8 @@ pub fn lower_ty<'tcx>(tcx: TyCtxt<'tcx>, hir_ty: &hir::Ty<'tcx>) -> Ty<'tcx> {\n pub fn lower_const_arg_for_rustdoc<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     hir_ct: &hir::ConstArg<'tcx>,\n-    feed: FeedConstTy<'tcx>,\n+    ty: Ty<'tcx>,\n ) -> Const<'tcx> {\n     let env_def_id = tcx.hir_get_parent_item(hir_ct.hir_id);\n-    collect::ItemCtxt::new(tcx, env_def_id.def_id).lowerer().lower_const_arg(hir_ct, feed)\n+    collect::ItemCtxt::new(tcx, env_def_id.def_id).lowerer().lower_const_arg(hir_ct, ty)\n }\ndiff --git a/compiler/rustc_hir_typeck/src/expr.rs b/compiler/rustc_hir_typeck/src/expr.rs\nindex d7366887d85..9f3ff0b2d03 100644\n--- a/compiler/rustc_hir_typeck/src/expr.rs\n+++ b/compiler/rustc_hir_typeck/src/expr.rs\n@@ -21,7 +21,7 @@\n use rustc_hir::lang_items::LangItem;\n use rustc_hir::{ExprKind, HirId, QPath, find_attr, is_range_literal};\n use rustc_hir_analysis::NoVariantNamed;\n-use rustc_hir_analysis::hir_ty_lowering::{FeedConstTy, HirTyLowerer as _};\n+use rustc_hir_analysis::hir_ty_lowering::HirTyLowerer as _;\n use rustc_infer::infer::{self, DefineOpaqueTypes, InferOk, RegionVariableOrigin};\n use rustc_infer::traits::query::NoSolution;\n use rustc_middle::ty::adjustment::{Adjust, Adjustment, AllowTwoPhase};\n@@ -1749,10 +1749,7 @@ fn check_expr_repeat(\n         let count_span = count.span;\n         let count = self.try_structurally_resolve_const(\n             count_span,\n-            self.normalize(\n-                count_span,\n-                self.lower_const_arg(count, FeedConstTy::WithTy(tcx.types.usize)),\n-            ),\n+            self.normalize(count_span, self.lower_const_arg(count, tcx.types.usize)),\n         );\n \n         if let Some(count) = count.try_to_target_usize(tcx) {\ndiff --git a/compiler/rustc_hir_typeck/src/fn_ctxt/_impl.rs b/compiler/rustc_hir_typeck/src/fn_ctxt/_impl.rs\nindex a66ff2a23c2..91f91d91144 100644\n--- a/compiler/rustc_hir_typeck/src/fn_ctxt/_impl.rs\n+++ b/compiler/rustc_hir_typeck/src/fn_ctxt/_impl.rs\n@@ -14,8 +14,8 @@\n     check_generic_arg_count_for_call, lower_generic_args,\n };\n use rustc_hir_analysis::hir_ty_lowering::{\n-    ExplicitLateBound, FeedConstTy, GenericArgCountMismatch, GenericArgCountResult,\n-    GenericArgsLowerer, GenericPathSegment, HirTyLowerer, IsMethodCall, RegionInferReason,\n+    ExplicitLateBound, GenericArgCountMismatch, GenericArgCountResult, GenericArgsLowerer,\n+    GenericPathSegment, HirTyLowerer, IsMethodCall, RegionInferReason,\n };\n use rustc_infer::infer::canonical::{Canonical, OriginalQueryValues, QueryResponse};\n use rustc_infer::infer::{DefineOpaqueTypes, InferResult};\n@@ -525,9 +525,9 @@ pub(super) fn user_args_for_adt(ty: LoweredTy<'tcx>) -> UserArgs<'tcx> {\n     pub(crate) fn lower_const_arg(\n         &self,\n         const_arg: &'tcx hir::ConstArg<'tcx>,\n-        feed: FeedConstTy<'tcx>,\n+        ty: Ty<'tcx>,\n     ) -> ty::Const<'tcx> {\n-        let ct = self.lowerer().lower_const_arg(const_arg, feed);\n+        let ct = self.lowerer().lower_const_arg(const_arg, ty);\n         self.register_wf_obligation(\n             ct.into(),\n             self.tcx.hir_span(const_arg.hir_id),\n@@ -1228,7 +1228,10 @@ fn provided_kind(\n                         // Ambiguous parts of `ConstArg` are handled in the match arms below\n                         .lower_const_arg(\n                             ct.as_unambig_ct(),\n-                            FeedConstTy::with_type_of(self.fcx.tcx, param.def_id, preceding_args),\n+                            self.fcx\n+                                .tcx\n+                                .type_of(param.def_id)\n+                                .instantiate(self.fcx.tcx, preceding_args),\n                         )\n                         .into(),\n                     (&GenericParamDefKind::Const { .. }, GenericArg::Infer(inf)) => {\ndiff --git a/compiler/rustc_hir_typeck/src/method/confirm.rs b/compiler/rustc_hir_typeck/src/method/confirm.rs\nindex aab4e398555..270f011b2b1 100644\n--- a/compiler/rustc_hir_typeck/src/method/confirm.rs\n+++ b/compiler/rustc_hir_typeck/src/method/confirm.rs\n@@ -7,7 +7,7 @@\n     check_generic_arg_count_for_call, lower_generic_args,\n };\n use rustc_hir_analysis::hir_ty_lowering::{\n-    FeedConstTy, GenericArgsLowerer, HirTyLowerer, IsMethodCall, RegionInferReason,\n+    GenericArgsLowerer, HirTyLowerer, IsMethodCall, RegionInferReason,\n };\n use rustc_infer::infer::{\n     BoundRegionConversionTime, DefineOpaqueTypes, InferOk, RegionVariableOrigin,\n@@ -447,7 +447,10 @@ fn provided_kind(\n                         // We handle the ambig portions of `ConstArg` in the match arms below\n                         .lower_const_arg(\n                             ct.as_unambig_ct(),\n-                            FeedConstTy::with_type_of(self.cfcx.tcx, param.def_id, preceding_args),\n+                            self.cfcx\n+                                .tcx\n+                                .type_of(param.def_id)\n+                                .instantiate(self.cfcx.tcx, preceding_args),\n                         )\n                         .into(),\n                     (GenericParamDefKind::Const { .. }, GenericArg::Infer(inf)) => {\ndiff --git a/src/librustdoc/clean/mod.rs b/src/librustdoc/clean/mod.rs\nindex ac17014ebfd..c7c23f75d69 100644\n--- a/src/librustdoc/clean/mod.rs\n+++ b/src/librustdoc/clean/mod.rs\n@@ -43,7 +43,6 @@\n use rustc_hir::def::{CtorKind, DefKind, MacroKinds, Res};\n use rustc_hir::def_id::{DefId, DefIdMap, DefIdSet, LOCAL_CRATE, LocalDefId};\n use rustc_hir::{LangItem, PredicateOrigin, find_attr};\n-use rustc_hir_analysis::hir_ty_lowering::FeedConstTy;\n use rustc_hir_analysis::{lower_const_arg_for_rustdoc, lower_ty};\n use rustc_middle::metadata::Reexport;\n use rustc_middle::middle::resolve_bound_vars as rbv;\n@@ -485,7 +484,7 @@ fn clean_hir_term<'tcx>(\n                 Ty::new_error_with_message(cx.tcx, span, \"cannot find the associated constant\")\n             };\n \n-            let ct = lower_const_arg_for_rustdoc(cx.tcx, c, FeedConstTy::WithTy(ty));\n+            let ct = lower_const_arg_for_rustdoc(cx.tcx, c, ty);\n             Term::Constant(clean_middle_const(ty::Binder::dummy(ct), cx))\n         }\n     }\n@@ -663,12 +662,7 @@ fn clean_generic_param<'tcx>(\n                 ty: Box::new(clean_ty(ty, cx)),\n                 default: default.map(|ct| {\n                     Box::new(\n-                        lower_const_arg_for_rustdoc(\n-                            cx.tcx,\n-                            ct,\n-                            FeedConstTy::WithTy(lower_ty(cx.tcx, ty)),\n-                        )\n-                        .to_string(),\n+                        lower_const_arg_for_rustdoc(cx.tcx, ct, lower_ty(cx.tcx, ty)).to_string(),\n                     )\n                 }),\n             },\n@@ -1831,11 +1825,7 @@ pub(crate) fn clean_ty<'tcx>(ty: &hir::Ty<'tcx>, cx: &mut DocContext<'tcx>) -> T\n             let length = match const_arg.kind {\n                 hir::ConstArgKind::Infer(..) | hir::ConstArgKind::Error(..) => \"_\".to_string(),\n                 hir::ConstArgKind::Anon(hir::AnonConst { def_id, .. }) => {\n-                    let ct = lower_const_arg_for_rustdoc(\n-                        cx.tcx,\n-                        const_arg,\n-                        FeedConstTy::WithTy(cx.tcx.types.usize),\n-                    );\n+                    let ct = lower_const_arg_for_rustdoc(cx.tcx, const_arg, cx.tcx.types.usize);\n                     let typing_env = ty::TypingEnv::post_analysis(cx.tcx, *def_id);\n                     let ct = cx.tcx.normalize_erasing_regions(typing_env, ct);\n                     print_const(cx, ct)\n@@ -1846,11 +1836,7 @@ pub(crate) fn clean_ty<'tcx>(ty: &hir::Ty<'tcx>, cx: &mut DocContext<'tcx>) -> T\n                 | hir::ConstArgKind::Tup(..)\n                 | hir::ConstArgKind::Array(..)\n                 | hir::ConstArgKind::Literal(..) => {\n-                    let ct = lower_const_arg_for_rustdoc(\n-                        cx.tcx,\n-                        const_arg,\n-                        FeedConstTy::WithTy(cx.tcx.types.usize),\n-                    );\n+                    let ct = lower_const_arg_for_rustdoc(cx.tcx, const_arg, cx.tcx.types.usize);\n                     print_const(cx, ct)\n                 }\n             };"}, {"role": "assistant", "content": "refactor: simplify const arg lowering by removing FeedConstTy enum"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../babel-plugin-react-compiler/src/HIR/HIR.ts     |  1 +\n .../src/Inference/DropManualMemoization.ts         |  1 +\n .../src/Optimization/ConstantPropagation.ts        | 13 +++++\n .../Validation/ValidateExhaustiveDependencies.ts   | 66 ++++++++++++----------\n .../ValidatePreservedManualMemoization.ts          |  3 +\n .../context-variable-as-jsx-element-tag.expect.md  |  3 +-\n .../context-variable-as-jsx-element-tag.js         |  2 +-\n ...ive-deps-disallow-unused-stable-types.expect.md | 42 ++++++++++++++\n ...exhaustive-deps-disallow-unused-stable-types.js | 14 +++++\n ...ive-deps-allow-constant-folded-values.expect.md | 41 ++++++++++++++\n ...exhaustive-deps-allow-constant-folded-values.js | 11 ++++\n ...nsure-constant-prop-decls-get-removed.expect.md |  4 +-\n .../todo-ensure-constant-prop-decls-get-removed.ts |  2 +-\n ...riable-preserve-memoization-guarantee.expect.md |  2 +-\n ...free-variable-preserve-memoization-guarantee.js |  2 +-\n 15 files changed, 169 insertions(+), 38 deletions(-)\n\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts b/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\nindex 55bcd0b..9fb360c 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/HIR/HIR.ts\n@@ -803,6 +803,7 @@ export type ManualMemoDependency = {\n     | {\n         kind: 'NamedLocal';\n         value: Place;\n+        constant: boolean;\n       }\n     | {kind: 'Global'; identifierName: string};\n   path: DependencyPath;\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Inference/DropManualMemoization.ts b/compiler/packages/babel-plugin-react-compiler/src/Inference/DropManualMemoization.ts\nindex bcfc534..0138e52 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Inference/DropManualMemoization.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Inference/DropManualMemoization.ts\n@@ -92,6 +92,7 @@ export function collectMaybeMemoDependencies(\n           root: {\n             kind: 'NamedLocal',\n             value: {...value.place},\n+            constant: false,\n           },\n           path: [],\n         };\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Optimization/ConstantPropagation.ts b/compiler/packages/babel-plugin-react-compiler/src/Optimization/ConstantPropagation.ts\nindex ca2f6e0..7330b63 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Optimization/ConstantPropagation.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Optimization/ConstantPropagation.ts\n@@ -609,6 +609,19 @@ function evaluateInstruction(\n       constantPropagationImpl(value.loweredFunc.func, constants);\n       return null;\n     }\n+    case 'StartMemoize': {\n+      if (value.deps != null) {\n+        for (const dep of value.deps) {\n+          if (dep.root.kind === 'NamedLocal') {\n+            const placeValue = read(constants, dep.root.value);\n+            if (placeValue != null && placeValue.kind === 'Primitive') {\n+              dep.root.constant = true;\n+            }\n+          }\n+        }\n+      }\n+      return null;\n+    }\n     default: {\n       // TODO: handle more cases\n       return null;\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\nindex b3a68fc..5035fa9 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\n@@ -22,6 +22,7 @@ import {\n   Identifier,\n   IdentifierId,\n   InstructionKind,\n+  isPrimitiveType,\n   isStableType,\n   isSubPath,\n   isSubPathIgnoringOptionals,\n@@ -53,20 +54,18 @@ const DEBUG = false;\n  * - If the manual dependencies had extraneous deps, then auto memoization\n  *   will remove them and cause the value to update *less* frequently.\n  *\n- * We consider a value V as missing if ALL of the following conditions are met:\n- * - V is reactive\n- * - There is no manual dependency path P such that whenever V would change,\n- *   P would also change. If V is `x.y.z`, this means there must be some\n- *   path P that is either `x.y.z`, `x.y`, or `x`. Note that we assume no\n- *   interior mutability, such that a shorter path \"covers\" changes to longer\n- *   more precise paths.\n- *\n- * We consider a value V extraneous if either of the folowing are true:\n- * - V is a reactive local that is unreferenced\n- * - V is a global that is unreferenced\n- *\n- * In other words, we allow extraneous non-reactive values since we know they cannot\n- * impact how often the memoization would run.\n+ * The implementation compares the manual dependencies against the values\n+ * actually used within the memoization function\n+ * - For each value V referenced in the memo function, either:\n+ *   - If the value is non-reactive *and* a known stable type, then the\n+ *     value may optionally be specified as an exact dependency.\n+ *   - Otherwise, report an error unless there is a manual dependency that will\n+ *     invalidate whenever V invalidates. If `x.y.z` is referenced, there must\n+ *     be a manual dependency for `x.y.z`, `x.y`, or `x`. Note that we assume\n+ *     no interior mutability, ie we assume that any changes to inner paths must\n+ *     always cause the other path to change as well.\n+ * - Any dependencies that do not correspond to a value referenced in the memo\n+ *   function are considered extraneous and throw an error\n  *\n  * ## TODO: Invalid, Complex Deps\n  *\n@@ -226,9 +225,6 @@ export function validateExhaustiveDependencies(\n         reason: 'Unexpected function dependency',\n         loc: value.loc,\n       });\n-      const isRequiredDependency = reactive.has(\n-        inferredDependency.identifier.id,\n-      );\n       let hasMatchingManualDependency = false;\n       for (const manualDependency of manualDependencies) {\n         if (\n@@ -243,32 +239,40 @@ export function validateExhaustiveDependencies(\n         ) {\n           hasMatchingManualDependency = true;\n           matched.add(manualDependency);\n-          if (!isRequiredDependency) {\n-            extra.push(manualDependency);\n-          }\n         }\n       }\n-      if (isRequiredDependency && !hasMatchingManualDependency) {\n-        missing.push(inferredDependency);\n+      const isOptionalDependency =\n+        !reactive.has(inferredDependency.identifier.id) &&\n+        (isStableType(inferredDependency.identifier) ||\n+          isPrimitiveType(inferredDependency.identifier));\n+      if (hasMatchingManualDependency || isOptionalDependency) {\n+        continue;\n       }\n+      missing.push(inferredDependency);\n     }\n \n     for (const dep of startMemo.deps ?? []) {\n       if (matched.has(dep)) {\n         continue;\n       }\n+      if (dep.root.kind === 'NamedLocal' && dep.root.constant) {\n+        CompilerError.simpleInvariant(\n+          !dep.root.value.reactive &&\n+            isPrimitiveType(dep.root.value.identifier),\n+          {\n+            reason: 'Expected constant-folded dependency to be non-reactive',\n+            loc: dep.root.value.loc,\n+          },\n+        );\n+        /*\n+         * Constant primitives can get constant-folded, which means we won't\n+         * see a LoadLocal for the value within the memo function.\n+         */\n+        continue;\n+      }\n       extra.push(dep);\n     }\n \n-    /**\n-     * Per docblock, we only consider dependencies as extraneous if\n-     * they are unused globals or reactive locals. Notably, this allows\n-     * non-reactive locals.\n-     */\n-    retainWhere(extra, dep => {\n-      return dep.root.kind === 'Global' || dep.root.value.reactive;\n-    });\n-\n     if (missing.length !== 0 || extra.length !== 0) {\n       let suggestions: Array<CompilerSuggestion> | null = null;\n       if (startMemo.depsLoc != null && typeof startMemo.depsLoc !== 'symbol') {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidatePreservedManualMemoization.ts b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidatePreservedManualMemoization.ts\nindex 19af0ed..48cec3c 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidatePreservedManualMemoization.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidatePreservedManualMemoization.ts\n@@ -267,6 +267,7 @@ function validateInferredDep(\n           effect: Effect.Read,\n           reactive: false,\n         },\n+        constant: false,\n       },\n       path: [...dep.path],\n     };\n@@ -379,6 +380,7 @@ class Visitor extends ReactiveFunctionVisitor<VisitorState> {\n                 root: {\n                   kind: 'NamedLocal',\n                   value: storeTarget,\n+                  constant: false,\n                 },\n                 path: [],\n               });\n@@ -408,6 +410,7 @@ class Visitor extends ReactiveFunctionVisitor<VisitorState> {\n         root: {\n           kind: 'NamedLocal',\n           value: {...lvalue},\n+          constant: false,\n         },\n         path: [],\n       });\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/context-variable-as-jsx-element-tag.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/context-variable-as-jsx-element-tag.expect.md\nindex 407fdcb..636bc53 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/context-variable-as-jsx-element-tag.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/context-variable-as-jsx-element-tag.expect.md\n@@ -11,7 +11,7 @@ function Component(props) {\n \n   Component = useMemo(() => {\n     return Component;\n-  });\n+  }, [Component]);\n \n   return <Component {...props} />;\n }\n@@ -36,6 +36,7 @@ function Component(props) {\n   if ($[0] === Symbol.for(\"react.memo_cache_sentinel\")) {\n     Component = Stringify;\n \n+    Component;\n     Component = Component;\n     $[0] = Component;\n   } else {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/context-variable-as-jsx-element-tag.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/context-variable-as-jsx-element-tag.js\nindex 5ed1a91..49cf336 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/context-variable-as-jsx-element-tag.js\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/context-variable-as-jsx-element-tag.js\n@@ -7,7 +7,7 @@ function Component(props) {\n \n   Component = useMemo(() => {\n     return Component;\n-  });\n+  }, [Component]);\n \n   return <Component {...props} />;\n }\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md\nnew file mode 100644\nindex 0000000..b6d8a46\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.expect.md\n@@ -0,0 +1,42 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveMemoizationDependencies\n+\n+import {useState} from 'react';\n+import {Stringify} from 'shared-runtime';\n+\n+function Component() {\n+  const [state, setState] = useState(0);\n+  const x = useMemo(() => {\n+    return [state];\n+    // error: `setState` is a stable type, but not actually referenced\n+  }, [state, setState]);\n+\n+  return 'oops';\n+}\n+\n+```\n+\n+\n+## Error\n+\n+```\n+Found 1 error:\n+\n+Error: Found unnecessary memoization dependencies\n+\n+Unnecessary dependencies can cause a value to update more often than necessary, causing performance regressions and effects to fire more often than expected.\n+\n+error.invalid-exhaustive-deps-disallow-unused-stable-types.ts:11:5\n+   9 |     return [state];\n+  10 |     // error: `setState` is a stable type, but not actually referenced\n+> 11 |   }, [state, setState]);\n+     |      ^^^^^^^^^^^^^^^^^ Unnecessary dependencies `setState`\n+  12 |\n+  13 |   return 'oops';\n+  14 | }\n+```\n+          \n+      \n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.js\nnew file mode 100644\nindex 0000000..2bb03c3\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps-disallow-unused-stable-types.js\n@@ -0,0 +1,14 @@\n+// @validateExhaustiveMemoizationDependencies\n+\n+import {useState} from 'react';\n+import {Stringify} from 'shared-runtime';\n+\n+function Component() {\n+  const [state, setState] = useState(0);\n+  const x = useMemo(() => {\n+    return [state];\n+    // error: `setState` is a stable type, but not actually referenced\n+  }, [state, setState]);\n+\n+  return 'oops';\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.expect.md\nnew file mode 100644\nindex 0000000..bda2b03\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.expect.md\n@@ -0,0 +1,41 @@\n+\n+## Input\n+\n+```javascript\n+// @validateExhaustiveMemoizationDependencies\n+\n+function Component() {\n+  const x = 0;\n+  const y = useMemo(() => {\n+    return [x];\n+    // x gets constant-folded but shouldn't count as extraneous,\n+    // it was referenced in the memo block\n+  }, [x]);\n+  return y;\n+}\n+\n+```\n+\n+## Code\n+\n+```javascript\n+import { c as _c } from \"react/compiler-runtime\"; // @validateExhaustiveMemoizationDependencies\n+\n+function Component() {\n+  const $ = _c(1);\n+  const x = 0;\n+  let t0;\n+  if ($[0] === Symbol.for(\"react.memo_cache_sentinel\")) {\n+    t0 = [0];\n+    $[0] = t0;\n+  } else {\n+    t0 = $[0];\n+  }\n+  const y = t0;\n+  return y;\n+}\n+\n+```\n+      \n+### Eval output\n+(kind: exception) Fixture not implemented\n\\ No newline at end of file\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.js\nnew file mode 100644\nindex 0000000..6ee141c\n--- /dev/null\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/exhaustive-deps-allow-constant-folded-values.js\n@@ -0,0 +1,11 @@\n+// @validateExhaustiveMemoizationDependencies\n+\n+function Component() {\n+  const x = 0;\n+  const y = useMemo(() => {\n+    return [x];\n+    // x gets constant-folded but shouldn't count as extraneous,\n+    // it was referenced in the memo block\n+  }, [x]);\n+  return y;\n+}\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/todo-ensure-constant-prop-decls-get-removed.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/todo-ensure-constant-prop-decls-get-removed.expect.md\nindex cf36d6e..f23cf84 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/todo-ensure-constant-prop-decls-get-removed.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/todo-ensure-constant-prop-decls-get-removed.expect.md\n@@ -2,7 +2,7 @@\n ## Input\n \n ```javascript\n-// @validatePreserveExistingMemoizationGuarantees\n+// @validatePreserveExistingMemoizationGuarantees @validateExhaustiveMemoizationDependencies:false\n \n import {useMemo} from 'react';\n \n@@ -27,7 +27,7 @@ export const FIXTURE_ENTRYPOINT = {\n ## Code\n \n ```javascript\n-import { c as _c } from \"react/compiler-runtime\"; // @validatePreserveExistingMemoizationGuarantees\n+import { c as _c } from \"react/compiler-runtime\"; // @validatePreserveExistingMemoizationGuarantees @validateExhaustiveMemoizationDependencies:false\n \n import { useMemo } from \"react\";\n \ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/todo-ensure-constant-prop-decls-get-removed.ts b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/todo-ensure-constant-prop-decls-get-removed.ts\nindex b0c0139..bfbc0ab 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/todo-ensure-constant-prop-decls-get-removed.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/preserve-memo-validation/todo-ensure-constant-prop-decls-get-removed.ts\n@@ -1,4 +1,4 @@\n-// @validatePreserveExistingMemoizationGuarantees\n+// @validatePreserveExistingMemoizationGuarantees @validateExhaustiveMemoizationDependencies:false\n \n import {useMemo} from 'react';\n \ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/useCallback-maybe-modify-free-variable-preserve-memoization-guarantee.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/useCallback-maybe-modify-free-variable-preserve-memoization-guarantee.expect.md\nindex 43b3b59..16169a7 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/useCallback-maybe-modify-free-variable-preserve-memoization-guarantee.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/useCallback-maybe-modify-free-variable-preserve-memoization-guarantee.expect.md\n@@ -15,7 +15,7 @@ function Component(props) {\n     const x = makeObject_Primitives();\n     x.value = props.value;\n     mutate(x, free, part);\n-  }, [props.value]);\n+  }, [props.value, free, part]);\n   mutate(free, part);\n   return callback;\n }\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/useCallback-maybe-modify-free-variable-preserve-memoization-guarantee.js b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/useCallback-maybe-modify-free-variable-preserve-memoization-guarantee.js\nindex 662162e..e9d1152 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/useCallback-maybe-modify-free-variable-preserve-memoization-guarantee.js\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/useCallback-maybe-modify-free-variable-preserve-memoization-guarantee.js\n@@ -11,7 +11,7 @@ function Component(props) {\n     const x = makeObject_Primitives();\n     x.value = props.value;\n     mutate(x, free, part);\n-  }, [props.value]);\n+  }, [props.value, free, part]);\n   mutate(free, part);\n   return callback;\n }"}, {"role": "assistant", "content": "fix(compiler): validate exhaustive deps for stable and constant-folded"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n packages/compiler/src/expression_parser/ast.ts    | 12 +++++++++++-\n packages/compiler/src/expression_parser/parser.ts |  6 +++++-\n 2 files changed, 16 insertions(+), 2 deletions(-)\n\ndiff --git a/packages/compiler/src/expression_parser/ast.ts b/packages/compiler/src/expression_parser/ast.ts\nindex 099c4059..b351da84 100644\n--- a/packages/compiler/src/expression_parser/ast.ts\n+++ b/packages/compiler/src/expression_parser/ast.ts\n@@ -268,7 +268,17 @@ export class Interpolation extends AST {\n   }\n }\n \n-type AssignmentOperation = '=' | '+=' | '-=' | '*=' | '/=' | '%=' | '**=' | '&&=' | '||=' | '??=';\n+export type AssignmentOperation =\n+  | '='\n+  | '+='\n+  | '-='\n+  | '*='\n+  | '/='\n+  | '%='\n+  | '**='\n+  | '&&='\n+  | '||='\n+  | '??=';\n type BinaryOperation =\n   | AssignmentOperation\n   // Logical\ndiff --git a/packages/compiler/src/expression_parser/parser.ts b/packages/compiler/src/expression_parser/parser.ts\nindex a8e819e9..f8b404be 100644\n--- a/packages/compiler/src/expression_parser/parser.ts\n+++ b/packages/compiler/src/expression_parser/parser.ts\n@@ -56,6 +56,7 @@ import {\n   Unary,\n   VariableBinding,\n   VoidExpression,\n+  type AssignmentOperation,\n } from './ast';\n import {EOF, Lexer, StringTokenKind, Token, TokenType} from './lexer';\n export interface InterpolationPiece {\n@@ -730,7 +731,10 @@ class _ParseAST {\n     }\n   }\n \n-  private isAssignmentOperator(token: Token): boolean {\n+  private isAssignmentOperator(token: Token): token is Token & {\n+    type: typeof TokenType.Operator;\n+    strValue: AssignmentOperation;\n+  } {\n     return token.type === TokenType.Operator && Binary.isAssignmentOperation(token.strValue);\n   }\n "}, {"role": "assistant", "content": "refactor: `_ParseAST.isAssignmentOperator` to type guard"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 520554e..9bd794f 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -15,6 +15,7 @@ hide:\n \n ### Internal\n \n+* \ud83d\udc65 Update FastAPI People - Sponsors. PR [#14626](https://github.com/fastapi/fastapi/pull/14626) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc65 Update FastAPI GitHub topic repositories. PR [#14630](https://github.com/fastapi/fastapi/pull/14630) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc65 Update FastAPI People - Contributors and Translators. PR [#14625](https://github.com/fastapi/fastapi/pull/14625) by [@tiangolo](https://github.com/tiangolo).\n * \ud83c\udf10 Update translation prompts. PR [#14619](https://github.com/fastapi/fastapi/pull/14619) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: update release notes with sponsors"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/data/contributors.yml          |  29 ++++---\n docs/en/data/translation_reviewers.yml | 146 ++++++++++++++++++---------------\n docs/en/data/translators.yml           |  26 +++---\n 3 files changed, 108 insertions(+), 93 deletions(-)\n\ndiff --git a/docs/en/data/contributors.yml b/docs/en/data/contributors.yml\nindex 163dc68..0c144cd 100644\n--- a/docs/en/data/contributors.yml\n+++ b/docs/en/data/contributors.yml\n@@ -1,6 +1,6 @@\n tiangolo:\n   login: tiangolo\n-  count: 808\n+  count: 857\n   avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n   url: https://github.com/tiangolo\n dependabot:\n@@ -10,7 +10,7 @@ dependabot:\n   url: https://github.com/apps/dependabot\n alejsdev:\n   login: alejsdev\n-  count: 52\n+  count: 53\n   avatarUrl: https://avatars.githubusercontent.com/u/90076947?u=85ceac49fb87138aebe8d663912e359447329090&v=4\n   url: https://github.com/alejsdev\n pre-commit-ci:\n@@ -18,6 +18,11 @@ pre-commit-ci:\n   count: 50\n   avatarUrl: https://avatars.githubusercontent.com/in/68672?v=4\n   url: https://github.com/apps/pre-commit-ci\n+YuriiMotov:\n+  login: YuriiMotov\n+  count: 36\n+  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n+  url: https://github.com/YuriiMotov\n github-actions:\n   login: github-actions\n   count: 26\n@@ -28,26 +33,21 @@ Kludex:\n   count: 25\n   avatarUrl: https://avatars.githubusercontent.com/u/7353520?u=df8a3f06ba8f55ae1967a3e2d5ed882903a4e330&v=4\n   url: https://github.com/Kludex\n-YuriiMotov:\n-  login: YuriiMotov\n-  count: 20\n-  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n-  url: https://github.com/YuriiMotov\n dmontagu:\n   login: dmontagu\n   count: 17\n   avatarUrl: https://avatars.githubusercontent.com/u/35119617?u=540f30c937a6450812628b9592a1dfe91bbe148e&v=4\n   url: https://github.com/dmontagu\n+svlandeg:\n+  login: svlandeg\n+  count: 16\n+  avatarUrl: https://avatars.githubusercontent.com/u/8796347?u=556c97650c27021911b0b9447ec55e75987b0e8a&v=4\n+  url: https://github.com/svlandeg\n nilslindemann:\n   login: nilslindemann\n   count: 15\n   avatarUrl: https://avatars.githubusercontent.com/u/6892179?u=1dca6a22195d6cd1ab20737c0e19a4c55d639472&v=4\n   url: https://github.com/nilslindemann\n-svlandeg:\n-  login: svlandeg\n-  count: 14\n-  avatarUrl: https://avatars.githubusercontent.com/u/8796347?u=556c97650c27021911b0b9447ec55e75987b0e8a&v=4\n-  url: https://github.com/svlandeg\n euri10:\n   login: euri10\n   count: 13\n@@ -553,6 +553,11 @@ DanielKusyDev:\n   count: 2\n   avatarUrl: https://avatars.githubusercontent.com/u/36250676?u=2ea6114ff751fc48b55f231987a0e2582c6b1bd2&v=4\n   url: https://github.com/DanielKusyDev\n+Viicos:\n+  login: Viicos\n+  count: 2\n+  avatarUrl: https://avatars.githubusercontent.com/u/65306057?u=fcd677dc1b9bef12aa103613e5ccb3f8ce305af9&v=4\n+  url: https://github.com/Viicos\n DanielYang59:\n   login: DanielYang59\n   count: 2\ndiff --git a/docs/en/data/translation_reviewers.yml b/docs/en/data/translation_reviewers.yml\nindex c3d3d03..62db8e8 100644\n--- a/docs/en/data/translation_reviewers.yml\n+++ b/docs/en/data/translation_reviewers.yml\n@@ -15,7 +15,7 @@ sodaMelon:\n   url: https://github.com/sodaMelon\n ceb10n:\n   login: ceb10n\n-  count: 116\n+  count: 117\n   avatarUrl: https://avatars.githubusercontent.com/u/235213?u=edcce471814a1eba9f0cdaa4cd0de18921a940a6&v=4\n   url: https://github.com/ceb10n\n tokusumi:\n@@ -23,16 +23,16 @@ tokusumi:\n   count: 104\n   avatarUrl: https://avatars.githubusercontent.com/u/41147016?u=55010621aece725aa702270b54fed829b6a1fe60&v=4\n   url: https://github.com/tokusumi\n+hard-coders:\n+  login: hard-coders\n+  count: 96\n+  avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=78d12d1acdf853c817700145e73de7fd9e5d068b&v=4\n+  url: https://github.com/hard-coders\n hasansezertasan:\n   login: hasansezertasan\n   count: 95\n   avatarUrl: https://avatars.githubusercontent.com/u/13135006?u=99f0b0f0fc47e88e8abb337b4447357939ef93e7&v=4\n   url: https://github.com/hasansezertasan\n-hard-coders:\n-  login: hard-coders\n-  count: 93\n-  avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=95db33927bbff1ed1c07efddeb97ac2ff33068ed&v=4\n-  url: https://github.com/hard-coders\n alv2017:\n   login: alv2017\n   count: 88\n@@ -40,7 +40,7 @@ alv2017:\n   url: https://github.com/alv2017\n nazarepiedady:\n   login: nazarepiedady\n-  count: 86\n+  count: 87\n   avatarUrl: https://avatars.githubusercontent.com/u/31008635?u=f69ddc4ea8bda3bdfac7aa0e2ea38de282e6ee2d&v=4\n   url: https://github.com/nazarepiedady\n AlertRED:\n@@ -48,6 +48,11 @@ AlertRED:\n   count: 81\n   avatarUrl: https://avatars.githubusercontent.com/u/15695000?u=f5a4944c6df443030409c88da7d7fa0b7ead985c&v=4\n   url: https://github.com/AlertRED\n+tiangolo:\n+  login: tiangolo\n+  count: 73\n+  avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n+  url: https://github.com/tiangolo\n Alexandrhub:\n   login: Alexandrhub\n   count: 68\n@@ -63,21 +68,16 @@ cassiobotaro:\n   count: 62\n   avatarUrl: https://avatars.githubusercontent.com/u/3127847?u=a08022b191ddbd0a6159b2981d9d878b6d5bb71f&v=4\n   url: https://github.com/cassiobotaro\n+mattwang44:\n+  login: mattwang44\n+  count: 61\n+  avatarUrl: https://avatars.githubusercontent.com/u/24987826?u=58e37fb3927b9124b458945ac4c97aa0f1062d85&v=4\n+  url: https://github.com/mattwang44\n nilslindemann:\n   login: nilslindemann\n   count: 59\n   avatarUrl: https://avatars.githubusercontent.com/u/6892179?u=1dca6a22195d6cd1ab20737c0e19a4c55d639472&v=4\n   url: https://github.com/nilslindemann\n-mattwang44:\n-  login: mattwang44\n-  count: 59\n-  avatarUrl: https://avatars.githubusercontent.com/u/24987826?u=58e37fb3927b9124b458945ac4c97aa0f1062d85&v=4\n-  url: https://github.com/mattwang44\n-tiangolo:\n-  login: tiangolo\n-  count: 56\n-  avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n-  url: https://github.com/tiangolo\n Laineyzhang55:\n   login: Laineyzhang55\n   count: 48\n@@ -88,6 +88,11 @@ Kludex:\n   count: 47\n   avatarUrl: https://avatars.githubusercontent.com/u/7353520?u=df8a3f06ba8f55ae1967a3e2d5ed882903a4e330&v=4\n   url: https://github.com/Kludex\n+YuriiMotov:\n+  login: YuriiMotov\n+  count: 46\n+  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n+  url: https://github.com/YuriiMotov\n komtaki:\n   login: komtaki\n   count: 45\n@@ -118,11 +123,6 @@ Winand:\n   count: 40\n   avatarUrl: https://avatars.githubusercontent.com/u/53390?u=bb0e71a2fc3910a8e0ee66da67c33de40ea695f8&v=4\n   url: https://github.com/Winand\n-YuriiMotov:\n-  login: YuriiMotov\n-  count: 40\n-  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n-  url: https://github.com/YuriiMotov\n solomein-sv:\n   login: solomein-sv\n   count: 38\n@@ -138,6 +138,11 @@ alejsdev:\n   count: 37\n   avatarUrl: https://avatars.githubusercontent.com/u/90076947?u=85ceac49fb87138aebe8d663912e359447329090&v=4\n   url: https://github.com/alejsdev\n+mezgoodle:\n+  login: mezgoodle\n+  count: 37\n+  avatarUrl: https://avatars.githubusercontent.com/u/41520940?u=4a9c765af688389d54296845d18b8f6cd6ddf09a&v=4\n+  url: https://github.com/mezgoodle\n stlucasgarcia:\n   login: stlucasgarcia\n   count: 36\n@@ -153,11 +158,6 @@ timothy-jeong:\n   count: 36\n   avatarUrl: https://avatars.githubusercontent.com/u/53824764?u=db3d0cea2f5fab64d810113c5039a369699a2774&v=4\n   url: https://github.com/timothy-jeong\n-mezgoodle:\n-  login: mezgoodle\n-  count: 35\n-  avatarUrl: https://avatars.githubusercontent.com/u/41520940?u=4a9c765af688389d54296845d18b8f6cd6ddf09a&v=4\n-  url: https://github.com/mezgoodle\n rjNemo:\n   login: rjNemo\n   count: 34\n@@ -173,6 +173,11 @@ akarev0:\n   count: 33\n   avatarUrl: https://avatars.githubusercontent.com/u/53393089?u=6e528bb4789d56af887ce6fe237bea4010885406&v=4\n   url: https://github.com/akarev0\n+Vincy1230:\n+  login: Vincy1230\n+  count: 33\n+  avatarUrl: https://avatars.githubusercontent.com/u/81342412?u=ab5e256a4077a4a91f3f9cd2115ba80780454cbe&v=4\n+  url: https://github.com/Vincy1230\n romashevchenko:\n   login: romashevchenko\n   count: 32\n@@ -183,11 +188,6 @@ LorhanSohaky:\n   count: 30\n   avatarUrl: https://avatars.githubusercontent.com/u/16273730?u=095b66f243a2cd6a0aadba9a095009f8aaf18393&v=4\n   url: https://github.com/LorhanSohaky\n-Vincy1230:\n-  login: Vincy1230\n-  count: 30\n-  avatarUrl: https://avatars.githubusercontent.com/u/81342412?u=ab5e256a4077a4a91f3f9cd2115ba80780454cbe&v=4\n-  url: https://github.com/Vincy1230\n black-redoc:\n   login: black-redoc\n   count: 29\n@@ -250,7 +250,7 @@ mycaule:\n   url: https://github.com/mycaule\n Aruelius:\n   login: Aruelius\n-  count: 24\n+  count: 25\n   avatarUrl: https://avatars.githubusercontent.com/u/25380989?u=574f8cfcda3ea77a3f81884f6b26a97068e36a9d&v=4\n   url: https://github.com/Aruelius\n wisderfin:\n@@ -263,6 +263,11 @@ OzgunCaglarArslan:\n   count: 24\n   avatarUrl: https://avatars.githubusercontent.com/u/86166426?v=4\n   url: https://github.com/OzgunCaglarArslan\n+ycd:\n+  login: ycd\n+  count: 23\n+  avatarUrl: https://avatars.githubusercontent.com/u/62724709?u=f1e7bae394a315da950912c92dc861a8eaf95d4c&v=4\n+  url: https://github.com/ycd\n sh0nk:\n   login: sh0nk\n   count: 23\n@@ -288,11 +293,6 @@ Attsun1031:\n   count: 20\n   avatarUrl: https://avatars.githubusercontent.com/u/1175560?v=4\n   url: https://github.com/Attsun1031\n-ycd:\n-  login: ycd\n-  count: 20\n-  avatarUrl: https://avatars.githubusercontent.com/u/62724709?u=f1e7bae394a315da950912c92dc861a8eaf95d4c&v=4\n-  url: https://github.com/ycd\n delhi09:\n   login: delhi09\n   count: 20\n@@ -418,6 +418,11 @@ mattkoehne:\n   count: 14\n   avatarUrl: https://avatars.githubusercontent.com/u/80362153?v=4\n   url: https://github.com/mattkoehne\n+maru0123-2004:\n+  login: maru0123-2004\n+  count: 14\n+  avatarUrl: https://avatars.githubusercontent.com/u/43961566?u=16ed8603a4d6a4665cb6c53a7aece6f31379b769&v=4\n+  url: https://github.com/maru0123-2004\n jovicon:\n   login: jovicon\n   count: 13\n@@ -443,6 +448,11 @@ impocode:\n   count: 13\n   avatarUrl: https://avatars.githubusercontent.com/u/109408819?u=9cdfc5ccb31a2094c520f41b6087012fa9048982&v=4\n   url: https://github.com/impocode\n+waketzheng:\n+  login: waketzheng\n+  count: 13\n+  avatarUrl: https://avatars.githubusercontent.com/u/35413830?u=df19e4fd5bb928e7d086e053ef26a46aad23bf84&v=4\n+  url: https://github.com/waketzheng\n wesinalves:\n   login: wesinalves\n   count: 13\n@@ -538,21 +548,16 @@ Lufa1u:\n   count: 11\n   avatarUrl: https://avatars.githubusercontent.com/u/112495876?u=087658920ed9e74311597bdd921d8d2de939d276&v=4\n   url: https://github.com/Lufa1u\n-waketzheng:\n-  login: waketzheng\n-  count: 11\n-  avatarUrl: https://avatars.githubusercontent.com/u/35413830?u=df19e4fd5bb928e7d086e053ef26a46aad23bf84&v=4\n-  url: https://github.com/waketzheng\n KNChiu:\n   login: KNChiu\n   count: 11\n   avatarUrl: https://avatars.githubusercontent.com/u/36751646?v=4\n   url: https://github.com/KNChiu\n-maru0123-2004:\n-  login: maru0123-2004\n+Zhongheng-Cheng:\n+  login: Zhongheng-Cheng\n   count: 11\n-  avatarUrl: https://avatars.githubusercontent.com/u/43961566?u=16ed8603a4d6a4665cb6c53a7aece6f31379b769&v=4\n-  url: https://github.com/maru0123-2004\n+  avatarUrl: https://avatars.githubusercontent.com/u/95612344?u=a0f7730a3cc7486827965e01a119ad610bda4b0a&v=4\n+  url: https://github.com/Zhongheng-Cheng\n mariacamilagl:\n   login: mariacamilagl\n   count: 10\n@@ -608,16 +613,16 @@ nick-cjyx9:\n   count: 10\n   avatarUrl: https://avatars.githubusercontent.com/u/119087246?u=7227a2de948c68fb8396d5beff1ee5b0e057c42e&v=4\n   url: https://github.com/nick-cjyx9\n+marcelomarkus:\n+  login: marcelomarkus\n+  count: 10\n+  avatarUrl: https://avatars.githubusercontent.com/u/20115018?u=dda090ce9160ef0cd2ff69b1e5ea741283425cba&v=4\n+  url: https://github.com/marcelomarkus\n lucasbalieiro:\n   login: lucasbalieiro\n   count: 10\n-  avatarUrl: https://avatars.githubusercontent.com/u/37416577?u=dad91601ee4f40458d691774ec439aff308344d7&v=4\n+  avatarUrl: https://avatars.githubusercontent.com/u/37416577?u=d144221c34c08adac8b20e1833d776ffa1c4b1d0&v=4\n   url: https://github.com/lucasbalieiro\n-Zhongheng-Cheng:\n-  login: Zhongheng-Cheng\n-  count: 10\n-  avatarUrl: https://avatars.githubusercontent.com/u/95612344?u=a0f7730a3cc7486827965e01a119ad610bda4b0a&v=4\n-  url: https://github.com/Zhongheng-Cheng\n RunningIkkyu:\n   login: RunningIkkyu\n   count: 9\n@@ -668,11 +673,6 @@ yodai-yodai:\n   count: 9\n   avatarUrl: https://avatars.githubusercontent.com/u/7031039?u=4f3593f5931892b931a745cfab846eff6e9332e7&v=4\n   url: https://github.com/yodai-yodai\n-marcelomarkus:\n-  login: marcelomarkus\n-  count: 9\n-  avatarUrl: https://avatars.githubusercontent.com/u/20115018?u=dda090ce9160ef0cd2ff69b1e5ea741283425cba&v=4\n-  url: https://github.com/marcelomarkus\n JoaoGustavoRogel:\n   login: JoaoGustavoRogel\n   count: 9\n@@ -683,6 +683,11 @@ Yarous:\n   count: 9\n   avatarUrl: https://avatars.githubusercontent.com/u/61277193?u=5b462347458a373b2d599c6f416d2b75eddbffad&v=4\n   url: https://github.com/Yarous\n+Pyth3rEx:\n+  login: Pyth3rEx\n+  count: 9\n+  avatarUrl: https://avatars.githubusercontent.com/u/26427764?u=087724f74d813c95925d51e354554bd4b6d6bb60&v=4\n+  url: https://github.com/Pyth3rEx\n dimaqq:\n   login: dimaqq\n   count: 8\n@@ -1023,6 +1028,11 @@ devluisrodrigues:\n   count: 5\n   avatarUrl: https://avatars.githubusercontent.com/u/21125286?v=4\n   url: https://github.com/11kkw\n+EdmilsonRodrigues:\n+  login: EdmilsonRodrigues\n+  count: 5\n+  avatarUrl: https://avatars.githubusercontent.com/u/62777025?u=217d6f3cd6cc750bb8818a3af7726c8d74eb7c2d&v=4\n+  url: https://github.com/EdmilsonRodrigues\n lpdswing:\n   login: lpdswing\n   count: 4\n@@ -1163,6 +1173,11 @@ AbolfazlKameli:\n   count: 4\n   avatarUrl: https://avatars.githubusercontent.com/u/120686133?u=af8f025278cce0d489007071254e4055df60b78c&v=4\n   url: https://github.com/AbolfazlKameli\n+SBillion:\n+  login: SBillion\n+  count: 4\n+  avatarUrl: https://avatars.githubusercontent.com/u/1070649?u=3ab493dfc88b39da0eb1600e3b8e7df1c90a5dee&v=4\n+  url: https://github.com/SBillion\n tyronedamasceno:\n   login: tyronedamasceno\n   count: 3\n@@ -1211,7 +1226,7 @@ phamquanganh31101998:\n peebbv6364:\n   login: peebbv6364\n   count: 3\n-  avatarUrl: https://avatars.githubusercontent.com/u/26784747?u=75583df215ee01a5cd2dc646aecb81e7dbd33d06&v=4\n+  avatarUrl: https://avatars.githubusercontent.com/u/26784747?u=3bf07017eb4f4fa3639ba8d4ed19980a34bf8f90&v=4\n   url: https://github.com/peebbv6364\n mrparalon:\n   login: mrparalon\n@@ -1413,11 +1428,6 @@ Mohammad222PR:\n   count: 3\n   avatarUrl: https://avatars.githubusercontent.com/u/116789737?u=25810a5fe049d2f1618e2e7417cea011cc353ce4&v=4\n   url: https://github.com/Mohammad222PR\n-EdmilsonRodrigues:\n-  login: EdmilsonRodrigues\n-  count: 3\n-  avatarUrl: https://avatars.githubusercontent.com/u/62777025?u=217d6f3cd6cc750bb8818a3af7726c8d74eb7c2d&v=4\n-  url: https://github.com/EdmilsonRodrigues\n blaisep:\n   login: blaisep\n   count: 2\n@@ -1838,11 +1848,11 @@ NavesSapnis:\n   count: 2\n   avatarUrl: https://avatars.githubusercontent.com/u/79222417?u=b5b10291b8e9130ca84fd20f0a641e04ed94b6b1&v=4\n   url: https://github.com/NavesSapnis\n-eqsdxr:\n-  login: eqsdxr\n+isgin01:\n+  login: isgin01\n   count: 2\n-  avatarUrl: https://avatars.githubusercontent.com/u/157279130?u=7927dc0366995334f9a18c3204a41d3a34d6d96f&v=4\n-  url: https://github.com/eqsdxr\n+  avatarUrl: https://avatars.githubusercontent.com/u/157279130?u=ddffde10876b50f35dc90d1337f507a630530a6a&v=4\n+  url: https://github.com/isgin01\n syedasamina56:\n   login: syedasamina56\n   count: 2\ndiff --git a/docs/en/data/translators.yml b/docs/en/data/translators.yml\nindex c66eff4..940b128 100644\n--- a/docs/en/data/translators.yml\n+++ b/docs/en/data/translators.yml\n@@ -1,6 +1,6 @@\n nilslindemann:\n   login: nilslindemann\n-  count: 125\n+  count: 130\n   avatarUrl: https://avatars.githubusercontent.com/u/6892179?u=1dca6a22195d6cd1ab20737c0e19a4c55d639472&v=4\n   url: https://github.com/nilslindemann\n jaystone776:\n@@ -28,6 +28,11 @@ SwftAlpc:\n   count: 23\n   avatarUrl: https://avatars.githubusercontent.com/u/52768429?u=6a3aa15277406520ad37f6236e89466ed44bc5b8&v=4\n   url: https://github.com/SwftAlpc\n+tiangolo:\n+  login: tiangolo\n+  count: 22\n+  avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n+  url: https://github.com/tiangolo\n hasansezertasan:\n   login: hasansezertasan\n   count: 22\n@@ -46,7 +51,7 @@ AlertRED:\n hard-coders:\n   login: hard-coders\n   count: 15\n-  avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=95db33927bbff1ed1c07efddeb97ac2ff33068ed&v=4\n+  avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=78d12d1acdf853c817700145e73de7fd9e5d068b&v=4\n   url: https://github.com/hard-coders\n Joao-Pedro-P-Holanda:\n   login: Joao-Pedro-P-Holanda\n@@ -103,11 +108,6 @@ pablocm83:\n   count: 8\n   avatarUrl: https://avatars.githubusercontent.com/u/28315068?u=3310fbb05bb8bfc50d2c48b6cb64ac9ee4a14549&v=4\n   url: https://github.com/pablocm83\n-tiangolo:\n-  login: tiangolo\n-  count: 7\n-  avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n-  url: https://github.com/tiangolo\n ptt3199:\n   login: ptt3199\n   count: 7\n@@ -126,13 +126,18 @@ batlopes:\n lucasbalieiro:\n   login: lucasbalieiro\n   count: 6\n-  avatarUrl: https://avatars.githubusercontent.com/u/37416577?u=dad91601ee4f40458d691774ec439aff308344d7&v=4\n+  avatarUrl: https://avatars.githubusercontent.com/u/37416577?u=d144221c34c08adac8b20e1833d776ffa1c4b1d0&v=4\n   url: https://github.com/lucasbalieiro\n Alexandrhub:\n   login: Alexandrhub\n   count: 6\n   avatarUrl: https://avatars.githubusercontent.com/u/119126536?u=9fc0d48f3307817bafecc5861eb2168401a6cb04&v=4\n   url: https://github.com/Alexandrhub\n+YuriiMotov:\n+  login: YuriiMotov\n+  count: 6\n+  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n+  url: https://github.com/YuriiMotov\n Serrones:\n   login: Serrones\n   count: 5\n@@ -358,11 +363,6 @@ ruzia:\n   count: 3\n   avatarUrl: https://avatars.githubusercontent.com/u/24503?v=4\n   url: https://github.com/ruzia\n-YuriiMotov:\n-  login: YuriiMotov\n-  count: 3\n-  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n-  url: https://github.com/YuriiMotov\n izaguerreiro:\n   login: izaguerreiro\n   count: 2"}, {"role": "assistant", "content": "docs: update contributor and translator statistics"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .bazelversion     | 2 +-\n MODULE.bazel.lock | 4 ++--\n 2 files changed, 3 insertions(+), 3 deletions(-)\n\ndiff --git a/.bazelversion b/.bazelversion\nindex 6d289079..f9c71a52 100644\n--- a/.bazelversion\n+++ b/.bazelversion\n@@ -1 +1 @@\n-8.5.0\n+8.5.1\ndiff --git a/MODULE.bazel.lock b/MODULE.bazel.lock\nindex 6dec6aa9..963c800f 100644\n--- a/MODULE.bazel.lock\n+++ b/MODULE.bazel.lock\n@@ -412,7 +412,7 @@\n     },\n     \"@@aspect_rules_js+//npm:extensions.bzl%pnpm\": {\n       \"general\": {\n-        \"bzlTransitiveDigest\": \"zVV86HvMwDBJ8IsFt27k/Sjq0vCMPr8b8X9OAuprQ6w=\",\n+        \"bzlTransitiveDigest\": \"VaGKuK2sKVTWlq9QBZfNc4fhigCeN9Wt4YhnhdGUkv8=\",\n         \"usagesDigest\": \"V3eYj3dhR+UR/L7u17ZGfCuqJZpobNrN/6oEZPkZgDc=\",\n         \"recordedFileInputs\": {},\n         \"recordedDirentsInputs\": {},\n@@ -1508,7 +1508,7 @@\n     },\n     \"@@rules_python+//python/extensions:pip.bzl%pip\": {\n       \"general\": {\n-        \"bzlTransitiveDigest\": \"39J6fxZx6VyebAMZs6LDsQSGw91SROMECqQx77bSJqE=\",\n+        \"bzlTransitiveDigest\": \"rPZpN8uoLnuu3B+LRiijfMadoMlO1/dxOO8/emPCZV4=\",\n         \"usagesDigest\": \"/9NP3RV6/DWuNdYAsIU/8UCgCX0TdPUJr0X6O+0lrtk=\",\n         \"recordedFileInputs\": {\n           \"@@protobuf+//python/requirements.txt\": \"983be60d3cec4b319dcab6d48aeb3f5b2f7c3350f26b3a9e97486c37967c73c5\","}, {"role": "assistant", "content": "build: update dependency bazel to v8.5.1"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/net/rpc/server.go | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/net/rpc/server.go b/src/net/rpc/server.go\nindex 4233a426..961145c6 100644\n--- a/src/net/rpc/server.go\n+++ b/src/net/rpc/server.go\n@@ -202,7 +202,7 @@ func NewServer() *Server {\n // DefaultServer is the default instance of [*Server].\n var DefaultServer = NewServer()\n \n-// Is this type exported or a builtin?\n+// isExportedOrBuiltinType reports whether t is an exported or builtin type\n func isExportedOrBuiltinType(t reflect.Type) bool {\n \tfor t.Kind() == reflect.Pointer {\n \t\tt = t.Elem()"}, {"role": "assistant", "content": "docs: improve isExportedOrBuiltinType comment"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/compile/internal/ssa/rewrite.go |  2 +-\n src/cmd/compile/internal/ssagen/ssa.go  |  2 +-\n src/runtime/_mkmalloc/mkmalloc.go       |  2 +-\n src/runtime/malloc_generated.go         | 30 +++++++++++++++---------------\n src/runtime/malloc_tables_generated.go  | 30 +++++++++++++++---------------\n test/codegen/strings.go                 |  2 +-\n test/live.go                            |  4 ++--\n test/live_regabi.go                     |  4 ++--\n 8 files changed, 38 insertions(+), 38 deletions(-)\n\ndiff --git a/src/cmd/compile/internal/ssa/rewrite.go b/src/cmd/compile/internal/ssa/rewrite.go\nindex af2568ae..032915f7 100644\n--- a/src/cmd/compile/internal/ssa/rewrite.go\n+++ b/src/cmd/compile/internal/ssa/rewrite.go\n@@ -480,7 +480,7 @@ func isSpecializedMalloc(aux Aux) bool {\n \tname := fn.String()\n \treturn strings.HasPrefix(name, \"runtime.mallocgcSmallNoScanSC\") ||\n \t\tstrings.HasPrefix(name, \"runtime.mallocgcSmallScanNoHeaderSC\") ||\n-\t\tstrings.HasPrefix(name, \"runtime.mallocTiny\")\n+\t\tstrings.HasPrefix(name, \"runtime.mallocgcTinySize\")\n }\n \n // canLoadUnaligned reports if the architecture supports unaligned load operations.\ndiff --git a/src/cmd/compile/internal/ssagen/ssa.go b/src/cmd/compile/internal/ssagen/ssa.go\nindex dd5baa0e..17feb90d 100644\n--- a/src/cmd/compile/internal/ssagen/ssa.go\n+++ b/src/cmd/compile/internal/ssagen/ssa.go\n@@ -140,7 +140,7 @@ func InitConfig() {\n \t\tir.Syms.MallocGCSmallScanNoHeader[i] = typecheck.LookupRuntimeFunc(fmt.Sprintf(\"mallocgcSmallScanNoHeaderSC%d\", i))\n \t}\n \tfor i := 1; i < len(ir.Syms.MallocGCTiny); i++ {\n-\t\tir.Syms.MallocGCTiny[i] = typecheck.LookupRuntimeFunc(fmt.Sprintf(\"mallocTiny%d\", i))\n+\t\tir.Syms.MallocGCTiny[i] = typecheck.LookupRuntimeFunc(fmt.Sprintf(\"mallocgcTinySize%d\", i))\n \t}\n \tir.Syms.MallocGC = typecheck.LookupRuntimeFunc(\"mallocgc\")\n \tir.Syms.Memmove = typecheck.LookupRuntimeFunc(\"memmove\")\ndiff --git a/src/runtime/_mkmalloc/mkmalloc.go b/src/runtime/_mkmalloc/mkmalloc.go\nindex 434eaad7..450608a7 100644\n--- a/src/runtime/_mkmalloc/mkmalloc.go\n+++ b/src/runtime/_mkmalloc/mkmalloc.go\n@@ -130,7 +130,7 @@ func tinyFuncName(size uintptr) string {\n \tif size == 0 || size > smallScanNoHeaderMax {\n \t\treturn \"mallocPanic\"\n \t}\n-\treturn fmt.Sprintf(\"mallocTiny%d\", size)\n+\treturn fmt.Sprintf(\"mallocgcTinySize%d\", size)\n }\n \n func smallNoScanSCFuncName(sc, scMax uint8) string {\ndiff --git a/src/runtime/malloc_generated.go b/src/runtime/malloc_generated.go\nindex 2be6a5b6..8d711264 100644\n--- a/src/runtime/malloc_generated.go\n+++ b/src/runtime/malloc_generated.go\n@@ -4300,7 +4300,7 @@ func mallocgcSmallScanNoHeaderSC26(size uintptr, typ *_type, needzero bool) unsa\n \treturn x\n }\n \n-func mallocTiny1(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize1(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -4456,7 +4456,7 @@ func mallocTiny1(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny2(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize2(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -4612,7 +4612,7 @@ func mallocTiny2(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny3(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize3(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -4768,7 +4768,7 @@ func mallocTiny3(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny4(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize4(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -4924,7 +4924,7 @@ func mallocTiny4(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny5(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize5(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -5080,7 +5080,7 @@ func mallocTiny5(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny6(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize6(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -5236,7 +5236,7 @@ func mallocTiny6(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny7(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize7(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -5392,7 +5392,7 @@ func mallocTiny7(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny8(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize8(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -5548,7 +5548,7 @@ func mallocTiny8(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny9(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize9(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -5704,7 +5704,7 @@ func mallocTiny9(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny10(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize10(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -5860,7 +5860,7 @@ func mallocTiny10(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny11(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize11(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -6016,7 +6016,7 @@ func mallocTiny11(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny12(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize12(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -6172,7 +6172,7 @@ func mallocTiny12(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny13(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize13(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -6328,7 +6328,7 @@ func mallocTiny13(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny14(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize14(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\n@@ -6484,7 +6484,7 @@ func mallocTiny14(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \treturn x\n }\n \n-func mallocTiny15(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n+func mallocgcTinySize15(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n \n \tgp := getg()\n \tif goexperiment.RuntimeSecret && gp.secret > 0 {\ndiff --git a/src/runtime/malloc_tables_generated.go b/src/runtime/malloc_tables_generated.go\nindex 36650881..b1ddde2a 100644\n--- a/src/runtime/malloc_tables_generated.go\n+++ b/src/runtime/malloc_tables_generated.go\n@@ -523,21 +523,21 @@ var mallocScanTable = [513]func(size uintptr, typ *_type, needzero bool) unsafe.\n \n var mallocNoScanTable = [513]func(size uintptr, typ *_type, needzero bool) unsafe.Pointer{\n \tmallocPanic,\n-\tmallocTiny1,\n-\tmallocTiny2,\n-\tmallocTiny3,\n-\tmallocTiny4,\n-\tmallocTiny5,\n-\tmallocTiny6,\n-\tmallocTiny7,\n-\tmallocTiny8,\n-\tmallocTiny9,\n-\tmallocTiny10,\n-\tmallocTiny11,\n-\tmallocTiny12,\n-\tmallocTiny13,\n-\tmallocTiny14,\n-\tmallocTiny15,\n+\tmallocgcTinySize1,\n+\tmallocgcTinySize2,\n+\tmallocgcTinySize3,\n+\tmallocgcTinySize4,\n+\tmallocgcTinySize5,\n+\tmallocgcTinySize6,\n+\tmallocgcTinySize7,\n+\tmallocgcTinySize8,\n+\tmallocgcTinySize9,\n+\tmallocgcTinySize10,\n+\tmallocgcTinySize11,\n+\tmallocgcTinySize12,\n+\tmallocgcTinySize13,\n+\tmallocgcTinySize14,\n+\tmallocgcTinySize15,\n \tmallocgcSmallNoScanSC2,\n \tmallocgcSmallNoScanSC3,\n \tmallocgcSmallNoScanSC3,\ndiff --git a/test/codegen/strings.go b/test/codegen/strings.go\nindex 0c5ee2f8..1c140211 100644\n--- a/test/codegen/strings.go\n+++ b/test/codegen/strings.go\n@@ -23,7 +23,7 @@ func CountBytes(s []byte) int {\n \n func ToByteSlice() []byte { // Issue #24698\n \t// amd64:`LEAQ type:\\[3\\]uint8`\n-\t// amd64:`CALL runtime\\.(newobject|mallocTiny3)`\n+\t// amd64:`CALL runtime\\.(newobject|mallocgcTinySize3)`\n \t// amd64:-`.*runtime.stringtoslicebyte`\n \treturn []byte(\"foo\")\n }\ndiff --git a/test/live.go b/test/live.go\nindex f8ad8df1..6561b209 100644\n--- a/test/live.go\n+++ b/test/live.go\n@@ -665,14 +665,14 @@ func f39a() (x []int) {\n \n func f39b() (x [10]*int) {\n \tx = [10]*int{}\n-\tx[0] = new(int) // ERROR \"live at call to (newobject|mallocTiny[48]): x$\"\n+\tx[0] = new(int) // ERROR \"live at call to (newobject|mallocgcTinySize[48]): x$\"\n \tprintnl()       // ERROR \"live at call to printnl: x$\"\n \treturn x\n }\n \n func f39c() (x [10]*int) {\n \tx = [10]*int{}\n-\tx[0] = new(int) // ERROR \"live at call to (newobject|mallocTiny[48]): x$\"\n+\tx[0] = new(int) // ERROR \"live at call to (newobject|mallocgcTinySize[48]): x$\"\n \tprintnl()       // ERROR \"live at call to printnl: x$\"\n \treturn\n }\ndiff --git a/test/live_regabi.go b/test/live_regabi.go\nindex 9809353f..75b842d7 100644\n--- a/test/live_regabi.go\n+++ b/test/live_regabi.go\n@@ -663,14 +663,14 @@ func f39a() (x []int) {\n \n func f39b() (x [10]*int) {\n \tx = [10]*int{}\n-\tx[0] = new(int) // ERROR \"live at call to (newobject|mallocTiny[48]): x$\"\n+\tx[0] = new(int) // ERROR \"live at call to (newobject|mallocgcTinySize[48]): x$\"\n \tprintnl()       // ERROR \"live at call to printnl: x$\"\n \treturn x\n }\n \n func f39c() (x [10]*int) {\n \tx = [10]*int{}\n-\tx[0] = new(int) // ERROR \"live at call to (newobject|mallocTiny[48]): x$\"\n+\tx[0] = new(int) // ERROR \"live at call to (newobject|mallocgcTinySize[48]): x$\"\n \tprintnl()       // ERROR \"live at call to printnl: x$\"\n \treturn\n }"}, {"role": "assistant", "content": "refactor(runtime): rename mallocTiny to mallocgcTinySize"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/client/ReactDOMComponent.js                | 77 ++++++++++++++++++++--\n 1 file changed, 71 insertions(+), 6 deletions(-)\n\ndiff --git a/packages/react-dom-bindings/src/client/ReactDOMComponent.js b/packages/react-dom-bindings/src/client/ReactDOMComponent.js\nindex 549b279..1b25e37 100644\n--- a/packages/react-dom-bindings/src/client/ReactDOMComponent.js\n+++ b/packages/react-dom-bindings/src/client/ReactDOMComponent.js\n@@ -235,6 +235,31 @@ function warnForPropDifference(\n   }\n }\n \n+function hasViewTransition(htmlElement: HTMLElement): boolean {\n+  return !!(\n+    htmlElement.getAttribute('vt-share') ||\n+    htmlElement.getAttribute('vt-exit') ||\n+    htmlElement.getAttribute('vt-enter') ||\n+    htmlElement.getAttribute('vt-update')\n+  );\n+}\n+\n+function isExpectedViewTransitionName(htmlElement: HTMLElement): boolean {\n+  if (!hasViewTransition(htmlElement)) {\n+    // We didn't expect to see a view transition name applied.\n+    return false;\n+  }\n+  const expectedVtName = htmlElement.getAttribute('vt-name');\n+  const actualVtName: string = (htmlElement.style: any)['view-transition-name'];\n+  if (expectedVtName) {\n+    return expectedVtName === actualVtName;\n+  } else {\n+    // Auto-generated name.\n+    // TODO: If Fizz starts applying a prefix to this name, we need to consider that.\n+    return actualVtName.startsWith('_T_');\n+  }\n+}\n+\n function warnForExtraAttributes(\n   domElement: Element,\n   attributeNames: Set<string>,\n@@ -242,10 +267,28 @@ function warnForExtraAttributes(\n ) {\n   if (__DEV__) {\n     attributeNames.forEach(function (attributeName) {\n-      serverDifferences[getPropNameFromAttributeName(attributeName)] =\n-        attributeName === 'style'\n-          ? getStylesObjectFromElement(domElement)\n-          : domElement.getAttribute(attributeName);\n+      if (attributeName === 'style') {\n+        if (domElement.getAttribute(attributeName) === '') {\n+          // Skip empty style. It's fine.\n+          return;\n+        }\n+        const htmlElement = ((domElement: any): HTMLElement);\n+        const style = htmlElement.style;\n+        const isOnlyVTStyles =\n+          (style.length === 1 && style[0] === 'view-transition-name') ||\n+          (style.length === 2 &&\n+            style[0] === 'view-transition-class' &&\n+            style[1] === 'view-transition-name');\n+        if (isOnlyVTStyles && isExpectedViewTransitionName(htmlElement)) {\n+          // If the only extra style was the view-transition-name that we applied from the Fizz\n+          // runtime, then we should ignore it.\n+        } else {\n+          serverDifferences.style = getStylesObjectFromElement(domElement);\n+        }\n+      } else {\n+        serverDifferences[getPropNameFromAttributeName(attributeName)] =\n+          domElement.getAttribute(attributeName);\n+      }\n     });\n   }\n }\n@@ -1977,13 +2020,21 @@ function getStylesObjectFromElement(domElement: Element): {\n   [styleName: string]: string,\n } {\n   const serverValueInObjectForm: {[prop: string]: string} = {};\n-  const style = ((domElement: any): HTMLElement).style;\n+  const htmlElement: HTMLElement = (domElement: any);\n+  const style = htmlElement.style;\n   for (let i = 0; i < style.length; i++) {\n     const styleName: string = style[i];\n     // TODO: We should use the original prop value here if it is equivalent.\n     // TODO: We could use the original client capitalization if the equivalent\n     // other capitalization exists in the DOM.\n-    serverValueInObjectForm[styleName] = style.getPropertyValue(styleName);\n+    if (\n+      styleName === 'view-transition-name' &&\n+      isExpectedViewTransitionName(htmlElement)\n+    ) {\n+      // This is a view transition name added by the Fizz runtime, not the user's props.\n+    } else {\n+      serverValueInObjectForm[styleName] = style.getPropertyValue(styleName);\n+    }\n   }\n   return serverValueInObjectForm;\n }\n@@ -2018,6 +2069,20 @@ function diffHydratedStyles(\n     return;\n   }\n \n+  if (\n+    // Trailing semi-colon means this was regenerated.\n+    normalizedServerValue[normalizedServerValue.length - 1] === ';' &&\n+    // TODO: Should we just ignore any style if the style as been manipulated?\n+    hasViewTransition((domElement: any))\n+  ) {\n+    // If this had a view transition we might have applied a view transition\n+    // name/class and removed it. If that happens, the style attribute gets\n+    // regenerated from the style object. This means we've lost the format\n+    // that we sent from the server and is unable to diff it. We just treat\n+    // it as passing even if it should be a mismatch in this edge case.\n+    return;\n+  }\n+\n   // Otherwise, we create the object from the DOM for the diff view.\n   serverDifferences.style = getStylesObjectFromElement(domElement);\n }"}, {"role": "assistant", "content": "fix(react-dom): ignore view transition styles in hydration diff"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../signals-view/signals-visualizer/BUILD.bazel         |  2 +-\n .../signals-visualizer/signals-visualizer.ts            | 16 +++++++---------\n .../{dagre-d3-types.ts => visualizer-types.ts}          | 17 +++++------------\n 3 files changed, 13 insertions(+), 22 deletions(-)\n\ndiff --git a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/BUILD.bazel b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/BUILD.bazel\nindex b12c11a5..9ddfd7f7 100644\n--- a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/BUILD.bazel\n+++ b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/BUILD.bazel\n@@ -13,9 +13,9 @@ sass_binary(\n ng_project(\n     name = \"signals-visualizer\",\n     srcs = [\n-        \"dagre-d3-types.ts\",\n         \"signals-visualizer.component.ts\",\n         \"signals-visualizer.ts\",\n+        \"visualizer-types.ts\",\n     ],\n     angular_assets = [\n         \"signals-visualizer.component.html\",\ndiff --git a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.ts b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.ts\nindex a430c667..114d1abd 100644\n--- a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.ts\n+++ b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/signals-visualizer.ts\n@@ -17,7 +17,7 @@ import {\n   DevtoolsSignalNode,\n } from '../../signal-graph';\n import {DebugSignalGraphNode} from '../../../../../../../protocol';\n-import type {DagreGraph, DagreGraphCluster, DagreGraphNode} from './dagre-d3-types';\n+import type {DagreCluster, DagreEdge, DagreNode, DagreRegularNode} from './visualizer-types';\n \n const KIND_CLASS_MAP: {[key in DebugSignalGraphNode['kind']]: string} = {\n   'signal': 'kind-signal',\n@@ -65,7 +65,7 @@ const CLUSTER_EXPAND_ANIM_DURATION = 1100; // Empirical value based on Dagre's b\n // - Standard cluster node \u2013\u00a0A cluster node, visualized as a standard node (i.e. collapsed)\n // - Expanded cluster node \u2013\u00a0A cluster node, visualized as a container of its child nodes (i.e. expanded)\n export class SignalsGraphVisualizer {\n-  private graph: DagreGraph;\n+  private graph: graphlib.Graph<any, DagreNode, DagreEdge>;\n   private drender: ReturnType<typeof dagreRender>;\n \n   zoomController: d3.ZoomBehavior<SVGSVGElement, unknown>;\n@@ -302,7 +302,7 @@ export class SignalsGraphVisualizer {\n     // Add new/update existing nodes\n     for (const n of signalGraph.nodes) {\n       const isSignal = isSignalNode(n);\n-      const existingNode = this.graph.node(n.id) as DagreGraphNode | undefined;\n+      const existingNode = this.graph.node(n.id) as DagreRegularNode | undefined;\n \n       if (existingNode) {\n         if (isSignal && n.epoch !== existingNode.epoch) {\n@@ -408,7 +408,7 @@ export class SignalsGraphVisualizer {\n \n   private updateDagreNode(\n     newNode: DevtoolsSignalNode,\n-    existingNode: DagreGraphNode,\n+    existingNode: DagreRegularNode,\n     signalGraph: DevtoolsSignalGraph,\n   ) {\n     const count = this.animatedNodesMap.get(newNode.id) ?? 0;\n@@ -548,7 +548,7 @@ export class SignalsGraphVisualizer {\n       .each((nodeId, idx, group) => {\n         const node = group[idx];\n         const d3Node = d3.select(node);\n-        const {width, height} = this.graph.node(nodeId as string) as DagreGraphNode;\n+        const {width, height} = this.graph.node(nodeId as string) as DagreRegularNode;\n \n         d3Node\n           .select('g')\n@@ -600,8 +600,6 @@ function convertNodesToMap(nodes: DevtoolsSignalGraphNode[]): Map<string, Devtoo\n   return new Map(nodes.map((n) => [n.id, n]));\n }\n \n-function isDagreClusterNode(\n-  node: DagreGraphCluster | DagreGraphNode | undefined,\n-): node is DagreGraphCluster {\n-  return !!(node as DagreGraphCluster)?.clusterLabelPos;\n+function isDagreClusterNode(node: DagreNode | undefined): node is DagreCluster {\n+  return !!(node as DagreCluster)?.clusterLabelPos;\n }\ndiff --git a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/dagre-d3-types.ts b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/visualizer-types.ts\nsimilarity index 61%\nrename from devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/dagre-d3-types.ts\nrename to devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/visualizer-types.ts\nindex 014285c0..cd773b9e 100644\n--- a/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/dagre-d3-types.ts\n+++ b/devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/signals-view/signals-visualizer/visualizer-types.ts\n@@ -6,10 +6,8 @@\n  * found in the LICENSE file at https://angular.dev/license\n  */\n \n-import {graphlib} from 'dagre-d3-es';\n-\n // Non-exhaustive; Alter based on Dagre D3 docs if required\n-export interface DagreGraphNode {\n+export interface DagreRegularNode {\n   label: HTMLDivElement;\n   labelType: string;\n   shape: string;\n@@ -21,24 +19,19 @@ export interface DagreGraphNode {\n }\n \n // Non-exhaustive; Alter based on Dagre D3 docs if required\n-export interface DagreGraphCluster {\n+export interface DagreCluster {\n   label: string;\n   clusterLabelPos: string;\n   class?: string;\n   style?: string;\n }\n \n+export type DagreNode = DagreRegularNode | DagreCluster;\n+\n // Non-exhaustive; Alter based on Dagre D3 docs if required\n-export interface DagreGraphEdge {\n+export interface DagreEdge {\n   curve: any;\n   style?: string;\n   arrowheadStyle?: string;\n   class?: string;\n }\n-\n-// Improve Graphlib types\n-export declare class DagreGraph extends graphlib.Graph {\n-  override setNode(id: string, value: DagreGraphNode | DagreGraphCluster, ...args: any[]): this;\n-  override node(id: string): DagreGraphNode | DagreGraphCluster;\n-  override edges(): {v: string; w: string}[];\n-}"}, {"role": "assistant", "content": "refactor(devtools): drop dagre graph type"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/go/internal/work/exec.go | 5 +++++\n src/cmd/go/internal/work/gc.go   | 3 +++\n 2 files changed, 8 insertions(+)\n\ndiff --git a/src/cmd/go/internal/work/exec.go b/src/cmd/go/internal/work/exec.go\nindex 654e9e93..f2d1b104 100644\n--- a/src/cmd/go/internal/work/exec.go\n+++ b/src/cmd/go/internal/work/exec.go\n@@ -248,6 +248,11 @@ func (b *Builder) Do(ctx context.Context, root *Action) {\n \n \twg.Wait()\n \n+\tif tokens != totalTokens || concurrentProcesses != 0 {\n+\t\tbase.Fatalf(\"internal error: tokens not restored at end of build: tokens: %d, totalTokens: %d, concurrentProcesses: %d\",\n+\t\t\ttokens, totalTokens, concurrentProcesses)\n+\t}\n+\n \t// Write action graph again, this time with timing information.\n \twriteActionGraph()\n }\ndiff --git a/src/cmd/go/internal/work/gc.go b/src/cmd/go/internal/work/gc.go\nindex 9a5e6c92..fc74715f 100644\n--- a/src/cmd/go/internal/work/gc.go\n+++ b/src/cmd/go/internal/work/gc.go\n@@ -227,6 +227,7 @@ func compilerConcurrency() (int, func()) {\n \treturn c, func() {\n \t\ttokensMu.Lock()\n \t\tdefer tokensMu.Unlock()\n+\t\tconcurrentProcesses--\n \t\ttokens += c\n \t}\n }\n@@ -235,6 +236,7 @@ var maxCompilerConcurrency = runtime.GOMAXPROCS(0) // max value we will use for\n \n var (\n \ttokensMu            sync.Mutex\n+\ttotalTokens         int // total number of tokens: this is used for checking that we get them all back in the end\n \ttokens              int // number of available tokens\n \tconcurrentProcesses int // number of currently running compiles\n )\n@@ -246,6 +248,7 @@ func initCompilerConcurrencyPool() {\n \t// than what it was when we capped the concurrency to 4.\n \toldConcurrencyCap := min(4, maxCompilerConcurrency)\n \ttokens = oldConcurrencyCap * cfg.BuildP\n+\ttotalTokens = tokens\n }\n \n // trimpath returns the -trimpath argument to use"}, {"role": "assistant", "content": "fix(build): add token restoration check and fix concurrent process"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/runtime/secret/secret_test.go | 38 +++++++++++++++++++++++++++++---------\n 1 file changed, 29 insertions(+), 9 deletions(-)\n\ndiff --git a/src/runtime/secret/secret_test.go b/src/runtime/secret/secret_test.go\nindex 98d67cf8..e2f78c53 100644\n--- a/src/runtime/secret/secret_test.go\n+++ b/src/runtime/secret/secret_test.go\n@@ -19,6 +19,7 @@ import (\n \t\"testing\"\n \t\"time\"\n \t\"unsafe\"\n+\t\"weak\"\n )\n \n type secretType int64\n@@ -63,28 +64,33 @@ func heapSTiny() *secretType {\n // are freed.\n // See runtime/mheap.go:freeSpecial.\n func TestHeap(t *testing.T) {\n-\tvar u uintptr\n+\tvar addr uintptr\n+\tvar p weak.Pointer[S]\n \tDo(func() {\n-\t\tu = uintptr(unsafe.Pointer(heapS()))\n+\t\tsp := heapS()\n+\t\taddr = uintptr(unsafe.Pointer(sp))\n+\t\tp = weak.Make(sp)\n \t})\n-\n-\truntime.GC()\n+\twaitCollected(t, p)\n \n \t// Check that object got zeroed.\n-\tcheckRangeForSecret(t, u, u+unsafe.Sizeof(S{}))\n+\tcheckRangeForSecret(t, addr, addr+unsafe.Sizeof(S{}))\n \t// Also check our stack, just because we can.\n \tcheckStackForSecret(t)\n }\n \n func TestHeapTiny(t *testing.T) {\n-\tvar u uintptr\n+\tvar addr uintptr\n+\tvar p weak.Pointer[secretType]\n \tDo(func() {\n-\t\tu = uintptr(unsafe.Pointer(heapSTiny()))\n+\t\tsp := heapSTiny()\n+\t\taddr = uintptr(unsafe.Pointer(sp))\n+\t\tp = weak.Make(sp)\n \t})\n-\truntime.GC()\n+\twaitCollected(t, p)\n \n \t// Check that object got zeroed.\n-\tcheckRangeForSecret(t, u, u+unsafe.Sizeof(secretType(0)))\n+\tcheckRangeForSecret(t, addr, addr+unsafe.Sizeof(secretType(0)))\n \t// Also check our stack, just because we can.\n \tcheckStackForSecret(t)\n }\n@@ -240,6 +246,20 @@ func checkRangeForSecret(t *testing.T, lo, hi uintptr) {\n \t}\n }\n \n+func waitCollected[P any](t *testing.T, ptr weak.Pointer[P]) {\n+\tt.Helper()\n+\ti := 0\n+\tfor ptr.Value() != nil {\n+\t\truntime.GC()\n+\t\ti++\n+\t\t// 20 seems like a decent number of times to try\n+\t\tif i > 20 {\n+\t\t\tt.Errorf(\"value was never collected\")\n+\t\t}\n+\t}\n+\tt.Logf(\"number of cycles until collection: %d\", i)\n+}\n+\n func TestRegisters(t *testing.T) {\n \tDo(func() {\n \t\ts := makeS()"}, {"role": "assistant", "content": "test(secret): use weak pointers to verify object collection"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../test/node/api/validators/pattern.spec.ts       | 51 ++++++++++++++++++++++\n 1 file changed, 51 insertions(+)\n\ndiff --git a/packages/forms/signals/test/node/api/validators/pattern.spec.ts b/packages/forms/signals/test/node/api/validators/pattern.spec.ts\nindex 13f884fa..b043eaf3 100644\n--- a/packages/forms/signals/test/node/api/validators/pattern.spec.ts\n+++ b/packages/forms/signals/test/node/api/validators/pattern.spec.ts\n@@ -95,6 +95,57 @@ describe('pattern validator', () => {\n       expect(f.name().pattern()).toEqual([/pir.*jok/, /pelmeni/]);\n     });\n \n+    it('validates multiple patterns independently (AND logic)', () => {\n+      const model = signal('abc123');\n+      const f = form(\n+        model,\n+        (p) => {\n+          pattern(p, /abc/); // matches\n+          pattern(p, /\\d+/); // matches\n+        },\n+        {injector: TestBed.inject(Injector)},\n+      );\n+\n+      // Both patterns match, so no errors\n+      expect(f().pattern()).toEqual([/abc/, /\\d+/]);\n+      expect(f().errors()).toEqual([]);\n+    });\n+\n+    it('validates multiple patterns independently - partial match produces errors', () => {\n+      const model = signal('abc');\n+      const f = form(\n+        model,\n+        (p) => {\n+          pattern(p, /abc/); // matches\n+          pattern(p, /\\d+/); // does not match\n+        },\n+        {injector: TestBed.inject(Injector)},\n+      );\n+\n+      // Only one pattern matches, so we get an error from the non-matching one\n+      expect(f().pattern()).toEqual([/abc/, /\\d+/]);\n+      expect(f().errors()).toEqual([patternError(/\\d+/, {fieldTree: f})]);\n+    });\n+\n+    it('validates multiple patterns - no match produces multiple errors', () => {\n+      const model = signal('xyz');\n+      const f = form(\n+        model,\n+        (p) => {\n+          pattern(p, /abc/); // does not match\n+          pattern(p, /\\d+/); // does not match\n+        },\n+        {injector: TestBed.inject(Injector)},\n+      );\n+\n+      // No patterns match, so we get errors from both\n+      expect(f().pattern()).toEqual([/abc/, /\\d+/]);\n+      expect(f().errors()).toEqual([\n+        patternError(/abc/, {fieldTree: f}),\n+        patternError(/\\d+/, {fieldTree: f}),\n+      ]);\n+    });\n+\n     it('PATTERN property defaults to empty list', () => {\n       const cat = signal({name: 'pelmeni-the-cat'});\n       const f = form("}, {"role": "assistant", "content": "test(forms): improve test coverage for multiple pattern validators"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/cmd/go/internal/work/exec.go | 12 ++++++------\n 1 file changed, 6 insertions(+), 6 deletions(-)\n\ndiff --git a/src/cmd/go/internal/work/exec.go b/src/cmd/go/internal/work/exec.go\nindex f2d1b104..0afdce23 100644\n--- a/src/cmd/go/internal/work/exec.go\n+++ b/src/cmd/go/internal/work/exec.go\n@@ -627,7 +627,7 @@ func (b *Builder) checkCacheForBuild(a, buildAction *Action, covMetaFileName str\n \t// If we are going to do a full build anyway,\n \t// we're going to regenerate the files in the build action anyway.\n \tif need == needVet {\n-\t\tif err := b.loadCachedVet(buildAction); err == nil {\n+\t\tif err := b.loadCachedVet(buildAction, a.Deps); err == nil {\n \t\t\tneed &^= needVet\n \t\t}\n \t}\n@@ -841,7 +841,7 @@ func (b *Builder) build(ctx context.Context, a *Action) (err error) {\n \n \t// Prepare Go vet config if needed.\n \tif need&needVet != 0 {\n-\t\tbuildVetConfig(a, srcfiles)\n+\t\tbuildVetConfig(a, srcfiles, a.Deps)\n \t\tneed &^= needVet\n \t}\n \tif need&needCompiledGoFiles != 0 {\n@@ -1121,7 +1121,7 @@ func (b *Builder) cacheSrcFiles(a *Action, srcfiles []string) {\n \tcache.PutBytes(c, cache.Subkey(a.actionID, \"srcfiles\"), buf.Bytes())\n }\n \n-func (b *Builder) loadCachedVet(a *Action) error {\n+func (b *Builder) loadCachedVet(a *Action, vetDeps []*Action) error {\n \tc := cache.Default()\n \tlist, _, err := cache.GetBytes(c, cache.Subkey(a.actionID, \"srcfiles\"))\n \tif err != nil {\n@@ -1141,7 +1141,7 @@ func (b *Builder) loadCachedVet(a *Action) error {\n \t\t}\n \t\tsrcfiles = append(srcfiles, a.Objdir+name)\n \t}\n-\tbuildVetConfig(a, srcfiles)\n+\tbuildVetConfig(a, srcfiles, vetDeps)\n \treturn nil\n }\n \n@@ -1197,7 +1197,7 @@ type vetConfig struct {\n \tSucceedOnTypecheckFailure bool // awful hack; see #18395 and below\n }\n \n-func buildVetConfig(a *Action, srcfiles []string) {\n+func buildVetConfig(a *Action, srcfiles []string, vetDeps []*Action) {\n \t// Classify files based on .go extension.\n \t// srcfiles does not include raw cgo files.\n \tvar gofiles, nongofiles []string\n@@ -1253,7 +1253,7 @@ func buildVetConfig(a *Action, srcfiles []string) {\n \t\tvcfgMapped[p] = true\n \t}\n \n-\tfor _, a1 := range a.Deps {\n+\tfor _, a1 := range vetDeps {\n \t\tp1 := a1.Package\n \t\tif p1 == nil || p1.ImportPath == \"\" || p1 == a.Package {\n \t\t\tcontinue"}, {"role": "assistant", "content": "refactor(work): pass vet deps explicitly to buildVetConfig"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/compiler-sfc/src/script/defineProps.ts | 2 +-\n packages/compiler-sfc/src/script/utils.ts       | 2 +-\n 2 files changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/packages/compiler-sfc/src/script/defineProps.ts b/packages/compiler-sfc/src/script/defineProps.ts\nindex 9a4880a..e839d84 100644\n--- a/packages/compiler-sfc/src/script/defineProps.ts\n+++ b/packages/compiler-sfc/src/script/defineProps.ts\n@@ -369,7 +369,7 @@ function genDestructuredDefaultValue(\n   }\n }\n \n-// non-comprehensive, best-effort type infernece for a runtime value\n+// non-comprehensive, best-effort type inference for a runtime value\n // this is used to catch default value / type declaration mismatches\n // when using props destructure.\n function inferValueType(node: Node): string | undefined {\ndiff --git a/packages/compiler-sfc/src/script/utils.ts b/packages/compiler-sfc/src/script/utils.ts\nindex bda64dc..7e41ac2 100644\n--- a/packages/compiler-sfc/src/script/utils.ts\n+++ b/packages/compiler-sfc/src/script/utils.ts\n@@ -109,7 +109,7 @@ function toFileNameLowerCase(x: string) {\n \n /**\n  * We need `getCanonicalFileName` when creating ts module resolution cache,\n- * but TS does not expose it directly. This implementation is repllicated from\n+ * but TS does not expose it directly. This implementation is replicated from\n  * the TS source code.\n  */\n export function createGetCanonicalFileName("}, {"role": "assistant", "content": "docs: fix typos in comments"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/translate.yml |  6 +++++\n scripts/translate.py            | 52 ++++++++++++++++++++++++++---------------\n 2 files changed, 39 insertions(+), 19 deletions(-)\n\ndiff --git a/.github/workflows/translate.yml b/.github/workflows/translate.yml\nindex e6edc5a..734a378 100644\n--- a/.github/workflows/translate.yml\n+++ b/.github/workflows/translate.yml\n@@ -30,6 +30,11 @@ on:\n         type: string\n         required: false\n         default: \"\"\n+      commit_in_place:\n+        description: Whether to commit changes directly instead of making a PR\n+        type: boolean\n+        required: false\n+        default: false\n \n jobs:\n   langs:\n@@ -109,3 +114,4 @@ jobs:\n           LANGUAGE: ${{ matrix.lang }}\n           EN_PATH: ${{ github.event.inputs.en_path }}\n           COMMAND: ${{ matrix.command }}\n+          COMMIT_IN_PLACE: ${{ github.event.inputs.commit_in_place }}\ndiff --git a/scripts/translate.py b/scripts/translate.py\nindex c7e6c7e..eba4ad6 100644\n--- a/scripts/translate.py\n+++ b/scripts/translate.py\n@@ -360,6 +360,9 @@ def make_pr(\n     command: Annotated[str | None, typer.Option(envvar=\"COMMAND\")] = None,\n     github_token: Annotated[str, typer.Option(envvar=\"GITHUB_TOKEN\")],\n     github_repository: Annotated[str, typer.Option(envvar=\"GITHUB_REPOSITORY\")],\n+    commit_in_place: Annotated[\n+        bool, typer.Option(envvar=\"COMMIT_IN_PLACE\", show_default=True)\n+    ] = False,\n ) -> None:\n     print(\"Setting up GitHub Actions git user\")\n     repo = git.Repo(Path(__file__).absolute().parent.parent)\n@@ -371,14 +374,22 @@ def make_pr(\n         [\"git\", \"config\", \"user.email\", \"github-actions[bot]@users.noreply.github.com\"],\n         check=True,\n     )\n-    branch_name = \"translate\"\n-    if language:\n-        branch_name += f\"-{language}\"\n-    if command:\n-        branch_name += f\"-{command}\"\n-    branch_name += f\"-{secrets.token_hex(4)}\"\n-    print(f\"Creating a new branch {branch_name}\")\n-    subprocess.run([\"git\", \"checkout\", \"-b\", branch_name], check=True)\n+    current_branch = repo.active_branch.name\n+    if current_branch == \"master\" and commit_in_place:\n+        print(\"Can't commit directly to master\")\n+        raise typer.Exit(code=1)\n+\n+    if not commit_in_place:\n+        branch_name = \"translate\"\n+        if language:\n+            branch_name += f\"-{language}\"\n+        if command:\n+            branch_name += f\"-{command}\"\n+        branch_name += f\"-{secrets.token_hex(4)}\"\n+        print(f\"Creating a new branch {branch_name}\")\n+        subprocess.run([\"git\", \"checkout\", \"-b\", branch_name], check=True)\n+    else:\n+        print(f\"Committing in place on branch {current_branch}\")\n     print(\"Adding updated files\")\n     git_path = Path(\"docs\")\n     subprocess.run([\"git\", \"add\", str(git_path)], check=True)\n@@ -391,17 +402,20 @@ def make_pr(\n     subprocess.run([\"git\", \"commit\", \"-m\", message], check=True)\n     print(\"Pushing branch\")\n     subprocess.run([\"git\", \"push\", \"origin\", branch_name], check=True)\n-    print(\"Creating PR\")\n-    g = Github(github_token)\n-    gh_repo = g.get_repo(github_repository)\n-    body = (\n-        message\n-        + \"\\n\\nThis PR was created automatically using LLMs.\"\n-        + f\"\\n\\nIt uses the prompt file https://github.com/fastapi/fastapi/blob/master/docs/{language}/llm-prompt.md.\"\n-        + \"\\n\\nIn most cases, it's better to make PRs updating that file so that the LLM can do a better job generating the translations than suggesting changes in this PR.\"\n-    )\n-    pr = gh_repo.create_pull(title=message, body=body, base=\"master\", head=branch_name)\n-    print(f\"Created PR: {pr.number}\")\n+    if not commit_in_place:\n+        print(\"Creating PR\")\n+        g = Github(github_token)\n+        gh_repo = g.get_repo(github_repository)\n+        body = (\n+            message\n+            + \"\\n\\nThis PR was created automatically using LLMs.\"\n+            + f\"\\n\\nIt uses the prompt file https://github.com/fastapi/fastapi/blob/master/docs/{language}/llm-prompt.md.\"\n+            + \"\\n\\nIn most cases, it's better to make PRs updating that file so that the LLM can do a better job generating the translations than suggesting changes in this PR.\"\n+        )\n+        pr = gh_repo.create_pull(\n+            title=message, body=body, base=\"master\", head=branch_name\n+        )\n+        print(f\"Created PR: {pr.number}\")\n     print(\"Finished\")\n \n "}, {"role": "assistant", "content": "feat(ci): add commitinplace option to translation workflow"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n adev/shared-docs/styles/_colors.scss | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/adev/shared-docs/styles/_colors.scss b/adev/shared-docs/styles/_colors.scss\nindex 4b7f4c94..74e603e4 100644\n--- a/adev/shared-docs/styles/_colors.scss\n+++ b/adev/shared-docs/styles/_colors.scss\n@@ -40,7 +40,7 @@\n   --symbolic-pink: oklch(63.67% 0.254 13.47); // #ff025c\n   --symbolic-orange: oklch(64.73% 0.23769984683784018 33.18328352127882); // #fe3700\n   --symbolic-yellow: oklch(78.09% 0.163 65.69); // #fd9f28\n-  --symbolic-green: oklch(67.83% 0.229 142.73); // #00b80a\n+  --symbolic-green: oklch(48% 0.16 145); // #008B38\n   --symbolic-cyan: oklch(67.05% 0.1205924489987394 181.34025902203868); // #00ad9a\n   --symbolic-magenta: oklch(51.74% 0.25453048882711515 315.26261625862725); // #9c00c8\n   --symbolic-teal: oklch(57.59% 0.083 230.58); // #3f82a1\n@@ -288,7 +288,7 @@\n     var(--full-contrast) 65%\n   );\n   --symbolic-yellow: color-mix(in srgb, oklch(78.09% 0.163 65.69), var(--full-contrast) 65%);\n-  --symbolic-green: color-mix(in srgb, oklch(67.83% 0.229 142.73), var(--full-contrast) 65%);\n+  --symbolic-green: color-mix(in srgb, oklch(48% 0.16 145), var(--full-contrast) 65%);\n   --symbolic-cyan: color-mix(\n     in srgb,\n     oklch(67.05% 0.1205924489987394 181.34025902203868),"}, {"role": "assistant", "content": "fix(docs-infra): improve symbolic green contrast for WCAG compliance"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/bootstrap/Cargo.toml      | 2 +-\n src/build_helper/Cargo.toml   | 7 +++++--\n src/build_helper/src/lib.rs   | 1 +\n src/ci/citool/Cargo.toml      | 2 +-\n src/tools/opt-dist/Cargo.toml | 2 +-\n 5 files changed, 9 insertions(+), 5 deletions(-)\n\ndiff --git a/src/bootstrap/Cargo.toml b/src/bootstrap/Cargo.toml\nindex e1725db60cf..e66c0576e9e 100644\n--- a/src/bootstrap/Cargo.toml\n+++ b/src/bootstrap/Cargo.toml\n@@ -6,7 +6,7 @@ build = \"build.rs\"\n default-run = \"bootstrap\"\n \n [features]\n-build-metrics = [\"sysinfo\"]\n+build-metrics = [\"dep:sysinfo\", \"build_helper/metrics\"]\n tracing = [\"dep:tracing\", \"dep:tracing-chrome\", \"dep:tracing-subscriber\", \"dep:chrono\", \"dep:tempfile\"]\n \n [lib]\ndiff --git a/src/build_helper/Cargo.toml b/src/build_helper/Cargo.toml\nindex 66894e1abc4..2ec44fe2730 100644\n--- a/src/build_helper/Cargo.toml\n+++ b/src/build_helper/Cargo.toml\n@@ -6,5 +6,8 @@ edition = \"2021\"\n # See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n \n [dependencies]\n-serde = \"1\"\n-serde_derive = \"1\"\n+serde = { version = \"1\", optional = true }\n+serde_derive = { version = \"1\", optional = true }\n+\n+[features]\n+metrics = [\"dep:serde\", \"dep:serde_derive\"]\ndiff --git a/src/build_helper/src/lib.rs b/src/build_helper/src/lib.rs\nindex 266eedc6245..e23a158ac05 100644\n--- a/src/build_helper/src/lib.rs\n+++ b/src/build_helper/src/lib.rs\n@@ -4,6 +4,7 @@\n pub mod drop_bomb;\n pub mod fs;\n pub mod git;\n+#[cfg(feature = \"metrics\")]\n pub mod metrics;\n pub mod npm;\n pub mod stage0_parser;\ndiff --git a/src/ci/citool/Cargo.toml b/src/ci/citool/Cargo.toml\nindex 468d8c8a02a..539edf60033 100644\n--- a/src/ci/citool/Cargo.toml\n+++ b/src/ci/citool/Cargo.toml\n@@ -15,7 +15,7 @@ serde_yaml = \"0.9\"\n serde_json = \"1\"\n ureq = { version = \"3\", features = [\"json\"] }\n \n-build_helper = { path = \"../../build_helper\" }\n+build_helper = { path = \"../../build_helper\", features = [\"metrics\"] }\n \n [dev-dependencies]\n insta = \"1\"\ndiff --git a/src/tools/opt-dist/Cargo.toml b/src/tools/opt-dist/Cargo.toml\nindex f4051ae67d7..66c19183f34 100644\n--- a/src/tools/opt-dist/Cargo.toml\n+++ b/src/tools/opt-dist/Cargo.toml\n@@ -4,7 +4,7 @@ version = \"0.1.0\"\n edition = \"2024\"\n \n [dependencies]\n-build_helper = { path = \"../../build_helper\" }\n+build_helper = { path = \"../../build_helper\", features = [\"metrics\"] }\n env_logger = \"0.11\"\n log = \"0.4\"\n anyhow = \"1\""}, {"role": "assistant", "content": "refactor(build): make serde deps optional behind metrics feature"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/main/elementSelection.js                   |  2 +-\n .../react-devtools-extensions/src/main/index.js    | 49 ++++++++++++++++++++++\n .../devtools/views/Components/InspectedElement.css |  8 ++++\n .../devtools/views/Components/InspectedElement.js  | 15 ++++++-\n .../src/devtools/views/DevTools.js                 | 11 +++++\n .../InspectedElement/InspectedElementPane.css      | 15 +++++++\n .../views/InspectedElement/InspectedElementPane.js | 34 +++++++++++++++\n 7 files changed, 131 insertions(+), 3 deletions(-)\n\ndiff --git a/packages/react-devtools-extensions/src/main/elementSelection.js b/packages/react-devtools-extensions/src/main/elementSelection.js\nindex 315482e..10dd81d 100644\n--- a/packages/react-devtools-extensions/src/main/elementSelection.js\n+++ b/packages/react-devtools-extensions/src/main/elementSelection.js\n@@ -32,7 +32,7 @@ export function setReactSelectionFromBrowser(bridge) {\n           return;\n         }\n \n-        // Remember to sync the selection next time we show Components tab.\n+        // Remember to sync the selection next time we show inspected element\n         bridge.send('syncSelectionFromBuiltinElementsPanel');\n       }\n     },\ndiff --git a/packages/react-devtools-extensions/src/main/index.js b/packages/react-devtools-extensions/src/main/index.js\nindex 03f9c2b..5d7bd37 100644\n--- a/packages/react-devtools-extensions/src/main/index.js\n+++ b/packages/react-devtools-extensions/src/main/index.js\n@@ -206,6 +206,7 @@ function createBridgeAndStore() {\n         bridge,\n         browserTheme: getBrowserTheme(),\n         componentsPortalContainer,\n+        inspectedElementPortalContainer,\n         profilerPortalContainer,\n         editorPortalContainer,\n         currentSelectedSource,\n@@ -278,6 +279,51 @@ function createComponentsPanel() {\n   );\n }\n \n+function createElementsInspectPanel() {\n+  if (inspectedElementPortalContainer) {\n+    // Panel is created and user opened it at least once\n+    ensureInitialHTMLIsCleared(inspectedElementPortalContainer);\n+    render();\n+\n+    return;\n+  }\n+\n+  if (inspectedElementPane) {\n+    // Panel is created, but wasn't opened yet, so no document is present for it\n+    return;\n+  }\n+\n+  const elementsPanel = chrome.devtools.panels.elements;\n+  if (__IS_FIREFOX__ || !elementsPanel || !elementsPanel.createSidebarPane) {\n+    // Firefox will not pass the window to the onShown listener despite setPage\n+    // being called.\n+    // See https://bugzilla.mozilla.org/show_bug.cgi?id=2010549\n+\n+    // May not be supported in some browsers.\n+    // See https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/devtools/panels/ElementsPanel/createSidebarPane#browser_compatibility\n+    return;\n+  }\n+\n+  elementsPanel.createSidebarPane('React Element \u269b', createdPane => {\n+    inspectedElementPane = createdPane;\n+\n+    createdPane.setPage('panel.html');\n+    createdPane.setHeight('75px');\n+\n+    createdPane.onShown.addListener(portal => {\n+      inspectedElementPortalContainer = portal.container;\n+      if (inspectedElementPortalContainer != null && render) {\n+        ensureInitialHTMLIsCleared(inspectedElementPortalContainer);\n+\n+        render();\n+        portal.injectStyles(cloneStyleTags);\n+\n+        logEvent({event_name: 'selected-inspected-element-pane'});\n+      }\n+    });\n+  });\n+}\n+\n function createProfilerPanel() {\n   if (profilerPortalContainer) {\n     // Panel is created and user opened it at least once\n@@ -508,6 +554,7 @@ function mountReactDevTools() {\n   createComponentsPanel();\n   createProfilerPanel();\n   createSourcesEditorPanel();\n+  createElementsInspectPanel();\n   // Suspense Tab is created via the hook\n   // TODO(enableSuspenseTab): Create eagerly once Suspense tab is stable\n }\n@@ -556,10 +603,12 @@ let componentsPanel = null;\n let profilerPanel = null;\n let suspensePanel = null;\n let editorPane = null;\n+let inspectedElementPane = null;\n let componentsPortalContainer = null;\n let profilerPortalContainer = null;\n let suspensePortalContainer = null;\n let editorPortalContainer = null;\n+let inspectedElementPortalContainer = null;\n \n let mostRecentOverrideTab = null;\n let render = null;\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.css b/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.css\nindex 156b28f..7b00c0c 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.css\n+++ b/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.css\n@@ -77,3 +77,11 @@\n   padding: 0.25rem;\n   color: var(--color-console-error-icon);\n }\n+\n+.VRule {\n+  height: 20px;\n+  width: 1px;\n+  flex: 0 0 1px;\n+  margin: 0 0.5rem;\n+  background-color: var(--color-border);\n+}\ndiff --git a/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.js b/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.js\nindex 633a4d3..7ba7067 100644\n--- a/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.js\n+++ b/packages/react-devtools-shared/src/devtools/views/Components/InspectedElement.js\n@@ -34,13 +34,17 @@ import useEditorURL from '../useEditorURL';\n import styles from './InspectedElement.css';\n import Tooltip from './reach-ui/tooltip';\n \n-export type Props = {};\n+export type Props = {\n+  actionButtons?: React.Node,\n+};\n \n // TODO Make edits and deletes also use transition API!\n \n const noSourcePromise = Promise.resolve(null);\n \n-export default function InspectedElementWrapper(_: Props): React.Node {\n+export default function InspectedElementWrapper({\n+  actionButtons,\n+}: Props): React.Node {\n   const {inspectedElementID} = useContext(TreeStateContext);\n   const bridge = useContext(BridgeContext);\n   const store = useContext(StoreContext);\n@@ -305,6 +309,13 @@ export default function InspectedElementWrapper(_: Props): React.Node {\n             symbolicatedSourcePromise={symbolicatedSourcePromise}\n           />\n         )}\n+\n+        {actionButtons && (\n+          <>\n+            <div className={styles.VRule} />\n+            {actionButtons}\n+          </>\n+        )}\n       </div>\n \n       {inspectedElement === null && (\ndiff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js\nindex 6ddacef..dc47157 100644\n--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js\n+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js\n@@ -26,6 +26,7 @@ import Profiler from './Profiler/Profiler';\n import SuspenseTab from './SuspenseTab/SuspenseTab';\n import TabBar from './TabBar';\n import EditorPane from './Editor/EditorPane';\n+import InspectedElementPane from './InspectedElement/InspectedElementPane';\n import {SettingsContextController} from './Settings/SettingsContext';\n import {TreeContextController} from './Components/TreeContext';\n import ViewElementSourceContext from './Components/ViewElementSourceContext';\n@@ -100,6 +101,7 @@ export type Props = {\n   // The root <DevTools> app is rendered in the top-level extension window,\n   // but individual tabs (e.g. Components, Profiling) can be rendered into portals within their browser panels.\n   componentsPortalContainer?: Element,\n+  inspectedElementPortalContainer?: Element,\n   profilerPortalContainer?: Element,\n   suspensePortalContainer?: Element,\n   editorPortalContainer?: Element,\n@@ -155,6 +157,7 @@ export default function DevTools({\n   canViewElementSourceFunction,\n   componentsPortalContainer,\n   editorPortalContainer,\n+  inspectedElementPortalContainer,\n   profilerPortalContainer,\n   suspensePortalContainer,\n   currentSelectedSource,\n@@ -379,6 +382,14 @@ export default function DevTools({\n                                       portalContainer={editorPortalContainer}\n                                     />\n                                   ) : null}\n+                                  {inspectedElementPortalContainer ? (\n+                                    <InspectedElementPane\n+                                      selectedSource={currentSelectedSource}\n+                                      portalContainer={\n+                                        inspectedElementPortalContainer\n+                                      }\n+                                    />\n+                                  ) : null}\n                                 </ThemeProvider>\n                               </SuspenseTreeContextController>\n                             </InspectedElementContextController>\ndiff --git a/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.css b/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.css\nnew file mode 100644\nindex 0000000..5d0cd2e\n--- /dev/null\n+++ b/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.css\n@@ -0,0 +1,15 @@\n+.InspectedElementPane, .InspectedElementPane * {\n+  box-sizing: border-box;\n+  -webkit-font-smoothing: var(--font-smoothing);\n+}\n+\n+.InspectedElementPane {\n+  position: relative;\n+  width: 100%;\n+  height: 100%;\n+  display: flex;\n+  flex-direction: row;\n+  background-color: var(--color-background);\n+  color: var(--color-text);\n+  font-family: var(--font-family-sans);\n+}\ndiff --git a/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.js b/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.js\nnew file mode 100644\nindex 0000000..0d5b523\n--- /dev/null\n+++ b/packages/react-devtools-shared/src/devtools/views/InspectedElement/InspectedElementPane.js\n@@ -0,0 +1,34 @@\n+/**\n+ * Copyright (c) Meta Platforms, Inc. and affiliates.\n+ *\n+ * This source code is licensed under the MIT license found in the\n+ * LICENSE file in the root directory of this source tree.\n+ *\n+ * @flow\n+ */\n+\n+import * as React from 'react';\n+import {useContext} from 'react';\n+\n+import portaledContent from 'react-devtools-shared/src/devtools/views/portaledContent';\n+import {OptionsContext} from 'react-devtools-shared/src/devtools/views/context';\n+import InspectedElement from 'react-devtools-shared/src/devtools/views/Components/InspectedElement';\n+import SettingsModal from 'react-devtools-shared/src/devtools/views/Settings/SettingsModal';\n+import SettingsModalContextToggle from 'react-devtools-shared/src/devtools/views/Settings/SettingsModalContextToggle';\n+import {SettingsModalContextController} from 'react-devtools-shared/src/devtools/views/Settings/SettingsModalContext';\n+import styles from './InspectedElementPane.css';\n+\n+function InspectedElementPane() {\n+  const {hideSettings} = useContext(OptionsContext);\n+  return (\n+    <SettingsModalContextController>\n+      <div className={styles.InspectedElementPane}>\n+        <InspectedElement\n+          actionButtons={!hideSettings && <SettingsModalContextToggle />}\n+        />\n+        <SettingsModal />\n+      </div>\n+    </SettingsModalContextController>\n+  );\n+}\n+export default (portaledContent(InspectedElementPane): component());"}, {"role": "assistant", "content": "feat(devtools): add inspected element sidebar pane to Elements panel"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n src/os/exec/exec_test.go | 24 +++++++-----------------\n 1 file changed, 7 insertions(+), 17 deletions(-)\n\ndiff --git a/src/os/exec/exec_test.go b/src/os/exec/exec_test.go\nindex bf2f3da5..2746ad87 100644\n--- a/src/os/exec/exec_test.go\n+++ b/src/os/exec/exec_test.go\n@@ -1845,23 +1845,13 @@ func TestStart_twice(t *testing.T) {\n \ttestenv.MustHaveExec(t)\n \n \tcmd := exec.Command(\"/bin/nonesuch\")\n-\tfor i, want := range []string{\n-\t\tcond(runtime.GOOS == \"windows\",\n-\t\t\t`exec: \"/bin/nonesuch\": executable file not found in %PATH%`,\n-\t\t\t\"fork/exec /bin/nonesuch: no such file or directory\"),\n-\t\t\"exec: already started\",\n-\t} {\n-\t\terr := cmd.Start()\n-\t\tif got := fmt.Sprint(err); got != want {\n-\t\t\tt.Errorf(\"Start call #%d return err %q, want %q\", i+1, got, want)\n-\t\t}\n+\tif err := cmd.Start(); err == nil {\n+\t\tt.Fatalf(\"running invalid command succeeded\")\n \t}\n-}\n-\n-func cond[T any](cond bool, t, f T) T {\n-\tif cond {\n-\t\treturn t\n-\t} else {\n-\t\treturn f\n+\terr := cmd.Start()\n+\tgot := fmt.Sprint(err)\n+\twant := \"exec: already started\"\n+\tif got != want {\n+\t\tt.Fatalf(\"Start call returned err %q, want %q\", got, want)\n \t}\n }"}, {"role": "assistant", "content": "test(exec): simplify TestStart_twice"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../packages/babel-plugin-react-compiler/src/CompilerError.ts  | 10 +++++++++-\n .../babel-plugin-react-compiler/src/Entrypoint/Pipeline.ts     |  8 +++++---\n .../src/Validation/ValidateExhaustiveDependencies.ts           |  4 ++--\n .../fixtures/compiler/error.invalid-exhaustive-deps.expect.md  |  8 ++++----\n 4 files changed, 20 insertions(+), 10 deletions(-)\n\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/CompilerError.ts b/compiler/packages/babel-plugin-react-compiler/src/CompilerError.ts\nindex 352d31b..c7c8d6a 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/CompilerError.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/CompilerError.ts\n@@ -1067,7 +1067,15 @@ function getRuleForCategoryImpl(category: ErrorCategory): LintRule {\n         name: 'memo-dependencies',\n         description:\n           'Validates that useMemo() and useCallback() specify comprehensive dependencies without extraneous values. See [`useMemo()` docs](https://react.dev/reference/react/useMemo) for more information.',\n-        preset: LintRulePreset.RecommendedLatest,\n+        /**\n+         * TODO: the \"MemoDependencies\" rule largely reimplements the \"exhaustive-deps\" non-compiler rule,\n+         * allowing the compiler to ensure it does not regress change behavior due to different dependencies.\n+         * We previously relied on the source having ESLint suppressions for any exhaustive-deps violations,\n+         * but it's more reliable to verify it within the compiler.\n+         *\n+         * Long-term we should de-duplicate these implementations.\n+         */\n+        preset: LintRulePreset.Off,\n       };\n     }\n     case ErrorCategory.IncompatibleLibrary: {\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Entrypoint/Pipeline.ts b/compiler/packages/babel-plugin-react-compiler/src/Entrypoint/Pipeline.ts\nindex 3d97d4d..1b76dfb 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Entrypoint/Pipeline.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Entrypoint/Pipeline.ts\n@@ -303,9 +303,11 @@ function runWithEnvironment(\n   inferReactivePlaces(hir);\n   log({kind: 'hir', name: 'InferReactivePlaces', value: hir});\n \n-  if (env.config.validateExhaustiveMemoizationDependencies) {\n-    // NOTE: this relies on reactivity inference running first\n-    validateExhaustiveDependencies(hir).unwrap();\n+  if (env.enableValidations) {\n+    if (env.config.validateExhaustiveMemoizationDependencies) {\n+      // NOTE: this relies on reactivity inference running first\n+      validateExhaustiveDependencies(hir).unwrap();\n+    }\n   }\n \n   rewriteInstructionKindsBasedOnReassignment(hir);\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\nindex d5f9ab2..b3a68fc 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\n+++ b/compiler/packages/babel-plugin-react-compiler/src/Validation/ValidateExhaustiveDependencies.ts\n@@ -284,7 +284,7 @@ export function validateExhaustiveDependencies(\n       if (missing.length !== 0) {\n         const diagnostic = CompilerDiagnostic.create({\n           category: ErrorCategory.MemoDependencies,\n-          reason: 'Found non-exhaustive dependencies',\n+          reason: 'Found missing memoization dependencies',\n           description:\n             'Missing dependencies can cause a value not to update when those inputs change, ' +\n             'resulting in stale UI',\n@@ -309,7 +309,7 @@ export function validateExhaustiveDependencies(\n           reason: 'Found unnecessary memoization dependencies',\n           description:\n             'Unnecessary dependencies can cause a value to update more often than necessary, ' +\n-            'which can cause effects to run more than expected',\n+            'causing performance regressions and effects to fire more often than expected',\n         });\n         diagnostic.withDetails({\n           kind: 'error',\ndiff --git a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.expect.md b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.expect.md\nindex bca95a8..ed317be 100644\n--- a/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.expect.md\n+++ b/compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/error.invalid-exhaustive-deps.expect.md\n@@ -53,7 +53,7 @@ function Component({x, y, z}) {\n ```\n Found 4 errors:\n \n-Error: Found non-exhaustive dependencies\n+Error: Found missing memoization dependencies\n \n Missing dependencies can cause a value not to update when those inputs change, resulting in stale UI.\n \n@@ -66,7 +66,7 @@ error.invalid-exhaustive-deps.ts:7:11\n    9 |   }, [x?.y.z?.a.b]);\n   10 |   const b = useMemo(() => {\n \n-Error: Found non-exhaustive dependencies\n+Error: Found missing memoization dependencies\n \n Missing dependencies can cause a value not to update when those inputs change, resulting in stale UI.\n \n@@ -81,7 +81,7 @@ error.invalid-exhaustive-deps.ts:15:11\n \n Error: Found unnecessary memoization dependencies\n \n-Unnecessary dependencies can cause a value to update more often than necessary, which can cause effects to run more than expected.\n+Unnecessary dependencies can cause a value to update more often than necessary, causing performance regressions and effects to fire more often than expected.\n \n error.invalid-exhaustive-deps.ts:31:5\n   29 |     return [];\n@@ -92,7 +92,7 @@ error.invalid-exhaustive-deps.ts:31:5\n   33 |   const ref2 = useRef(null);\n   34 |   const ref = z ? ref1 : ref2;\n \n-Error: Found non-exhaustive dependencies\n+Error: Found missing memoization dependencies\n \n Missing dependencies can cause a value not to update when those inputs change, resulting in stale UI.\n "}, {"role": "assistant", "content": "refactor(compiler): improve memo deps validation and error messages"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/translate.yml | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/.github/workflows/translate.yml b/.github/workflows/translate.yml\nindex 734a378..8351861 100644\n--- a/.github/workflows/translate.yml\n+++ b/.github/workflows/translate.yml\n@@ -31,7 +31,7 @@ on:\n         required: false\n         default: \"\"\n       commit_in_place:\n-        description: Whether to commit changes directly instead of making a PR\n+        description: Commit changes directly instead of making a PR\n         type: boolean\n         required: false\n         default: false"}, {"role": "assistant", "content": "ci: update workflow input description"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/zh/llm-prompt.md | 46 ++++++++++++++++++++++++++++++++++++++++++++++\n 1 file changed, 46 insertions(+)\n\ndiff --git a/docs/zh/llm-prompt.md b/docs/zh/llm-prompt.md\nnew file mode 100644\nindex 0000000..1dfbe59\n--- /dev/null\n+++ b/docs/zh/llm-prompt.md\n@@ -0,0 +1,46 @@\n+### Target language\n+\n+Translate to Simplified Chinese (\u7b80\u4f53\u4e2d\u6587).\n+\n+Language code: zh.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using \u201c\u4f60/\u4f60\u7684\u201d).\n+\n+### Headings\n+\n+1) Follow existing Simplified Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+3) If a heading contains only the name of a FastAPI feature, do not translate it.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Simplified Chinese docs (they often mix English terms like \u201cFastAPI\u201d with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over  `\u2026\u2026`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): \u8bf7\u6c42\n+- response (HTTP): \u54cd\u5e94\n+- path operation: \u8def\u5f84\u64cd\u4f5c\n+- path operation function: \u8def\u5f84\u64cd\u4f5c\u51fd\u6570\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// tip | \u63d0\u793a`\n+- `/// note | \u6ce8\u610f`\n+- `/// warning | \u8b66\u544a`\n+- `/// info | \u4fe1\u606f`\n+- `/// danger | \u5371\u9669`"}, {"role": "assistant", "content": "docs: add chinese translation prompt guide"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n tests/test_request_params/test_body/test_list.py   |  34 +++----\n tests/test_request_params/test_file/test_list.py   | 105 ++++-----------------\n tests/test_request_params/test_form/test_list.py   |  34 +++----\n tests/test_request_params/test_header/test_list.py |  34 +++----\n tests/test_request_params/test_query/test_list.py  |  34 +++----\n 5 files changed, 64 insertions(+), 177 deletions(-)\n\ndiff --git a/tests/test_request_params/test_body/test_list.py b/tests/test_request_params/test_body/test_list.py\nindex 5084733..970e6a6 100644\n--- a/tests/test_request_params/test_body/test_list.py\n+++ b/tests/test_request_params/test_body/test_list.py\n@@ -1,7 +1,7 @@\n from typing import Annotated, Union\n \n import pytest\n-from dirty_equals import IsDict, IsOneOf, IsPartialDict\n+from dirty_equals import IsOneOf, IsPartialDict\n from fastapi import Body, FastAPI\n from fastapi.testclient import TestClient\n from pydantic import BaseModel, Field\n@@ -59,28 +59,16 @@ def test_required_list_str_missing(path: str, json: Union[dict, None]):\n     client = TestClient(app)\n     response = client.post(path, json=json)\n     assert response.status_code == 422\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": IsOneOf([\"body\", \"p\"], [\"body\"]),\n-                    \"msg\": \"Field required\",\n-                    \"input\": IsOneOf(None, {}),\n-                }\n-            ]\n-        }\n-    ) | IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"loc\": IsOneOf([\"body\", \"p\"], [\"body\"]),\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                }\n-            ]\n-        }\n-    )\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": IsOneOf([\"body\", \"p\"], [\"body\"]),\n+                \"msg\": \"Field required\",\n+                \"input\": IsOneOf(None, {}),\n+            }\n+        ]\n+    }\n \n \n @pytest.mark.parametrize(\ndiff --git a/tests/test_request_params/test_file/test_list.py b/tests/test_request_params/test_file/test_list.py\nindex f096532..68280fc 100644\n--- a/tests/test_request_params/test_file/test_list.py\n+++ b/tests/test_request_params/test_file/test_list.py\n@@ -1,7 +1,6 @@\n from typing import Annotated\n \n import pytest\n-from dirty_equals import IsDict\n from fastapi import FastAPI, File, UploadFile\n from fastapi.testclient import TestClient\n \n@@ -36,27 +35,11 @@ def test_list_schema(path: str):\n \n     assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n         \"properties\": {\n-            \"p\": (\n-                IsDict(\n-                    {\n-                        \"anyOf\": [\n-                            {\n-                                \"type\": \"array\",\n-                                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                            },\n-                            {\"type\": \"null\"},\n-                        ],\n-                        \"title\": \"P\",\n-                    },\n-                )\n-                | IsDict(\n-                    {\n-                        \"type\": \"array\",\n-                        \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                        \"title\": \"P\",\n-                    },\n-                )\n-            )\n+            \"p\": {\n+                \"type\": \"array\",\n+                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n+                \"title\": \"P\",\n+            },\n         },\n         \"required\": [\"p\"],\n         \"title\": body_model_name,\n@@ -130,27 +113,11 @@ def test_list_alias_schema(path: str):\n \n     assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n         \"properties\": {\n-            \"p_alias\": (\n-                IsDict(\n-                    {\n-                        \"anyOf\": [\n-                            {\n-                                \"type\": \"array\",\n-                                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                            },\n-                            {\"type\": \"null\"},\n-                        ],\n-                        \"title\": \"P Alias\",\n-                    },\n-                )\n-                | IsDict(\n-                    {\n-                        \"type\": \"array\",\n-                        \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                        \"title\": \"P Alias\",\n-                    },\n-                )\n-            )\n+            \"p_alias\": {\n+                \"type\": \"array\",\n+                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n+                \"title\": \"P Alias\",\n+            },\n         },\n         \"required\": [\"p_alias\"],\n         \"title\": body_model_name,\n@@ -252,27 +219,11 @@ def test_list_validation_alias_schema(path: str):\n \n     assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n         \"properties\": {\n-            \"p_val_alias\": (\n-                IsDict(\n-                    {\n-                        \"anyOf\": [\n-                            {\n-                                \"type\": \"array\",\n-                                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                            },\n-                            {\"type\": \"null\"},\n-                        ],\n-                        \"title\": \"P Val Alias\",\n-                    },\n-                )\n-                | IsDict(\n-                    {\n-                        \"type\": \"array\",\n-                        \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                        \"title\": \"P Val Alias\",\n-                    },\n-                )\n-            )\n+            \"p_val_alias\": {\n+                \"type\": \"array\",\n+                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n+                \"title\": \"P Val Alias\",\n+            },\n         },\n         \"required\": [\"p_val_alias\"],\n         \"title\": body_model_name,\n@@ -385,27 +336,11 @@ def test_list_alias_and_validation_alias_schema(path: str):\n \n     assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n         \"properties\": {\n-            \"p_val_alias\": (\n-                IsDict(\n-                    {\n-                        \"anyOf\": [\n-                            {\n-                                \"type\": \"array\",\n-                                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                            },\n-                            {\"type\": \"null\"},\n-                        ],\n-                        \"title\": \"P Val Alias\",\n-                    },\n-                )\n-                | IsDict(\n-                    {\n-                        \"type\": \"array\",\n-                        \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                        \"title\": \"P Val Alias\",\n-                    },\n-                )\n-            )\n+            \"p_val_alias\": {\n+                \"type\": \"array\",\n+                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n+                \"title\": \"P Val Alias\",\n+            },\n         },\n         \"required\": [\"p_val_alias\"],\n         \"title\": body_model_name,\ndiff --git a/tests/test_request_params/test_form/test_list.py b/tests/test_request_params/test_form/test_list.py\nindex cfc42f5..abe781c 100644\n--- a/tests/test_request_params/test_form/test_list.py\n+++ b/tests/test_request_params/test_form/test_list.py\n@@ -1,7 +1,7 @@\n from typing import Annotated\n \n import pytest\n-from dirty_equals import IsDict, IsOneOf, IsPartialDict\n+from dirty_equals import IsOneOf, IsPartialDict\n from fastapi import FastAPI, Form\n from fastapi.testclient import TestClient\n from pydantic import BaseModel, Field\n@@ -58,28 +58,16 @@ def test_required_list_str_missing(path: str):\n     client = TestClient(app)\n     response = client.post(path)\n     assert response.status_code == 422\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"p\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": IsOneOf(None, {}),\n-                }\n-            ]\n-        }\n-    ) | IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"loc\": [\"body\", \"p\"],\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                }\n-            ]\n-        }\n-    )\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": [\"body\", \"p\"],\n+                \"msg\": \"Field required\",\n+                \"input\": IsOneOf(None, {}),\n+            }\n+        ]\n+    }\n \n \n @pytest.mark.parametrize(\ndiff --git a/tests/test_request_params/test_header/test_list.py b/tests/test_request_params/test_header/test_list.py\nindex 6551009..489a6b3 100644\n--- a/tests/test_request_params/test_header/test_list.py\n+++ b/tests/test_request_params/test_header/test_list.py\n@@ -1,7 +1,7 @@\n from typing import Annotated\n \n import pytest\n-from dirty_equals import AnyThing, IsDict, IsOneOf, IsPartialDict\n+from dirty_equals import AnyThing, IsOneOf, IsPartialDict\n from fastapi import FastAPI, Header\n from fastapi.testclient import TestClient\n from pydantic import BaseModel, Field\n@@ -53,28 +53,16 @@ def test_required_list_str_missing(path: str):\n     client = TestClient(app)\n     response = client.get(path)\n     assert response.status_code == 422\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"header\", \"p\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": AnyThing,\n-                }\n-            ]\n-        }\n-    ) | IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"loc\": [\"header\", \"p\"],\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                }\n-            ]\n-        }\n-    )\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": [\"header\", \"p\"],\n+                \"msg\": \"Field required\",\n+                \"input\": AnyThing,\n+            }\n+        ]\n+    }\n \n \n @pytest.mark.parametrize(\ndiff --git a/tests/test_request_params/test_query/test_list.py b/tests/test_request_params/test_query/test_list.py\nindex ed2ea6c..e933da2 100644\n--- a/tests/test_request_params/test_query/test_list.py\n+++ b/tests/test_request_params/test_query/test_list.py\n@@ -1,7 +1,7 @@\n from typing import Annotated\n \n import pytest\n-from dirty_equals import IsDict, IsOneOf\n+from dirty_equals import IsOneOf\n from fastapi import FastAPI, Query\n from fastapi.testclient import TestClient\n from pydantic import BaseModel, Field\n@@ -53,28 +53,16 @@ def test_required_list_str_missing(path: str):\n     client = TestClient(app)\n     response = client.get(path)\n     assert response.status_code == 422\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"query\", \"p\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": IsOneOf(None, {}),\n-                }\n-            ]\n-        }\n-    ) | IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"loc\": [\"query\", \"p\"],\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                }\n-            ]\n-        }\n-    )\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": [\"query\", \"p\"],\n+                \"msg\": \"Field required\",\n+                \"input\": IsOneOf(None, {}),\n+            }\n+        ]\n+    }\n \n \n @pytest.mark.parametrize("}, {"role": "assistant", "content": "refactor(tests): simplify assertions by removing IsDict alternates"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n vscode-ng-language-service/tools/release.mts | 95 ++++++++++++++++++++++++----\n 1 file changed, 82 insertions(+), 13 deletions(-)\n\ndiff --git a/vscode-ng-language-service/tools/release.mts b/vscode-ng-language-service/tools/release.mts\nindex 37049db9..ef52502c 100644\n--- a/vscode-ng-language-service/tools/release.mts\n+++ b/vscode-ng-language-service/tools/release.mts\n@@ -13,7 +13,7 @@\n  */\n \n // tslint:disable:no-console\n-import {input} from '@inquirer/prompts';\n+import {input, select} from '@inquirer/prompts';\n import chalk from 'chalk';\n import semver from 'semver';\n import {writeFile, readFile} from 'node:fs/promises';\n@@ -68,6 +68,8 @@ async function main(): Promise<void> {\n \n   // Ensure the user has a clean working directory before starting the release process.\n   await checkCleanWorkingDirectory();\n+  // Ensure there is a github token before starting the release process.\n+  ensureGithubToken();\n \n   let branchToReleaseFrom: string | undefined = process.env['BRANCH_TO_RELEASE'];\n   if (!branchToReleaseFrom) {\n@@ -91,10 +93,13 @@ async function main(): Promise<void> {\n   await installDependencies();\n   await buildExtension();\n \n-  await prepareReleasePullRequest(releaseBranch, `${releaseCommitPrefix}${newVersion}`, [\n-    packageJsonPath,\n-    changelogPath,\n-  ]);\n+  const forkRemote = await getForkRemoteName();\n+  await prepareReleasePullRequest(\n+    releaseBranch,\n+    `${releaseCommitPrefix}${newVersion}`,\n+    [packageJsonPath, changelogPath],\n+    forkRemote,\n+  );\n   await waitForPRToBeMergedAndTag(newVersion, branchToReleaseFrom);\n \n   await publishExtension();\n@@ -102,7 +107,7 @@ async function main(): Promise<void> {\n   await createGithubRelease(newVersion, changelog);\n \n   if (branchToReleaseFrom !== 'main') {\n-    await cherryPickChangelog(changelog, newVersion);\n+    await cherryPickChangelog(changelog, newVersion, forkRemote);\n   }\n \n   console.log(chalk.green('VSCode extension release process complete!'));\n@@ -216,10 +221,11 @@ async function prepareReleasePullRequest(\n   branch: string,\n   commitMessage: string,\n   files: string[],\n+  forkRemote: string,\n ): Promise<void> {\n   await exec(`git commit -m \"${commitMessage}\" \"${files.join('\" \"')}\"`);\n-  await exec(`git push origin ${branch} --force-with-lease`);\n-  const {stdout: remoteUrl} = await exec('git remote get-url origin');\n+  await exec(`git push ${forkRemote} ${branch} --force-with-lease`);\n+  const {stdout: remoteUrl} = await exec(`git remote get-url ${forkRemote}`);\n   const {owner, repo} = getRepoDetails(remoteUrl);\n \n   console.log(\n@@ -382,6 +388,17 @@ async function buildExtension(): Promise<void> {\n   console.log(chalk.green(`VSCode extension packaged at ${extensionPath}`));\n }\n \n+function ensureGithubToken(): string {\n+  // https://github.com/angular/dev-infra/blob/8ce8257f740613a7291256173e2706fb2ed8aefa/ng-dev/utils/git/github-yargs.ts#L45\n+  const token = process.env['GITHUB_TOKEN'] ?? process.env['TOKEN'];\n+  if (!token) {\n+    throw new Error(\n+      'GITHUB_TOKEN nor TOKEN environment variable is not set. Cannot create GitHub release.',\n+    );\n+  }\n+  return token;\n+}\n+\n /**\n  * Creates a GitHub release and uploads the extension asset.\n  *\n@@ -389,10 +406,7 @@ async function buildExtension(): Promise<void> {\n  * @param changelog The changelog content for the release.\n  */\n async function createGithubRelease(version: string, changelog: string): Promise<void> {\n-  const token = process.env['GITHUB_TOKEN'];\n-  if (!token) {\n-    throw new Error('GITHUB_TOKEN environment variable is not set. Cannot create GitHub release.');\n-  }\n+  const token = ensureGithubToken();\n \n   console.log(chalk.blue('Creating GitHub release...'));\n \n@@ -478,7 +492,11 @@ async function publishExtension(): Promise<void> {\n  * @param changelog The changelog content to add.\n  * @param newVersion The new version number.\n  */\n-async function cherryPickChangelog(changelog: string, newVersion: string): Promise<void> {\n+async function cherryPickChangelog(\n+  changelog: string,\n+  newVersion: string,\n+  forkRemote: string,\n+): Promise<void> {\n   console.log(chalk.blue('Cherry-picking changelog to main...'));\n \n   await exec(`git stash`);\n@@ -497,6 +515,7 @@ async function cherryPickChangelog(changelog: string, newVersion: string): Promi\n     cherryPickBranch,\n     `docs: release notes for the vscode extension ${newVersion} release`,\n     [changelogPath],\n+    forkRemote,\n   );\n }\n \n@@ -591,6 +610,56 @@ function getTagName(version: string): string {\n   return `${tagPrefix}${version}`;\n }\n \n+/**\n+ * Gets the name of the remote to use as the user's fork.\n+ *\n+ * This function lists all configured remotes and attempts to identify the user's fork.\n+ * - If 'origin' exists and is not the upstream angular repo, it is used.\n+ * - If there are other candidates (remotes that are not the upstream angular repo),\n+ *   it asks the user to select one if there are multiple.\n+ *\n+ * @returns The name of the remote to use.\n+ */\n+async function getForkRemoteName(): Promise<string> {\n+  const {stdout} = await exec('git remote -v');\n+  const remotes = new Map<string, string>();\n+  for (const line of stdout.split('\\n')) {\n+    const parts = line.split(/\\s+/);\n+    if (parts.length >= 2) {\n+      const [name, url] = parts;\n+      remotes.set(name, url);\n+    }\n+  }\n+\n+  const candidates: string[] = [];\n+  for (const [name, url] of remotes) {\n+    if (getRepoDetails(url).owner !== 'angular') {\n+      candidates.push(name);\n+    }\n+  }\n+\n+  // If origin is a candidate, we prefer it appropriately IF it's likely the user's fork.\n+  // The check `getRepoDetails(url).owner !== 'angular'` already filters out upstream.\n+  // So if `origin` is in candidates, it's safe to use?\n+  // User wanted: \"If origin exists and is a candidate ... return 'origin'\".\n+  if (candidates.includes('origin')) {\n+    return 'origin';\n+  }\n+\n+  if (candidates.length === 0) {\n+    throw new Error('No suitable fork remote found. Please add a remote for your fork.');\n+  }\n+\n+  if (candidates.length === 1) {\n+    return candidates[0];\n+  }\n+\n+  return await select({\n+    message: 'Which remote should be used as your fork (to push the release commit to for the PR)?',\n+    choices: candidates.map((c) => ({value: c})),\n+  });\n+}\n+\n // Start the release process.\n main().catch((err) => {\n   console.error(chalk.red(err));"}, {"role": "assistant", "content": "build: Update vscode release script"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 52166f4..46488d3 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -22,6 +22,7 @@ hide:\n \n ### Internal\n \n+* \u2b06 Bump actions/download-artifact from 6 to 7. PR [#14526](https://github.com/fastapi/fastapi/pull/14526) by [@dependabot[bot]](https://github.com/apps/dependabot).\n * \ud83d\udc77 Tweak CI input names. PR [#14688](https://github.com/fastapi/fastapi/pull/14688) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udd28 Refactor translation script to allow committing in place. PR [#14687](https://github.com/fastapi/fastapi/pull/14687) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc1b Fix translation script path. PR [#14685](https://github.com/fastapi/fastapi/pull/14685) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: add dependabot bump to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_hir_typeck/src/pat.rs  | 13 ++++----\n tests/ui/pattern/type_mismatch.rs     | 63 ++++++++++++++++++++++++++++++++++-\n tests/ui/pattern/type_mismatch.stderr | 61 +++++++++++++++++++++++++++++++--\n 3 files changed, 128 insertions(+), 9 deletions(-)\n\ndiff --git a/compiler/rustc_hir_typeck/src/pat.rs b/compiler/rustc_hir_typeck/src/pat.rs\nindex 90e22b2cd38..b56ab6dcb4a 100644\n--- a/compiler/rustc_hir_typeck/src/pat.rs\n+++ b/compiler/rustc_hir_typeck/src/pat.rs\n@@ -1512,11 +1512,14 @@ fn check_pat_struct(\n         pat_info: PatInfo<'tcx>,\n     ) -> Ty<'tcx> {\n         // Type-check the path.\n-        let _ = self.demand_eqtype_pat(pat.span, expected, pat_ty, &pat_info.top_info);\n+        let had_err = self.demand_eqtype_pat(pat.span, expected, pat_ty, &pat_info.top_info);\n \n         // Type-check subpatterns.\n         match self.check_struct_pat_fields(pat_ty, pat, variant, fields, has_rest_pat, pat_info) {\n-            Ok(()) => pat_ty,\n+            Ok(()) => match had_err {\n+                Ok(()) => pat_ty,\n+                Err(guar) => Ty::new_error(self.tcx, guar),\n+            },\n             Err(guar) => Ty::new_error(self.tcx, guar),\n         }\n     }\n@@ -1764,8 +1767,7 @@ fn check_pat_tuple_struct(\n         };\n \n         // Type-check the tuple struct pattern against the expected type.\n-        let diag = self.demand_eqtype_pat_diag(pat.span, expected, pat_ty, &pat_info.top_info);\n-        let had_err = diag.map_err(|diag| diag.emit());\n+        let had_err = self.demand_eqtype_pat(pat.span, expected, pat_ty, &pat_info.top_info);\n \n         // Type-check subpatterns.\n         if subpats.len() == variant.fields.len()\n@@ -1989,11 +1991,10 @@ fn check_pat_tuple(\n         if let Err(reported) = self.demand_eqtype_pat(span, expected, pat_ty, &pat_info.top_info) {\n             // Walk subpatterns with an expected type of `err` in this case to silence\n             // further errors being emitted when using the bindings. #50333\n-            let element_tys_iter = (0..max_len).map(|_| Ty::new_error(tcx, reported));\n             for (_, elem) in elements.iter().enumerate_and_adjust(max_len, ddpos) {\n                 self.check_pat(elem, Ty::new_error(tcx, reported), pat_info);\n             }\n-            Ty::new_tup_from_iter(tcx, element_tys_iter)\n+            Ty::new_error(tcx, reported)\n         } else {\n             for (i, elem) in elements.iter().enumerate_and_adjust(max_len, ddpos) {\n                 self.check_pat(elem, element_tys[i], pat_info);\ndiff --git a/tests/ui/pattern/type_mismatch.rs b/tests/ui/pattern/type_mismatch.rs\nindex 408ff758847..39d57301e98 100644\n--- a/tests/ui/pattern/type_mismatch.rs\n+++ b/tests/ui/pattern/type_mismatch.rs\n@@ -1,4 +1,4 @@\n-//! This test used to ICE: rust-lang/rust#109812\n+//! These tests used to ICE: rust-lang/rust#109812, rust-lang/rust#150507\n //! Instead of actually analyzing the erroneous patterns,\n //! we instead stop after typeck where errors are already\n //! reported.\n@@ -8,12 +8,21 @@\n enum Either {\n     One(X),\n     Two(X),\n+    Three { a: X },\n }\n \n struct X(Y);\n \n struct Y;\n \n+struct Z(*const i32);\n+unsafe impl Send for Z {}\n+\n+enum Meow {\n+    A { a: Z },\n+    B(Z),\n+}\n+\n fn consume_fnmut(_: impl FnMut()) {}\n \n fn move_into_fnmut() {\n@@ -25,6 +34,58 @@ fn move_into_fnmut() {\n \n         let X(mut _t) = x;\n     });\n+\n+    consume_fnmut(|| {\n+        let Either::Three { a: ref mut _t } = x;\n+        //~^ ERROR: mismatched types\n+\n+        let X(mut _t) = x;\n+    });\n+}\n+\n+fn tuple_against_array() {\n+    let variant: [();1] = [()];\n+\n+    || match variant {\n+        (2,) => (),\n+        //~^ ERROR: mismatched types\n+        _ => {}\n+    };\n+\n+    || {\n+        let ((2,) | _) = variant;\n+        //~^ ERROR: mismatched types\n+    };\n+}\n+\n+// Reproducer that triggers the compatibility lint more reliably, instead of relying on the fact\n+// that at the time of writing, an unresolved integer type variable does not implement any\n+// auto-traits.\n+//\n+// The @_ makes this example also reproduce ICE #150507 before PR #138961\n+fn arcane() {\n+    let variant: [();1] = [()];\n+\n+    || {\n+        match variant {\n+            (Z(y@_),) => {}\n+            //~^ ERROR: mismatched types\n+        }\n+    };\n+\n+    || {\n+        match variant {\n+            Meow::A { a: Z(y@_) } => {}\n+            //~^ ERROR: mismatched types\n+        }\n+    };\n+\n+    || {\n+        match variant {\n+            Meow::B(Z(y@_)) => {}\n+            //~^ ERROR: mismatched types\n+        }\n+    };\n }\n \n fn main() {}\ndiff --git a/tests/ui/pattern/type_mismatch.stderr b/tests/ui/pattern/type_mismatch.stderr\nindex b0441b1fadc..3f24b2e7069 100644\n--- a/tests/ui/pattern/type_mismatch.stderr\n+++ b/tests/ui/pattern/type_mismatch.stderr\n@@ -1,11 +1,68 @@\n error[E0308]: mismatched types\n-  --> $DIR/type_mismatch.rs:23:13\n+  --> $DIR/type_mismatch.rs:32:13\n    |\n LL |         let Either::Two(ref mut _t) = x;\n    |             ^^^^^^^^^^^^^^^^^^^^^^^   - this expression has type `X`\n    |             |\n    |             expected `X`, found `Either`\n \n-error: aborting due to 1 previous error\n+error[E0308]: mismatched types\n+  --> $DIR/type_mismatch.rs:39:13\n+   |\n+LL |         let Either::Three { a: ref mut _t } = x;\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^   - this expression has type `X`\n+   |             |\n+   |             expected `X`, found `Either`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/type_mismatch.rs:50:9\n+   |\n+LL |     || match variant {\n+   |              ------- this expression has type `[(); 1]`\n+LL |         (2,) => (),\n+   |         ^^^^ expected `[(); 1]`, found `(_,)`\n+   |\n+   = note: expected array `[(); 1]`\n+              found tuple `(_,)`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/type_mismatch.rs:56:14\n+   |\n+LL |         let ((2,) | _) = variant;\n+   |              ^^^^        ------- this expression has type `[(); 1]`\n+   |              |\n+   |              expected `[(); 1]`, found `(_,)`\n+   |\n+   = note: expected array `[(); 1]`\n+              found tuple `(_,)`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/type_mismatch.rs:71:13\n+   |\n+LL |         match variant {\n+   |               ------- this expression has type `[(); 1]`\n+LL |             (Z(y@_),) => {}\n+   |             ^^^^^^^^^ expected `[(); 1]`, found `(_,)`\n+   |\n+   = note: expected array `[(); 1]`\n+              found tuple `(_,)`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/type_mismatch.rs:78:13\n+   |\n+LL |         match variant {\n+   |               ------- this expression has type `[(); 1]`\n+LL |             Meow::A { a: Z(y@_) } => {}\n+   |             ^^^^^^^^^^^^^^^^^^^^^ expected `[(); 1]`, found `Meow`\n+\n+error[E0308]: mismatched types\n+  --> $DIR/type_mismatch.rs:85:13\n+   |\n+LL |         match variant {\n+   |               ------- this expression has type `[(); 1]`\n+LL |             Meow::B(Z(y@_)) => {}\n+   |             ^^^^^^^^^^^^^^^ expected `[(); 1]`, found `Meow`\n+\n+error: aborting due to 7 previous errors\n \n For more information about this error, try `rustc --explain E0308`."}, {"role": "assistant", "content": "fix(typeck): propagate type errors in struct and tuple patterns"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n packages/compiler/src/expression_parser/lexer.ts   | 28 +++++++++++++++-------\n .../compiler/test/expression_parser/lexer_spec.ts  | 24 +++++++++++++++++++\n 2 files changed, 44 insertions(+), 8 deletions(-)\n\ndiff --git a/packages/compiler/src/expression_parser/lexer.ts b/packages/compiler/src/expression_parser/lexer.ts\nindex f18bfc27..c91bf800 100644\n--- a/packages/compiler/src/expression_parser/lexer.ts\n+++ b/packages/compiler/src/expression_parser/lexer.ts\n@@ -343,15 +343,9 @@ class _Scanner {\n       case chars.$GT:\n         return this.scanComplexOperator(start, String.fromCharCode(peek), chars.$EQ, '=');\n       case chars.$BANG:\n+        return this.scanComplexOperator(start, '!', chars.$EQ, '=', chars.$EQ, '=');\n       case chars.$EQ:\n-        return this.scanComplexOperator(\n-          start,\n-          String.fromCharCode(peek),\n-          chars.$EQ,\n-          '=',\n-          chars.$EQ,\n-          '=',\n-        );\n+        return this.scanEquals(start);\n       case chars.$AMPERSAND:\n         return this.scanComplexOperator(start, '&', chars.$AMPERSAND, '&', chars.$EQ, '=');\n       case chars.$BAR:\n@@ -424,6 +418,24 @@ class _Scanner {\n     return newOperatorToken(start, this.index, str);\n   }\n \n+  private scanEquals(start: number): Token {\n+    this.advance();\n+    let str: string = '=';\n+    if (this.peek === chars.$EQ) {\n+      this.advance();\n+      str += '=';\n+    } else if (this.peek === chars.$GT) {\n+      this.advance();\n+      str += '>';\n+      return newOperatorToken(start, this.index, str);\n+    }\n+    if (this.peek === chars.$EQ) {\n+      this.advance();\n+      str += '=';\n+    }\n+    return newOperatorToken(start, this.index, str);\n+  }\n+\n   private scanIdentifier(): Token {\n     const start: number = this.index;\n     this.advance();\ndiff --git a/packages/compiler/test/expression_parser/lexer_spec.ts b/packages/compiler/test/expression_parser/lexer_spec.ts\nindex 31cbbba8..00ebb071 100644\n--- a/packages/compiler/test/expression_parser/lexer_spec.ts\n+++ b/packages/compiler/test/expression_parser/lexer_spec.ts\n@@ -967,6 +967,30 @@ describe('lexer', () => {\n           'Lexer Error: Unterminated regular expression at column 2 in expression [/a]',\n         );\n       });\n+\n+      it('should tokenize an arrow function without parenthesis', () => {\n+        const tokens = lex('a => a + 1');\n+        expect(tokens.length).toBe(5);\n+        expectIdentifierToken(tokens[0], 0, 1, 'a');\n+        expectOperatorToken(tokens[1], 2, 4, '=>');\n+        expectIdentifierToken(tokens[2], 5, 6, 'a');\n+        expectOperatorToken(tokens[3], 7, 8, '+');\n+        expectNumberToken(tokens[4], 9, 10, 1);\n+      });\n+\n+      it('should tokenize an arrow function with parenthesis', () => {\n+        const tokens = lex('(a, b) => a + b');\n+        expect(tokens.length).toBe(9);\n+        expectCharacterToken(tokens[0], 0, 1, '(');\n+        expectIdentifierToken(tokens[1], 1, 2, 'a');\n+        expectCharacterToken(tokens[2], 2, 3, ',');\n+        expectIdentifierToken(tokens[3], 4, 5, 'b');\n+        expectCharacterToken(tokens[4], 5, 6, ')');\n+        expectOperatorToken(tokens[5], 7, 9, '=>');\n+        expectIdentifierToken(tokens[6], 10, 11, 'a');\n+        expectOperatorToken(tokens[7], 12, 13, '+');\n+        expectIdentifierToken(tokens[8], 14, 15, 'b');\n+      });\n     });\n   });\n });"}, {"role": "assistant", "content": "refactor(compiler): tokenize =>"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/management-tasks.md | 27 +++++++--------------------\n 1 file changed, 7 insertions(+), 20 deletions(-)\n\ndiff --git a/docs/en/docs/management-tasks.md b/docs/en/docs/management-tasks.md\nindex 68d10a4..6f34afb 100644\n--- a/docs/en/docs/management-tasks.md\n+++ b/docs/en/docs/management-tasks.md\n@@ -74,7 +74,7 @@ Make sure you use a supported label from the <a href=\"https://github.com/tiangol\n * `refactor`: Refactors\n     * This is normally for changes to the internal code that don't change the behavior. Normally it improves maintainability, or enables future features, etc.\n * `upgrade`: Upgrades\n-    * This is for upgrades to direct dependencies from the project, or extra optional dependencies, normally in `pyproject.toml`. So, things that would affect final users, they would end up receiving the upgrade in their code base once they update. But this is not for upgrades to internal dependencies used for development, testing, docs, etc. Those internal dependencies, normally in `requirements.txt` files or GitHub Action versions should be marked as `internal`, not `upgrade`.\n+    * This is for upgrades to direct dependencies from the project, or extra optional dependencies, normally in `pyproject.toml`. So, things that would affect final users, they would end up receiving the upgrade in their code base once they update. But this is not for upgrades to internal dependencies used for development, testing, docs, etc. Those internal dependencies or GitHub Action versions should be marked as `internal`, not `upgrade`.\n * `docs`: Docs\n     * Changes in docs. This includes updating the docs, fixing typos. But it doesn't include changes to translations.\n     * You can normally quickly detect it by going to the \"Files changed\" tab in the PR and checking if the updated file(s) starts with `docs/en/docs`. The original version of the docs is always in English, so in `docs/en/docs`.\n@@ -118,9 +118,11 @@ For these language translation PRs, confirm that:\n \n ## Review PRs\n \n-If a PR doesn't explain what it does or why, ask for more information.\n+* If a PR doesn't explain what it does or why, if it seems like it could be useful, ask for more information. Otherwise, feel free to close it.\n \n-A PR should have a specific use case that it is solving.\n+* If a PR seems to be spam, meaningless, only to change statistics (to appear as \"contributor\") or similar, you can simply mark it as `invalid`, and it will be automatically closed.\n+\n+* A PR should have a specific use case that it is solving.\n \n * If the PR is for a feature, it should have docs.\n     * Unless it's a feature we want to discourage, like support for a corner case that we don't want users to use.\n@@ -140,27 +142,12 @@ Every month, a GitHub Action updates the FastAPI People data. Those PRs look lik\n \n If the tests are passing, you can merge it right away.\n \n-## External Links PRs\n-\n-When people add external links they edit this file <a href=\"https://github.com/fastapi/fastapi/blob/master/docs/en/data/external_links.yml\" class=\"external-link\" target=\"_blank\">external_links.yml</a>.\n-\n-* Make sure the new link is in the correct category (e.g. \"Podcasts\") and language (e.g. \"Japanese\").\n-* A new link should be at the top of its list.\n-* The link URL should work (it should not return a 404).\n-* The content of the link should be about FastAPI.\n-* The new addition should have these fields:\n-    * `author`: The name of the author.\n-    * `link`: The URL with the content.\n-    * `title`: The title of the link (the title of the article, podcast, etc).\n-\n-After checking all these things and ensuring the PR has the right labels, you can merge it.\n-\n ## Dependabot PRs\n \n Dependabot will create PRs to update dependencies for several things, and those PRs all look similar, but some are way more delicate than others.\n \n-* If the PR is for a direct dependency, so, Dependabot is modifying `pyproject.toml`, **don't merge it**. \ud83d\ude31 Let me check it first. There's a good chance that some additional tweaks or updates are needed.\n-* If the PR updates one of the internal dependencies, for example it's modifying `requirements.txt` files, or GitHub Action versions, if the tests are passing, the release notes (shown in a summary in the PR) don't show any obvious potential breaking change, you can merge it. \ud83d\ude0e\n+* If the PR is for a direct dependency, so, Dependabot is modifying `pyproject.toml` in the main dependencies, **don't merge it**. \ud83d\ude31 Let me check it first. There's a good chance that some additional tweaks or updates are needed.\n+* If the PR updates one of the internal dependencies, for example the group `dev` in `pyproject.toml`, or GitHub Action versions, if the tests are passing, the release notes (shown in a summary in the PR) don't show any obvious potential breaking change, you can merge it. \ud83d\ude0e\n \n ## Mark GitHub Discussions Answers\n "}, {"role": "assistant", "content": "docs: simplify management tasks documentation"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n tests/rustdoc-gui/utils.goml | 30 ++++++++++++++++++++++++------\n 1 file changed, 24 insertions(+), 6 deletions(-)"}, {"role": "assistant", "content": "test: improve rustdoc-gui utils test coverage"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/deploy-docs.yml | 2 +-\n .github/workflows/smokeshow.yml   | 2 +-\n .github/workflows/test.yml        | 2 +-\n 3 files changed, 3 insertions(+), 3 deletions(-)\n\ndiff --git a/.github/workflows/deploy-docs.yml b/.github/workflows/deploy-docs.yml\nindex 79d7391..734fc24 100644\n--- a/.github/workflows/deploy-docs.yml\n+++ b/.github/workflows/deploy-docs.yml\n@@ -45,7 +45,7 @@ jobs:\n         run: |\n           rm -rf ./site\n           mkdir ./site\n-      - uses: actions/download-artifact@v6\n+      - uses: actions/download-artifact@v7\n         with:\n           path: ./site/\n           pattern: docs-site-*\ndiff --git a/.github/workflows/smokeshow.yml b/.github/workflows/smokeshow.yml\nindex 1a45174..f23b962 100644\n--- a/.github/workflows/smokeshow.yml\n+++ b/.github/workflows/smokeshow.yml\n@@ -28,7 +28,7 @@ jobs:\n             pyproject.toml\n             uv.lock\n       - run: uv sync --locked --no-dev --group github-actions\n-      - uses: actions/download-artifact@v6\n+      - uses: actions/download-artifact@v7\n         with:\n           name: coverage-html\n           path: htmlcov\ndiff --git a/.github/workflows/test.yml b/.github/workflows/test.yml\nindex 4d45c20..605d7c8 100644\n--- a/.github/workflows/test.yml\n+++ b/.github/workflows/test.yml\n@@ -112,7 +112,7 @@ jobs:\n       - name: Install Dependencies\n         run: uv sync --locked --no-dev --group tests --extra all\n       - name: Get coverage files\n-        uses: actions/download-artifact@v6\n+        uses: actions/download-artifact@v7\n         with:\n           pattern: coverage-*\n           path: coverage"}, {"role": "assistant", "content": "ci: update download-artifact action to v7"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 7727fa6..2a2b0d6 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -9,6 +9,7 @@ hide:\n \n ### Docs\n \n+* \ud83d\udcdd Update docs for contributing with translations. PR [#14701](https://github.com/fastapi/fastapi/pull/14701) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udcdd Specify language code for code block. PR [#14656](https://github.com/fastapi/fastapi/pull/14656) by [@YuriiMotov](https://github.com/YuriiMotov).\n \n ### Translations"}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/runtime-core/src/apiAsyncComponent.ts | 5 ++++-\n 1 file changed, 4 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/runtime-core/src/apiAsyncComponent.ts b/packages/runtime-core/src/apiAsyncComponent.ts\nindex f5ba778..e594944 100644\n--- a/packages/runtime-core/src/apiAsyncComponent.ts\n+++ b/packages/runtime-core/src/apiAsyncComponent.ts\n@@ -241,7 +241,10 @@ export function defineAsyncComponent<\n             error: error.value,\n           })\n         } else if (loadingComponent && !delayed.value) {\n-          return createVNode(loadingComponent)\n+          return createInnerComp(\n+            loadingComponent as ConcreteComponent,\n+            instance,\n+          )\n         }\n       }\n     },"}, {"role": "assistant", "content": "fix(async-component): pass instance context to loading component"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n packages/react-reconciler/src/ReactFiberCommitViewTransitions.js | 6 +++++-\n 1 file changed, 5 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/react-reconciler/src/ReactFiberCommitViewTransitions.js b/packages/react-reconciler/src/ReactFiberCommitViewTransitions.js\nindex 20abaa6..64940c3 100644\n--- a/packages/react-reconciler/src/ReactFiberCommitViewTransitions.js\n+++ b/packages/react-reconciler/src/ReactFiberCommitViewTransitions.js\n@@ -711,7 +711,11 @@ function measureViewTransitionHostInstancesRecursive(\n         }\n         viewTransitionCancelableChildren.push(\n           instance,\n-          oldName,\n+          viewTransitionHostInstanceIdx === 0\n+            ? oldName\n+            : // If we have multiple Host Instances below, we add a suffix to the name to give\n+              // each one a unique name.\n+              oldName + '_' + viewTransitionHostInstanceIdx,\n           child.memoizedProps,\n         );\n       }"}, {"role": "assistant", "content": "fix(reconciler): add unique suffix to view transition names for multiple"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../runtime-core/src/compat/componentVModel.ts     | 10 +++++-\n .../vue-compat/__tests__/componentVModel.spec.ts   | 37 ++++++++++++++++++++++\n 2 files changed, 46 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/runtime-core/src/compat/componentVModel.ts b/packages/runtime-core/src/compat/componentVModel.ts\nindex 7a9fea9..a994a67 100644\n--- a/packages/runtime-core/src/compat/componentVModel.ts\n+++ b/packages/runtime-core/src/compat/componentVModel.ts\n@@ -1,5 +1,6 @@\n import { ShapeFlags, extend } from '@vue/shared'\n import type { ComponentInternalInstance, ComponentOptions } from '../component'\n+import { createAppContext } from '../apiCreateApp'\n import { ErrorCodes, callWithErrorHandling } from '../errorHandling'\n import type { VNode } from '../vnode'\n import { popWarningContext, pushWarningContext } from '../warning'\n@@ -31,7 +32,14 @@ export function convertLegacyVModelProps(vnode: VNode): void {\n \n     if (__DEV__ && !warnedTypes.has(comp)) {\n       pushWarningContext(vnode)\n-      warnDeprecation(DeprecationTypes.COMPONENT_V_MODEL, { type } as any, comp)\n+      warnDeprecation(\n+        DeprecationTypes.COMPONENT_V_MODEL,\n+        {\n+          type,\n+          appContext: (vnode.ctx && vnode.ctx.appContext) || createAppContext(),\n+        } as any,\n+        comp,\n+      )\n       popWarningContext()\n       warnedTypes.add(comp)\n     }\ndiff --git a/packages/vue-compat/__tests__/componentVModel.spec.ts b/packages/vue-compat/__tests__/componentVModel.spec.ts\nindex 5ef1995..0c85d3f 100644\n--- a/packages/vue-compat/__tests__/componentVModel.spec.ts\n+++ b/packages/vue-compat/__tests__/componentVModel.spec.ts\n@@ -140,4 +140,41 @@ describe('COMPONENT_V_MODEL', () => {\n       template: `<input :value=\"foo\" @input=\"$emit('bar', $event.target.value)\">`,\n     })\n   })\n+\n+  // #14202\n+  test('should handle v-model deprecation warning with missing appContext', async () => {\n+    const ChildComponent = {\n+      template: `<div @click=\"$emit('input', 'new val')\">{{ value }}</div>`,\n+      props: ['value'],\n+    }\n+\n+    const vm = new Vue({\n+      components: { ChildComponent },\n+      data() {\n+        return {\n+          myVal: 'initial',\n+        }\n+      },\n+      template: `\n+        <div>\n+          <child-component v-model=\"myVal\"></child-component>\n+        </div>\n+      `,\n+    }).$mount() as any\n+\n+    expect(vm.$el.textContent).toContain('initial')\n+\n+    expect(\n+      (deprecationData[DeprecationTypes.COMPONENT_V_MODEL].message as Function)(\n+        ChildComponent,\n+      ),\n+    ).toHaveBeenWarned()\n+\n+    // Should work correctly\n+    const child = vm.$el.querySelector('div')\n+    child.click()\n+    await nextTick()\n+    expect(vm.myVal).toBe('new val')\n+    expect(vm.$el.textContent).toContain('new val')\n+  })\n })"}, {"role": "assistant", "content": "fix(compat): handle missing appContext in v-model deprecation warning"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .github/workflows/autofix.yml     | 2 +-\n .github/workflows/ci.yml          | 2 +-\n .github/workflows/release.yml     | 2 +-\n .github/workflows/size-data.yml   | 2 +-\n .github/workflows/size-report.yml | 2 +-\n .github/workflows/test.yml        | 8 ++++----\n 6 files changed, 9 insertions(+), 9 deletions(-)\n\ndiff --git a/.github/workflows/autofix.yml b/.github/workflows/autofix.yml\nindex 27ae80c..42eacd3 100644\n--- a/.github/workflows/autofix.yml\n+++ b/.github/workflows/autofix.yml\n@@ -11,7 +11,7 @@ jobs:\n     env:\n       PUPPETEER_SKIP_DOWNLOAD: 'true'\n     steps:\n-      - uses: actions/checkout@v5\n+      - uses: actions/checkout@v6\n \n       - name: Install pnpm\n         uses: pnpm/action-setup@v4.2.0\ndiff --git a/.github/workflows/ci.yml b/.github/workflows/ci.yml\nindex ee9fd61..e93c164 100644\n--- a/.github/workflows/ci.yml\n+++ b/.github/workflows/ci.yml\n@@ -20,7 +20,7 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - name: Checkout\n-        uses: actions/checkout@v5\n+        uses: actions/checkout@v6\n \n       - name: Install pnpm\n         uses: pnpm/action-setup@v4\ndiff --git a/.github/workflows/release.yml b/.github/workflows/release.yml\nindex 645495a..14ba7b5 100644\n--- a/.github/workflows/release.yml\n+++ b/.github/workflows/release.yml\n@@ -21,7 +21,7 @@ jobs:\n     environment: Release\n     steps:\n       - name: Checkout\n-        uses: actions/checkout@v5\n+        uses: actions/checkout@v6\n \n       - name: Install pnpm\n         uses: pnpm/action-setup@v4\ndiff --git a/.github/workflows/size-data.yml b/.github/workflows/size-data.yml\nindex 55357b9..182c9b5 100644\n--- a/.github/workflows/size-data.yml\n+++ b/.github/workflows/size-data.yml\n@@ -22,7 +22,7 @@ jobs:\n     runs-on: ubuntu-latest\n \n     steps:\n-      - uses: actions/checkout@v5\n+      - uses: actions/checkout@v6\n \n       - name: Install pnpm\n         uses: pnpm/action-setup@v4.2.0\ndiff --git a/.github/workflows/size-report.yml b/.github/workflows/size-report.yml\nindex af54b7a..a75e68c 100644\n--- a/.github/workflows/size-report.yml\n+++ b/.github/workflows/size-report.yml\n@@ -22,7 +22,7 @@ jobs:\n       github.event.workflow_run.event == 'pull_request' &&\n       github.event.workflow_run.conclusion == 'success'\n     steps:\n-      - uses: actions/checkout@v5\n+      - uses: actions/checkout@v6\n \n       - name: Install pnpm\n         uses: pnpm/action-setup@v4.2.0\ndiff --git a/.github/workflows/test.yml b/.github/workflows/test.yml\nindex 2fa2b53..efcca4b 100644\n--- a/.github/workflows/test.yml\n+++ b/.github/workflows/test.yml\n@@ -11,7 +11,7 @@ jobs:\n     env:\n       PUPPETEER_SKIP_DOWNLOAD: 'true'\n     steps:\n-      - uses: actions/checkout@v5\n+      - uses: actions/checkout@v6\n \n       - name: Install pnpm\n         uses: pnpm/action-setup@v4.2.0\n@@ -32,7 +32,7 @@ jobs:\n     env:\n       PUPPETEER_SKIP_DOWNLOAD: 'true'\n     steps:\n-      - uses: actions/checkout@v5\n+      - uses: actions/checkout@v6\n \n       - name: Install pnpm\n         uses: pnpm/action-setup@v4.2.0\n@@ -54,7 +54,7 @@ jobs:\n   e2e-test:\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: actions/checkout@v5\n+      - uses: actions/checkout@v6\n \n       - name: Setup cache for Chromium binary\n         uses: actions/cache@v4\n@@ -85,7 +85,7 @@ jobs:\n     env:\n       PUPPETEER_SKIP_DOWNLOAD: 'true'\n     steps:\n-      - uses: actions/checkout@v5\n+      - uses: actions/checkout@v6\n \n       - name: Install pnpm\n         uses: pnpm/action-setup@v4.2.0"}, {"role": "assistant", "content": "ci: bump actions/checkout from v5 to v6"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex 1df9e63..628eff3 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -9,6 +9,7 @@ hide:\n \n ### Docs\n \n+* \ud83d\udcdd Update docs for management tasks. PR [#14705](https://github.com/fastapi/fastapi/pull/14705) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udcdd Update docs about managing translations. PR [#14704](https://github.com/fastapi/fastapi/pull/14704) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udcdd Update docs for contributing with translations. PR [#14701](https://github.com/fastapi/fastapi/pull/14701) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udcdd Specify language code for code block. PR [#14656](https://github.com/fastapi/fastapi/pull/14656) by [@YuriiMotov](https://github.com/YuriiMotov)."}, {"role": "assistant", "content": "docs: update release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n INSTALL.md | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/INSTALL.md b/INSTALL.md\nindex 98eb825cd10..dd6c64b3df5 100644\n--- a/INSTALL.md\n+++ b/INSTALL.md\n@@ -97,7 +97,7 @@ See [the rustc-dev-guide for more info][sysllvm].\n       --set llvm.ninja=false \\\n       --set rust.debug-assertions=false \\\n       --set rust.jemalloc \\\n-      --set rust.use-lld=true \\\n+      --set rust.bootstrap-override-lld=true \\\n       --set rust.lto=thin \\\n       --set rust.codegen-units=1\n    ```"}, {"role": "assistant", "content": "docs: update rust config option name"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/docs/release-notes.md | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/docs/en/docs/release-notes.md b/docs/en/docs/release-notes.md\nindex c1d2456..f7d8cb5 100644\n--- a/docs/en/docs/release-notes.md\n+++ b/docs/en/docs/release-notes.md\n@@ -19,6 +19,7 @@ hide:\n \n ### Internal\n \n+* \u2b06\ufe0f  Migrate to uv. PR [#14676](https://github.com/fastapi/fastapi/pull/14676) by [@DoctorJohn](https://github.com/DoctorJohn).\n * \ud83d\udd28 Add LLM translations tool fixer. PR [#14652](https://github.com/fastapi/fastapi/pull/14652) by [@YuriiMotov](https://github.com/YuriiMotov).\n * \ud83d\udc65 Update FastAPI People - Sponsors. PR [#14626](https://github.com/fastapi/fastapi/pull/14626) by [@tiangolo](https://github.com/tiangolo).\n * \ud83d\udc65 Update FastAPI GitHub topic repositories. PR [#14630](https://github.com/fastapi/fastapi/pull/14630) by [@tiangolo](https://github.com/tiangolo)."}, {"role": "assistant", "content": "docs: add uv migration to release notes"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n compiler/rustc_parse/src/parser/generics.rs        | 26 +++++++-\n tests/ui/const-generics/incorrect-const-param.rs   | 45 ++++++++++++++\n .../ui/const-generics/incorrect-const-param.stderr | 70 ++++++++++++++++++++++\n 3 files changed, 140 insertions(+), 1 deletion(-)\n\ndiff --git a/compiler/rustc_parse/src/parser/generics.rs b/compiler/rustc_parse/src/parser/generics.rs\nindex 2c76c0fe358..ef6c9cc344c 100644\n--- a/compiler/rustc_parse/src/parser/generics.rs\n+++ b/compiler/rustc_parse/src/parser/generics.rs\n@@ -109,7 +109,31 @@ pub(crate) fn parse_const_param(\n \n         self.expect_keyword(exp!(Const))?;\n         let ident = self.parse_ident()?;\n-        self.expect(exp!(Colon))?;\n+        if let Err(mut err) = self.expect(exp!(Colon)) {\n+            return if self.token.kind == token::Comma || self.token.kind == token::Gt {\n+                // Recover parse from `<const N>` where the type is missing.\n+                let span = const_span.to(ident.span);\n+                err.span_suggestion_verbose(\n+                    ident.span.shrink_to_hi(),\n+                    \"you likely meant to write the type of the const parameter here\",\n+                    \": /* Type */\".to_string(),\n+                    Applicability::HasPlaceholders,\n+                );\n+                let kind = TyKind::Err(err.emit());\n+                let ty = self.mk_ty(span, kind);\n+                Ok(GenericParam {\n+                    ident,\n+                    id: ast::DUMMY_NODE_ID,\n+                    attrs: preceding_attrs,\n+                    bounds: Vec::new(),\n+                    kind: GenericParamKind::Const { ty, span, default: None },\n+                    is_placeholder: false,\n+                    colon_span: None,\n+                })\n+            } else {\n+                Err(err)\n+            };\n+        }\n         let ty = self.parse_ty()?;\n \n         // Parse optional const generics default value.\ndiff --git a/tests/ui/const-generics/incorrect-const-param.rs b/tests/ui/const-generics/incorrect-const-param.rs\nnew file mode 100644\nindex 00000000000..5f1d8ca2ae9\n--- /dev/null\n+++ b/tests/ui/const-generics/incorrect-const-param.rs\n@@ -0,0 +1,45 @@\n+// #84327\n+\n+struct VecWrapper<T>(Vec<T>);\n+\n+// Correct\n+impl<T, const N: usize> From<[T; N]> for VecWrapper<T>\n+where\n+    T: Clone,\n+{\n+    fn from(slice: [T; N]) -> Self {\n+        VecWrapper(slice.to_vec())\n+    }\n+}\n+\n+// Forgot const\n+impl<T, N: usize> From<[T; N]> for VecWrapper<T> //~ ERROR expected value, found type parameter `N`\n+where //~^ ERROR expected trait, found builtin type `usize`\n+    T: Clone,\n+{\n+    fn from(slice: [T; N]) -> Self { //~ ERROR expected value, found type parameter `N`\n+        VecWrapper(slice.to_vec())\n+    }\n+}\n+\n+// Forgot type\n+impl<T, const N> From<[T; N]> for VecWrapper<T> //~ ERROR expected `:`, found `>`\n+where\n+    T: Clone,\n+{\n+    fn from(slice: [T; N]) -> Self {\n+        VecWrapper(slice.to_vec())\n+    }\n+}\n+\n+// Forgot const and type\n+impl<T, N> From<[T; N]> for VecWrapper<T> //~ ERROR expected value, found type parameter `N`\n+where\n+    T: Clone,\n+{\n+    fn from(slice: [T; N]) -> Self { //~ ERROR expected value, found type parameter `N`\n+        VecWrapper(slice.to_vec())\n+    }\n+}\n+\n+fn main() {}\ndiff --git a/tests/ui/const-generics/incorrect-const-param.stderr b/tests/ui/const-generics/incorrect-const-param.stderr\nnew file mode 100644\nindex 00000000000..c5cf54500ee\n--- /dev/null\n+++ b/tests/ui/const-generics/incorrect-const-param.stderr\n@@ -0,0 +1,70 @@\n+error: expected `:`, found `>`\n+  --> $DIR/incorrect-const-param.rs:26:16\n+   |\n+LL | impl<T, const N> From<[T; N]> for VecWrapper<T>\n+   |                ^ expected `:`\n+   |\n+help: you likely meant to write the type of the const parameter here\n+   |\n+LL | impl<T, const N: /* Type */> From<[T; N]> for VecWrapper<T>\n+   |                ++++++++++++\n+\n+error[E0423]: expected value, found type parameter `N`\n+  --> $DIR/incorrect-const-param.rs:16:28\n+   |\n+LL | impl<T, N: usize> From<[T; N]> for VecWrapper<T>\n+   |         -                  ^ not a value\n+   |         |\n+   |         found this type parameter\n+\n+error[E0404]: expected trait, found builtin type `usize`\n+  --> $DIR/incorrect-const-param.rs:16:12\n+   |\n+LL | impl<T, N: usize> From<[T; N]> for VecWrapper<T>\n+   |            ^^^^^ not a trait\n+   |\n+help: you might have meant to write a const parameter here\n+   |\n+LL | impl<T, const N: usize> From<[T; N]> for VecWrapper<T>\n+   |         +++++\n+\n+error[E0423]: expected value, found type parameter `N`\n+  --> $DIR/incorrect-const-param.rs:20:24\n+   |\n+LL | impl<T, N: usize> From<[T; N]> for VecWrapper<T>\n+   |         - found this type parameter\n+...\n+LL |     fn from(slice: [T; N]) -> Self {\n+   |                        ^ not a value\n+\n+error[E0423]: expected value, found type parameter `N`\n+  --> $DIR/incorrect-const-param.rs:36:21\n+   |\n+LL | impl<T, N> From<[T; N]> for VecWrapper<T>\n+   |         -           ^ not a value\n+   |         |\n+   |         found this type parameter\n+   |\n+help: you might have meant to write a const parameter here\n+   |\n+LL | impl<T, const N: /* Type */> From<[T; N]> for VecWrapper<T>\n+   |         +++++  ++++++++++++\n+\n+error[E0423]: expected value, found type parameter `N`\n+  --> $DIR/incorrect-const-param.rs:40:24\n+   |\n+LL | impl<T, N> From<[T; N]> for VecWrapper<T>\n+   |         - found this type parameter\n+...\n+LL |     fn from(slice: [T; N]) -> Self {\n+   |                        ^ not a value\n+   |\n+help: you might have meant to write a const parameter here\n+   |\n+LL | impl<T, const N: /* Type */> From<[T; N]> for VecWrapper<T>\n+   |         +++++  ++++++++++++\n+\n+error: aborting due to 6 previous errors\n+\n+Some errors have detailed explanations: E0404, E0423.\n+For more information about an error, try `rustc --explain E0404`."}, {"role": "assistant", "content": "fix(parser): recover from missing type in const generic params"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../src/backend/views/Highlighter/index.js                    | 11 +++++------\n 1 file changed, 5 insertions(+), 6 deletions(-)\n\ndiff --git a/packages/react-devtools-shared/src/backend/views/Highlighter/index.js b/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\nindex 34a81f3..f1711e0 100644\n--- a/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\n+++ b/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\n@@ -202,13 +202,12 @@ export default function setupHighlighter(\n           typeof node.getClientRects === 'function'\n             ? node.getClientRects()\n             : [];\n-        // If this is currently display: none, then try another node.\n-        // This can happen when one of the host instances is a hoistable.\n         if (\n-          nodeRects.length > 0 &&\n-          (nodeRects.length > 2 ||\n-            nodeRects[0].width > 0 ||\n-            nodeRects[0].height > 0)\n+          typeof node.getClientRects === 'undefined' || // If Host doesn't implement getClientRects, try to show the overlay.\n+          (nodeRects.length > 0 && //                      If this is currently display: none, then try another node.\n+            (nodeRects.length > 2 || //                    This can happen when one of the host instances is a hoistable.\n+              nodeRects[0].width > 0 ||\n+              nodeRects[0].height > 0))\n         ) {\n           // $FlowFixMe[method-unbinding]\n           if (scrollIntoView && typeof node.scrollIntoView === 'function') {"}, {"role": "assistant", "content": "fix(devtools): handle hosts without getClientRects in highlighter"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n vscode-ng-language-service/server/src/session.ts | 19 ++++++++++++++++++-\n 1 file changed, 18 insertions(+), 1 deletion(-)\n\ndiff --git a/vscode-ng-language-service/server/src/session.ts b/vscode-ng-language-service/server/src/session.ts\nindex 780aca77..20282200 100644\n--- a/vscode-ng-language-service/server/src/session.ts\n+++ b/vscode-ng-language-service/server/src/session.ts\n@@ -1403,7 +1403,24 @@ export class Session {\n       options,\n     );\n     if (!completions) {\n-      return null;\n+      const sf = this.getDefaultProjectForScriptInfo(scriptInfo)?.getSourceFile(scriptInfo.path);\n+      if (!sf) {\n+        return null;\n+      }\n+      const node = getTokenAtPosition(sf, offset);\n+      if (!isInlineStyleNode(node)) {\n+        return null;\n+      }\n+      const virtualScssDocContents = getSCSSVirtualContent(sf);\n+      const virtualScssDoc = TextDocument.create(\n+        params.textDocument.uri.toString(),\n+        'scss',\n+        0,\n+        virtualScssDocContents,\n+      );\n+      const stylesheet = scssLS.parseStylesheet(virtualScssDoc);\n+      const scssCompletions = scssLS.doComplete(virtualScssDoc, params.position, stylesheet);\n+      return scssCompletions.items;\n     }\n     return completions.entries.map((e) =>\n       tsCompletionEntryToLspCompletionItem(e, params.position, scriptInfo),"}, {"role": "assistant", "content": "feat(language-server): Add completions and hover info for inline styles"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commits format: type(scope): description\n\nValid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore\n\nRules:\n- Keep the subject line under 72 characters\n- Start description with lowercase\n- Do not end with a period\n- Be concise and specific\n\n .../server/src/embedded_support.ts                 |  2 +-\n vscode-ng-language-service/server/src/session.ts   | 33 ++++++++++++++++++++--\n 2 files changed, 32 insertions(+), 3 deletions(-)\n\ndiff --git a/vscode-ng-language-service/server/src/embedded_support.ts b/vscode-ng-language-service/server/src/embedded_support.ts\nindex 8f9b1891..1e14bec8 100644\n--- a/vscode-ng-language-service/server/src/embedded_support.ts\n+++ b/vscode-ng-language-service/server/src/embedded_support.ts\n@@ -69,7 +69,7 @@ export function getSCSSVirtualContent(sf: ts.SourceFile): string {\n   return content;\n }\n \n-function isInlineStyleNode(node: ts.Node) {\n+export function isInlineStyleNode(node: ts.Node) {\n   if (!ts.isStringLiteralLike(node)) {\n     return false;\n   }\ndiff --git a/vscode-ng-language-service/server/src/session.ts b/vscode-ng-language-service/server/src/session.ts\nindex cf1591a7..780aca77 100644\n--- a/vscode-ng-language-service/server/src/session.ts\n+++ b/vscode-ng-language-service/server/src/session.ts\n@@ -39,7 +39,7 @@ import {\n \n import {readNgCompletionData, tsCompletionEntryToLspCompletionItem} from './completion';\n import {tsDiagnosticToLspDiagnostic} from './diagnostic';\n-import {getHTMLVirtualContent, getSCSSVirtualContent} from './embedded_support';\n+import {getHTMLVirtualContent, getSCSSVirtualContent, isInlineStyleNode} from './embedded_support';\n import {ServerHost} from './server_host';\n import {documentationToMarkdown} from './text_render';\n import {\n@@ -1327,7 +1327,23 @@ export class Session {\n     const offset = lspPositionToTsPosition(scriptInfo, params.position);\n     const info = languageService.getQuickInfoAtPosition(scriptInfo.fileName, offset);\n     if (!info) {\n-      return null;\n+      const sf = this.getDefaultProjectForScriptInfo(scriptInfo)?.getSourceFile(scriptInfo.path);\n+      if (!sf) {\n+        return null;\n+      }\n+      const node = getTokenAtPosition(sf, offset);\n+      if (!isInlineStyleNode(node)) {\n+        return null;\n+      }\n+      const virtualScssDocContents = getSCSSVirtualContent(sf);\n+      const virtualScssDoc = TextDocument.create(\n+        params.textDocument.uri.toString(),\n+        'scss',\n+        0,\n+        virtualScssDocContents,\n+      );\n+      const stylesheet = scssLS.parseStylesheet(virtualScssDoc);\n+      return scssLS.doHover(virtualScssDoc, params.position, stylesheet);\n     }\n     const {kind, kindModifiers, textSpan, displayParts, documentation, tags} = info;\n     let desc = kindModifiers ? kindModifiers + ' ' : '';\n@@ -1668,3 +1684,16 @@ function generateCommandAndTextEditsFromCodeActions(\n     additionalTextEdits: additionalTextEdits.length ? additionalTextEdits : undefined,\n   };\n }\n+\n+function getTokenAtPosition(sourceFile: ts.SourceFile, position: number): ts.Node {\n+  let current: ts.Node = sourceFile;\n+  while (true) {\n+    const child = current\n+      .getChildren(sourceFile)\n+      .find((c) => c.getStart(sourceFile) <= position && c.getEnd() > position);\n+    if (!child || child.kind === ts.SyntaxKind.EndOfFileToken) {\n+      return current;\n+    }\n+    current = child;\n+  }\n+}"}, {"role": "assistant", "content": "feat(language-server): Add quick info for inline styles"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n tests/ui/const-generics/mgca/tuple_expr_arg_bad-issue-151048.rs   | 8 ++++++++\n .../ui/const-generics/mgca/tuple_expr_arg_bad-issue-151048.stderr | 8 ++++++++\n 2 files changed, 16 insertions(+)\n\ndiff --git a/tests/ui/const-generics/mgca/tuple_expr_arg_bad-issue-151048.rs b/tests/ui/const-generics/mgca/tuple_expr_arg_bad-issue-151048.rs\nnew file mode 100644\nindex 00000000000..4aecd30e86b\n--- /dev/null\n+++ b/tests/ui/const-generics/mgca/tuple_expr_arg_bad-issue-151048.rs\n@@ -0,0 +1,8 @@\n+#![feature(min_generic_const_args)]\n+#![expect(incomplete_features)]\n+\n+struct Y {\n+    stuff: [u8; { ([1, 2], 3, [4, 5]) }], //~ ERROR expected `usize`, found const tuple\n+}\n+\n+fn main() {}\ndiff --git a/tests/ui/const-generics/mgca/tuple_expr_arg_bad-issue-151048.stderr b/tests/ui/const-generics/mgca/tuple_expr_arg_bad-issue-151048.stderr\nnew file mode 100644\nindex 00000000000..468bf703d90\n--- /dev/null\n+++ b/tests/ui/const-generics/mgca/tuple_expr_arg_bad-issue-151048.stderr\n@@ -0,0 +1,8 @@\n+error: expected `usize`, found const tuple\n+  --> $DIR/tuple_expr_arg_bad-issue-151048.rs:5:19\n+   |\n+LL |     stuff: [u8; { ([1, 2], 3, [4, 5]) }],\n+   |                   ^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 1 previous error\n+"}, {"role": "assistant", "content": "test: add regression test for issue 151048"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n docs/en/data/topic_repos.yml | 442 +++++++++++++++++++++----------------------\n 1 file changed, 221 insertions(+), 221 deletions(-)\n\ndiff --git a/docs/en/data/topic_repos.yml b/docs/en/data/topic_repos.yml\nindex cb7e3c0..d089c7e 100644\n--- a/docs/en/data/topic_repos.yml\n+++ b/docs/en/data/topic_repos.yml\n@@ -1,495 +1,495 @@\n - name: full-stack-fastapi-template\n   html_url: https://github.com/fastapi/full-stack-fastapi-template\n-  stars: 39475\n+  stars: 40334\n   owner_login: fastapi\n   owner_html_url: https://github.com/fastapi\n - name: Hello-Python\n   html_url: https://github.com/mouredev/Hello-Python\n-  stars: 33090\n+  stars: 33628\n   owner_login: mouredev\n   owner_html_url: https://github.com/mouredev\n - name: serve\n   html_url: https://github.com/jina-ai/serve\n-  stars: 21798\n+  stars: 21817\n   owner_login: jina-ai\n   owner_html_url: https://github.com/jina-ai\n - name: HivisionIDPhotos\n   html_url: https://github.com/Zeyi-Lin/HivisionIDPhotos\n-  stars: 20258\n+  stars: 20409\n   owner_login: Zeyi-Lin\n   owner_html_url: https://github.com/Zeyi-Lin\n - name: sqlmodel\n   html_url: https://github.com/fastapi/sqlmodel\n-  stars: 17212\n+  stars: 17415\n   owner_login: fastapi\n   owner_html_url: https://github.com/fastapi\n-- name: Douyin_TikTok_Download_API\n-  html_url: https://github.com/Evil0ctal/Douyin_TikTok_Download_API\n-  stars: 15145\n-  owner_login: Evil0ctal\n-  owner_html_url: https://github.com/Evil0ctal\n - name: fastapi-best-practices\n   html_url: https://github.com/zhanymkanov/fastapi-best-practices\n-  stars: 14644\n+  stars: 15776\n   owner_login: zhanymkanov\n   owner_html_url: https://github.com/zhanymkanov\n+- name: Douyin_TikTok_Download_API\n+  html_url: https://github.com/Evil0ctal/Douyin_TikTok_Download_API\n+  stars: 15588\n+  owner_login: Evil0ctal\n+  owner_html_url: https://github.com/Evil0ctal\n - name: machine-learning-zoomcamp\n   html_url: https://github.com/DataTalksClub/machine-learning-zoomcamp\n-  stars: 12320\n+  stars: 12447\n   owner_login: DataTalksClub\n   owner_html_url: https://github.com/DataTalksClub\n-- name: fastapi_mcp\n-  html_url: https://github.com/tadata-org/fastapi_mcp\n-  stars: 11174\n-  owner_login: tadata-org\n-  owner_html_url: https://github.com/tadata-org\n - name: SurfSense\n   html_url: https://github.com/MODSetter/SurfSense\n-  stars: 10858\n+  stars: 12128\n   owner_login: MODSetter\n   owner_html_url: https://github.com/MODSetter\n+- name: fastapi_mcp\n+  html_url: https://github.com/tadata-org/fastapi_mcp\n+  stars: 11326\n+  owner_login: tadata-org\n+  owner_html_url: https://github.com/tadata-org\n - name: awesome-fastapi\n   html_url: https://github.com/mjhea0/awesome-fastapi\n-  stars: 10758\n+  stars: 10901\n   owner_login: mjhea0\n   owner_html_url: https://github.com/mjhea0\n - name: XHS-Downloader\n   html_url: https://github.com/JoeanAmier/XHS-Downloader\n-  stars: 9313\n+  stars: 9584\n   owner_login: JoeanAmier\n   owner_html_url: https://github.com/JoeanAmier\n-- name: FastUI\n-  html_url: https://github.com/pydantic/FastUI\n-  stars: 8915\n-  owner_login: pydantic\n-  owner_html_url: https://github.com/pydantic\n - name: polar\n   html_url: https://github.com/polarsource/polar\n-  stars: 8339\n+  stars: 8951\n   owner_login: polarsource\n   owner_html_url: https://github.com/polarsource\n+- name: FastUI\n+  html_url: https://github.com/pydantic/FastUI\n+  stars: 8934\n+  owner_login: pydantic\n+  owner_html_url: https://github.com/pydantic\n - name: FileCodeBox\n   html_url: https://github.com/vastsa/FileCodeBox\n-  stars: 7721\n+  stars: 7934\n   owner_login: vastsa\n   owner_html_url: https://github.com/vastsa\n - name: nonebot2\n   html_url: https://github.com/nonebot/nonebot2\n-  stars: 7170\n+  stars: 7248\n   owner_login: nonebot\n   owner_html_url: https://github.com/nonebot\n - name: hatchet\n   html_url: https://github.com/hatchet-dev/hatchet\n-  stars: 6253\n+  stars: 6392\n   owner_login: hatchet-dev\n   owner_html_url: https://github.com/hatchet-dev\n - name: fastapi-users\n   html_url: https://github.com/fastapi-users/fastapi-users\n-  stars: 5849\n+  stars: 5899\n   owner_login: fastapi-users\n   owner_html_url: https://github.com/fastapi-users\n - name: serge\n   html_url: https://github.com/serge-chat/serge\n-  stars: 5756\n+  stars: 5754\n   owner_login: serge-chat\n   owner_html_url: https://github.com/serge-chat\n - name: strawberry\n   html_url: https://github.com/strawberry-graphql/strawberry\n-  stars: 4569\n+  stars: 4577\n   owner_login: strawberry-graphql\n   owner_html_url: https://github.com/strawberry-graphql\n-- name: chatgpt-web-share\n-  html_url: https://github.com/chatpire/chatgpt-web-share\n-  stars: 4294\n-  owner_login: chatpire\n-  owner_html_url: https://github.com/chatpire\n - name: poem\n   html_url: https://github.com/poem-web/poem\n-  stars: 4276\n+  stars: 4303\n   owner_login: poem-web\n   owner_html_url: https://github.com/poem-web\n+- name: chatgpt-web-share\n+  html_url: https://github.com/chatpire/chatgpt-web-share\n+  stars: 4287\n+  owner_login: chatpire\n+  owner_html_url: https://github.com/chatpire\n - name: dynaconf\n   html_url: https://github.com/dynaconf/dynaconf\n-  stars: 4202\n+  stars: 4221\n   owner_login: dynaconf\n   owner_html_url: https://github.com/dynaconf\n-- name: atrilabs-engine\n-  html_url: https://github.com/Atri-Labs/atrilabs-engine\n-  stars: 4093\n-  owner_login: Atri-Labs\n-  owner_html_url: https://github.com/Atri-Labs\n - name: Kokoro-FastAPI\n   html_url: https://github.com/remsky/Kokoro-FastAPI\n-  stars: 4019\n+  stars: 4181\n   owner_login: remsky\n   owner_html_url: https://github.com/remsky\n+- name: atrilabs-engine\n+  html_url: https://github.com/Atri-Labs/atrilabs-engine\n+  stars: 4090\n+  owner_login: Atri-Labs\n+  owner_html_url: https://github.com/Atri-Labs\n+- name: devpush\n+  html_url: https://github.com/hunvreus/devpush\n+  stars: 4037\n+  owner_login: hunvreus\n+  owner_html_url: https://github.com/hunvreus\n - name: logfire\n   html_url: https://github.com/pydantic/logfire\n-  stars: 3805\n+  stars: 3896\n   owner_login: pydantic\n   owner_html_url: https://github.com/pydantic\n - name: LitServe\n   html_url: https://github.com/Lightning-AI/LitServe\n-  stars: 3719\n+  stars: 3756\n   owner_login: Lightning-AI\n   owner_html_url: https://github.com/Lightning-AI\n-- name: fastapi-admin\n-  html_url: https://github.com/fastapi-admin/fastapi-admin\n-  stars: 3632\n-  owner_login: fastapi-admin\n-  owner_html_url: https://github.com/fastapi-admin\n-- name: datamodel-code-generator\n-  html_url: https://github.com/koxudaxi/datamodel-code-generator\n-  stars: 3609\n-  owner_login: koxudaxi\n-  owner_html_url: https://github.com/koxudaxi\n - name: huma\n   html_url: https://github.com/danielgtaylor/huma\n-  stars: 3603\n+  stars: 3702\n   owner_login: danielgtaylor\n   owner_html_url: https://github.com/danielgtaylor\n+- name: Yuxi-Know\n+  html_url: https://github.com/xerrors/Yuxi-Know\n+  stars: 3680\n+  owner_login: xerrors\n+  owner_html_url: https://github.com/xerrors\n+- name: datamodel-code-generator\n+  html_url: https://github.com/koxudaxi/datamodel-code-generator\n+  stars: 3675\n+  owner_login: koxudaxi\n+  owner_html_url: https://github.com/koxudaxi\n+- name: fastapi-admin\n+  html_url: https://github.com/fastapi-admin/fastapi-admin\n+  stars: 3659\n+  owner_login: fastapi-admin\n+  owner_html_url: https://github.com/fastapi-admin\n - name: farfalle\n   html_url: https://github.com/rashadphz/farfalle\n-  stars: 3490\n+  stars: 3497\n   owner_login: rashadphz\n   owner_html_url: https://github.com/rashadphz\n - name: tracecat\n   html_url: https://github.com/TracecatHQ/tracecat\n-  stars: 3379\n+  stars: 3421\n   owner_login: TracecatHQ\n   owner_html_url: https://github.com/TracecatHQ\n - name: opyrator\n   html_url: https://github.com/ml-tooling/opyrator\n-  stars: 3135\n+  stars: 3136\n   owner_login: ml-tooling\n   owner_html_url: https://github.com/ml-tooling\n - name: docarray\n   html_url: https://github.com/docarray/docarray\n-  stars: 3114\n+  stars: 3111\n   owner_login: docarray\n   owner_html_url: https://github.com/docarray\n-- name: devpush\n-  html_url: https://github.com/hunvreus/devpush\n-  stars: 3097\n-  owner_login: hunvreus\n-  owner_html_url: https://github.com/hunvreus\n - name: fastapi-realworld-example-app\n   html_url: https://github.com/nsidnev/fastapi-realworld-example-app\n-  stars: 3050\n+  stars: 3051\n   owner_login: nsidnev\n   owner_html_url: https://github.com/nsidnev\n-- name: uvicorn-gunicorn-fastapi-docker\n-  html_url: https://github.com/tiangolo/uvicorn-gunicorn-fastapi-docker\n-  stars: 2911\n-  owner_login: tiangolo\n-  owner_html_url: https://github.com/tiangolo\n - name: mcp-context-forge\n   html_url: https://github.com/IBM/mcp-context-forge\n-  stars: 2899\n+  stars: 3034\n   owner_login: IBM\n   owner_html_url: https://github.com/IBM\n-- name: best-of-web-python\n-  html_url: https://github.com/ml-tooling/best-of-web-python\n-  stars: 2648\n-  owner_login: ml-tooling\n-  owner_html_url: https://github.com/ml-tooling\n+- name: uvicorn-gunicorn-fastapi-docker\n+  html_url: https://github.com/tiangolo/uvicorn-gunicorn-fastapi-docker\n+  stars: 2904\n+  owner_login: tiangolo\n+  owner_html_url: https://github.com/tiangolo\n - name: FastAPI-template\n   html_url: https://github.com/s3rius/FastAPI-template\n-  stars: 2637\n+  stars: 2680\n   owner_login: s3rius\n   owner_html_url: https://github.com/s3rius\n+- name: best-of-web-python\n+  html_url: https://github.com/ml-tooling/best-of-web-python\n+  stars: 2662\n+  owner_login: ml-tooling\n+  owner_html_url: https://github.com/ml-tooling\n - name: YC-Killer\n   html_url: https://github.com/sahibzada-allahyar/YC-Killer\n-  stars: 2599\n+  stars: 2614\n   owner_login: sahibzada-allahyar\n   owner_html_url: https://github.com/sahibzada-allahyar\n-- name: fastapi-react\n-  html_url: https://github.com/Buuntu/fastapi-react\n-  stars: 2569\n-  owner_login: Buuntu\n-  owner_html_url: https://github.com/Buuntu\n-- name: Yuxi-Know\n-  html_url: https://github.com/xerrors/Yuxi-Know\n-  stars: 2563\n-  owner_login: xerrors\n-  owner_html_url: https://github.com/xerrors\n - name: sqladmin\n   html_url: https://github.com/aminalaee/sqladmin\n-  stars: 2558\n+  stars: 2587\n   owner_login: aminalaee\n   owner_html_url: https://github.com/aminalaee\n+- name: fastapi-react\n+  html_url: https://github.com/Buuntu/fastapi-react\n+  stars: 2566\n+  owner_login: Buuntu\n+  owner_html_url: https://github.com/Buuntu\n - name: RasaGPT\n   html_url: https://github.com/paulpierre/RasaGPT\n-  stars: 2451\n+  stars: 2456\n   owner_login: paulpierre\n   owner_html_url: https://github.com/paulpierre\n - name: supabase-py\n   html_url: https://github.com/supabase/supabase-py\n-  stars: 2344\n+  stars: 2394\n   owner_login: supabase\n   owner_html_url: https://github.com/supabase\n - name: nextpy\n   html_url: https://github.com/dot-agent/nextpy\n-  stars: 2335\n+  stars: 2338\n   owner_login: dot-agent\n   owner_html_url: https://github.com/dot-agent\n - name: fastapi-utils\n   html_url: https://github.com/fastapiutils/fastapi-utils\n-  stars: 2291\n+  stars: 2289\n   owner_login: fastapiutils\n   owner_html_url: https://github.com/fastapiutils\n-- name: 30-Days-of-Python\n-  html_url: https://github.com/codingforentrepreneurs/30-Days-of-Python\n-  stars: 2220\n-  owner_login: codingforentrepreneurs\n-  owner_html_url: https://github.com/codingforentrepreneurs\n - name: langserve\n   html_url: https://github.com/langchain-ai/langserve\n-  stars: 2215\n+  stars: 2234\n   owner_login: langchain-ai\n   owner_html_url: https://github.com/langchain-ai\n+- name: 30-Days-of-Python\n+  html_url: https://github.com/codingforentrepreneurs/30-Days-of-Python\n+  stars: 2232\n+  owner_login: codingforentrepreneurs\n+  owner_html_url: https://github.com/codingforentrepreneurs\n - name: solara\n   html_url: https://github.com/widgetti/solara\n-  stars: 2122\n+  stars: 2141\n   owner_login: widgetti\n   owner_html_url: https://github.com/widgetti\n - name: mangum\n   html_url: https://github.com/Kludex/mangum\n-  stars: 2029\n+  stars: 2046\n   owner_login: Kludex\n   owner_html_url: https://github.com/Kludex\n+- name: fastapi_best_architecture\n+  html_url: https://github.com/fastapi-practices/fastapi_best_architecture\n+  stars: 1963\n+  owner_login: fastapi-practices\n+  owner_html_url: https://github.com/fastapi-practices\n+- name: NoteDiscovery\n+  html_url: https://github.com/gamosoft/NoteDiscovery\n+  stars: 1943\n+  owner_login: gamosoft\n+  owner_html_url: https://github.com/gamosoft\n - name: agentkit\n   html_url: https://github.com/BCG-X-Official/agentkit\n-  stars: 1912\n+  stars: 1936\n   owner_login: BCG-X-Official\n   owner_html_url: https://github.com/BCG-X-Official\n+- name: vue-fastapi-admin\n+  html_url: https://github.com/mizhexiaoxiao/vue-fastapi-admin\n+  stars: 1909\n+  owner_login: mizhexiaoxiao\n+  owner_html_url: https://github.com/mizhexiaoxiao\n - name: manage-fastapi\n   html_url: https://github.com/ycd/manage-fastapi\n-  stars: 1885\n+  stars: 1887\n   owner_login: ycd\n   owner_html_url: https://github.com/ycd\n - name: openapi-python-client\n   html_url: https://github.com/openapi-generators/openapi-python-client\n-  stars: 1862\n+  stars: 1879\n   owner_login: openapi-generators\n   owner_html_url: https://github.com/openapi-generators\n+- name: slowapi\n+  html_url: https://github.com/laurentS/slowapi\n+  stars: 1845\n+  owner_login: laurentS\n+  owner_html_url: https://github.com/laurentS\n - name: piccolo\n   html_url: https://github.com/piccolo-orm/piccolo\n-  stars: 1836\n+  stars: 1843\n   owner_login: piccolo-orm\n   owner_html_url: https://github.com/piccolo-orm\n-- name: vue-fastapi-admin\n-  html_url: https://github.com/mizhexiaoxiao/vue-fastapi-admin\n-  stars: 1831\n-  owner_login: mizhexiaoxiao\n-  owner_html_url: https://github.com/mizhexiaoxiao\n - name: python-week-2022\n   html_url: https://github.com/rochacbruno/python-week-2022\n-  stars: 1817\n+  stars: 1813\n   owner_login: rochacbruno\n   owner_html_url: https://github.com/rochacbruno\n-- name: slowapi\n-  html_url: https://github.com/laurentS/slowapi\n-  stars: 1798\n-  owner_login: laurentS\n-  owner_html_url: https://github.com/laurentS\n - name: fastapi-cache\n   html_url: https://github.com/long2ice/fastapi-cache\n-  stars: 1789\n+  stars: 1805\n   owner_login: long2ice\n   owner_html_url: https://github.com/long2ice\n - name: ormar\n   html_url: https://github.com/collerek/ormar\n-  stars: 1783\n+  stars: 1785\n   owner_login: collerek\n   owner_html_url: https://github.com/collerek\n-- name: termpair\n-  html_url: https://github.com/cs01/termpair\n-  stars: 1716\n-  owner_login: cs01\n-  owner_html_url: https://github.com/cs01\n-- name: FastAPI-boilerplate\n-  html_url: https://github.com/benavlabs/FastAPI-boilerplate\n-  stars: 1660\n-  owner_login: benavlabs\n-  owner_html_url: https://github.com/benavlabs\n - name: fastapi-langgraph-agent-production-ready-template\n   html_url: https://github.com/wassim249/fastapi-langgraph-agent-production-ready-template\n-  stars: 1638\n+  stars: 1780\n   owner_login: wassim249\n   owner_html_url: https://github.com/wassim249\n+- name: FastAPI-boilerplate\n+  html_url: https://github.com/benavlabs/FastAPI-boilerplate\n+  stars: 1734\n+  owner_login: benavlabs\n+  owner_html_url: https://github.com/benavlabs\n+- name: termpair\n+  html_url: https://github.com/cs01/termpair\n+  stars: 1724\n+  owner_login: cs01\n+  owner_html_url: https://github.com/cs01\n+- name: fastapi-crudrouter\n+  html_url: https://github.com/awtkns/fastapi-crudrouter\n+  stars: 1671\n+  owner_login: awtkns\n+  owner_html_url: https://github.com/awtkns\n - name: langchain-serve\n   html_url: https://github.com/jina-ai/langchain-serve\n-  stars: 1635\n+  stars: 1633\n   owner_login: jina-ai\n   owner_html_url: https://github.com/jina-ai\n-- name: awesome-fastapi-projects\n-  html_url: https://github.com/Kludex/awesome-fastapi-projects\n-  stars: 1589\n-  owner_login: Kludex\n-  owner_html_url: https://github.com/Kludex\n - name: fastapi-pagination\n   html_url: https://github.com/uriyyo/fastapi-pagination\n-  stars: 1585\n+  stars: 1588\n   owner_login: uriyyo\n   owner_html_url: https://github.com/uriyyo\n+- name: awesome-fastapi-projects\n+  html_url: https://github.com/Kludex/awesome-fastapi-projects\n+  stars: 1583\n+  owner_login: Kludex\n+  owner_html_url: https://github.com/Kludex\n - name: coronavirus-tracker-api\n   html_url: https://github.com/ExpDev07/coronavirus-tracker-api\n-  stars: 1574\n+  stars: 1571\n   owner_login: ExpDev07\n   owner_html_url: https://github.com/ExpDev07\n-- name: fastapi-crudrouter\n-  html_url: https://github.com/awtkns/fastapi-crudrouter\n-  stars: 1559\n-  owner_login: awtkns\n-  owner_html_url: https://github.com/awtkns\n - name: bracket\n   html_url: https://github.com/evroon/bracket\n-  stars: 1489\n+  stars: 1549\n   owner_login: evroon\n   owner_html_url: https://github.com/evroon\n - name: fastapi-amis-admin\n   html_url: https://github.com/amisadmin/fastapi-amis-admin\n-  stars: 1475\n+  stars: 1491\n   owner_login: amisadmin\n   owner_html_url: https://github.com/amisadmin\n - name: fastapi-boilerplate\n   html_url: https://github.com/teamhide/fastapi-boilerplate\n-  stars: 1436\n+  stars: 1452\n   owner_login: teamhide\n   owner_html_url: https://github.com/teamhide\n-- name: awesome-python-resources\n-  html_url: https://github.com/DjangoEx/awesome-python-resources\n-  stars: 1426\n-  owner_login: DjangoEx\n-  owner_html_url: https://github.com/DjangoEx\n - name: fastcrud\n   html_url: https://github.com/benavlabs/fastcrud\n-  stars: 1414\n+  stars: 1452\n   owner_login: benavlabs\n   owner_html_url: https://github.com/benavlabs\n+- name: awesome-python-resources\n+  html_url: https://github.com/DjangoEx/awesome-python-resources\n+  stars: 1430\n+  owner_login: DjangoEx\n+  owner_html_url: https://github.com/DjangoEx\n - name: prometheus-fastapi-instrumentator\n   html_url: https://github.com/trallnag/prometheus-fastapi-instrumentator\n-  stars: 1388\n+  stars: 1399\n   owner_login: trallnag\n   owner_html_url: https://github.com/trallnag\n-- name: fastapi_best_architecture\n-  html_url: https://github.com/fastapi-practices/fastapi_best_architecture\n-  stars: 1378\n-  owner_login: fastapi-practices\n-  owner_html_url: https://github.com/fastapi-practices\n - name: fastapi-code-generator\n   html_url: https://github.com/koxudaxi/fastapi-code-generator\n-  stars: 1375\n+  stars: 1371\n   owner_login: koxudaxi\n   owner_html_url: https://github.com/koxudaxi\n+- name: fastapi-tutorial\n+  html_url: https://github.com/liaogx/fastapi-tutorial\n+  stars: 1346\n+  owner_login: liaogx\n+  owner_html_url: https://github.com/liaogx\n - name: budgetml\n   html_url: https://github.com/ebhy/budgetml\n   stars: 1345\n   owner_login: ebhy\n   owner_html_url: https://github.com/ebhy\n-- name: fastapi-tutorial\n-  html_url: https://github.com/liaogx/fastapi-tutorial\n-  stars: 1327\n-  owner_login: liaogx\n-  owner_html_url: https://github.com/liaogx\n-- name: fastapi-alembic-sqlmodel-async\n-  html_url: https://github.com/jonra1993/fastapi-alembic-sqlmodel-async\n-  stars: 1259\n-  owner_login: jonra1993\n-  owner_html_url: https://github.com/jonra1993\n - name: fastapi-scaff\n   html_url: https://github.com/atpuxiner/fastapi-scaff\n-  stars: 1255\n+  stars: 1331\n   owner_login: atpuxiner\n   owner_html_url: https://github.com/atpuxiner\n-- name: bedrock-chat\n-  html_url: https://github.com/aws-samples/bedrock-chat\n-  stars: 1254\n-  owner_login: aws-samples\n-  owner_html_url: https://github.com/aws-samples\n - name: bolt-python\n   html_url: https://github.com/slackapi/bolt-python\n-  stars: 1253\n+  stars: 1266\n   owner_login: slackapi\n   owner_html_url: https://github.com/slackapi\n+- name: bedrock-chat\n+  html_url: https://github.com/aws-samples/bedrock-chat\n+  stars: 1266\n+  owner_login: aws-samples\n+  owner_html_url: https://github.com/aws-samples\n+- name: fastapi-alembic-sqlmodel-async\n+  html_url: https://github.com/jonra1993/fastapi-alembic-sqlmodel-async\n+  stars: 1260\n+  owner_login: jonra1993\n+  owner_html_url: https://github.com/jonra1993\n - name: fastapi_production_template\n   html_url: https://github.com/zhanymkanov/fastapi_production_template\n-  stars: 1217\n+  stars: 1222\n   owner_login: zhanymkanov\n   owner_html_url: https://github.com/zhanymkanov\n - name: langchain-extract\n   html_url: https://github.com/langchain-ai/langchain-extract\n-  stars: 1176\n+  stars: 1179\n   owner_login: langchain-ai\n   owner_html_url: https://github.com/langchain-ai\n - name: restish\n   html_url: https://github.com/rest-sh/restish\n-  stars: 1140\n+  stars: 1152\n   owner_login: rest-sh\n   owner_html_url: https://github.com/rest-sh\n - name: odmantic\n   html_url: https://github.com/art049/odmantic\n-  stars: 1138\n+  stars: 1143\n   owner_login: art049\n   owner_html_url: https://github.com/art049\n - name: authx\n   html_url: https://github.com/yezz123/authx\n-  stars: 1119\n+  stars: 1128\n   owner_login: yezz123\n   owner_html_url: https://github.com/yezz123\n-- name: NoteDiscovery\n-  html_url: https://github.com/gamosoft/NoteDiscovery\n-  stars: 1107\n-  owner_login: gamosoft\n-  owner_html_url: https://github.com/gamosoft\n+- name: SAG\n+  html_url: https://github.com/Zleap-AI/SAG\n+  stars: 1104\n+  owner_login: Zleap-AI\n+  owner_html_url: https://github.com/Zleap-AI\n+- name: aktools\n+  html_url: https://github.com/akfamily/aktools\n+  stars: 1072\n+  owner_login: akfamily\n+  owner_html_url: https://github.com/akfamily\n+- name: RuoYi-Vue3-FastAPI\n+  html_url: https://github.com/insistence/RuoYi-Vue3-FastAPI\n+  stars: 1063\n+  owner_login: insistence\n+  owner_html_url: https://github.com/insistence\n - name: flock\n   html_url: https://github.com/Onelevenvy/flock\n-  stars: 1055\n+  stars: 1059\n   owner_login: Onelevenvy\n   owner_html_url: https://github.com/Onelevenvy\n - name: fastapi-observability\n   html_url: https://github.com/blueswen/fastapi-observability\n-  stars: 1038\n+  stars: 1046\n   owner_login: blueswen\n   owner_html_url: https://github.com/blueswen\n-- name: aktools\n-  html_url: https://github.com/akfamily/aktools\n-  stars: 1027\n-  owner_login: akfamily\n-  owner_html_url: https://github.com/akfamily\n-- name: RuoYi-Vue3-FastAPI\n-  html_url: https://github.com/insistence/RuoYi-Vue3-FastAPI\n+- name: enterprise-deep-research\n+  html_url: https://github.com/SalesforceAIResearch/enterprise-deep-research\n+  stars: 1019\n+  owner_login: SalesforceAIResearch\n+  owner_html_url: https://github.com/SalesforceAIResearch\n+- name: titiler\n+  html_url: https://github.com/developmentseed/titiler\n   stars: 1016\n-  owner_login: insistence\n-  owner_html_url: https://github.com/insistence\n+  owner_login: developmentseed\n+  owner_html_url: https://github.com/developmentseed\n+- name: every-pdf\n+  html_url: https://github.com/DDULDDUCK/every-pdf\n+  stars: 1004\n+  owner_login: DDULDDUCK\n+  owner_html_url: https://github.com/DDULDDUCK\n - name: autollm\n   html_url: https://github.com/viddexa/autollm\n-  stars: 1002\n+  stars: 1003\n   owner_login: viddexa\n   owner_html_url: https://github.com/viddexa\n-- name: titiler\n-  html_url: https://github.com/developmentseed/titiler\n-  stars: 999\n-  owner_login: developmentseed\n-  owner_html_url: https://github.com/developmentseed\n - name: lanarky\n   html_url: https://github.com/ajndkr/lanarky\n-  stars: 994\n+  stars: 996\n   owner_login: ajndkr\n   owner_html_url: https://github.com/ajndkr\n-- name: every-pdf\n-  html_url: https://github.com/DDULDDUCK/every-pdf\n-  stars: 985\n-  owner_login: DDULDDUCK\n-  owner_html_url: https://github.com/DDULDDUCK\n-- name: enterprise-deep-research\n-  html_url: https://github.com/SalesforceAIResearch/enterprise-deep-research\n-  stars: 973\n-  owner_login: SalesforceAIResearch\n-  owner_html_url: https://github.com/SalesforceAIResearch\n-- name: fastapi-mail\n-  html_url: https://github.com/sabuhish/fastapi-mail\n-  stars: 964\n-  owner_login: sabuhish\n-  owner_html_url: https://github.com/sabuhish"}, {"role": "assistant", "content": "docs: update topic repos star counts"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../__tests__/components/Suspense.spec.ts          | 36 ++++++++++++++++++++++\n packages/runtime-core/src/components/Suspense.ts   |  4 +--\n 2 files changed, 38 insertions(+), 2 deletions(-)\n\ndiff --git a/packages/runtime-core/__tests__/components/Suspense.spec.ts b/packages/runtime-core/__tests__/components/Suspense.spec.ts\nindex c6683d6..4e8da32 100644\n--- a/packages/runtime-core/__tests__/components/Suspense.spec.ts\n+++ b/packages/runtime-core/__tests__/components/Suspense.spec.ts\n@@ -24,6 +24,7 @@ import {\n   shallowRef,\n   watch,\n   watchEffect,\n+  withDirectives,\n } from '@vue/runtime-test'\n import { computed, createApp, defineComponent, inject, provide } from 'vue'\n import type { RawSlots } from 'packages/runtime-core/src/componentSlots'\n@@ -2358,5 +2359,40 @@ describe('Suspense', () => {\n         `<div>444</div><div>555</div><div>666</div>`,\n       )\n     })\n+\n+    test('should call unmounted directive once when fallback is replaced by resolved async component', async () => {\n+      const Comp = {\n+        render() {\n+          return h('div', null, 'comp')\n+        },\n+      }\n+      const Foo = defineAsyncComponent({\n+        render() {\n+          return h(Comp)\n+        },\n+      })\n+      const unmounted = vi.fn(el => {\n+        el.foo = null\n+      })\n+      const vDir = {\n+        unmounted,\n+      }\n+      const App = {\n+        setup() {\n+          return () => {\n+            return h(Suspense, null, {\n+              fallback: () => withDirectives(h('div'), [[vDir, true]]),\n+              default: () => h(Foo),\n+            })\n+          }\n+        },\n+      }\n+      const root = nodeOps.createElement('div')\n+      render(h(App), root)\n+\n+      await Promise.all(deps)\n+      await nextTick()\n+      expect(unmounted).toHaveBeenCalledTimes(1)\n+    })\n   })\n })\ndiff --git a/packages/runtime-core/src/components/Suspense.ts b/packages/runtime-core/src/components/Suspense.ts\nindex d14e96b..0c8b6c2 100644\n--- a/packages/runtime-core/src/components/Suspense.ts\n+++ b/packages/runtime-core/src/components/Suspense.ts\n@@ -20,6 +20,7 @@ import {\n   type RendererInternals,\n   type RendererNode,\n   type SetupRenderEffectFn,\n+  queuePostRenderEffect,\n } from '../renderer'\n import { queuePostFlushCb } from '../scheduler'\n import { filterSingleRoot, updateHOCHostEl } from '../componentRenderUtils'\n@@ -576,9 +577,8 @@ function createSuspenseBoundary(\n           }\n           unmount(activeBranch, parentComponent, suspense, true)\n           // clear el reference from fallback vnode to allow GC\n-          // only clear immediately if there's no delayed transition\n           if (!delayEnter && isInFallback && vnode.ssFallback) {\n-            vnode.ssFallback.el = null\n+            queuePostRenderEffect(() => (vnode.ssFallback!.el = null), suspense)\n           }\n         }\n         if (!delayEnter) {"}, {"role": "assistant", "content": "fix(suspense): defer fallback el cleanup to avoid duplicate directive"}]}
{"messages": [{"role": "user", "content": "Generate a conventional commit message for the following git diff.\n\nFollow the conventional commit format: type(scope): description\n\nTypes: feat, fix, docs, style, refactor, test, chore, ci, build, perf\n\nRules:\n- Use lowercase for description\n- Use imperative mood (add, fix, update)\n- No period at end\n- Keep under 72 characters\n\n .../__tests__/ssrFallthroughAttrs.spec.ts          | 25 ++++++++++++++++++++++\n .../src/transforms/ssrInjectFallthroughAttrs.ts    |  3 ++-\n 2 files changed, 27 insertions(+), 1 deletion(-)\n\ndiff --git a/packages/compiler-ssr/__tests__/ssrFallthroughAttrs.spec.ts b/packages/compiler-ssr/__tests__/ssrFallthroughAttrs.spec.ts\nindex 7b3d196..3adfe64 100644\n--- a/packages/compiler-ssr/__tests__/ssrFallthroughAttrs.spec.ts\n+++ b/packages/compiler-ssr/__tests__/ssrFallthroughAttrs.spec.ts\n@@ -48,6 +48,31 @@ describe('ssr: attrs fallthrough', () => {\n       `)\n   })\n \n+  //#8072\n+  test(`fallthrough component content (with whitespace: 'preserve')`, () => {\n+    expect(\n+      compile(\n+        `\n+      <a v-if=\"to\">Foo</a>\n+      <a v-else>Bar</a>\n+    `,\n+        {\n+          whitespace: 'preserve',\n+        },\n+      ).code,\n+    ).toMatchInlineSnapshot(`\n+        \"const { ssrRenderAttrs: _ssrRenderAttrs } = require(\"vue/server-renderer\")\n+\n+        return function ssrRender(_ctx, _push, _parent, _attrs) {\n+          if (_ctx.to) {\n+            _push(\\`<a\\${_ssrRenderAttrs(_attrs)}>Foo</a>\\`)\n+          } else {\n+            _push(\\`<a\\${_ssrRenderAttrs(_attrs)}>Bar</a>\\`)\n+          }\n+        }\"\n+      `)\n+  })\n+\n   test('should not inject to fallthrough component content if not root', () => {\n     expect(compile(`<div/><transition><div/></transition>`).code)\n       .toMatchInlineSnapshot(`\ndiff --git a/packages/compiler-ssr/src/transforms/ssrInjectFallthroughAttrs.ts b/packages/compiler-ssr/src/transforms/ssrInjectFallthroughAttrs.ts\nindex b1aac0d..580e79c 100644\n--- a/packages/compiler-ssr/src/transforms/ssrInjectFallthroughAttrs.ts\n+++ b/packages/compiler-ssr/src/transforms/ssrInjectFallthroughAttrs.ts\n@@ -7,11 +7,12 @@ import {\n   type TemplateChildNode,\n   createSimpleExpression,\n   findDir,\n+  isCommentOrWhitespace,\n   locStub,\n } from '@vue/compiler-dom'\n \n const filterChild = (node: ParentNode) =>\n-  node.children.filter(n => n.type !== NodeTypes.COMMENT)\n+  node.children.filter(n => !isCommentOrWhitespace(n))\n \n const hasSingleChild = (node: ParentNode): boolean =>\n   filterChild(node).length === 1"}, {"role": "assistant", "content": "fix(compiler-ssr): handle whitespace in fallthrough attrs detection"}]}
